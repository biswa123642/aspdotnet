---
ID: "1327d00f-4216-4d22-99c8-8f64db31b07a"
Parent: "a128db73-5665-48cc-aec4-6f9ad6d1486a"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Themes/OneWeb/Default/SXA Base Theme/scripts/xaquery
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/1327D00F42164D2299C88F64DB31B07A.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "27913833-0a39-47d5-9f20-17c0533f216d"
  Value: d2luZG93LiR4YSA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgeGFKcXVlcnksIHhhSnF1ZXJ5VUk7DQogICAgLyohIGpRdWVyeSB2My41LjEgfCAoYykgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIHwganF1ZXJ5Lm9yZy9saWNlbnNlICovDQogICAgIWZ1bmN0aW9uIChlLCB0KSB7ICJ1c2Ugc3RyaWN0IjsgIm9iamVjdCIgPT0gdHlwZW9mIG1vZHVsZSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPyBtb2R1bGUuZXhwb3J0cyA9IGUuZG9jdW1lbnQgPyB0KGUsICEwKSA6IGZ1bmN0aW9uIChlKSB7IGlmICghZS5kb2N1bWVudCkgdGhyb3cgbmV3IEVycm9yKCJqUXVlcnkgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50Iik7IHJldHVybiB0KGUpIH0gOiB0KGUpIH0oInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uIChDLCBlKSB7ICJ1c2Ugc3RyaWN0IjsgdmFyIHQgPSBbXSwgciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwgcyA9IHQuc2xpY2UsIGcgPSB0LmZsYXQgPyBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5mbGF0LmNhbGwoZSkgfSA6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0LmNvbmNhdC5hcHBseShbXSwgZSkgfSwgdSA9IHQucHVzaCwgaSA9IHQuaW5kZXhPZiwgbiA9IHt9LCBvID0gbi50b1N0cmluZywgdiA9IG4uaGFzT3duUHJvcGVydHksIGEgPSB2LnRvU3RyaW5nLCBsID0gYS5jYWxsKE9iamVjdCksIHkgPSB7fSwgbSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmICJudW1iZXIiICE9IHR5cGVvZiBlLm5vZGVUeXBlIH0sIHggPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbnVsbCAhPSBlICYmIGUgPT09IGUud2luZG93IH0sIEUgPSBDLmRvY3VtZW50LCBjID0geyB0eXBlOiAhMCwgc3JjOiAhMCwgbm9uY2U6ICEwLCBub01vZHVsZTogITAgfTsgZnVuY3Rpb24gYihlLCB0LCBuKSB7IHZhciByLCBpLCBvID0gKG4gPSBuIHx8IEUpLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOyBpZiAoby50ZXh0ID0gZSwgdCkgZm9yIChyIGluIGMpIChpID0gdFtyXSB8fCB0LmdldEF0dHJpYnV0ZSAmJiB0LmdldEF0dHJpYnV0ZShyKSkgJiYgby5zZXRBdHRyaWJ1dGUociwgaSk7IG4uaGVhZC5hcHBlbmRDaGlsZChvKS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG8pIH0gZnVuY3Rpb24gdyhlKSB7IHJldHVybiBudWxsID09IGUgPyBlICsgIiIgOiAib2JqZWN0IiA9PSB0eXBlb2YgZSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gbltvLmNhbGwoZSldIHx8ICJvYmplY3QiIDogdHlwZW9mIGUgfSB2YXIgZiA9ICIzLjUuMSIsIFMgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gbmV3IFMuZm4uaW5pdChlLCB0KSB9OyBmdW5jdGlvbiBwKGUpIHsgdmFyIHQgPSAhIWUgJiYgImxlbmd0aCIgaW4gZSAmJiBlLmxlbmd0aCwgbiA9IHcoZSk7IHJldHVybiAhbShlKSAmJiAheChlKSAmJiAoImFycmF5IiA9PT0gbiB8fCAwID09PSB0IHx8ICJudW1iZXIiID09IHR5cGVvZiB0ICYmIDAgPCB0ICYmIHQgLSAxIGluIGUpIH0gUy5mbiA9IFMucHJvdG90eXBlID0geyBqcXVlcnk6IGYsIGNvbnN0cnVjdG9yOiBTLCBsZW5ndGg6IDAsIHRvQXJyYXk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHMuY2FsbCh0aGlzKSB9LCBnZXQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBudWxsID09IGUgPyBzLmNhbGwodGhpcykgOiBlIDwgMCA/IHRoaXNbZSArIHRoaXMubGVuZ3RoXSA6IHRoaXNbZV0gfSwgcHVzaFN0YWNrOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IFMubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBlKTsgcmV0dXJuIHQucHJldk9iamVjdCA9IHRoaXMsIHQgfSwgZWFjaDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFMuZWFjaCh0aGlzLCBlKSB9LCBtYXA6IGZ1bmN0aW9uIChuKSB7IHJldHVybiB0aGlzLnB1c2hTdGFjayhTLm1hcCh0aGlzLCBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gbi5jYWxsKGUsIHQsIGUpIH0pKSB9LCBzbGljZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5wdXNoU3RhY2socy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB9LCBmaXJzdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5lcSgwKSB9LCBsYXN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmVxKC0xKSB9LCBldmVuOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnB1c2hTdGFjayhTLmdyZXAodGhpcywgZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICh0ICsgMSkgJSAyIH0pKSB9LCBvZGQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMucHVzaFN0YWNrKFMuZ3JlcCh0aGlzLCBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdCAlIDIgfSkpIH0sIGVxOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMubGVuZ3RoLCBuID0gK2UgKyAoZSA8IDAgPyB0IDogMCk7IHJldHVybiB0aGlzLnB1c2hTdGFjaygwIDw9IG4gJiYgbiA8IHQgPyBbdGhpc1tuXV0gOiBbXSkgfSwgZW5kOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcigpIH0sIHB1c2g6IHUsIHNvcnQ6IHQuc29ydCwgc3BsaWNlOiB0LnNwbGljZSB9LCBTLmV4dGVuZCA9IFMuZm4uZXh0ZW5kID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCwgbiwgciwgaSwgbywgYSA9IGFyZ3VtZW50c1swXSB8fCB7fSwgcyA9IDEsIHUgPSBhcmd1bWVudHMubGVuZ3RoLCBsID0gITE7IGZvciAoImJvb2xlYW4iID09IHR5cGVvZiBhICYmIChsID0gYSwgYSA9IGFyZ3VtZW50c1tzXSB8fCB7fSwgcysrKSwgIm9iamVjdCIgPT0gdHlwZW9mIGEgfHwgbShhKSB8fCAoYSA9IHt9KSwgcyA9PT0gdSAmJiAoYSA9IHRoaXMsIHMtLSk7IHMgPCB1OyBzKyspaWYgKG51bGwgIT0gKGUgPSBhcmd1bWVudHNbc10pKSBmb3IgKHQgaW4gZSkgciA9IGVbdF0sICJfX3Byb3RvX18iICE9PSB0ICYmIGEgIT09IHIgJiYgKGwgJiYgciAmJiAoUy5pc1BsYWluT2JqZWN0KHIpIHx8IChpID0gQXJyYXkuaXNBcnJheShyKSkpID8gKG4gPSBhW3RdLCBvID0gaSAmJiAhQXJyYXkuaXNBcnJheShuKSA/IFtdIDogaSB8fCBTLmlzUGxhaW5PYmplY3QobikgPyBuIDoge30sIGkgPSAhMSwgYVt0XSA9IFMuZXh0ZW5kKGwsIG8sIHIpKSA6IHZvaWQgMCAhPT0gciAmJiAoYVt0XSA9IHIpKTsgcmV0dXJuIGEgfSwgUy5leHRlbmQoeyBleHBhbmRvOiAialF1ZXJ5IiArIChmICsgTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywgIiIpLCBpc1JlYWR5OiAhMCwgZXJyb3I6IGZ1bmN0aW9uIChlKSB7IHRocm93IG5ldyBFcnJvcihlKSB9LCBub29wOiBmdW5jdGlvbiAoKSB7IH0sIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBuOyByZXR1cm4gISghZSB8fCAiW29iamVjdCBPYmplY3RdIiAhPT0gby5jYWxsKGUpKSAmJiAoISh0ID0gcihlKSkgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKG4gPSB2LmNhbGwodCwgImNvbnN0cnVjdG9yIikgJiYgdC5jb25zdHJ1Y3RvcikgJiYgYS5jYWxsKG4pID09PSBsKSB9LCBpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiAoZSkgeyB2YXIgdDsgZm9yICh0IGluIGUpIHJldHVybiAhMTsgcmV0dXJuICEwIH0sIGdsb2JhbEV2YWw6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IGIoZSwgeyBub25jZTogdCAmJiB0Lm5vbmNlIH0sIG4pIH0sIGVhY2g6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCByID0gMDsgaWYgKHAoZSkpIHsgZm9yIChuID0gZS5sZW5ndGg7IHIgPCBuOyByKyspaWYgKCExID09PSB0LmNhbGwoZVtyXSwgciwgZVtyXSkpIGJyZWFrIH0gZWxzZSBmb3IgKHIgaW4gZSkgaWYgKCExID09PSB0LmNhbGwoZVtyXSwgciwgZVtyXSkpIGJyZWFrOyByZXR1cm4gZSB9LCBtYWtlQXJyYXk6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gdCB8fCBbXTsgcmV0dXJuIG51bGwgIT0gZSAmJiAocChPYmplY3QoZSkpID8gUy5tZXJnZShuLCAic3RyaW5nIiA9PSB0eXBlb2YgZSA/IFtlXSA6IGUpIDogdS5jYWxsKG4sIGUpKSwgbiB9LCBpbkFycmF5OiBmdW5jdGlvbiAoZSwgdCwgbikgeyByZXR1cm4gbnVsbCA9PSB0ID8gLTEgOiBpLmNhbGwodCwgZSwgbikgfSwgbWVyZ2U6IGZ1bmN0aW9uIChlLCB0KSB7IGZvciAodmFyIG4gPSArdC5sZW5ndGgsIHIgPSAwLCBpID0gZS5sZW5ndGg7IHIgPCBuOyByKyspZVtpKytdID0gdFtyXTsgcmV0dXJuIGUubGVuZ3RoID0gaSwgZSB9LCBncmVwOiBmdW5jdGlvbiAoZSwgdCwgbikgeyBmb3IgKHZhciByID0gW10sIGkgPSAwLCBvID0gZS5sZW5ndGgsIGEgPSAhbjsgaSA8IG87IGkrKykhdChlW2ldLCBpKSAhPT0gYSAmJiByLnB1c2goZVtpXSk7IHJldHVybiByIH0sIG1hcDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8gPSAwLCBhID0gW107IGlmIChwKGUpKSBmb3IgKHIgPSBlLmxlbmd0aDsgbyA8IHI7IG8rKyludWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgYS5wdXNoKGkpOyBlbHNlIGZvciAobyBpbiBlKSBudWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgYS5wdXNoKGkpOyByZXR1cm4gZyhhKSB9LCBndWlkOiAxLCBzdXBwb3J0OiB5IH0pLCAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgKFMuZm5bU3ltYm9sLml0ZXJhdG9yXSA9IHRbU3ltYm9sLml0ZXJhdG9yXSksIFMuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciBTeW1ib2wiLnNwbGl0KCIgIiksIGZ1bmN0aW9uIChlLCB0KSB7IG5bIltvYmplY3QgIiArIHQgKyAiXSJdID0gdC50b0xvd2VyQ2FzZSgpIH0pOyB2YXIgZCA9IGZ1bmN0aW9uIChuKSB7IHZhciBlLCBkLCBiLCBvLCBpLCBoLCBmLCBnLCB3LCB1LCBsLCBULCBDLCBhLCBFLCB2LCBzLCBjLCB5LCBTID0gInNpenpsZSIgKyAxICogbmV3IERhdGUsIHAgPSBuLmRvY3VtZW50LCBrID0gMCwgciA9IDAsIG0gPSB1ZSgpLCB4ID0gdWUoKSwgQSA9IHVlKCksIE4gPSB1ZSgpLCBEID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIGUgPT09IHQgJiYgKGwgPSAhMCksIDAgfSwgaiA9IHt9Lmhhc093blByb3BlcnR5LCB0ID0gW10sIHEgPSB0LnBvcCwgTCA9IHQucHVzaCwgSCA9IHQucHVzaCwgTyA9IHQuc2xpY2UsIFAgPSBmdW5jdGlvbiAoZSwgdCkgeyBmb3IgKHZhciBuID0gMCwgciA9IGUubGVuZ3RoOyBuIDwgcjsgbisrKWlmIChlW25dID09PSB0KSByZXR1cm4gbjsgcmV0dXJuIC0xIH0sIFIgPSAiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLCBNID0gIltcXHgyMFxcdFxcclxcblxcZl0iLCBJID0gIig/OlxcXFxbXFxkYS1mQS1GXXsxLDZ9IiArIE0gKyAiP3xcXFxcW15cXHJcXG5cXGZdfFtcXHctXXxbXlwwLVxceDdmXSkrIiwgVyA9ICJcXFsiICsgTSArICIqKCIgKyBJICsgIikoPzoiICsgTSArICIqKFsqXiR8IX5dPz0pIiArIE0gKyAiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiICsgSSArICIpKXwpIiArIE0gKyAiKlxcXSIsIEYgPSAiOigiICsgSSArICIpKD86XFwoKCgnKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcIil8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIFcgKyAiKSopfC4qKVxcKXwpIiwgQiA9IG5ldyBSZWdFeHAoTSArICIrIiwgImciKSwgJCA9IG5ldyBSZWdFeHAoIl4iICsgTSArICIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiICsgTSArICIrJCIsICJnIiksIF8gPSBuZXcgUmVnRXhwKCJeIiArIE0gKyAiKiwiICsgTSArICIqIiksIHogPSBuZXcgUmVnRXhwKCJeIiArIE0gKyAiKihbPit+XXwiICsgTSArICIpIiArIE0gKyAiKiIpLCBVID0gbmV3IFJlZ0V4cChNICsgInw+IiksIFggPSBuZXcgUmVnRXhwKEYpLCBWID0gbmV3IFJlZ0V4cCgiXiIgKyBJICsgIiQiKSwgRyA9IHsgSUQ6IG5ldyBSZWdFeHAoIl4jKCIgKyBJICsgIikiKSwgQ0xBU1M6IG5ldyBSZWdFeHAoIl5cXC4oIiArIEkgKyAiKSIpLCBUQUc6IG5ldyBSZWdFeHAoIl4oIiArIEkgKyAifFsqXSkiKSwgQVRUUjogbmV3IFJlZ0V4cCgiXiIgKyBXKSwgUFNFVURPOiBuZXcgUmVnRXhwKCJeIiArIEYpLCBDSElMRDogbmV3IFJlZ0V4cCgiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIE0gKyAiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyBNICsgIiooPzooWystXXwpIiArIE0gKyAiKihcXGQrKXwpKSIgKyBNICsgIipcXCl8KSIsICJpIiksIGJvb2w6IG5ldyBSZWdFeHAoIl4oPzoiICsgUiArICIpJCIsICJpIiksIG5lZWRzQ29udGV4dDogbmV3IFJlZ0V4cCgiXiIgKyBNICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKyBNICsgIiooKD86LVxcZCk/XFxkKikiICsgTSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiKSB9LCBZID0gL0hUTUwkL2ksIFEgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLCBKID0gL15oXGQkL2ksIEsgPSAvXltee10rXHtccypcW25hdGl2ZSBcdy8sIFogPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLCBlZSA9IC9bK35dLywgdGUgPSBuZXcgUmVnRXhwKCJcXFxcW1xcZGEtZkEtRl17MSw2fSIgKyBNICsgIj98XFxcXChbXlxcclxcblxcZl0pIiwgImciKSwgbmUgPSBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiA9ICIweCIgKyBlLnNsaWNlKDEpIC0gNjU1MzY7IHJldHVybiB0IHx8IChuIDwgMCA/IFN0cmluZy5mcm9tQ2hhckNvZGUobiArIDY1NTM2KSA6IFN0cmluZy5mcm9tQ2hhckNvZGUobiA+PiAxMCB8IDU1Mjk2LCAxMDIzICYgbiB8IDU2MzIwKSkgfSwgcmUgPSAvKFtcMC1ceDFmXHg3Zl18Xi0/XGQpfF4tJHxbXlwwLVx4MWZceDdmLVx1RkZGRlx3LV0vZywgaWUgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdCA/ICJcMCIgPT09IGUgPyAiXHVmZmZkIiA6IGUuc2xpY2UoMCwgLTEpICsgIlxcIiArIGUuY2hhckNvZGVBdChlLmxlbmd0aCAtIDEpLnRvU3RyaW5nKDE2KSArICIgIiA6ICJcXCIgKyBlIH0sIG9lID0gZnVuY3Rpb24gKCkgeyBUKCkgfSwgYWUgPSBiZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gITAgPT09IGUuZGlzYWJsZWQgJiYgImZpZWxkc2V0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIH0sIHsgZGlyOiAicGFyZW50Tm9kZSIsIG5leHQ6ICJsZWdlbmQiIH0pOyB0cnkgeyBILmFwcGx5KHQgPSBPLmNhbGwocC5jaGlsZE5vZGVzKSwgcC5jaGlsZE5vZGVzKSwgdFtwLmNoaWxkTm9kZXMubGVuZ3RoXS5ub2RlVHlwZSB9IGNhdGNoIChlKSB7IEggPSB7IGFwcGx5OiB0Lmxlbmd0aCA/IGZ1bmN0aW9uIChlLCB0KSB7IEwuYXBwbHkoZSwgTy5jYWxsKHQpKSB9IDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4gPSBlLmxlbmd0aCwgciA9IDA7IHdoaWxlIChlW24rK10gPSB0W3IrK10pOyBlLmxlbmd0aCA9IG4gLSAxIH0gfSB9IGZ1bmN0aW9uIHNlKHQsIGUsIG4sIHIpIHsgdmFyIGksIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSBlICYmIGUub3duZXJEb2N1bWVudCwgcCA9IGUgPyBlLm5vZGVUeXBlIDogOTsgaWYgKG4gPSBuIHx8IFtdLCAic3RyaW5nIiAhPSB0eXBlb2YgdCB8fCAhdCB8fCAxICE9PSBwICYmIDkgIT09IHAgJiYgMTEgIT09IHApIHJldHVybiBuOyBpZiAoIXIgJiYgKFQoZSksIGUgPSBlIHx8IEMsIEUpKSB7IGlmICgxMSAhPT0gcCAmJiAodSA9IFouZXhlYyh0KSkpIGlmIChpID0gdVsxXSkgeyBpZiAoOSA9PT0gcCkgeyBpZiAoIShhID0gZS5nZXRFbGVtZW50QnlJZChpKSkpIHJldHVybiBuOyBpZiAoYS5pZCA9PT0gaSkgcmV0dXJuIG4ucHVzaChhKSwgbiB9IGVsc2UgaWYgKGYgJiYgKGEgPSBmLmdldEVsZW1lbnRCeUlkKGkpKSAmJiB5KGUsIGEpICYmIGEuaWQgPT09IGkpIHJldHVybiBuLnB1c2goYSksIG4gfSBlbHNlIHsgaWYgKHVbMl0pIHJldHVybiBILmFwcGx5KG4sIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodCkpLCBuOyBpZiAoKGkgPSB1WzNdKSAmJiBkLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSByZXR1cm4gSC5hcHBseShuLCBlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaSkpLCBuIH0gaWYgKGQucXNhICYmICFOW3QgKyAiICJdICYmICghdiB8fCAhdi50ZXN0KHQpKSAmJiAoMSAhPT0gcCB8fCAib2JqZWN0IiAhPT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSkgeyBpZiAoYyA9IHQsIGYgPSBlLCAxID09PSBwICYmIChVLnRlc3QodCkgfHwgei50ZXN0KHQpKSkgeyAoZiA9IGVlLnRlc3QodCkgJiYgeWUoZS5wYXJlbnROb2RlKSB8fCBlKSA9PT0gZSAmJiBkLnNjb3BlIHx8ICgocyA9IGUuZ2V0QXR0cmlidXRlKCJpZCIpKSA/IHMgPSBzLnJlcGxhY2UocmUsIGllKSA6IGUuc2V0QXR0cmlidXRlKCJpZCIsIHMgPSBTKSksIG8gPSAobCA9IGgodCkpLmxlbmd0aDsgd2hpbGUgKG8tLSkgbFtvXSA9IChzID8gIiMiICsgcyA6ICI6c2NvcGUiKSArICIgIiArIHhlKGxbb10pOyBjID0gbC5qb2luKCIsIikgfSB0cnkgeyByZXR1cm4gSC5hcHBseShuLCBmLnF1ZXJ5U2VsZWN0b3JBbGwoYykpLCBuIH0gY2F0Y2ggKGUpIHsgTih0LCAhMCkgfSBmaW5hbGx5IHsgcyA9PT0gUyAmJiBlLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKSB9IH0gfSByZXR1cm4gZyh0LnJlcGxhY2UoJCwgIiQxIiksIGUsIG4sIHIpIH0gZnVuY3Rpb24gdWUoKSB7IHZhciByID0gW107IHJldHVybiBmdW5jdGlvbiBlKHQsIG4pIHsgcmV0dXJuIHIucHVzaCh0ICsgIiAiKSA+IGIuY2FjaGVMZW5ndGggJiYgZGVsZXRlIGVbci5zaGlmdCgpXSwgZVt0ICsgIiAiXSA9IG4gfSB9IGZ1bmN0aW9uIGxlKGUpIHsgcmV0dXJuIGVbU10gPSAhMCwgZSB9IGZ1bmN0aW9uIGNlKGUpIHsgdmFyIHQgPSBDLmNyZWF0ZUVsZW1lbnQoImZpZWxkc2V0Iik7IHRyeSB7IHJldHVybiAhIWUodCkgfSBjYXRjaCAoZSkgeyByZXR1cm4gITEgfSBmaW5hbGx5IHsgdC5wYXJlbnROb2RlICYmIHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KSwgdCA9IG51bGwgfSB9IGZ1bmN0aW9uIGZlKGUsIHQpIHsgdmFyIG4gPSBlLnNwbGl0KCJ8IiksIHIgPSBuLmxlbmd0aDsgd2hpbGUgKHItLSkgYi5hdHRySGFuZGxlW25bcl1dID0gdCB9IGZ1bmN0aW9uIHBlKGUsIHQpIHsgdmFyIG4gPSB0ICYmIGUsIHIgPSBuICYmIDEgPT09IGUubm9kZVR5cGUgJiYgMSA9PT0gdC5ub2RlVHlwZSAmJiBlLnNvdXJjZUluZGV4IC0gdC5zb3VyY2VJbmRleDsgaWYgKHIpIHJldHVybiByOyBpZiAobikgd2hpbGUgKG4gPSBuLm5leHRTaWJsaW5nKSBpZiAobiA9PT0gdCkgcmV0dXJuIC0xOyByZXR1cm4gZSA/IDEgOiAtMSB9IGZ1bmN0aW9uIGRlKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiAiaW5wdXQiID09PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgJiYgZS50eXBlID09PSB0IH0gfSBmdW5jdGlvbiBoZShuKSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsgcmV0dXJuICgiaW5wdXQiID09PSB0IHx8ICJidXR0b24iID09PSB0KSAmJiBlLnR5cGUgPT09IG4gfSB9IGZ1bmN0aW9uIGdlKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiAiZm9ybSIgaW4gZSA/IGUucGFyZW50Tm9kZSAmJiAhMSA9PT0gZS5kaXNhYmxlZCA/ICJsYWJlbCIgaW4gZSA/ICJsYWJlbCIgaW4gZS5wYXJlbnROb2RlID8gZS5wYXJlbnROb2RlLmRpc2FibGVkID09PSB0IDogZS5kaXNhYmxlZCA9PT0gdCA6IGUuaXNEaXNhYmxlZCA9PT0gdCB8fCBlLmlzRGlzYWJsZWQgIT09ICF0ICYmIGFlKGUpID09PSB0IDogZS5kaXNhYmxlZCA9PT0gdCA6ICJsYWJlbCIgaW4gZSAmJiBlLmRpc2FibGVkID09PSB0IH0gfSBmdW5jdGlvbiB2ZShhKSB7IHJldHVybiBsZShmdW5jdGlvbiAobykgeyByZXR1cm4gbyA9ICtvLCBsZShmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiwgciA9IGEoW10sIGUubGVuZ3RoLCBvKSwgaSA9IHIubGVuZ3RoOyB3aGlsZSAoaS0tKSBlW24gPSByW2ldXSAmJiAoZVtuXSA9ICEodFtuXSA9IGVbbl0pKSB9KSB9KSB9IGZ1bmN0aW9uIHllKGUpIHsgcmV0dXJuIGUgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUgJiYgZSB9IGZvciAoZSBpbiBkID0gc2Uuc3VwcG9ydCA9IHt9LCBpID0gc2UuaXNYTUwgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUubmFtZXNwYWNlVVJJLCBuID0gKGUub3duZXJEb2N1bWVudCB8fCBlKS5kb2N1bWVudEVsZW1lbnQ7IHJldHVybiAhWS50ZXN0KHQgfHwgbiAmJiBuLm5vZGVOYW1lIHx8ICJIVE1MIikgfSwgVCA9IHNlLnNldERvY3VtZW50ID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQsIG4sIHIgPSBlID8gZS5vd25lckRvY3VtZW50IHx8IGUgOiBwOyByZXR1cm4gciAhPSBDICYmIDkgPT09IHIubm9kZVR5cGUgJiYgci5kb2N1bWVudEVsZW1lbnQgJiYgKGEgPSAoQyA9IHIpLmRvY3VtZW50RWxlbWVudCwgRSA9ICFpKEMpLCBwICE9IEMgJiYgKG4gPSBDLmRlZmF1bHRWaWV3KSAmJiBuLnRvcCAhPT0gbiAmJiAobi5hZGRFdmVudExpc3RlbmVyID8gbi5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLCBvZSwgITEpIDogbi5hdHRhY2hFdmVudCAmJiBuLmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsIG9lKSksIGQuc2NvcGUgPSBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5hcHBlbmRDaGlsZChDLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUucXVlcnlTZWxlY3RvckFsbCAmJiAhZS5xdWVyeVNlbGVjdG9yQWxsKCI6c2NvcGUgZmllbGRzZXQgZGl2IikubGVuZ3RoIH0pLCBkLmF0dHJpYnV0ZXMgPSBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5jbGFzc05hbWUgPSAiaSIsICFlLmdldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIikgfSksIGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5hcHBlbmRDaGlsZChDLmNyZWF0ZUNvbW1lbnQoIiIpKSwgIWUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGggfSksIGQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IEsudGVzdChDLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpLCBkLmdldEJ5SWQgPSBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5pZCA9IFMsICFDLmdldEVsZW1lbnRzQnlOYW1lIHx8ICFDLmdldEVsZW1lbnRzQnlOYW1lKFMpLmxlbmd0aCB9KSwgZC5nZXRCeUlkID8gKGIuZmlsdGVyLklEID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnJlcGxhY2UodGUsIG5lKTsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gdCB9IH0sIGIuZmluZC5JRCA9IGZ1bmN0aW9uIChlLCB0KSB7IGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50QnlJZCAmJiBFKSB7IHZhciBuID0gdC5nZXRFbGVtZW50QnlJZChlKTsgcmV0dXJuIG4gPyBbbl0gOiBbXSB9IH0pIDogKGIuZmlsdGVyLklEID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnJlcGxhY2UodGUsIG5lKTsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0QXR0cmlidXRlTm9kZSAmJiBlLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7IHJldHVybiB0ICYmIHQudmFsdWUgPT09IG4gfSB9LCBiLmZpbmQuSUQgPSBmdW5jdGlvbiAoZSwgdCkgeyBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQgJiYgRSkgeyB2YXIgbiwgciwgaSwgbyA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7IGlmIChvKSB7IGlmICgobiA9IG8uZ2V0QXR0cmlidXRlTm9kZSgiaWQiKSkgJiYgbi52YWx1ZSA9PT0gZSkgcmV0dXJuIFtvXTsgaSA9IHQuZ2V0RWxlbWVudHNCeU5hbWUoZSksIHIgPSAwOyB3aGlsZSAobyA9IGlbcisrXSkgaWYgKChuID0gby5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpKSAmJiBuLnZhbHVlID09PSBlKSByZXR1cm4gW29dIH0gcmV0dXJuIFtdIH0gfSksIGIuZmluZC5UQUcgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICJ1bmRlZmluZWQiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gdC5nZXRFbGVtZW50c0J5VGFnTmFtZShlKSA6IGQucXNhID8gdC5xdWVyeVNlbGVjdG9yQWxsKGUpIDogdm9pZCAwIH0gOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiwgciA9IFtdLCBpID0gMCwgbyA9IHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk7IGlmICgiKiIgPT09IGUpIHsgd2hpbGUgKG4gPSBvW2krK10pIDEgPT09IG4ubm9kZVR5cGUgJiYgci5wdXNoKG4pOyByZXR1cm4gciB9IHJldHVybiBvIH0sIGIuZmluZC5DTEFTUyA9IGQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiAoZSwgdCkgeyBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBFKSByZXR1cm4gdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGUpIH0sIHMgPSBbXSwgdiA9IFtdLCAoZC5xc2EgPSBLLnRlc3QoQy5xdWVyeVNlbGVjdG9yQWxsKSkgJiYgKGNlKGZ1bmN0aW9uIChlKSB7IHZhciB0OyBhLmFwcGVuZENoaWxkKGUpLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIFMgKyAiJz48L2E+PHNlbGVjdCBpZD0nIiArIFMgKyAiLVxyXFwnIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IiwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCAmJiB2LnB1c2goIlsqXiRdPSIgKyBNICsgIiooPzonJ3xcIlwiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGggfHwgdi5wdXNoKCJcXFsiICsgTSArICIqKD86dmFsdWV8IiArIFIgKyAiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49IiArIFMgKyAiLV0iKS5sZW5ndGggfHwgdi5wdXNoKCJ+PSIpLCAodCA9IEMuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJuYW1lIiwgIiIpLCBlLmFwcGVuZENoaWxkKHQpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPScnXSIpLmxlbmd0aCB8fCB2LnB1c2goIlxcWyIgKyBNICsgIipuYW1lIiArIE0gKyAiKj0iICsgTSArICIqKD86Jyd8XCJcIikiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCB8fCB2LnB1c2goIjpjaGVja2VkIiksIGUucXVlcnlTZWxlY3RvckFsbCgiYSMiICsgUyArICIrKiIpLmxlbmd0aCB8fCB2LnB1c2goIi4jLitbK35dIiksIGUucXVlcnlTZWxlY3RvckFsbCgiXFxcZiIpLCB2LnB1c2goIltcXHJcXG5cXGZdIikgfSksIGNlKGZ1bmN0aW9uIChlKSB7IGUuaW5uZXJIVE1MID0gIjxhIGhyZWY9JycgZGlzYWJsZWQ9J2Rpc2FibGVkJz48L2E+PHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PiI7IHZhciB0ID0gQy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOyB0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKSwgZS5hcHBlbmRDaGlsZCh0KS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAiRCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoICYmIHYucHVzaCgibmFtZSIgKyBNICsgIipbKl4kfCF+XT89IiksIDIgIT09IGUucXVlcnlTZWxlY3RvckFsbCgiOmVuYWJsZWQiKS5sZW5ndGggJiYgdi5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKSwgYS5hcHBlbmRDaGlsZChlKS5kaXNhYmxlZCA9ICEwLCAyICE9PSBlLnF1ZXJ5U2VsZWN0b3JBbGwoIjpkaXNhYmxlZCIpLmxlbmd0aCAmJiB2LnB1c2goIjplbmFibGVkIiwgIjpkaXNhYmxlZCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKSwgdi5wdXNoKCIsLio6IikgfSkpLCAoZC5tYXRjaGVzU2VsZWN0b3IgPSBLLnRlc3QoYyA9IGEubWF0Y2hlcyB8fCBhLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBhLm1vek1hdGNoZXNTZWxlY3RvciB8fCBhLm9NYXRjaGVzU2VsZWN0b3IgfHwgYS5tc01hdGNoZXNTZWxlY3RvcikpICYmIGNlKGZ1bmN0aW9uIChlKSB7IGQuZGlzY29ubmVjdGVkTWF0Y2ggPSBjLmNhbGwoZSwgIioiKSwgYy5jYWxsKGUsICJbcyE9JyddOngiKSwgcy5wdXNoKCIhPSIsIEYpIH0pLCB2ID0gdi5sZW5ndGggJiYgbmV3IFJlZ0V4cCh2LmpvaW4oInwiKSksIHMgPSBzLmxlbmd0aCAmJiBuZXcgUmVnRXhwKHMuam9pbigifCIpKSwgdCA9IEsudGVzdChhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSwgeSA9IHQgfHwgSy50ZXN0KGEuY29udGFpbnMpID8gZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4gPSA5ID09PSBlLm5vZGVUeXBlID8gZS5kb2N1bWVudEVsZW1lbnQgOiBlLCByID0gdCAmJiB0LnBhcmVudE5vZGU7IHJldHVybiBlID09PSByIHx8ICEoIXIgfHwgMSAhPT0gci5ub2RlVHlwZSB8fCAhKG4uY29udGFpbnMgPyBuLmNvbnRhaW5zKHIpIDogZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiAxNiAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKSB9IDogZnVuY3Rpb24gKGUsIHQpIHsgaWYgKHQpIHdoaWxlICh0ID0gdC5wYXJlbnROb2RlKSBpZiAodCA9PT0gZSkgcmV0dXJuICEwOyByZXR1cm4gITEgfSwgRCA9IHQgPyBmdW5jdGlvbiAoZSwgdCkgeyBpZiAoZSA9PT0gdCkgcmV0dXJuIGwgPSAhMCwgMDsgdmFyIG4gPSAhZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOyByZXR1cm4gbiB8fCAoMSAmIChuID0gKGUub3duZXJEb2N1bWVudCB8fCBlKSA9PSAodC5vd25lckRvY3VtZW50IHx8IHQpID8gZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSA6IDEpIHx8ICFkLnNvcnREZXRhY2hlZCAmJiB0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGUpID09PSBuID8gZSA9PSBDIHx8IGUub3duZXJEb2N1bWVudCA9PSBwICYmIHkocCwgZSkgPyAtMSA6IHQgPT0gQyB8fCB0Lm93bmVyRG9jdW1lbnQgPT0gcCAmJiB5KHAsIHQpID8gMSA6IHUgPyBQKHUsIGUpIC0gUCh1LCB0KSA6IDAgOiA0ICYgbiA/IC0xIDogMSkgfSA6IGZ1bmN0aW9uIChlLCB0KSB7IGlmIChlID09PSB0KSByZXR1cm4gbCA9ICEwLCAwOyB2YXIgbiwgciA9IDAsIGkgPSBlLnBhcmVudE5vZGUsIG8gPSB0LnBhcmVudE5vZGUsIGEgPSBbZV0sIHMgPSBbdF07IGlmICghaSB8fCAhbykgcmV0dXJuIGUgPT0gQyA/IC0xIDogdCA9PSBDID8gMSA6IGkgPyAtMSA6IG8gPyAxIDogdSA/IFAodSwgZSkgLSBQKHUsIHQpIDogMDsgaWYgKGkgPT09IG8pIHJldHVybiBwZShlLCB0KTsgbiA9IGU7IHdoaWxlIChuID0gbi5wYXJlbnROb2RlKSBhLnVuc2hpZnQobik7IG4gPSB0OyB3aGlsZSAobiA9IG4ucGFyZW50Tm9kZSkgcy51bnNoaWZ0KG4pOyB3aGlsZSAoYVtyXSA9PT0gc1tyXSkgcisrOyByZXR1cm4gciA/IHBlKGFbcl0sIHNbcl0pIDogYVtyXSA9PSBwID8gLTEgOiBzW3JdID09IHAgPyAxIDogMCB9KSwgQyB9LCBzZS5tYXRjaGVzID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHNlKGUsIG51bGwsIG51bGwsIHQpIH0sIHNlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uIChlLCB0KSB7IGlmIChUKGUpLCBkLm1hdGNoZXNTZWxlY3RvciAmJiBFICYmICFOW3QgKyAiICJdICYmICghcyB8fCAhcy50ZXN0KHQpKSAmJiAoIXYgfHwgIXYudGVzdCh0KSkpIHRyeSB7IHZhciBuID0gYy5jYWxsKGUsIHQpOyBpZiAobiB8fCBkLmRpc2Nvbm5lY3RlZE1hdGNoIHx8IGUuZG9jdW1lbnQgJiYgMTEgIT09IGUuZG9jdW1lbnQubm9kZVR5cGUpIHJldHVybiBuIH0gY2F0Y2ggKGUpIHsgTih0LCAhMCkgfSByZXR1cm4gMCA8IHNlKHQsIEMsIG51bGwsIFtlXSkubGVuZ3RoIH0sIHNlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIChlLm93bmVyRG9jdW1lbnQgfHwgZSkgIT0gQyAmJiBUKGUpLCB5KGUsIHQpIH0sIHNlLmF0dHIgPSBmdW5jdGlvbiAoZSwgdCkgeyAoZS5vd25lckRvY3VtZW50IHx8IGUpICE9IEMgJiYgVChlKTsgdmFyIG4gPSBiLmF0dHJIYW5kbGVbdC50b0xvd2VyQ2FzZSgpXSwgciA9IG4gJiYgai5jYWxsKGIuYXR0ckhhbmRsZSwgdC50b0xvd2VyQ2FzZSgpKSA/IG4oZSwgdCwgIUUpIDogdm9pZCAwOyByZXR1cm4gdm9pZCAwICE9PSByID8gciA6IGQuYXR0cmlidXRlcyB8fCAhRSA/IGUuZ2V0QXR0cmlidXRlKHQpIDogKHIgPSBlLmdldEF0dHJpYnV0ZU5vZGUodCkpICYmIHIuc3BlY2lmaWVkID8gci52YWx1ZSA6IG51bGwgfSwgc2UuZXNjYXBlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIChlICsgIiIpLnJlcGxhY2UocmUsIGllKSB9LCBzZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRocm93IG5ldyBFcnJvcigiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIGUpIH0sIHNlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiA9IFtdLCByID0gMCwgaSA9IDA7IGlmIChsID0gIWQuZGV0ZWN0RHVwbGljYXRlcywgdSA9ICFkLnNvcnRTdGFibGUgJiYgZS5zbGljZSgwKSwgZS5zb3J0KEQpLCBsKSB7IHdoaWxlICh0ID0gZVtpKytdKSB0ID09PSBlW2ldICYmIChyID0gbi5wdXNoKGkpKTsgd2hpbGUgKHItLSkgZS5zcGxpY2UobltyXSwgMSkgfSByZXR1cm4gdSA9IG51bGwsIGUgfSwgbyA9IHNlLmdldFRleHQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiA9ICIiLCByID0gMCwgaSA9IGUubm9kZVR5cGU7IGlmIChpKSB7IGlmICgxID09PSBpIHx8IDkgPT09IGkgfHwgMTEgPT09IGkpIHsgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlLnRleHRDb250ZW50KSByZXR1cm4gZS50ZXh0Q29udGVudDsgZm9yIChlID0gZS5maXJzdENoaWxkOyBlOyBlID0gZS5uZXh0U2libGluZyluICs9IG8oZSkgfSBlbHNlIGlmICgzID09PSBpIHx8IDQgPT09IGkpIHJldHVybiBlLm5vZGVWYWx1ZSB9IGVsc2Ugd2hpbGUgKHQgPSBlW3IrK10pIG4gKz0gbyh0KTsgcmV0dXJuIG4gfSwgKGIgPSBzZS5zZWxlY3RvcnMgPSB7IGNhY2hlTGVuZ3RoOiA1MCwgY3JlYXRlUHNldWRvOiBsZSwgbWF0Y2g6IEcsIGF0dHJIYW5kbGU6IHt9LCBmaW5kOiB7fSwgcmVsYXRpdmU6IHsgIj4iOiB7IGRpcjogInBhcmVudE5vZGUiLCBmaXJzdDogITAgfSwgIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sICIrIjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciLCBmaXJzdDogITAgfSwgIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfSB9LCBwcmVGaWx0ZXI6IHsgQVRUUjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGVbMV0gPSBlWzFdLnJlcGxhY2UodGUsIG5lKSwgZVszXSA9IChlWzNdIHx8IGVbNF0gfHwgZVs1XSB8fCAiIikucmVwbGFjZSh0ZSwgbmUpLCAifj0iID09PSBlWzJdICYmIChlWzNdID0gIiAiICsgZVszXSArICIgIiksIGUuc2xpY2UoMCwgNCkgfSwgQ0hJTEQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlWzFdID0gZVsxXS50b0xvd2VyQ2FzZSgpLCAibnRoIiA9PT0gZVsxXS5zbGljZSgwLCAzKSA/IChlWzNdIHx8IHNlLmVycm9yKGVbMF0pLCBlWzRdID0gKyhlWzRdID8gZVs1XSArIChlWzZdIHx8IDEpIDogMiAqICgiZXZlbiIgPT09IGVbM10gfHwgIm9kZCIgPT09IGVbM10pKSwgZVs1XSA9ICsoZVs3XSArIGVbOF0gfHwgIm9kZCIgPT09IGVbM10pKSA6IGVbM10gJiYgc2UuZXJyb3IoZVswXSksIGUgfSwgUFNFVURPOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiA9ICFlWzZdICYmIGVbMl07IHJldHVybiBHLkNISUxELnRlc3QoZVswXSkgPyBudWxsIDogKGVbM10gPyBlWzJdID0gZVs0XSB8fCBlWzVdIHx8ICIiIDogbiAmJiBYLnRlc3QobikgJiYgKHQgPSBoKG4sICEwKSkgJiYgKHQgPSBuLmluZGV4T2YoIikiLCBuLmxlbmd0aCAtIHQpIC0gbi5sZW5ndGgpICYmIChlWzBdID0gZVswXS5zbGljZSgwLCB0KSwgZVsyXSA9IG4uc2xpY2UoMCwgdCkpLCBlLnNsaWNlKDAsIDMpKSB9IH0sIGZpbHRlcjogeyBUQUc6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5yZXBsYWNlKHRlLCBuZSkudG9Mb3dlckNhc2UoKTsgcmV0dXJuICIqIiA9PT0gZSA/IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwIH0gOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5ub2RlTmFtZSAmJiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHQgfSB9LCBDTEFTUzogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBtW2UgKyAiICJdOyByZXR1cm4gdCB8fCAodCA9IG5ldyBSZWdFeHAoIihefCIgKyBNICsgIikiICsgZSArICIoIiArIE0gKyAifCQpIikpICYmIG0oZSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHQudGVzdCgic3RyaW5nIiA9PSB0eXBlb2YgZS5jbGFzc05hbWUgJiYgZS5jbGFzc05hbWUgfHwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0QXR0cmlidXRlICYmIGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiKSB9KSB9LCBBVFRSOiBmdW5jdGlvbiAobiwgciwgaSkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBzZS5hdHRyKGUsIG4pOyByZXR1cm4gbnVsbCA9PSB0ID8gIiE9IiA9PT0gciA6ICFyIHx8ICh0ICs9ICIiLCAiPSIgPT09IHIgPyB0ID09PSBpIDogIiE9IiA9PT0gciA/IHQgIT09IGkgOiAiXj0iID09PSByID8gaSAmJiAwID09PSB0LmluZGV4T2YoaSkgOiAiKj0iID09PSByID8gaSAmJiAtMSA8IHQuaW5kZXhPZihpKSA6ICIkPSIgPT09IHIgPyBpICYmIHQuc2xpY2UoLWkubGVuZ3RoKSA9PT0gaSA6ICJ+PSIgPT09IHIgPyAtMSA8ICgiICIgKyB0LnJlcGxhY2UoQiwgIiAiKSArICIgIikuaW5kZXhPZihpKSA6ICJ8PSIgPT09IHIgJiYgKHQgPT09IGkgfHwgdC5zbGljZSgwLCBpLmxlbmd0aCArIDEpID09PSBpICsgIi0iKSkgfSB9LCBDSElMRDogZnVuY3Rpb24gKGgsIGUsIHQsIGcsIHYpIHsgdmFyIHkgPSAibnRoIiAhPT0gaC5zbGljZSgwLCAzKSwgbSA9ICJsYXN0IiAhPT0gaC5zbGljZSgtNCksIHggPSAib2YtdHlwZSIgPT09IGU7IHJldHVybiAxID09PSBnICYmIDAgPT09IHYgPyBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISFlLnBhcmVudE5vZGUgfSA6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhLCBzLCB1LCBsID0geSAhPT0gbSA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwgYyA9IGUucGFyZW50Tm9kZSwgZiA9IHggJiYgZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBwID0gIW4gJiYgIXgsIGQgPSAhMTsgaWYgKGMpIHsgaWYgKHkpIHsgd2hpbGUgKGwpIHsgYSA9IGU7IHdoaWxlIChhID0gYVtsXSkgaWYgKHggPyBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGYgOiAxID09PSBhLm5vZGVUeXBlKSByZXR1cm4gITE7IHUgPSBsID0gIm9ubHkiID09PSBoICYmICF1ICYmICJuZXh0U2libGluZyIgfSByZXR1cm4gITAgfSBpZiAodSA9IFttID8gYy5maXJzdENoaWxkIDogYy5sYXN0Q2hpbGRdLCBtICYmIHApIHsgZCA9IChzID0gKHIgPSAoaSA9IChvID0gKGEgPSBjKVtTXSB8fCAoYVtTXSA9IHt9KSlbYS51bmlxdWVJRF0gfHwgKG9bYS51bmlxdWVJRF0gPSB7fSkpW2hdIHx8IFtdKVswXSA9PT0gayAmJiByWzFdKSAmJiByWzJdLCBhID0gcyAmJiBjLmNoaWxkTm9kZXNbc107IHdoaWxlIChhID0gKytzICYmIGEgJiYgYVtsXSB8fCAoZCA9IHMgPSAwKSB8fCB1LnBvcCgpKSBpZiAoMSA9PT0gYS5ub2RlVHlwZSAmJiArK2QgJiYgYSA9PT0gZSkgeyBpW2hdID0gW2ssIHMsIGRdOyBicmVhayB9IH0gZWxzZSBpZiAocCAmJiAoZCA9IHMgPSAociA9IChpID0gKG8gPSAoYSA9IGUpW1NdIHx8IChhW1NdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gfHwgW10pWzBdID09PSBrICYmIHJbMV0pLCAhMSA9PT0gZCkgd2hpbGUgKGEgPSArK3MgJiYgYSAmJiBhW2xdIHx8IChkID0gcyA9IDApIHx8IHUucG9wKCkpIGlmICgoeCA/IGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gZiA6IDEgPT09IGEubm9kZVR5cGUpICYmICsrZCAmJiAocCAmJiAoKGkgPSAobyA9IGFbU10gfHwgKGFbU10gPSB7fSkpW2EudW5pcXVlSURdIHx8IChvW2EudW5pcXVlSURdID0ge30pKVtoXSA9IFtrLCBkXSksIGEgPT09IGUpKSBicmVhazsgcmV0dXJuIChkIC09IHYpID09PSBnIHx8IGQgJSBnID09IDAgJiYgMCA8PSBkIC8gZyB9IH0gfSwgUFNFVURPOiBmdW5jdGlvbiAoZSwgbykgeyB2YXIgdCwgYSA9IGIucHNldWRvc1tlXSB8fCBiLnNldEZpbHRlcnNbZS50b0xvd2VyQ2FzZSgpXSB8fCBzZS5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgZSk7IHJldHVybiBhW1NdID8gYShvKSA6IDEgPCBhLmxlbmd0aCA/ICh0ID0gW2UsIGUsICIiLCBvXSwgYi5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KGUudG9Mb3dlckNhc2UoKSkgPyBsZShmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiwgciA9IGEoZSwgbyksIGkgPSByLmxlbmd0aDsgd2hpbGUgKGktLSkgZVtuID0gUChlLCByW2ldKV0gPSAhKHRbbl0gPSByW2ldKSB9KSA6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBhKGUsIDAsIHQpIH0pIDogYSB9IH0sIHBzZXVkb3M6IHsgbm90OiBsZShmdW5jdGlvbiAoZSkgeyB2YXIgciA9IFtdLCBpID0gW10sIHMgPSBmKGUucmVwbGFjZSgkLCAiJDEiKSk7IHJldHVybiBzW1NdID8gbGUoZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHsgdmFyIGksIG8gPSBzKGUsIG51bGwsIHIsIFtdKSwgYSA9IGUubGVuZ3RoOyB3aGlsZSAoYS0tKSAoaSA9IG9bYV0pICYmIChlW2FdID0gISh0W2FdID0gaSkpIH0pIDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIHJbMF0gPSBlLCBzKHIsIG51bGwsIG4sIGkpLCByWzBdID0gbnVsbCwgIWkucG9wKCkgfSB9KSwgaGFzOiBsZShmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIDAgPCBzZSh0LCBlKS5sZW5ndGggfSB9KSwgY29udGFpbnM6IGxlKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ID0gdC5yZXBsYWNlKHRlLCBuZSksIGZ1bmN0aW9uIChlKSB7IHJldHVybiAtMSA8IChlLnRleHRDb250ZW50IHx8IG8oZSkpLmluZGV4T2YodCkgfSB9KSwgbGFuZzogbGUoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIFYudGVzdChuIHx8ICIiKSB8fCBzZS5lcnJvcigidW5zdXBwb3J0ZWQgbGFuZzogIiArIG4pLCBuID0gbi5yZXBsYWNlKHRlLCBuZSkudG9Mb3dlckNhc2UoKSwgZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IGRvIHsgaWYgKHQgPSBFID8gZS5sYW5nIDogZS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgcmV0dXJuICh0ID0gdC50b0xvd2VyQ2FzZSgpKSA9PT0gbiB8fCAwID09PSB0LmluZGV4T2YobiArICItIikgfSB3aGlsZSAoKGUgPSBlLnBhcmVudE5vZGUpICYmIDEgPT09IGUubm9kZVR5cGUpOyByZXR1cm4gITEgfSB9KSwgdGFyZ2V0OiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IG4ubG9jYXRpb24gJiYgbi5sb2NhdGlvbi5oYXNoOyByZXR1cm4gdCAmJiB0LnNsaWNlKDEpID09PSBlLmlkIH0sIHJvb3Q6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlID09PSBhIH0sIGZvY3VzOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSA9PT0gQy5hY3RpdmVFbGVtZW50ICYmICghQy5oYXNGb2N1cyB8fCBDLmhhc0ZvY3VzKCkpICYmICEhKGUudHlwZSB8fCBlLmhyZWYgfHwgfmUudGFiSW5kZXgpIH0sIGVuYWJsZWQ6IGdlKCExKSwgZGlzYWJsZWQ6IGdlKCEwKSwgY2hlY2tlZDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7IHJldHVybiAiaW5wdXQiID09PSB0ICYmICEhZS5jaGVja2VkIHx8ICJvcHRpb24iID09PSB0ICYmICEhZS5zZWxlY3RlZCB9LCBzZWxlY3RlZDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUucGFyZW50Tm9kZSAmJiBlLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgITAgPT09IGUuc2VsZWN0ZWQgfSwgZW1wdHk6IGZ1bmN0aW9uIChlKSB7IGZvciAoZSA9IGUuZmlyc3RDaGlsZDsgZTsgZSA9IGUubmV4dFNpYmxpbmcpaWYgKGUubm9kZVR5cGUgPCA2KSByZXR1cm4gITE7IHJldHVybiAhMCB9LCBwYXJlbnQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhYi5wc2V1ZG9zLmVtcHR5KGUpIH0sIGhlYWRlcjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEoudGVzdChlLm5vZGVOYW1lKSB9LCBpbnB1dDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFEudGVzdChlLm5vZGVOYW1lKSB9LCBidXR0b246IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOyByZXR1cm4gImlucHV0IiA9PT0gdCAmJiAiYnV0dG9uIiA9PT0gZS50eXBlIHx8ICJidXR0b24iID09PSB0IH0sIHRleHQ6IGZ1bmN0aW9uIChlKSB7IHZhciB0OyByZXR1cm4gImlucHV0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmICJ0ZXh0IiA9PT0gZS50eXBlICYmIChudWxsID09ICh0ID0gZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgfHwgInRleHQiID09PSB0LnRvTG93ZXJDYXNlKCkpIH0sIGZpcnN0OiB2ZShmdW5jdGlvbiAoKSB7IHJldHVybiBbMF0gfSksIGxhc3Q6IHZlKGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBbdCAtIDFdIH0pLCBlcTogdmUoZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIFtuIDwgMCA/IG4gKyB0IDogbl0gfSksIGV2ZW46IHZlKGZ1bmN0aW9uIChlLCB0KSB7IGZvciAodmFyIG4gPSAwOyBuIDwgdDsgbiArPSAyKWUucHVzaChuKTsgcmV0dXJuIGUgfSksIG9kZDogdmUoZnVuY3Rpb24gKGUsIHQpIHsgZm9yICh2YXIgbiA9IDE7IG4gPCB0OyBuICs9IDIpZS5wdXNoKG4pOyByZXR1cm4gZSB9KSwgbHQ6IHZlKGZ1bmN0aW9uIChlLCB0LCBuKSB7IGZvciAodmFyIHIgPSBuIDwgMCA/IG4gKyB0IDogdCA8IG4gPyB0IDogbjsgMCA8PSAtLXI7KWUucHVzaChyKTsgcmV0dXJuIGUgfSksIGd0OiB2ZShmdW5jdGlvbiAoZSwgdCwgbikgeyBmb3IgKHZhciByID0gbiA8IDAgPyBuICsgdCA6IG47ICsrciA8IHQ7KWUucHVzaChyKTsgcmV0dXJuIGUgfSkgfSB9KS5wc2V1ZG9zLm50aCA9IGIucHNldWRvcy5lcSwgeyByYWRpbzogITAsIGNoZWNrYm94OiAhMCwgZmlsZTogITAsIHBhc3N3b3JkOiAhMCwgaW1hZ2U6ICEwIH0pIGIucHNldWRvc1tlXSA9IGRlKGUpOyBmb3IgKGUgaW4geyBzdWJtaXQ6ICEwLCByZXNldDogITAgfSkgYi5wc2V1ZG9zW2VdID0gaGUoZSk7IGZ1bmN0aW9uIG1lKCkgeyB9IGZ1bmN0aW9uIHhlKGUpIHsgZm9yICh2YXIgdCA9IDAsIG4gPSBlLmxlbmd0aCwgciA9ICIiOyB0IDwgbjsgdCsrKXIgKz0gZVt0XS52YWx1ZTsgcmV0dXJuIHIgfSBmdW5jdGlvbiBiZShzLCBlLCB0KSB7IHZhciB1ID0gZS5kaXIsIGwgPSBlLm5leHQsIGMgPSBsIHx8IHUsIGYgPSB0ICYmICJwYXJlbnROb2RlIiA9PT0gYywgcCA9IHIrKzsgcmV0dXJuIGUuZmlyc3QgPyBmdW5jdGlvbiAoZSwgdCwgbikgeyB3aGlsZSAoZSA9IGVbdV0pIGlmICgxID09PSBlLm5vZGVUeXBlIHx8IGYpIHJldHVybiBzKGUsIHQsIG4pOyByZXR1cm4gITEgfSA6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhID0gW2ssIHBdOyBpZiAobikgeyB3aGlsZSAoZSA9IGVbdV0pIGlmICgoMSA9PT0gZS5ub2RlVHlwZSB8fCBmKSAmJiBzKGUsIHQsIG4pKSByZXR1cm4gITAgfSBlbHNlIHdoaWxlIChlID0gZVt1XSkgaWYgKDEgPT09IGUubm9kZVR5cGUgfHwgZikgaWYgKGkgPSAobyA9IGVbU10gfHwgKGVbU10gPSB7fSkpW2UudW5pcXVlSURdIHx8IChvW2UudW5pcXVlSURdID0ge30pLCBsICYmIGwgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgZSA9IGVbdV0gfHwgZTsgZWxzZSB7IGlmICgociA9IGlbY10pICYmIHJbMF0gPT09IGsgJiYgclsxXSA9PT0gcCkgcmV0dXJuIGFbMl0gPSByWzJdOyBpZiAoKGlbY10gPSBhKVsyXSA9IHMoZSwgdCwgbikpIHJldHVybiAhMCB9IHJldHVybiAhMSB9IH0gZnVuY3Rpb24gd2UoaSkgeyByZXR1cm4gMSA8IGkubGVuZ3RoID8gZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIgPSBpLmxlbmd0aDsgd2hpbGUgKHItLSkgaWYgKCFpW3JdKGUsIHQsIG4pKSByZXR1cm4gITE7IHJldHVybiAhMCB9IDogaVswXSB9IGZ1bmN0aW9uIFRlKGUsIHQsIG4sIHIsIGkpIHsgZm9yICh2YXIgbywgYSA9IFtdLCBzID0gMCwgdSA9IGUubGVuZ3RoLCBsID0gbnVsbCAhPSB0OyBzIDwgdTsgcysrKShvID0gZVtzXSkgJiYgKG4gJiYgIW4obywgciwgaSkgfHwgKGEucHVzaChvKSwgbCAmJiB0LnB1c2gocykpKTsgcmV0dXJuIGEgfSBmdW5jdGlvbiBDZShkLCBoLCBnLCB2LCB5LCBlKSB7IHJldHVybiB2ICYmICF2W1NdICYmICh2ID0gQ2UodikpLCB5ICYmICF5W1NdICYmICh5ID0gQ2UoeSwgZSkpLCBsZShmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyB2YXIgaSwgbywgYSwgcyA9IFtdLCB1ID0gW10sIGwgPSB0Lmxlbmd0aCwgYyA9IGUgfHwgZnVuY3Rpb24gKGUsIHQsIG4pIHsgZm9yICh2YXIgciA9IDAsIGkgPSB0Lmxlbmd0aDsgciA8IGk7IHIrKylzZShlLCB0W3JdLCBuKTsgcmV0dXJuIG4gfShoIHx8ICIqIiwgbi5ub2RlVHlwZSA/IFtuXSA6IG4sIFtdKSwgZiA9ICFkIHx8ICFlICYmIGggPyBjIDogVGUoYywgcywgZCwgbiwgciksIHAgPSBnID8geSB8fCAoZSA/IGQgOiBsIHx8IHYpID8gW10gOiB0IDogZjsgaWYgKGcgJiYgZyhmLCBwLCBuLCByKSwgdikgeyBpID0gVGUocCwgdSksIHYoaSwgW10sIG4sIHIpLCBvID0gaS5sZW5ndGg7IHdoaWxlIChvLS0pIChhID0gaVtvXSkgJiYgKHBbdVtvXV0gPSAhKGZbdVtvXV0gPSBhKSkgfSBpZiAoZSkgeyBpZiAoeSB8fCBkKSB7IGlmICh5KSB7IGkgPSBbXSwgbyA9IHAubGVuZ3RoOyB3aGlsZSAoby0tKSAoYSA9IHBbb10pICYmIGkucHVzaChmW29dID0gYSk7IHkobnVsbCwgcCA9IFtdLCBpLCByKSB9IG8gPSBwLmxlbmd0aDsgd2hpbGUgKG8tLSkgKGEgPSBwW29dKSAmJiAtMSA8IChpID0geSA/IFAoZSwgYSkgOiBzW29dKSAmJiAoZVtpXSA9ICEodFtpXSA9IGEpKSB9IH0gZWxzZSBwID0gVGUocCA9PT0gdCA/IHAuc3BsaWNlKGwsIHAubGVuZ3RoKSA6IHApLCB5ID8geShudWxsLCB0LCBwLCByKSA6IEguYXBwbHkodCwgcCkgfSkgfSBmdW5jdGlvbiBFZShlKSB7IGZvciAodmFyIGksIHQsIG4sIHIgPSBlLmxlbmd0aCwgbyA9IGIucmVsYXRpdmVbZVswXS50eXBlXSwgYSA9IG8gfHwgYi5yZWxhdGl2ZVsiICJdLCBzID0gbyA/IDEgOiAwLCB1ID0gYmUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgPT09IGkgfSwgYSwgITApLCBsID0gYmUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIC0xIDwgUChpLCBlKSB9LCBhLCAhMCksIGMgPSBbZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIgPSAhbyAmJiAobiB8fCB0ICE9PSB3KSB8fCAoKGkgPSB0KS5ub2RlVHlwZSA/IHUoZSwgdCwgbikgOiBsKGUsIHQsIG4pKTsgcmV0dXJuIGkgPSBudWxsLCByIH1dOyBzIDwgcjsgcysrKWlmICh0ID0gYi5yZWxhdGl2ZVtlW3NdLnR5cGVdKSBjID0gW2JlKHdlKGMpLCB0KV07IGVsc2UgeyBpZiAoKHQgPSBiLmZpbHRlcltlW3NdLnR5cGVdLmFwcGx5KG51bGwsIGVbc10ubWF0Y2hlcykpW1NdKSB7IGZvciAobiA9ICsrczsgbiA8IHI7IG4rKylpZiAoYi5yZWxhdGl2ZVtlW25dLnR5cGVdKSBicmVhazsgcmV0dXJuIENlKDEgPCBzICYmIHdlKGMpLCAxIDwgcyAmJiB4ZShlLnNsaWNlKDAsIHMgLSAxKS5jb25jYXQoeyB2YWx1ZTogIiAiID09PSBlW3MgLSAyXS50eXBlID8gIioiIDogIiIgfSkpLnJlcGxhY2UoJCwgIiQxIiksIHQsIHMgPCBuICYmIEVlKGUuc2xpY2UocywgbikpLCBuIDwgciAmJiBFZShlID0gZS5zbGljZShuKSksIG4gPCByICYmIHhlKGUpKSB9IGMucHVzaCh0KSB9IHJldHVybiB3ZShjKSB9IHJldHVybiBtZS5wcm90b3R5cGUgPSBiLmZpbHRlcnMgPSBiLnBzZXVkb3MsIGIuc2V0RmlsdGVycyA9IG5ldyBtZSwgaCA9IHNlLnRva2VuaXplID0gZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSB4W2UgKyAiICJdOyBpZiAobCkgcmV0dXJuIHQgPyAwIDogbC5zbGljZSgwKTsgYSA9IGUsIHMgPSBbXSwgdSA9IGIucHJlRmlsdGVyOyB3aGlsZSAoYSkgeyBmb3IgKG8gaW4gbiAmJiAhKHIgPSBfLmV4ZWMoYSkpIHx8IChyICYmIChhID0gYS5zbGljZShyWzBdLmxlbmd0aCkgfHwgYSksIHMucHVzaChpID0gW10pKSwgbiA9ICExLCAociA9IHouZXhlYyhhKSkgJiYgKG4gPSByLnNoaWZ0KCksIGkucHVzaCh7IHZhbHVlOiBuLCB0eXBlOiByWzBdLnJlcGxhY2UoJCwgIiAiKSB9KSwgYSA9IGEuc2xpY2Uobi5sZW5ndGgpKSwgYi5maWx0ZXIpICEociA9IEdbb10uZXhlYyhhKSkgfHwgdVtvXSAmJiAhKHIgPSB1W29dKHIpKSB8fCAobiA9IHIuc2hpZnQoKSwgaS5wdXNoKHsgdmFsdWU6IG4sIHR5cGU6IG8sIG1hdGNoZXM6IHIgfSksIGEgPSBhLnNsaWNlKG4ubGVuZ3RoKSk7IGlmICghbikgYnJlYWsgfSByZXR1cm4gdCA/IGEubGVuZ3RoIDogYSA/IHNlLmVycm9yKGUpIDogeChlLCBzKS5zbGljZSgwKSB9LCBmID0gc2UuY29tcGlsZSA9IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCB2LCB5LCBtLCB4LCByLCBpID0gW10sIG8gPSBbXSwgYSA9IEFbZSArICIgIl07IGlmICghYSkgeyB0IHx8ICh0ID0gaChlKSksIG4gPSB0Lmxlbmd0aDsgd2hpbGUgKG4tLSkgKGEgPSBFZSh0W25dKSlbU10gPyBpLnB1c2goYSkgOiBvLnB1c2goYSk7IChhID0gQShlLCAodiA9IG8sIG0gPSAwIDwgKHkgPSBpKS5sZW5ndGgsIHggPSAwIDwgdi5sZW5ndGgsIHIgPSBmdW5jdGlvbiAoZSwgdCwgbiwgciwgaSkgeyB2YXIgbywgYSwgcywgdSA9IDAsIGwgPSAiMCIsIGMgPSBlICYmIFtdLCBmID0gW10sIHAgPSB3LCBkID0gZSB8fCB4ICYmIGIuZmluZC5UQUcoIioiLCBpKSwgaCA9IGsgKz0gbnVsbCA9PSBwID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgLjEsIGcgPSBkLmxlbmd0aDsgZm9yIChpICYmICh3ID0gdCA9PSBDIHx8IHQgfHwgaSk7IGwgIT09IGcgJiYgbnVsbCAhPSAobyA9IGRbbF0pOyBsKyspIHsgaWYgKHggJiYgbykgeyBhID0gMCwgdCB8fCBvLm93bmVyRG9jdW1lbnQgPT0gQyB8fCAoVChvKSwgbiA9ICFFKTsgd2hpbGUgKHMgPSB2W2ErK10pIGlmIChzKG8sIHQgfHwgQywgbikpIHsgci5wdXNoKG8pOyBicmVhayB9IGkgJiYgKGsgPSBoKSB9IG0gJiYgKChvID0gIXMgJiYgbykgJiYgdS0tICwgZSAmJiBjLnB1c2gobykpIH0gaWYgKHUgKz0gbCwgbSAmJiBsICE9PSB1KSB7IGEgPSAwOyB3aGlsZSAocyA9IHlbYSsrXSkgcyhjLCBmLCB0LCBuKTsgaWYgKGUpIHsgaWYgKDAgPCB1KSB3aGlsZSAobC0tKSBjW2xdIHx8IGZbbF0gfHwgKGZbbF0gPSBxLmNhbGwocikpOyBmID0gVGUoZikgfSBILmFwcGx5KHIsIGYpLCBpICYmICFlICYmIDAgPCBmLmxlbmd0aCAmJiAxIDwgdSArIHkubGVuZ3RoICYmIHNlLnVuaXF1ZVNvcnQocikgfSByZXR1cm4gaSAmJiAoayA9IGgsIHcgPSBwKSwgYyB9LCBtID8gbGUocikgOiByKSkpLnNlbGVjdG9yID0gZSB9IHJldHVybiBhIH0sIGcgPSBzZS5zZWxlY3QgPSBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyB2YXIgaSwgbywgYSwgcywgdSwgbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgZSwgYyA9ICFyICYmIGgoZSA9IGwuc2VsZWN0b3IgfHwgZSk7IGlmIChuID0gbiB8fCBbXSwgMSA9PT0gYy5sZW5ndGgpIHsgaWYgKDIgPCAobyA9IGNbMF0gPSBjWzBdLnNsaWNlKDApKS5sZW5ndGggJiYgIklEIiA9PT0gKGEgPSBvWzBdKS50eXBlICYmIDkgPT09IHQubm9kZVR5cGUgJiYgRSAmJiBiLnJlbGF0aXZlW29bMV0udHlwZV0pIHsgaWYgKCEodCA9IChiLmZpbmQuSUQoYS5tYXRjaGVzWzBdLnJlcGxhY2UodGUsIG5lKSwgdCkgfHwgW10pWzBdKSkgcmV0dXJuIG47IGwgJiYgKHQgPSB0LnBhcmVudE5vZGUpLCBlID0gZS5zbGljZShvLnNoaWZ0KCkudmFsdWUubGVuZ3RoKSB9IGkgPSBHLm5lZWRzQ29udGV4dC50ZXN0KGUpID8gMCA6IG8ubGVuZ3RoOyB3aGlsZSAoaS0tKSB7IGlmIChhID0gb1tpXSwgYi5yZWxhdGl2ZVtzID0gYS50eXBlXSkgYnJlYWs7IGlmICgodSA9IGIuZmluZFtzXSkgJiYgKHIgPSB1KGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLCBuZSksIGVlLnRlc3Qob1swXS50eXBlKSAmJiB5ZSh0LnBhcmVudE5vZGUpIHx8IHQpKSkgeyBpZiAoby5zcGxpY2UoaSwgMSksICEoZSA9IHIubGVuZ3RoICYmIHhlKG8pKSkgcmV0dXJuIEguYXBwbHkobiwgciksIG47IGJyZWFrIH0gfSB9IHJldHVybiAobCB8fCBmKGUsIGMpKShyLCB0LCAhRSwgbiwgIXQgfHwgZWUudGVzdChlKSAmJiB5ZSh0LnBhcmVudE5vZGUpIHx8IHQpLCBuIH0sIGQuc29ydFN0YWJsZSA9IFMuc3BsaXQoIiIpLnNvcnQoRCkuam9pbigiIikgPT09IFMsIGQuZGV0ZWN0RHVwbGljYXRlcyA9ICEhbCwgVCgpLCBkLnNvcnREZXRhY2hlZCA9IGNlKGZ1bmN0aW9uIChlKSB7IHJldHVybiAxICYgZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihDLmNyZWF0ZUVsZW1lbnQoImZpZWxkc2V0IikpIH0pLCBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIyc+PC9hPiIsICIjIiA9PT0gZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpIH0pIHx8IGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24gKGUsIHQsIG4pIHsgaWYgKCFuKSByZXR1cm4gZS5nZXRBdHRyaWJ1dGUodCwgInR5cGUiID09PSB0LnRvTG93ZXJDYXNlKCkgPyAxIDogMikgfSksIGQuYXR0cmlidXRlcyAmJiBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pbm5lckhUTUwgPSAiPGlucHV0Lz4iLCBlLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiKSwgIiIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInZhbHVlIikgfSkgfHwgZmUoInZhbHVlIiwgZnVuY3Rpb24gKGUsIHQsIG4pIHsgaWYgKCFuICYmICJpbnB1dCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgcmV0dXJuIGUuZGVmYXVsdFZhbHVlIH0pLCBjZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gbnVsbCA9PSBlLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKSB9KSB8fCBmZShSLCBmdW5jdGlvbiAoZSwgdCwgbikgeyB2YXIgcjsgaWYgKCFuKSByZXR1cm4gITAgPT09IGVbdF0gPyB0LnRvTG93ZXJDYXNlKCkgOiAociA9IGUuZ2V0QXR0cmlidXRlTm9kZSh0KSkgJiYgci5zcGVjaWZpZWQgPyByLnZhbHVlIDogbnVsbCB9KSwgc2UgfShDKTsgUy5maW5kID0gZCwgUy5leHByID0gZC5zZWxlY3RvcnMsIFMuZXhwclsiOiJdID0gUy5leHByLnBzZXVkb3MsIFMudW5pcXVlU29ydCA9IFMudW5pcXVlID0gZC51bmlxdWVTb3J0LCBTLnRleHQgPSBkLmdldFRleHQsIFMuaXNYTUxEb2MgPSBkLmlzWE1MLCBTLmNvbnRhaW5zID0gZC5jb250YWlucywgUy5lc2NhcGVTZWxlY3RvciA9IGQuZXNjYXBlOyB2YXIgaCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByID0gW10sIGkgPSB2b2lkIDAgIT09IG47IHdoaWxlICgoZSA9IGVbdF0pICYmIDkgIT09IGUubm9kZVR5cGUpIGlmICgxID09PSBlLm5vZGVUeXBlKSB7IGlmIChpICYmIFMoZSkuaXMobikpIGJyZWFrOyByLnB1c2goZSkgfSByZXR1cm4gciB9LCBUID0gZnVuY3Rpb24gKGUsIHQpIHsgZm9yICh2YXIgbiA9IFtdOyBlOyBlID0gZS5uZXh0U2libGluZykxID09PSBlLm5vZGVUeXBlICYmIGUgIT09IHQgJiYgbi5wdXNoKGUpOyByZXR1cm4gbiB9LCBrID0gUy5leHByLm1hdGNoLm5lZWRzQ29udGV4dDsgZnVuY3Rpb24gQShlLCB0KSB7IHJldHVybiBlLm5vZGVOYW1lICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdC50b0xvd2VyQ2FzZSgpIH0gdmFyIE4gPSAvXjwoW2Etel1bXlwvXDA+Olx4MjBcdFxyXG5cZl0qKVtceDIwXHRcclxuXGZdKlwvPz4oPzo8XC9cMT58KSQvaTsgZnVuY3Rpb24gRChlLCBuLCByKSB7IHJldHVybiBtKG4pID8gUy5ncmVwKGUsIGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiAhIW4uY2FsbChlLCB0LCBlKSAhPT0gciB9KSA6IG4ubm9kZVR5cGUgPyBTLmdyZXAoZSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgPT09IG4gIT09IHIgfSkgOiAic3RyaW5nIiAhPSB0eXBlb2YgbiA/IFMuZ3JlcChlLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gLTEgPCBpLmNhbGwobiwgZSkgIT09IHIgfSkgOiBTLmZpbHRlcihuLCBlLCByKSB9IFMuZmlsdGVyID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIgPSB0WzBdOyByZXR1cm4gbiAmJiAoZSA9ICI6bm90KCIgKyBlICsgIikiKSwgMSA9PT0gdC5sZW5ndGggJiYgMSA9PT0gci5ub2RlVHlwZSA/IFMuZmluZC5tYXRjaGVzU2VsZWN0b3IociwgZSkgPyBbcl0gOiBbXSA6IFMuZmluZC5tYXRjaGVzKGUsIFMuZ3JlcCh0LCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gMSA9PT0gZS5ub2RlVHlwZSB9KSkgfSwgUy5mbi5leHRlbmQoeyBmaW5kOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiwgciA9IHRoaXMubGVuZ3RoLCBpID0gdGhpczsgaWYgKCJzdHJpbmciICE9IHR5cGVvZiBlKSByZXR1cm4gdGhpcy5wdXNoU3RhY2soUyhlKS5maWx0ZXIoZnVuY3Rpb24gKCkgeyBmb3IgKHQgPSAwOyB0IDwgcjsgdCsrKWlmIChTLmNvbnRhaW5zKGlbdF0sIHRoaXMpKSByZXR1cm4gITAgfSkpOyBmb3IgKG4gPSB0aGlzLnB1c2hTdGFjayhbXSksIHQgPSAwOyB0IDwgcjsgdCsrKVMuZmluZChlLCBpW3RdLCBuKTsgcmV0dXJuIDEgPCByID8gUy51bmlxdWVTb3J0KG4pIDogbiB9LCBmaWx0ZXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLnB1c2hTdGFjayhEKHRoaXMsIGUgfHwgW10sICExKSkgfSwgbm90OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5wdXNoU3RhY2soRCh0aGlzLCBlIHx8IFtdLCAhMCkpIH0sIGlzOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISFEKHRoaXMsICJzdHJpbmciID09IHR5cGVvZiBlICYmIGsudGVzdChlKSA/IFMoZSkgOiBlIHx8IFtdLCAhMSkubGVuZ3RoIH0gfSk7IHZhciBqLCBxID0gL14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0rKSkkLzsgKFMuZm4uaW5pdCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpOyBpZiAoIWUpIHJldHVybiB0aGlzOyBpZiAobiA9IG4gfHwgaiwgInN0cmluZyIgPT0gdHlwZW9mIGUpIHsgaWYgKCEociA9ICI8IiA9PT0gZVswXSAmJiAiPiIgPT09IGVbZS5sZW5ndGggLSAxXSAmJiAzIDw9IGUubGVuZ3RoID8gW251bGwsIGUsIG51bGxdIDogcS5leGVjKGUpKSB8fCAhclsxXSAmJiB0KSByZXR1cm4gIXQgfHwgdC5qcXVlcnkgPyAodCB8fCBuKS5maW5kKGUpIDogdGhpcy5jb25zdHJ1Y3Rvcih0KS5maW5kKGUpOyBpZiAoclsxXSkgeyBpZiAodCA9IHQgaW5zdGFuY2VvZiBTID8gdFswXSA6IHQsIFMubWVyZ2UodGhpcywgUy5wYXJzZUhUTUwoclsxXSwgdCAmJiB0Lm5vZGVUeXBlID8gdC5vd25lckRvY3VtZW50IHx8IHQgOiBFLCAhMCkpLCBOLnRlc3QoclsxXSkgJiYgUy5pc1BsYWluT2JqZWN0KHQpKSBmb3IgKHIgaW4gdCkgbSh0aGlzW3JdKSA/IHRoaXNbcl0odFtyXSkgOiB0aGlzLmF0dHIociwgdFtyXSk7IHJldHVybiB0aGlzIH0gcmV0dXJuIChpID0gRS5nZXRFbGVtZW50QnlJZChyWzJdKSkgJiYgKHRoaXNbMF0gPSBpLCB0aGlzLmxlbmd0aCA9IDEpLCB0aGlzIH0gcmV0dXJuIGUubm9kZVR5cGUgPyAodGhpc1swXSA9IGUsIHRoaXMubGVuZ3RoID0gMSwgdGhpcykgOiBtKGUpID8gdm9pZCAwICE9PSBuLnJlYWR5ID8gbi5yZWFkeShlKSA6IGUoUykgOiBTLm1ha2VBcnJheShlLCB0aGlzKSB9KS5wcm90b3R5cGUgPSBTLmZuLCBqID0gUyhFKTsgdmFyIEwgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywgSCA9IHsgY2hpbGRyZW46ICEwLCBjb250ZW50czogITAsIG5leHQ6ICEwLCBwcmV2OiAhMCB9OyBmdW5jdGlvbiBPKGUsIHQpIHsgd2hpbGUgKChlID0gZVt0XSkgJiYgMSAhPT0gZS5ub2RlVHlwZSk7IHJldHVybiBlIH0gUy5mbi5leHRlbmQoeyBoYXM6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gUyhlLCB0aGlzKSwgbiA9IHQubGVuZ3RoOyByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gMDsgZSA8IG47IGUrKylpZiAoUy5jb250YWlucyh0aGlzLCB0W2VdKSkgcmV0dXJuICEwIH0pIH0sIGNsb3Nlc3Q6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCByID0gMCwgaSA9IHRoaXMubGVuZ3RoLCBvID0gW10sIGEgPSAic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiBTKGUpOyBpZiAoIWsudGVzdChlKSkgZm9yICg7IHIgPCBpOyByKyspZm9yIChuID0gdGhpc1tyXTsgbiAmJiBuICE9PSB0OyBuID0gbi5wYXJlbnROb2RlKWlmIChuLm5vZGVUeXBlIDwgMTEgJiYgKGEgPyAtMSA8IGEuaW5kZXgobikgOiAxID09PSBuLm5vZGVUeXBlICYmIFMuZmluZC5tYXRjaGVzU2VsZWN0b3IobiwgZSkpKSB7IG8ucHVzaChuKTsgYnJlYWsgfSByZXR1cm4gdGhpcy5wdXNoU3RhY2soMSA8IG8ubGVuZ3RoID8gUy51bmlxdWVTb3J0KG8pIDogbykgfSwgaW5kZXg6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlID8gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBpLmNhbGwoUyhlKSwgdGhpc1swXSkgOiBpLmNhbGwodGhpcywgZS5qcXVlcnkgPyBlWzBdIDogZSkgOiB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTEgfSwgYWRkOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdGhpcy5wdXNoU3RhY2soUy51bmlxdWVTb3J0KFMubWVyZ2UodGhpcy5nZXQoKSwgUyhlLCB0KSkpKSB9LCBhZGRCYWNrOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5hZGQobnVsbCA9PSBlID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSkgfSB9KSwgUy5lYWNoKHsgcGFyZW50OiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUucGFyZW50Tm9kZTsgcmV0dXJuIHQgJiYgMTEgIT09IHQubm9kZVR5cGUgPyB0IDogbnVsbCB9LCBwYXJlbnRzOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gaChlLCAicGFyZW50Tm9kZSIpIH0sIHBhcmVudHNVbnRpbDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIGgoZSwgInBhcmVudE5vZGUiLCBuKSB9LCBuZXh0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gTyhlLCAibmV4dFNpYmxpbmciKSB9LCBwcmV2OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gTyhlLCAicHJldmlvdXNTaWJsaW5nIikgfSwgbmV4dEFsbDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGgoZSwgIm5leHRTaWJsaW5nIikgfSwgcHJldkFsbDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGgoZSwgInByZXZpb3VzU2libGluZyIpIH0sIG5leHRVbnRpbDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIGgoZSwgIm5leHRTaWJsaW5nIiwgbikgfSwgcHJldlVudGlsOiBmdW5jdGlvbiAoZSwgdCwgbikgeyByZXR1cm4gaChlLCAicHJldmlvdXNTaWJsaW5nIiwgbikgfSwgc2libGluZ3M6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBUKChlLnBhcmVudE5vZGUgfHwge30pLmZpcnN0Q2hpbGQsIGUpIH0sIGNoaWxkcmVuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gVChlLmZpcnN0Q2hpbGQpIH0sIGNvbnRlbnRzOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbnVsbCAhPSBlLmNvbnRlbnREb2N1bWVudCAmJiByKGUuY29udGVudERvY3VtZW50KSA/IGUuY29udGVudERvY3VtZW50IDogKEEoZSwgInRlbXBsYXRlIikgJiYgKGUgPSBlLmNvbnRlbnQgfHwgZSksIFMubWVyZ2UoW10sIGUuY2hpbGROb2RlcykpIH0gfSwgZnVuY3Rpb24gKHIsIGkpIHsgUy5mbltyXSA9IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gUy5tYXAodGhpcywgaSwgZSk7IHJldHVybiAiVW50aWwiICE9PSByLnNsaWNlKC01KSAmJiAodCA9IGUpLCB0ICYmICJzdHJpbmciID09IHR5cGVvZiB0ICYmIChuID0gUy5maWx0ZXIodCwgbikpLCAxIDwgdGhpcy5sZW5ndGggJiYgKEhbcl0gfHwgUy51bmlxdWVTb3J0KG4pLCBMLnRlc3QocikgJiYgbi5yZXZlcnNlKCkpLCB0aGlzLnB1c2hTdGFjayhuKSB9IH0pOyB2YXIgUCA9IC9bXlx4MjBcdFxyXG5cZl0rL2c7IGZ1bmN0aW9uIFIoZSkgeyByZXR1cm4gZSB9IGZ1bmN0aW9uIE0oZSkgeyB0aHJvdyBlIH0gZnVuY3Rpb24gSShlLCB0LCBuLCByKSB7IHZhciBpOyB0cnkgeyBlICYmIG0oaSA9IGUucHJvbWlzZSkgPyBpLmNhbGwoZSkuZG9uZSh0KS5mYWlsKG4pIDogZSAmJiBtKGkgPSBlLnRoZW4pID8gaS5jYWxsKGUsIHQsIG4pIDogdC5hcHBseSh2b2lkIDAsIFtlXS5zbGljZShyKSkgfSBjYXRjaCAoZSkgeyBuLmFwcGx5KHZvaWQgMCwgW2VdKSB9IH0gUy5DYWxsYmFja3MgPSBmdW5jdGlvbiAocikgeyB2YXIgZSwgbjsgciA9ICJzdHJpbmciID09IHR5cGVvZiByID8gKGUgPSByLCBuID0ge30sIFMuZWFjaChlLm1hdGNoKFApIHx8IFtdLCBmdW5jdGlvbiAoZSwgdCkgeyBuW3RdID0gITAgfSksIG4pIDogUy5leHRlbmQoe30sIHIpOyB2YXIgaSwgdCwgbywgYSwgcyA9IFtdLCB1ID0gW10sIGwgPSAtMSwgYyA9IGZ1bmN0aW9uICgpIHsgZm9yIChhID0gYSB8fCByLm9uY2UsIG8gPSBpID0gITA7IHUubGVuZ3RoOyBsID0gLTEpIHsgdCA9IHUuc2hpZnQoKTsgd2hpbGUgKCsrbCA8IHMubGVuZ3RoKSAhMSA9PT0gc1tsXS5hcHBseSh0WzBdLCB0WzFdKSAmJiByLnN0b3BPbkZhbHNlICYmIChsID0gcy5sZW5ndGgsIHQgPSAhMSkgfSByLm1lbW9yeSB8fCAodCA9ICExKSwgaSA9ICExLCBhICYmIChzID0gdCA/IFtdIDogIiIpIH0sIGYgPSB7IGFkZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcyAmJiAodCAmJiAhaSAmJiAobCA9IHMubGVuZ3RoIC0gMSwgdS5wdXNoKHQpKSwgZnVuY3Rpb24gbihlKSB7IFMuZWFjaChlLCBmdW5jdGlvbiAoZSwgdCkgeyBtKHQpID8gci51bmlxdWUgJiYgZi5oYXModCkgfHwgcy5wdXNoKHQpIDogdCAmJiB0Lmxlbmd0aCAmJiAic3RyaW5nIiAhPT0gdyh0KSAmJiBuKHQpIH0pIH0oYXJndW1lbnRzKSwgdCAmJiAhaSAmJiBjKCkpLCB0aGlzIH0sIHJlbW92ZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gUy5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG47IHdoaWxlICgtMSA8IChuID0gUy5pbkFycmF5KHQsIHMsIG4pKSkgcy5zcGxpY2UobiwgMSksIG4gPD0gbCAmJiBsLS0gfSksIHRoaXMgfSwgaGFzOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSA/IC0xIDwgUy5pbkFycmF5KGUsIHMpIDogMCA8IHMubGVuZ3RoIH0sIGVtcHR5OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzICYmIChzID0gW10pLCB0aGlzIH0sIGRpc2FibGU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEgPSB1ID0gW10sIHMgPSB0ID0gIiIsIHRoaXMgfSwgZGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICFzIH0sIGxvY2s6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEgPSB1ID0gW10sIHQgfHwgaSB8fCAocyA9IHQgPSAiIiksIHRoaXMgfSwgbG9ja2VkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhIWEgfSwgZmlyZVdpdGg6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBhIHx8ICh0ID0gW2UsICh0ID0gdCB8fCBbXSkuc2xpY2UgPyB0LnNsaWNlKCkgOiB0XSwgdS5wdXNoKHQpLCBpIHx8IGMoKSksIHRoaXMgfSwgZmlyZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gZi5maXJlV2l0aCh0aGlzLCBhcmd1bWVudHMpLCB0aGlzIH0sIGZpcmVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhIW8gfSB9OyByZXR1cm4gZiB9LCBTLmV4dGVuZCh7IERlZmVycmVkOiBmdW5jdGlvbiAoZSkgeyB2YXIgbyA9IFtbIm5vdGlmeSIsICJwcm9ncmVzcyIsIFMuQ2FsbGJhY2tzKCJtZW1vcnkiKSwgUy5DYWxsYmFja3MoIm1lbW9yeSIpLCAyXSwgWyJyZXNvbHZlIiwgImRvbmUiLCBTLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIDAsICJyZXNvbHZlZCJdLCBbInJlamVjdCIsICJmYWlsIiwgUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAxLCAicmVqZWN0ZWQiXV0sIGkgPSAicGVuZGluZyIsIGEgPSB7IHN0YXRlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBpIH0sIGFsd2F5czogZnVuY3Rpb24gKCkgeyByZXR1cm4gcy5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLCB0aGlzIH0sICJjYXRjaCI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBhLnRoZW4obnVsbCwgZSkgfSwgcGlwZTogZnVuY3Rpb24gKCkgeyB2YXIgaSA9IGFyZ3VtZW50czsgcmV0dXJuIFMuRGVmZXJyZWQoZnVuY3Rpb24gKHIpIHsgUy5lYWNoKG8sIGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gbShpW3RbNF1dKSAmJiBpW3RbNF1dOyBzW3RbMV1dKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBuICYmIG4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgZSAmJiBtKGUucHJvbWlzZSkgPyBlLnByb21pc2UoKS5wcm9ncmVzcyhyLm5vdGlmeSkuZG9uZShyLnJlc29sdmUpLmZhaWwoci5yZWplY3QpIDogclt0WzBdICsgIldpdGgiXSh0aGlzLCBuID8gW2VdIDogYXJndW1lbnRzKSB9KSB9KSwgaSA9IG51bGwgfSkucHJvbWlzZSgpIH0sIHRoZW46IGZ1bmN0aW9uICh0LCBuLCByKSB7IHZhciB1ID0gMDsgZnVuY3Rpb24gbChpLCBvLCBhLCBzKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBuID0gdGhpcywgciA9IGFyZ3VtZW50cywgZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIHQ7IGlmICghKGkgPCB1KSkgeyBpZiAoKGUgPSBhLmFwcGx5KG4sIHIpKSA9PT0gby5wcm9taXNlKCkpIHRocm93IG5ldyBUeXBlRXJyb3IoIlRoZW5hYmxlIHNlbGYtcmVzb2x1dGlvbiIpOyB0ID0gZSAmJiAoIm9iamVjdCIgPT0gdHlwZW9mIGUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSkgJiYgZS50aGVuLCBtKHQpID8gcyA/IHQuY2FsbChlLCBsKHUsIG8sIFIsIHMpLCBsKHUsIG8sIE0sIHMpKSA6ICh1KysgLCB0LmNhbGwoZSwgbCh1LCBvLCBSLCBzKSwgbCh1LCBvLCBNLCBzKSwgbCh1LCBvLCBSLCBvLm5vdGlmeVdpdGgpKSkgOiAoYSAhPT0gUiAmJiAobiA9IHZvaWQgMCwgciA9IFtlXSksIChzIHx8IG8ucmVzb2x2ZVdpdGgpKG4sIHIpKSB9IH0sIHQgPSBzID8gZSA6IGZ1bmN0aW9uICgpIHsgdHJ5IHsgZSgpIH0gY2F0Y2ggKGUpIHsgUy5EZWZlcnJlZC5leGNlcHRpb25Ib29rICYmIFMuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLCB0LnN0YWNrVHJhY2UpLCB1IDw9IGkgKyAxICYmIChhICE9PSBNICYmIChuID0gdm9pZCAwLCByID0gW2VdKSwgby5yZWplY3RXaXRoKG4sIHIpKSB9IH07IGkgPyB0KCkgOiAoUy5EZWZlcnJlZC5nZXRTdGFja0hvb2sgJiYgKHQuc3RhY2tUcmFjZSA9IFMuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCkpLCBDLnNldFRpbWVvdXQodCkpIH0gfSByZXR1cm4gUy5EZWZlcnJlZChmdW5jdGlvbiAoZSkgeyBvWzBdWzNdLmFkZChsKDAsIGUsIG0ocikgPyByIDogUiwgZS5ub3RpZnlXaXRoKSksIG9bMV1bM10uYWRkKGwoMCwgZSwgbSh0KSA/IHQgOiBSKSksIG9bMl1bM10uYWRkKGwoMCwgZSwgbShuKSA/IG4gOiBNKSkgfSkucHJvbWlzZSgpIH0sIHByb21pc2U6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBudWxsICE9IGUgPyBTLmV4dGVuZChlLCBhKSA6IGEgfSB9LCBzID0ge307IHJldHVybiBTLmVhY2gobywgZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4gPSB0WzJdLCByID0gdFs1XTsgYVt0WzFdXSA9IG4uYWRkLCByICYmIG4uYWRkKGZ1bmN0aW9uICgpIHsgaSA9IHIgfSwgb1szIC0gZV1bMl0uZGlzYWJsZSwgb1szIC0gZV1bM10uZGlzYWJsZSwgb1swXVsyXS5sb2NrLCBvWzBdWzNdLmxvY2spLCBuLmFkZCh0WzNdLmZpcmUpLCBzW3RbMF1dID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gc1t0WzBdICsgIldpdGgiXSh0aGlzID09PSBzID8gdm9pZCAwIDogdGhpcywgYXJndW1lbnRzKSwgdGhpcyB9LCBzW3RbMF0gKyAiV2l0aCJdID0gbi5maXJlV2l0aCB9KSwgYS5wcm9taXNlKHMpLCBlICYmIGUuY2FsbChzLCBzKSwgcyB9LCB3aGVuOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHQgPSBuLCByID0gQXJyYXkodCksIGkgPSBzLmNhbGwoYXJndW1lbnRzKSwgbyA9IFMuRGVmZXJyZWQoKSwgYSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByW3RdID0gdGhpcywgaVt0XSA9IDEgPCBhcmd1bWVudHMubGVuZ3RoID8gcy5jYWxsKGFyZ3VtZW50cykgOiBlLCAtLW4gfHwgby5yZXNvbHZlV2l0aChyLCBpKSB9IH07IGlmIChuIDw9IDEgJiYgKEkoZSwgby5kb25lKGEodCkpLnJlc29sdmUsIG8ucmVqZWN0LCAhbiksICJwZW5kaW5nIiA9PT0gby5zdGF0ZSgpIHx8IG0oaVt0XSAmJiBpW3RdLnRoZW4pKSkgcmV0dXJuIG8udGhlbigpOyB3aGlsZSAodC0tKSBJKGlbdF0sIGEodCksIG8ucmVqZWN0KTsgcmV0dXJuIG8ucHJvbWlzZSgpIH0gfSk7IHZhciBXID0gL14oRXZhbHxJbnRlcm5hbHxSYW5nZXxSZWZlcmVuY2V8U3ludGF4fFR5cGV8VVJJKUVycm9yJC87IFMuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayA9IGZ1bmN0aW9uIChlLCB0KSB7IEMuY29uc29sZSAmJiBDLmNvbnNvbGUud2FybiAmJiBlICYmIFcudGVzdChlLm5hbWUpICYmIEMuY29uc29sZS53YXJuKCJqUXVlcnkuRGVmZXJyZWQgZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlLCBlLnN0YWNrLCB0KSB9LCBTLnJlYWR5RXhjZXB0aW9uID0gZnVuY3Rpb24gKGUpIHsgQy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgdGhyb3cgZSB9KSB9OyB2YXIgRiA9IFMuRGVmZXJyZWQoKTsgZnVuY3Rpb24gQigpIHsgRS5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgQiksIEMucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsIEIpLCBTLnJlYWR5KCkgfSBTLmZuLnJlYWR5ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEYudGhlbihlKVsiY2F0Y2giXShmdW5jdGlvbiAoZSkgeyBTLnJlYWR5RXhjZXB0aW9uKGUpIH0pLCB0aGlzIH0sIFMuZXh0ZW5kKHsgaXNSZWFkeTogITEsIHJlYWR5V2FpdDogMSwgcmVhZHk6IGZ1bmN0aW9uIChlKSB7ICghMCA9PT0gZSA/IC0tUy5yZWFkeVdhaXQgOiBTLmlzUmVhZHkpIHx8IChTLmlzUmVhZHkgPSAhMCkgIT09IGUgJiYgMCA8IC0tUy5yZWFkeVdhaXQgfHwgRi5yZXNvbHZlV2l0aChFLCBbU10pIH0gfSksIFMucmVhZHkudGhlbiA9IEYudGhlbiwgImNvbXBsZXRlIiA9PT0gRS5yZWFkeVN0YXRlIHx8ICJsb2FkaW5nIiAhPT0gRS5yZWFkeVN0YXRlICYmICFFLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCA/IEMuc2V0VGltZW91dChTLnJlYWR5KSA6IChFLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBCKSwgQy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgQikpOyB2YXIgJCA9IGZ1bmN0aW9uIChlLCB0LCBuLCByLCBpLCBvLCBhKSB7IHZhciBzID0gMCwgdSA9IGUubGVuZ3RoLCBsID0gbnVsbCA9PSBuOyBpZiAoIm9iamVjdCIgPT09IHcobikpIGZvciAocyBpbiBpID0gITAsIG4pICQoZSwgdCwgcywgbltzXSwgITAsIG8sIGEpOyBlbHNlIGlmICh2b2lkIDAgIT09IHIgJiYgKGkgPSAhMCwgbShyKSB8fCAoYSA9ICEwKSwgbCAmJiAoYSA/ICh0LmNhbGwoZSwgciksIHQgPSBudWxsKSA6IChsID0gdCwgdCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiBsLmNhbGwoUyhlKSwgbikgfSkpLCB0KSkgZm9yICg7IHMgPCB1OyBzKyspdChlW3NdLCBuLCBhID8gciA6IHIuY2FsbChlW3NdLCBzLCB0KGVbc10sIG4pKSk7IHJldHVybiBpID8gZSA6IGwgPyB0LmNhbGwoZSkgOiB1ID8gdChlWzBdLCBuKSA6IG8gfSwgXyA9IC9eLW1zLS8sIHogPSAvLShbYS16XSkvZzsgZnVuY3Rpb24gVShlLCB0KSB7IHJldHVybiB0LnRvVXBwZXJDYXNlKCkgfSBmdW5jdGlvbiBYKGUpIHsgcmV0dXJuIGUucmVwbGFjZShfLCAibXMtIikucmVwbGFjZSh6LCBVKSB9IHZhciBWID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIDEgPT09IGUubm9kZVR5cGUgfHwgOSA9PT0gZS5ub2RlVHlwZSB8fCAhK2Uubm9kZVR5cGUgfTsgZnVuY3Rpb24gRygpIHsgdGhpcy5leHBhbmRvID0gUy5leHBhbmRvICsgRy51aWQrKyB9IEcudWlkID0gMSwgRy5wcm90b3R5cGUgPSB7IGNhY2hlOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGVbdGhpcy5leHBhbmRvXTsgcmV0dXJuIHQgfHwgKHQgPSB7fSwgVihlKSAmJiAoZS5ub2RlVHlwZSA/IGVbdGhpcy5leHBhbmRvXSA9IHQgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdGhpcy5leHBhbmRvLCB7IHZhbHVlOiB0LCBjb25maWd1cmFibGU6ICEwIH0pKSksIHQgfSwgc2V0OiBmdW5jdGlvbiAoZSwgdCwgbikgeyB2YXIgciwgaSA9IHRoaXMuY2FjaGUoZSk7IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCkgaVtYKHQpXSA9IG47IGVsc2UgZm9yIChyIGluIHQpIGlbWChyKV0gPSB0W3JdOyByZXR1cm4gaSB9LCBnZXQ6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiB2b2lkIDAgPT09IHQgPyB0aGlzLmNhY2hlKGUpIDogZVt0aGlzLmV4cGFuZG9dICYmIGVbdGhpcy5leHBhbmRvXVtYKHQpXSB9LCBhY2Nlc3M6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiB2b2lkIDAgPT09IHQgfHwgdCAmJiAic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiB2b2lkIDAgPT09IG4gPyB0aGlzLmdldChlLCB0KSA6ICh0aGlzLnNldChlLCB0LCBuKSwgdm9pZCAwICE9PSBuID8gbiA6IHQpIH0sIHJlbW92ZTogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIgPSBlW3RoaXMuZXhwYW5kb107IGlmICh2b2lkIDAgIT09IHIpIHsgaWYgKHZvaWQgMCAhPT0gdCkgeyBuID0gKHQgPSBBcnJheS5pc0FycmF5KHQpID8gdC5tYXAoWCkgOiAodCA9IFgodCkpIGluIHIgPyBbdF0gOiB0Lm1hdGNoKFApIHx8IFtdKS5sZW5ndGg7IHdoaWxlIChuLS0pIGRlbGV0ZSByW3Rbbl1dIH0gKHZvaWQgMCA9PT0gdCB8fCBTLmlzRW1wdHlPYmplY3QocikpICYmIChlLm5vZGVUeXBlID8gZVt0aGlzLmV4cGFuZG9dID0gdm9pZCAwIDogZGVsZXRlIGVbdGhpcy5leHBhbmRvXSkgfSB9LCBoYXNEYXRhOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGVbdGhpcy5leHBhbmRvXTsgcmV0dXJuIHZvaWQgMCAhPT0gdCAmJiAhUy5pc0VtcHR5T2JqZWN0KHQpIH0gfTsgdmFyIFkgPSBuZXcgRywgUSA9IG5ldyBHLCBKID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywgSyA9IC9bQS1aXS9nOyBmdW5jdGlvbiBaKGUsIHQsIG4pIHsgdmFyIHIsIGk7IGlmICh2b2lkIDAgPT09IG4gJiYgMSA9PT0gZS5ub2RlVHlwZSkgaWYgKHIgPSAiZGF0YS0iICsgdC5yZXBsYWNlKEssICItJCYiKS50b0xvd2VyQ2FzZSgpLCAic3RyaW5nIiA9PSB0eXBlb2YgKG4gPSBlLmdldEF0dHJpYnV0ZShyKSkpIHsgdHJ5IHsgbiA9ICJ0cnVlIiA9PT0gKGkgPSBuKSB8fCAiZmFsc2UiICE9PSBpICYmICgibnVsbCIgPT09IGkgPyBudWxsIDogaSA9PT0gK2kgKyAiIiA/ICtpIDogSi50ZXN0KGkpID8gSlNPTi5wYXJzZShpKSA6IGkpIH0gY2F0Y2ggKGUpIHsgfSBRLnNldChlLCB0LCBuKSB9IGVsc2UgbiA9IHZvaWQgMDsgcmV0dXJuIG4gfSBTLmV4dGVuZCh7IGhhc0RhdGE6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBRLmhhc0RhdGEoZSkgfHwgWS5oYXNEYXRhKGUpIH0sIGRhdGE6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiBRLmFjY2VzcyhlLCB0LCBuKSB9LCByZW1vdmVEYXRhOiBmdW5jdGlvbiAoZSwgdCkgeyBRLnJlbW92ZShlLCB0KSB9LCBfZGF0YTogZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIFkuYWNjZXNzKGUsIHQsIG4pIH0sIF9yZW1vdmVEYXRhOiBmdW5jdGlvbiAoZSwgdCkgeyBZLnJlbW92ZShlLCB0KSB9IH0pLCBTLmZuLmV4dGVuZCh7IGRhdGE6IGZ1bmN0aW9uIChuLCBlKSB7IHZhciB0LCByLCBpLCBvID0gdGhpc1swXSwgYSA9IG8gJiYgby5hdHRyaWJ1dGVzOyBpZiAodm9pZCAwID09PSBuKSB7IGlmICh0aGlzLmxlbmd0aCAmJiAoaSA9IFEuZ2V0KG8pLCAxID09PSBvLm5vZGVUeXBlICYmICFZLmdldChvLCAiaGFzRGF0YUF0dHJzIikpKSB7IHQgPSBhLmxlbmd0aDsgd2hpbGUgKHQtLSkgYVt0XSAmJiAwID09PSAociA9IGFbdF0ubmFtZSkuaW5kZXhPZigiZGF0YS0iKSAmJiAociA9IFgoci5zbGljZSg1KSksIFoobywgciwgaVtyXSkpOyBZLnNldChvLCAiaGFzRGF0YUF0dHJzIiwgITApIH0gcmV0dXJuIGkgfSByZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIG4gPyB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBRLnNldCh0aGlzLCBuKSB9KSA6ICQodGhpcywgZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IGlmIChvICYmIHZvaWQgMCA9PT0gZSkgcmV0dXJuIHZvaWQgMCAhPT0gKHQgPSBRLmdldChvLCBuKSkgPyB0IDogdm9pZCAwICE9PSAodCA9IFoobywgbikpID8gdCA6IHZvaWQgMDsgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUS5zZXQodGhpcywgbiwgZSkgfSkgfSwgbnVsbCwgZSwgMSA8IGFyZ3VtZW50cy5sZW5ndGgsIG51bGwsICEwKSB9LCByZW1vdmVEYXRhOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUS5yZW1vdmUodGhpcywgZSkgfSkgfSB9KSwgUy5leHRlbmQoeyBxdWV1ZTogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHI7IGlmIChlKSByZXR1cm4gdCA9ICh0IHx8ICJmeCIpICsgInF1ZXVlIiwgciA9IFkuZ2V0KGUsIHQpLCBuICYmICghciB8fCBBcnJheS5pc0FycmF5KG4pID8gciA9IFkuYWNjZXNzKGUsIHQsIFMubWFrZUFycmF5KG4pKSA6IHIucHVzaChuKSksIHIgfHwgW10gfSwgZGVxdWV1ZTogZnVuY3Rpb24gKGUsIHQpIHsgdCA9IHQgfHwgImZ4IjsgdmFyIG4gPSBTLnF1ZXVlKGUsIHQpLCByID0gbi5sZW5ndGgsIGkgPSBuLnNoaWZ0KCksIG8gPSBTLl9xdWV1ZUhvb2tzKGUsIHQpOyAiaW5wcm9ncmVzcyIgPT09IGkgJiYgKGkgPSBuLnNoaWZ0KCksIHItLSksIGkgJiYgKCJmeCIgPT09IHQgJiYgbi51bnNoaWZ0KCJpbnByb2dyZXNzIiksIGRlbGV0ZSBvLnN0b3AsIGkuY2FsbChlLCBmdW5jdGlvbiAoKSB7IFMuZGVxdWV1ZShlLCB0KSB9LCBvKSksICFyICYmIG8gJiYgby5lbXB0eS5maXJlKCkgfSwgX3F1ZXVlSG9va3M6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gdCArICJxdWV1ZUhvb2tzIjsgcmV0dXJuIFkuZ2V0KGUsIG4pIHx8IFkuYWNjZXNzKGUsIG4sIHsgZW1wdHk6IFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbiAoKSB7IFkucmVtb3ZlKGUsIFt0ICsgInF1ZXVlIiwgbl0pIH0pIH0pIH0gfSksIFMuZm4uZXh0ZW5kKHsgcXVldWU6IGZ1bmN0aW9uICh0LCBuKSB7IHZhciBlID0gMjsgcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiB0ICYmIChuID0gdCwgdCA9ICJmeCIsIGUtLSksIGFyZ3VtZW50cy5sZW5ndGggPCBlID8gUy5xdWV1ZSh0aGlzWzBdLCB0KSA6IHZvaWQgMCA9PT0gbiA/IHRoaXMgOiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFMucXVldWUodGhpcywgdCwgbik7IFMuX3F1ZXVlSG9va3ModGhpcywgdCksICJmeCIgPT09IHQgJiYgImlucHJvZ3Jlc3MiICE9PSBlWzBdICYmIFMuZGVxdWV1ZSh0aGlzLCB0KSB9KSB9LCBkZXF1ZXVlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUy5kZXF1ZXVlKHRoaXMsIGUpIH0pIH0sIGNsZWFyUXVldWU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLnF1ZXVlKGUgfHwgImZ4IiwgW10pIH0sIHByb21pc2U6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCByID0gMSwgaSA9IFMuRGVmZXJyZWQoKSwgbyA9IHRoaXMsIGEgPSB0aGlzLmxlbmd0aCwgcyA9IGZ1bmN0aW9uICgpIHsgLS1yIHx8IGkucmVzb2x2ZVdpdGgobywgW29dKSB9OyAic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCBlID0gZSB8fCAiZngiOyB3aGlsZSAoYS0tKSAobiA9IFkuZ2V0KG9bYV0sIGUgKyAicXVldWVIb29rcyIpKSAmJiBuLmVtcHR5ICYmIChyKysgLCBuLmVtcHR5LmFkZChzKSk7IHJldHVybiBzKCksIGkucHJvbWlzZSh0KSB9IH0pOyB2YXIgZWUgPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwgdGUgPSBuZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIgKyBlZSArICIpKFthLXolXSopJCIsICJpIiksIG5lID0gWyJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiXSwgcmUgPSBFLmRvY3VtZW50RWxlbWVudCwgaWUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gUy5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpIH0sIG9lID0geyBjb21wb3NlZDogITAgfTsgcmUuZ2V0Um9vdE5vZGUgJiYgKGllID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFMuY29udGFpbnMoZS5vd25lckRvY3VtZW50LCBlKSB8fCBlLmdldFJvb3ROb2RlKG9lKSA9PT0gZS5vd25lckRvY3VtZW50IH0pOyB2YXIgYWUgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gIm5vbmUiID09PSAoZSA9IHQgfHwgZSkuc3R5bGUuZGlzcGxheSB8fCAiIiA9PT0gZS5zdHlsZS5kaXNwbGF5ICYmIGllKGUpICYmICJub25lIiA9PT0gUy5jc3MoZSwgImRpc3BsYXkiKSB9OyBmdW5jdGlvbiBzZShlLCB0LCBuLCByKSB7IHZhciBpLCBvLCBhID0gMjAsIHMgPSByID8gZnVuY3Rpb24gKCkgeyByZXR1cm4gci5jdXIoKSB9IDogZnVuY3Rpb24gKCkgeyByZXR1cm4gUy5jc3MoZSwgdCwgIiIpIH0sIHUgPSBzKCksIGwgPSBuICYmIG5bM10gfHwgKFMuY3NzTnVtYmVyW3RdID8gIiIgOiAicHgiKSwgYyA9IGUubm9kZVR5cGUgJiYgKFMuY3NzTnVtYmVyW3RdIHx8ICJweCIgIT09IGwgJiYgK3UpICYmIHRlLmV4ZWMoUy5jc3MoZSwgdCkpOyBpZiAoYyAmJiBjWzNdICE9PSBsKSB7IHUgLz0gMiwgbCA9IGwgfHwgY1szXSwgYyA9ICt1IHx8IDE7IHdoaWxlIChhLS0pIFMuc3R5bGUoZSwgdCwgYyArIGwpLCAoMSAtIG8pICogKDEgLSAobyA9IHMoKSAvIHUgfHwgLjUpKSA8PSAwICYmIChhID0gMCksIGMgLz0gbzsgYyAqPSAyLCBTLnN0eWxlKGUsIHQsIGMgKyBsKSwgbiA9IG4gfHwgW10gfSByZXR1cm4gbiAmJiAoYyA9ICtjIHx8ICt1IHx8IDAsIGkgPSBuWzFdID8gYyArIChuWzFdICsgMSkgKiBuWzJdIDogK25bMl0sIHIgJiYgKHIudW5pdCA9IGwsIHIuc3RhcnQgPSBjLCByLmVuZCA9IGkpKSwgaSB9IHZhciB1ZSA9IHt9OyBmdW5jdGlvbiBsZShlLCB0KSB7IGZvciAodmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSBbXSwgYyA9IDAsIGYgPSBlLmxlbmd0aDsgYyA8IGY7IGMrKykociA9IGVbY10pLnN0eWxlICYmIChuID0gci5zdHlsZS5kaXNwbGF5LCB0ID8gKCJub25lIiA9PT0gbiAmJiAobFtjXSA9IFkuZ2V0KHIsICJkaXNwbGF5IikgfHwgbnVsbCwgbFtjXSB8fCAoci5zdHlsZS5kaXNwbGF5ID0gIiIpKSwgIiIgPT09IHIuc3R5bGUuZGlzcGxheSAmJiBhZShyKSAmJiAobFtjXSA9ICh1ID0gYSA9IG8gPSB2b2lkIDAsIGEgPSAoaSA9IHIpLm93bmVyRG9jdW1lbnQsIHMgPSBpLm5vZGVOYW1lLCAodSA9IHVlW3NdKSB8fCAobyA9IGEuYm9keS5hcHBlbmRDaGlsZChhLmNyZWF0ZUVsZW1lbnQocykpLCB1ID0gUy5jc3MobywgImRpc3BsYXkiKSwgby5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG8pLCAibm9uZSIgPT09IHUgJiYgKHUgPSAiYmxvY2siKSwgdWVbc10gPSB1KSkpKSA6ICJub25lIiAhPT0gbiAmJiAobFtjXSA9ICJub25lIiwgWS5zZXQociwgImRpc3BsYXkiLCBuKSkpOyBmb3IgKGMgPSAwOyBjIDwgZjsgYysrKW51bGwgIT0gbFtjXSAmJiAoZVtjXS5zdHlsZS5kaXNwbGF5ID0gbFtjXSk7IHJldHVybiBlIH0gUy5mbi5leHRlbmQoeyBzaG93OiBmdW5jdGlvbiAoKSB7IHJldHVybiBsZSh0aGlzLCAhMCkgfSwgaGlkZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gbGUodGhpcykgfSwgdG9nZ2xlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gImJvb2xlYW4iID09IHR5cGVvZiBlID8gZSA/IHRoaXMuc2hvdygpIDogdGhpcy5oaWRlKCkgOiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBhZSh0aGlzKSA/IFModGhpcykuc2hvdygpIDogUyh0aGlzKS5oaWRlKCkgfSkgfSB9KTsgdmFyIGNlLCBmZSwgcGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwgZGUgPSAvPChbYS16XVteXC9cMD5ceDIwXHRcclxuXGZdKikvaSwgaGUgPSAvXiR8Xm1vZHVsZSR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2k7IGNlID0gRS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJkaXYiKSksIChmZSA9IEUuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInJhZGlvIiksIGZlLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsICJjaGVja2VkIiksIGZlLnNldEF0dHJpYnV0ZSgibmFtZSIsICJ0IiksIGNlLmFwcGVuZENoaWxkKGZlKSwgeS5jaGVja0Nsb25lID0gY2UuY2xvbmVOb2RlKCEwKS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLCBjZS5pbm5lckhUTUwgPSAiPHRleHRhcmVhPng8L3RleHRhcmVhPiIsIHkubm9DbG9uZUNoZWNrZWQgPSAhIWNlLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmRlZmF1bHRWYWx1ZSwgY2UuaW5uZXJIVE1MID0gIjxvcHRpb24+PC9vcHRpb24+IiwgeS5vcHRpb24gPSAhIWNlLmxhc3RDaGlsZDsgdmFyIGdlID0geyB0aGVhZDogWzEsICI8dGFibGU+IiwgIjwvdGFibGU+Il0sIGNvbDogWzIsICI8dGFibGU+PGNvbGdyb3VwPiIsICI8L2NvbGdyb3VwPjwvdGFibGU+Il0sIHRyOiBbMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iXSwgdGQ6IFszLCAiPHRhYmxlPjx0Ym9keT48dHI+IiwgIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLCBfZGVmYXVsdDogWzAsICIiLCAiIl0gfTsgZnVuY3Rpb24gdmUoZSwgdCkgeyB2YXIgbjsgcmV0dXJuIG4gPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodCB8fCAiKiIpIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUucXVlcnlTZWxlY3RvckFsbCA/IGUucXVlcnlTZWxlY3RvckFsbCh0IHx8ICIqIikgOiBbXSwgdm9pZCAwID09PSB0IHx8IHQgJiYgQShlLCB0KSA/IFMubWVyZ2UoW2VdLCBuKSA6IG4gfSBmdW5jdGlvbiB5ZShlLCB0KSB7IGZvciAodmFyIG4gPSAwLCByID0gZS5sZW5ndGg7IG4gPCByOyBuKyspWS5zZXQoZVtuXSwgImdsb2JhbEV2YWwiLCAhdCB8fCBZLmdldCh0W25dLCAiZ2xvYmFsRXZhbCIpKSB9IGdlLnRib2R5ID0gZ2UudGZvb3QgPSBnZS5jb2xncm91cCA9IGdlLmNhcHRpb24gPSBnZS50aGVhZCwgZ2UudGggPSBnZS50ZCwgeS5vcHRpb24gfHwgKGdlLm9wdGdyb3VwID0gZ2Uub3B0aW9uID0gWzEsICI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwgIjwvc2VsZWN0PiJdKTsgdmFyIG1lID0gLzx8JiM/XHcrOy87IGZ1bmN0aW9uIHhlKGUsIHQsIG4sIHIsIGkpIHsgZm9yICh2YXIgbywgYSwgcywgdSwgbCwgYywgZiA9IHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCBwID0gW10sIGQgPSAwLCBoID0gZS5sZW5ndGg7IGQgPCBoOyBkKyspaWYgKChvID0gZVtkXSkgfHwgMCA9PT0gbykgaWYgKCJvYmplY3QiID09PSB3KG8pKSBTLm1lcmdlKHAsIG8ubm9kZVR5cGUgPyBbb10gOiBvKTsgZWxzZSBpZiAobWUudGVzdChvKSkgeyBhID0gYSB8fCBmLmFwcGVuZENoaWxkKHQuY3JlYXRlRWxlbWVudCgiZGl2IikpLCBzID0gKGRlLmV4ZWMobykgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCksIHUgPSBnZVtzXSB8fCBnZS5fZGVmYXVsdCwgYS5pbm5lckhUTUwgPSB1WzFdICsgUy5odG1sUHJlZmlsdGVyKG8pICsgdVsyXSwgYyA9IHVbMF07IHdoaWxlIChjLS0pIGEgPSBhLmxhc3RDaGlsZDsgUy5tZXJnZShwLCBhLmNoaWxkTm9kZXMpLCAoYSA9IGYuZmlyc3RDaGlsZCkudGV4dENvbnRlbnQgPSAiIiB9IGVsc2UgcC5wdXNoKHQuY3JlYXRlVGV4dE5vZGUobykpOyBmLnRleHRDb250ZW50ID0gIiIsIGQgPSAwOyB3aGlsZSAobyA9IHBbZCsrXSkgaWYgKHIgJiYgLTEgPCBTLmluQXJyYXkobywgcikpIGkgJiYgaS5wdXNoKG8pOyBlbHNlIGlmIChsID0gaWUobyksIGEgPSB2ZShmLmFwcGVuZENoaWxkKG8pLCAic2NyaXB0IiksIGwgJiYgeWUoYSksIG4pIHsgYyA9IDA7IHdoaWxlIChvID0gYVtjKytdKSBoZS50ZXN0KG8udHlwZSB8fCAiIikgJiYgbi5wdXNoKG8pIH0gcmV0dXJuIGYgfSB2YXIgYmUgPSAvXmtleS8sIHdlID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51fGRyYWd8ZHJvcCl8Y2xpY2svLCBUZSA9IC9eKFteLl0qKSg/OlwuKC4rKXwpLzsgZnVuY3Rpb24gQ2UoKSB7IHJldHVybiAhMCB9IGZ1bmN0aW9uIEVlKCkgeyByZXR1cm4gITEgfSBmdW5jdGlvbiBTZShlLCB0KSB7IHJldHVybiBlID09PSBmdW5jdGlvbiAoKSB7IHRyeSB7IHJldHVybiBFLmFjdGl2ZUVsZW1lbnQgfSBjYXRjaCAoZSkgeyB9IH0oKSA9PSAoImZvY3VzIiA9PT0gdCkgfSBmdW5jdGlvbiBrZShlLCB0LCBuLCByLCBpLCBvKSB7IHZhciBhLCBzOyBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIHQpIHsgZm9yIChzIGluICJzdHJpbmciICE9IHR5cGVvZiBuICYmIChyID0gciB8fCBuLCBuID0gdm9pZCAwKSwgdCkga2UoZSwgcywgbiwgciwgdFtzXSwgbyk7IHJldHVybiBlIH0gaWYgKG51bGwgPT0gciAmJiBudWxsID09IGkgPyAoaSA9IG4sIHIgPSBuID0gdm9pZCAwKSA6IG51bGwgPT0gaSAmJiAoInN0cmluZyIgPT0gdHlwZW9mIG4gPyAoaSA9IHIsIHIgPSB2b2lkIDApIDogKGkgPSByLCByID0gbiwgbiA9IHZvaWQgMCkpLCAhMSA9PT0gaSkgaSA9IEVlOyBlbHNlIGlmICghaSkgcmV0dXJuIGU7IHJldHVybiAxID09PSBvICYmIChhID0gaSwgKGkgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gUygpLm9mZihlKSwgYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0pLmd1aWQgPSBhLmd1aWQgfHwgKGEuZ3VpZCA9IFMuZ3VpZCsrKSksIGUuZWFjaChmdW5jdGlvbiAoKSB7IFMuZXZlbnQuYWRkKHRoaXMsIHQsIGksIHIsIG4pIH0pIH0gZnVuY3Rpb24gQWUoZSwgaSwgbykgeyBvID8gKFkuc2V0KGUsIGksICExKSwgUy5ldmVudC5hZGQoZSwgaSwgeyBuYW1lc3BhY2U6ICExLCBoYW5kbGVyOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiwgciA9IFkuZ2V0KHRoaXMsIGkpOyBpZiAoMSAmIGUuaXNUcmlnZ2VyICYmIHRoaXNbaV0pIHsgaWYgKHIubGVuZ3RoKSAoUy5ldmVudC5zcGVjaWFsW2ldIHx8IHt9KS5kZWxlZ2F0ZVR5cGUgJiYgZS5zdG9wUHJvcGFnYXRpb24oKTsgZWxzZSBpZiAociA9IHMuY2FsbChhcmd1bWVudHMpLCBZLnNldCh0aGlzLCBpLCByKSwgdCA9IG8odGhpcywgaSksIHRoaXNbaV0oKSwgciAhPT0gKG4gPSBZLmdldCh0aGlzLCBpKSkgfHwgdCA/IFkuc2V0KHRoaXMsIGksICExKSA6IG4gPSB7fSwgciAhPT0gbikgcmV0dXJuIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksIGUucHJldmVudERlZmF1bHQoKSwgbi52YWx1ZSB9IGVsc2Ugci5sZW5ndGggJiYgKFkuc2V0KHRoaXMsIGksIHsgdmFsdWU6IFMuZXZlbnQudHJpZ2dlcihTLmV4dGVuZChyWzBdLCBTLkV2ZW50LnByb3RvdHlwZSksIHIuc2xpY2UoMSksIHRoaXMpIH0pLCBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpKSB9IH0pKSA6IHZvaWQgMCA9PT0gWS5nZXQoZSwgaSkgJiYgUy5ldmVudC5hZGQoZSwgaSwgQ2UpIH0gUy5ldmVudCA9IHsgZ2xvYmFsOiB7fSwgYWRkOiBmdW5jdGlvbiAodCwgZSwgbiwgciwgaSkgeyB2YXIgbywgYSwgcywgdSwgbCwgYywgZiwgcCwgZCwgaCwgZywgdiA9IFkuZ2V0KHQpOyBpZiAoVih0KSkgeyBuLmhhbmRsZXIgJiYgKG4gPSAobyA9IG4pLmhhbmRsZXIsIGkgPSBvLnNlbGVjdG9yKSwgaSAmJiBTLmZpbmQubWF0Y2hlc1NlbGVjdG9yKHJlLCBpKSwgbi5ndWlkIHx8IChuLmd1aWQgPSBTLmd1aWQrKyksICh1ID0gdi5ldmVudHMpIHx8ICh1ID0gdi5ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpKSwgKGEgPSB2LmhhbmRsZSkgfHwgKGEgPSB2LmhhbmRsZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgUyAmJiBTLmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlID8gUy5ldmVudC5kaXNwYXRjaC5hcHBseSh0LCBhcmd1bWVudHMpIDogdm9pZCAwIH0pLCBsID0gKGUgPSAoZSB8fCAiIikubWF0Y2goUCkgfHwgWyIiXSkubGVuZ3RoOyB3aGlsZSAobC0tKSBkID0gZyA9IChzID0gVGUuZXhlYyhlW2xdKSB8fCBbXSlbMV0sIGggPSAoc1syXSB8fCAiIikuc3BsaXQoIi4iKS5zb3J0KCksIGQgJiYgKGYgPSBTLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIGQgPSAoaSA/IGYuZGVsZWdhdGVUeXBlIDogZi5iaW5kVHlwZSkgfHwgZCwgZiA9IFMuZXZlbnQuc3BlY2lhbFtkXSB8fCB7fSwgYyA9IFMuZXh0ZW5kKHsgdHlwZTogZCwgb3JpZ1R5cGU6IGcsIGRhdGE6IHIsIGhhbmRsZXI6IG4sIGd1aWQ6IG4uZ3VpZCwgc2VsZWN0b3I6IGksIG5lZWRzQ29udGV4dDogaSAmJiBTLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoaSksIG5hbWVzcGFjZTogaC5qb2luKCIuIikgfSwgbyksIChwID0gdVtkXSkgfHwgKChwID0gdVtkXSA9IFtdKS5kZWxlZ2F0ZUNvdW50ID0gMCwgZi5zZXR1cCAmJiAhMSAhPT0gZi5zZXR1cC5jYWxsKHQsIHIsIGgsIGEpIHx8IHQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0LmFkZEV2ZW50TGlzdGVuZXIoZCwgYSkpLCBmLmFkZCAmJiAoZi5hZGQuY2FsbCh0LCBjKSwgYy5oYW5kbGVyLmd1aWQgfHwgKGMuaGFuZGxlci5ndWlkID0gbi5ndWlkKSksIGkgPyBwLnNwbGljZShwLmRlbGVnYXRlQ291bnQrKywgMCwgYykgOiBwLnB1c2goYyksIFMuZXZlbnQuZ2xvYmFsW2RdID0gITApIH0gfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSwgdCwgbiwgciwgaSkgeyB2YXIgbywgYSwgcywgdSwgbCwgYywgZiwgcCwgZCwgaCwgZywgdiA9IFkuaGFzRGF0YShlKSAmJiBZLmdldChlKTsgaWYgKHYgJiYgKHUgPSB2LmV2ZW50cykpIHsgbCA9ICh0ID0gKHQgfHwgIiIpLm1hdGNoKFApIHx8IFsiIl0pLmxlbmd0aDsgd2hpbGUgKGwtLSkgaWYgKGQgPSBnID0gKHMgPSBUZS5leGVjKHRbbF0pIHx8IFtdKVsxXSwgaCA9IChzWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKSwgZCkgeyBmID0gUy5ldmVudC5zcGVjaWFsW2RdIHx8IHt9LCBwID0gdVtkID0gKHIgPyBmLmRlbGVnYXRlVHlwZSA6IGYuYmluZFR5cGUpIHx8IGRdIHx8IFtdLCBzID0gc1syXSAmJiBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSwgYSA9IG8gPSBwLmxlbmd0aDsgd2hpbGUgKG8tLSkgYyA9IHBbb10sICFpICYmIGcgIT09IGMub3JpZ1R5cGUgfHwgbiAmJiBuLmd1aWQgIT09IGMuZ3VpZCB8fCBzICYmICFzLnRlc3QoYy5uYW1lc3BhY2UpIHx8IHIgJiYgciAhPT0gYy5zZWxlY3RvciAmJiAoIioqIiAhPT0gciB8fCAhYy5zZWxlY3RvcikgfHwgKHAuc3BsaWNlKG8sIDEpLCBjLnNlbGVjdG9yICYmIHAuZGVsZWdhdGVDb3VudC0tICwgZi5yZW1vdmUgJiYgZi5yZW1vdmUuY2FsbChlLCBjKSk7IGEgJiYgIXAubGVuZ3RoICYmIChmLnRlYXJkb3duICYmICExICE9PSBmLnRlYXJkb3duLmNhbGwoZSwgaCwgdi5oYW5kbGUpIHx8IFMucmVtb3ZlRXZlbnQoZSwgZCwgdi5oYW5kbGUpLCBkZWxldGUgdVtkXSkgfSBlbHNlIGZvciAoZCBpbiB1KSBTLmV2ZW50LnJlbW92ZShlLCBkICsgdFtsXSwgbiwgciwgITApOyBTLmlzRW1wdHlPYmplY3QodSkgJiYgWS5yZW1vdmUoZSwgImhhbmRsZSBldmVudHMiKSB9IH0sIGRpc3BhdGNoOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiwgciwgaSwgbywgYSwgcyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKSwgdSA9IFMuZXZlbnQuZml4KGUpLCBsID0gKFkuZ2V0KHRoaXMsICJldmVudHMiKSB8fCBPYmplY3QuY3JlYXRlKG51bGwpKVt1LnR5cGVdIHx8IFtdLCBjID0gUy5ldmVudC5zcGVjaWFsW3UudHlwZV0gfHwge307IGZvciAoc1swXSA9IHUsIHQgPSAxOyB0IDwgYXJndW1lbnRzLmxlbmd0aDsgdCsrKXNbdF0gPSBhcmd1bWVudHNbdF07IGlmICh1LmRlbGVnYXRlVGFyZ2V0ID0gdGhpcywgIWMucHJlRGlzcGF0Y2ggfHwgITEgIT09IGMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCB1KSkgeyBhID0gUy5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIHUsIGwpLCB0ID0gMDsgd2hpbGUgKChpID0gYVt0KytdKSAmJiAhdS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7IHUuY3VycmVudFRhcmdldCA9IGkuZWxlbSwgbiA9IDA7IHdoaWxlICgobyA9IGkuaGFuZGxlcnNbbisrXSkgJiYgIXUuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgdS5ybmFtZXNwYWNlICYmICExICE9PSBvLm5hbWVzcGFjZSAmJiAhdS5ybmFtZXNwYWNlLnRlc3Qoby5uYW1lc3BhY2UpIHx8ICh1LmhhbmRsZU9iaiA9IG8sIHUuZGF0YSA9IG8uZGF0YSwgdm9pZCAwICE9PSAociA9ICgoUy5ldmVudC5zcGVjaWFsW28ub3JpZ1R5cGVdIHx8IHt9KS5oYW5kbGUgfHwgby5oYW5kbGVyKS5hcHBseShpLmVsZW0sIHMpKSAmJiAhMSA9PT0gKHUucmVzdWx0ID0gcikgJiYgKHUucHJldmVudERlZmF1bHQoKSwgdS5zdG9wUHJvcGFnYXRpb24oKSkpIH0gcmV0dXJuIGMucG9zdERpc3BhdGNoICYmIGMucG9zdERpc3BhdGNoLmNhbGwodGhpcywgdSksIHUucmVzdWx0IH0gfSwgaGFuZGxlcnM6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCByLCBpLCBvLCBhLCBzID0gW10sIHUgPSB0LmRlbGVnYXRlQ291bnQsIGwgPSBlLnRhcmdldDsgaWYgKHUgJiYgbC5ub2RlVHlwZSAmJiAhKCJjbGljayIgPT09IGUudHlwZSAmJiAxIDw9IGUuYnV0dG9uKSkgZm9yICg7IGwgIT09IHRoaXM7IGwgPSBsLnBhcmVudE5vZGUgfHwgdGhpcylpZiAoMSA9PT0gbC5ub2RlVHlwZSAmJiAoImNsaWNrIiAhPT0gZS50eXBlIHx8ICEwICE9PSBsLmRpc2FibGVkKSkgeyBmb3IgKG8gPSBbXSwgYSA9IHt9LCBuID0gMDsgbiA8IHU7IG4rKyl2b2lkIDAgPT09IGFbaSA9IChyID0gdFtuXSkuc2VsZWN0b3IgKyAiICJdICYmIChhW2ldID0gci5uZWVkc0NvbnRleHQgPyAtMSA8IFMoaSwgdGhpcykuaW5kZXgobCkgOiBTLmZpbmQoaSwgdGhpcywgbnVsbCwgW2xdKS5sZW5ndGgpLCBhW2ldICYmIG8ucHVzaChyKTsgby5sZW5ndGggJiYgcy5wdXNoKHsgZWxlbTogbCwgaGFuZGxlcnM6IG8gfSkgfSByZXR1cm4gbCA9IHRoaXMsIHUgPCB0Lmxlbmd0aCAmJiBzLnB1c2goeyBlbGVtOiBsLCBoYW5kbGVyczogdC5zbGljZSh1KSB9KSwgcyB9LCBhZGRQcm9wOiBmdW5jdGlvbiAodCwgZSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoUy5FdmVudC5wcm90b3R5cGUsIHQsIHsgZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIGdldDogbShlKSA/IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMub3JpZ2luYWxFdmVudCkgcmV0dXJuIGUodGhpcy5vcmlnaW5hbEV2ZW50KSB9IDogZnVuY3Rpb24gKCkgeyBpZiAodGhpcy5vcmlnaW5hbEV2ZW50KSByZXR1cm4gdGhpcy5vcmlnaW5hbEV2ZW50W3RdIH0sIHNldDogZnVuY3Rpb24gKGUpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHQsIHsgZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIHdyaXRhYmxlOiAhMCwgdmFsdWU6IGUgfSkgfSB9KSB9LCBmaXg6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlW1MuZXhwYW5kb10gPyBlIDogbmV3IFMuRXZlbnQoZSkgfSwgc3BlY2lhbDogeyBsb2FkOiB7IG5vQnViYmxlOiAhMCB9LCBjbGljazogeyBzZXR1cDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB0aGlzIHx8IGU7IHJldHVybiBwZS50ZXN0KHQudHlwZSkgJiYgdC5jbGljayAmJiBBKHQsICJpbnB1dCIpICYmIEFlKHQsICJjbGljayIsIENlKSwgITEgfSwgdHJpZ2dlcjogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB0aGlzIHx8IGU7IHJldHVybiBwZS50ZXN0KHQudHlwZSkgJiYgdC5jbGljayAmJiBBKHQsICJpbnB1dCIpICYmIEFlKHQsICJjbGljayIpLCAhMCB9LCBfZGVmYXVsdDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnRhcmdldDsgcmV0dXJuIHBlLnRlc3QodC50eXBlKSAmJiB0LmNsaWNrICYmIEEodCwgImlucHV0IikgJiYgWS5nZXQodCwgImNsaWNrIikgfHwgQSh0LCAiYSIpIH0gfSwgYmVmb3JldW5sb2FkOiB7IHBvc3REaXNwYXRjaDogZnVuY3Rpb24gKGUpIHsgdm9pZCAwICE9PSBlLnJlc3VsdCAmJiBlLm9yaWdpbmFsRXZlbnQgJiYgKGUub3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZSA9IGUucmVzdWx0KSB9IH0gfSB9LCBTLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgZS5yZW1vdmVFdmVudExpc3RlbmVyICYmIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LCBuKSB9LCBTLkV2ZW50ID0gZnVuY3Rpb24gKGUsIHQpIHsgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFMuRXZlbnQpKSByZXR1cm4gbmV3IFMuRXZlbnQoZSwgdCk7IGUgJiYgZS50eXBlID8gKHRoaXMub3JpZ2luYWxFdmVudCA9IGUsIHRoaXMudHlwZSA9IGUudHlwZSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBlLmRlZmF1bHRQcmV2ZW50ZWQgfHwgdm9pZCAwID09PSBlLmRlZmF1bHRQcmV2ZW50ZWQgJiYgITEgPT09IGUucmV0dXJuVmFsdWUgPyBDZSA6IEVlLCB0aGlzLnRhcmdldCA9IGUudGFyZ2V0ICYmIDMgPT09IGUudGFyZ2V0Lm5vZGVUeXBlID8gZS50YXJnZXQucGFyZW50Tm9kZSA6IGUudGFyZ2V0LCB0aGlzLmN1cnJlbnRUYXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQsIHRoaXMucmVsYXRlZFRhcmdldCA9IGUucmVsYXRlZFRhcmdldCkgOiB0aGlzLnR5cGUgPSBlLCB0ICYmIFMuZXh0ZW5kKHRoaXMsIHQpLCB0aGlzLnRpbWVTdGFtcCA9IGUgJiYgZS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKSwgdGhpc1tTLmV4cGFuZG9dID0gITAgfSwgUy5FdmVudC5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBTLkV2ZW50LCBpc0RlZmF1bHRQcmV2ZW50ZWQ6IEVlLCBpc1Byb3BhZ2F0aW9uU3RvcHBlZDogRWUsIGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiBFZSwgaXNTaW11bGF0ZWQ6ICExLCBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBDZSwgZSAmJiAhdGhpcy5pc1NpbXVsYXRlZCAmJiBlLnByZXZlbnREZWZhdWx0KCkgfSwgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OyB0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gQ2UsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5zdG9wUHJvcGFnYXRpb24oKSB9LCBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7IHRoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSBDZSwgZSAmJiAhdGhpcy5pc1NpbXVsYXRlZCAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCB0aGlzLnN0b3BQcm9wYWdhdGlvbigpIH0gfSwgUy5lYWNoKHsgYWx0S2V5OiAhMCwgYnViYmxlczogITAsIGNhbmNlbGFibGU6ICEwLCBjaGFuZ2VkVG91Y2hlczogITAsIGN0cmxLZXk6ICEwLCBkZXRhaWw6ICEwLCBldmVudFBoYXNlOiAhMCwgbWV0YUtleTogITAsIHBhZ2VYOiAhMCwgcGFnZVk6ICEwLCBzaGlmdEtleTogITAsIHZpZXc6ICEwLCAiY2hhciI6ICEwLCBjb2RlOiAhMCwgY2hhckNvZGU6ICEwLCBrZXk6ICEwLCBrZXlDb2RlOiAhMCwgYnV0dG9uOiAhMCwgYnV0dG9uczogITAsIGNsaWVudFg6ICEwLCBjbGllbnRZOiAhMCwgb2Zmc2V0WDogITAsIG9mZnNldFk6ICEwLCBwb2ludGVySWQ6ICEwLCBwb2ludGVyVHlwZTogITAsIHNjcmVlblg6ICEwLCBzY3JlZW5ZOiAhMCwgdGFyZ2V0VG91Y2hlczogITAsIHRvRWxlbWVudDogITAsIHRvdWNoZXM6ICEwLCB3aGljaDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLmJ1dHRvbjsgcmV0dXJuIG51bGwgPT0gZS53aGljaCAmJiBiZS50ZXN0KGUudHlwZSkgPyBudWxsICE9IGUuY2hhckNvZGUgPyBlLmNoYXJDb2RlIDogZS5rZXlDb2RlIDogIWUud2hpY2ggJiYgdm9pZCAwICE9PSB0ICYmIHdlLnRlc3QoZS50eXBlKSA/IDEgJiB0ID8gMSA6IDIgJiB0ID8gMyA6IDQgJiB0ID8gMiA6IDAgOiBlLndoaWNoIH0gfSwgUy5ldmVudC5hZGRQcm9wKSwgUy5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiAoZSwgdCkgeyBTLmV2ZW50LnNwZWNpYWxbZV0gPSB7IHNldHVwOiBmdW5jdGlvbiAoKSB7IHJldHVybiBBZSh0aGlzLCBlLCBTZSksICExIH0sIHRyaWdnZXI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEFlKHRoaXMsIGUpLCAhMCB9LCBkZWxlZ2F0ZVR5cGU6IHQgfSB9KSwgUy5lYWNoKHsgbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIsIHBvaW50ZXJlbnRlcjogInBvaW50ZXJvdmVyIiwgcG9pbnRlcmxlYXZlOiAicG9pbnRlcm91dCIgfSwgZnVuY3Rpb24gKGUsIGkpIHsgUy5ldmVudC5zcGVjaWFsW2VdID0geyBkZWxlZ2F0ZVR5cGU6IGksIGJpbmRUeXBlOiBpLCBoYW5kbGU6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBuID0gZS5yZWxhdGVkVGFyZ2V0LCByID0gZS5oYW5kbGVPYmo7IHJldHVybiBuICYmIChuID09PSB0aGlzIHx8IFMuY29udGFpbnModGhpcywgbikpIHx8IChlLnR5cGUgPSByLm9yaWdUeXBlLCB0ID0gci5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGUudHlwZSA9IGkpLCB0IH0gfSB9KSwgUy5mbi5leHRlbmQoeyBvbjogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHsgcmV0dXJuIGtlKHRoaXMsIGUsIHQsIG4sIHIpIH0sIG9uZTogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHsgcmV0dXJuIGtlKHRoaXMsIGUsIHQsIG4sIHIsIDEpIH0sIG9mZjogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGk7IGlmIChlICYmIGUucHJldmVudERlZmF1bHQgJiYgZS5oYW5kbGVPYmopIHJldHVybiByID0gZS5oYW5kbGVPYmosIFMoZS5kZWxlZ2F0ZVRhcmdldCkub2ZmKHIubmFtZXNwYWNlID8gci5vcmlnVHlwZSArICIuIiArIHIubmFtZXNwYWNlIDogci5vcmlnVHlwZSwgci5zZWxlY3Rvciwgci5oYW5kbGVyKSwgdGhpczsgaWYgKCJvYmplY3QiID09IHR5cGVvZiBlKSB7IGZvciAoaSBpbiBlKSB0aGlzLm9mZihpLCB0LCBlW2ldKTsgcmV0dXJuIHRoaXMgfSByZXR1cm4gITEgIT09IHQgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCB8fCAobiA9IHQsIHQgPSB2b2lkIDApLCAhMSA9PT0gbiAmJiAobiA9IEVlKSwgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUy5ldmVudC5yZW1vdmUodGhpcywgZSwgbiwgdCkgfSkgfSB9KTsgdmFyIE5lID0gLzxzY3JpcHR8PHN0eWxlfDxsaW5rL2ksIERlID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksIGplID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nOyBmdW5jdGlvbiBxZShlLCB0KSB7IHJldHVybiBBKGUsICJ0YWJsZSIpICYmIEEoMTEgIT09IHQubm9kZVR5cGUgPyB0IDogdC5maXJzdENoaWxkLCAidHIiKSAmJiBTKGUpLmNoaWxkcmVuKCJ0Ym9keSIpWzBdIHx8IGUgfSBmdW5jdGlvbiBMZShlKSB7IHJldHVybiBlLnR5cGUgPSAobnVsbCAhPT0gZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgKyAiLyIgKyBlLnR5cGUsIGUgfSBmdW5jdGlvbiBIZShlKSB7IHJldHVybiAidHJ1ZS8iID09PSAoZS50eXBlIHx8ICIiKS5zbGljZSgwLCA1KSA/IGUudHlwZSA9IGUudHlwZS5zbGljZSg1KSA6IGUucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksIGUgfSBmdW5jdGlvbiBPZShlLCB0KSB7IHZhciBuLCByLCBpLCBvLCBhLCBzOyBpZiAoMSA9PT0gdC5ub2RlVHlwZSkgeyBpZiAoWS5oYXNEYXRhKGUpICYmIChzID0gWS5nZXQoZSkuZXZlbnRzKSkgZm9yIChpIGluIFkucmVtb3ZlKHQsICJoYW5kbGUgZXZlbnRzIiksIHMpIGZvciAobiA9IDAsIHIgPSBzW2ldLmxlbmd0aDsgbiA8IHI7IG4rKylTLmV2ZW50LmFkZCh0LCBpLCBzW2ldW25dKTsgUS5oYXNEYXRhKGUpICYmIChvID0gUS5hY2Nlc3MoZSksIGEgPSBTLmV4dGVuZCh7fSwgbyksIFEuc2V0KHQsIGEpKSB9IH0gZnVuY3Rpb24gUGUobiwgciwgaSwgbykgeyByID0gZyhyKTsgdmFyIGUsIHQsIGEsIHMsIHUsIGwsIGMgPSAwLCBmID0gbi5sZW5ndGgsIHAgPSBmIC0gMSwgZCA9IHJbMF0sIGggPSBtKGQpOyBpZiAoaCB8fCAxIDwgZiAmJiAic3RyaW5nIiA9PSB0eXBlb2YgZCAmJiAheS5jaGVja0Nsb25lICYmIERlLnRlc3QoZCkpIHJldHVybiBuLmVhY2goZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBuLmVxKGUpOyBoICYmIChyWzBdID0gZC5jYWxsKHRoaXMsIGUsIHQuaHRtbCgpKSksIFBlKHQsIHIsIGksIG8pIH0pOyBpZiAoZiAmJiAodCA9IChlID0geGUociwgblswXS5vd25lckRvY3VtZW50LCAhMSwgbiwgbykpLmZpcnN0Q2hpbGQsIDEgPT09IGUuY2hpbGROb2Rlcy5sZW5ndGggJiYgKGUgPSB0KSwgdCB8fCBvKSkgeyBmb3IgKHMgPSAoYSA9IFMubWFwKHZlKGUsICJzY3JpcHQiKSwgTGUpKS5sZW5ndGg7IGMgPCBmOyBjKyspdSA9IGUsIGMgIT09IHAgJiYgKHUgPSBTLmNsb25lKHUsICEwLCAhMCksIHMgJiYgUy5tZXJnZShhLCB2ZSh1LCAic2NyaXB0IikpKSwgaS5jYWxsKG5bY10sIHUsIGMpOyBpZiAocykgZm9yIChsID0gYVthLmxlbmd0aCAtIDFdLm93bmVyRG9jdW1lbnQsIFMubWFwKGEsIEhlKSwgYyA9IDA7IGMgPCBzOyBjKyspdSA9IGFbY10sIGhlLnRlc3QodS50eXBlIHx8ICIiKSAmJiAhWS5hY2Nlc3ModSwgImdsb2JhbEV2YWwiKSAmJiBTLmNvbnRhaW5zKGwsIHUpICYmICh1LnNyYyAmJiAibW9kdWxlIiAhPT0gKHUudHlwZSB8fCAiIikudG9Mb3dlckNhc2UoKSA/IFMuX2V2YWxVcmwgJiYgIXUubm9Nb2R1bGUgJiYgUy5fZXZhbFVybCh1LnNyYywgeyBub25jZTogdS5ub25jZSB8fCB1LmdldEF0dHJpYnV0ZSgibm9uY2UiKSB9LCBsKSA6IGIodS50ZXh0Q29udGVudC5yZXBsYWNlKGplLCAiIiksIHUsIGwpKSB9IHJldHVybiBuIH0gZnVuY3Rpb24gUmUoZSwgdCwgbikgeyBmb3IgKHZhciByLCBpID0gdCA/IFMuZmlsdGVyKHQsIGUpIDogZSwgbyA9IDA7IG51bGwgIT0gKHIgPSBpW29dKTsgbysrKW4gfHwgMSAhPT0gci5ub2RlVHlwZSB8fCBTLmNsZWFuRGF0YSh2ZShyKSksIHIucGFyZW50Tm9kZSAmJiAobiAmJiBpZShyKSAmJiB5ZSh2ZShyLCAic2NyaXB0IikpLCByLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocikpOyByZXR1cm4gZSB9IFMuZXh0ZW5kKHsgaHRtbFByZWZpbHRlcjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgfSwgY2xvbmU6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhLCBzLCB1LCBsLCBjID0gZS5jbG9uZU5vZGUoITApLCBmID0gaWUoZSk7IGlmICghKHkubm9DbG9uZUNoZWNrZWQgfHwgMSAhPT0gZS5ub2RlVHlwZSAmJiAxMSAhPT0gZS5ub2RlVHlwZSB8fCBTLmlzWE1MRG9jKGUpKSkgZm9yIChhID0gdmUoYyksIHIgPSAwLCBpID0gKG8gPSB2ZShlKSkubGVuZ3RoOyByIDwgaTsgcisrKXMgPSBvW3JdLCB1ID0gYVtyXSwgdm9pZCAwLCAiaW5wdXQiID09PSAobCA9IHUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgJiYgcGUudGVzdChzLnR5cGUpID8gdS5jaGVja2VkID0gcy5jaGVja2VkIDogImlucHV0IiAhPT0gbCAmJiAidGV4dGFyZWEiICE9PSBsIHx8ICh1LmRlZmF1bHRWYWx1ZSA9IHMuZGVmYXVsdFZhbHVlKTsgaWYgKHQpIGlmIChuKSBmb3IgKG8gPSBvIHx8IHZlKGUpLCBhID0gYSB8fCB2ZShjKSwgciA9IDAsIGkgPSBvLmxlbmd0aDsgciA8IGk7IHIrKylPZShvW3JdLCBhW3JdKTsgZWxzZSBPZShlLCBjKTsgcmV0dXJuIDAgPCAoYSA9IHZlKGMsICJzY3JpcHQiKSkubGVuZ3RoICYmIHllKGEsICFmICYmIHZlKGUsICJzY3JpcHQiKSksIGMgfSwgY2xlYW5EYXRhOiBmdW5jdGlvbiAoZSkgeyBmb3IgKHZhciB0LCBuLCByLCBpID0gUy5ldmVudC5zcGVjaWFsLCBvID0gMDsgdm9pZCAwICE9PSAobiA9IGVbb10pOyBvKyspaWYgKFYobikpIHsgaWYgKHQgPSBuW1kuZXhwYW5kb10pIHsgaWYgKHQuZXZlbnRzKSBmb3IgKHIgaW4gdC5ldmVudHMpIGlbcl0gPyBTLmV2ZW50LnJlbW92ZShuLCByKSA6IFMucmVtb3ZlRXZlbnQobiwgciwgdC5oYW5kbGUpOyBuW1kuZXhwYW5kb10gPSB2b2lkIDAgfSBuW1EuZXhwYW5kb10gJiYgKG5bUS5leHBhbmRvXSA9IHZvaWQgMCkgfSB9IH0pLCBTLmZuLmV4dGVuZCh7IGRldGFjaDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFJlKHRoaXMsIGUsICEwKSB9LCByZW1vdmU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBSZSh0aGlzLCBlKSB9LCB0ZXh0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gJCh0aGlzLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwID09PSBlID8gUy50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmVhY2goZnVuY3Rpb24gKCkgeyAxICE9PSB0aGlzLm5vZGVUeXBlICYmIDExICE9PSB0aGlzLm5vZGVUeXBlICYmIDkgIT09IHRoaXMubm9kZVR5cGUgfHwgKHRoaXMudGV4dENvbnRlbnQgPSBlKSB9KSB9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKSB9LCBhcHBlbmQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFBlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGUpIHsgMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8IHFlKHRoaXMsIGUpLmFwcGVuZENoaWxkKGUpIH0pIH0sIHByZXBlbmQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFBlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGUpIHsgaWYgKDEgPT09IHRoaXMubm9kZVR5cGUgfHwgMTEgPT09IHRoaXMubm9kZVR5cGUgfHwgOSA9PT0gdGhpcy5ub2RlVHlwZSkgeyB2YXIgdCA9IHFlKHRoaXMsIGUpOyB0Lmluc2VydEJlZm9yZShlLCB0LmZpcnN0Q2hpbGQpIH0gfSkgfSwgYmVmb3JlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBQZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIChlKSB7IHRoaXMucGFyZW50Tm9kZSAmJiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsIHRoaXMpIH0pIH0sIGFmdGVyOiBmdW5jdGlvbiAoKSB7IHJldHVybiBQZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIChlKSB7IHRoaXMucGFyZW50Tm9kZSAmJiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsIHRoaXMubmV4dFNpYmxpbmcpIH0pIH0sIGVtcHR5OiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUsIHQgPSAwOyBudWxsICE9IChlID0gdGhpc1t0XSk7IHQrKykxID09PSBlLm5vZGVUeXBlICYmIChTLmNsZWFuRGF0YSh2ZShlLCAhMSkpLCBlLnRleHRDb250ZW50ID0gIiIpOyByZXR1cm4gdGhpcyB9LCBjbG9uZTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIGUgPSBudWxsICE9IGUgJiYgZSwgdCA9IG51bGwgPT0gdCA/IGUgOiB0LCB0aGlzLm1hcChmdW5jdGlvbiAoKSB7IHJldHVybiBTLmNsb25lKHRoaXMsIGUsIHQpIH0pIH0sIGh0bWw6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAkKHRoaXMsIGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpc1swXSB8fCB7fSwgbiA9IDAsIHIgPSB0aGlzLmxlbmd0aDsgaWYgKHZvaWQgMCA9PT0gZSAmJiAxID09PSB0Lm5vZGVUeXBlKSByZXR1cm4gdC5pbm5lckhUTUw7IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiAhTmUudGVzdChlKSAmJiAhZ2VbKGRlLmV4ZWMoZSkgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCldKSB7IGUgPSBTLmh0bWxQcmVmaWx0ZXIoZSk7IHRyeSB7IGZvciAoOyBuIDwgcjsgbisrKTEgPT09ICh0ID0gdGhpc1tuXSB8fCB7fSkubm9kZVR5cGUgJiYgKFMuY2xlYW5EYXRhKHZlKHQsICExKSksIHQuaW5uZXJIVE1MID0gZSk7IHQgPSAwIH0gY2F0Y2ggKGUpIHsgfSB9IHQgJiYgdGhpcy5lbXB0eSgpLmFwcGVuZChlKSB9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKSB9LCByZXBsYWNlV2l0aDogZnVuY3Rpb24gKCkgeyB2YXIgbiA9IFtdOyByZXR1cm4gUGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMucGFyZW50Tm9kZTsgUy5pbkFycmF5KHRoaXMsIG4pIDwgMCAmJiAoUy5jbGVhbkRhdGEodmUodGhpcykpLCB0ICYmIHQucmVwbGFjZUNoaWxkKGUsIHRoaXMpKSB9LCBuKSB9IH0pLCBTLmVhY2goeyBhcHBlbmRUbzogImFwcGVuZCIsIHByZXBlbmRUbzogInByZXBlbmQiLCBpbnNlcnRCZWZvcmU6ICJiZWZvcmUiLCBpbnNlcnRBZnRlcjogImFmdGVyIiwgcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIiB9LCBmdW5jdGlvbiAoZSwgYSkgeyBTLmZuW2VdID0gZnVuY3Rpb24gKGUpIHsgZm9yICh2YXIgdCwgbiA9IFtdLCByID0gUyhlKSwgaSA9IHIubGVuZ3RoIC0gMSwgbyA9IDA7IG8gPD0gaTsgbysrKXQgPSBvID09PSBpID8gdGhpcyA6IHRoaXMuY2xvbmUoITApLCBTKHJbb10pW2FdKHQpLCB1LmFwcGx5KG4sIHQuZ2V0KCkpOyByZXR1cm4gdGhpcy5wdXNoU3RhY2sobikgfSB9KTsgdmFyIE1lID0gbmV3IFJlZ0V4cCgiXigiICsgZWUgKyAiKSg/IXB4KVthLXolXSskIiwgImkiKSwgSWUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldzsgcmV0dXJuIHQgJiYgdC5vcGVuZXIgfHwgKHQgPSBDKSwgdC5nZXRDb21wdXRlZFN0eWxlKGUpIH0sIFdlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8gPSB7fTsgZm9yIChpIGluIHQpIG9baV0gPSBlLnN0eWxlW2ldLCBlLnN0eWxlW2ldID0gdFtpXTsgZm9yIChpIGluIHIgPSBuLmNhbGwoZSksIHQpIGUuc3R5bGVbaV0gPSBvW2ldOyByZXR1cm4gciB9LCBGZSA9IG5ldyBSZWdFeHAobmUuam9pbigifCIpLCAiaSIpOyBmdW5jdGlvbiBCZShlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhLCBzID0gZS5zdHlsZTsgcmV0dXJuIChuID0gbiB8fCBJZShlKSkgJiYgKCIiICE9PSAoYSA9IG4uZ2V0UHJvcGVydHlWYWx1ZSh0KSB8fCBuW3RdKSB8fCBpZShlKSB8fCAoYSA9IFMuc3R5bGUoZSwgdCkpLCAheS5waXhlbEJveFN0eWxlcygpICYmIE1lLnRlc3QoYSkgJiYgRmUudGVzdCh0KSAmJiAociA9IHMud2lkdGgsIGkgPSBzLm1pbldpZHRoLCBvID0gcy5tYXhXaWR0aCwgcy5taW5XaWR0aCA9IHMubWF4V2lkdGggPSBzLndpZHRoID0gYSwgYSA9IG4ud2lkdGgsIHMud2lkdGggPSByLCBzLm1pbldpZHRoID0gaSwgcy5tYXhXaWR0aCA9IG8pKSwgdm9pZCAwICE9PSBhID8gYSArICIiIDogYSB9IGZ1bmN0aW9uICRlKGUsIHQpIHsgcmV0dXJuIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IGlmICghZSgpKSByZXR1cm4gKHRoaXMuZ2V0ID0gdCkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgZGVsZXRlIHRoaXMuZ2V0IH0gfSB9ICFmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoKSB7IGlmIChsKSB7IHUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIiwgbC5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLCByZS5hcHBlbmRDaGlsZCh1KS5hcHBlbmRDaGlsZChsKTsgdmFyIGUgPSBDLmdldENvbXB1dGVkU3R5bGUobCk7IG4gPSAiMSUiICE9PSBlLnRvcCwgcyA9IDEyID09PSB0KGUubWFyZ2luTGVmdCksIGwuc3R5bGUucmlnaHQgPSAiNjAlIiwgbyA9IDM2ID09PSB0KGUucmlnaHQpLCByID0gMzYgPT09IHQoZS53aWR0aCksIGwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBpID0gMTIgPT09IHQobC5vZmZzZXRXaWR0aCAvIDMpLCByZS5yZW1vdmVDaGlsZCh1KSwgbCA9IG51bGwgfSB9IGZ1bmN0aW9uIHQoZSkgeyByZXR1cm4gTWF0aC5yb3VuZChwYXJzZUZsb2F0KGUpKSB9IHZhciBuLCByLCBpLCBvLCBhLCBzLCB1ID0gRS5jcmVhdGVFbGVtZW50KCJkaXYiKSwgbCA9IEUuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGwuc3R5bGUgJiYgKGwuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiY29udGVudC1ib3giLCBsLmNsb25lTm9kZSghMCkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIiwgeS5jbGVhckNsb25lU3R5bGUgPSAiY29udGVudC1ib3giID09PSBsLnN0eWxlLmJhY2tncm91bmRDbGlwLCBTLmV4dGVuZCh5LCB7IGJveFNpemluZ1JlbGlhYmxlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBlKCksIHIgfSwgcGl4ZWxCb3hTdHlsZXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUoKSwgbyB9LCBwaXhlbFBvc2l0aW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiBlKCksIG4gfSwgcmVsaWFibGVNYXJnaW5MZWZ0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlKCksIHMgfSwgc2Nyb2xsYm94U2l6ZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gZSgpLCBpIH0sIHJlbGlhYmxlVHJEaW1lbnNpb25zOiBmdW5jdGlvbiAoKSB7IHZhciBlLCB0LCBuLCByOyByZXR1cm4gbnVsbCA9PSBhICYmIChlID0gRS5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpLCB0ID0gRS5jcmVhdGVFbGVtZW50KCJ0ciIpLCBuID0gRS5jcmVhdGVFbGVtZW50KCJkaXYiKSwgZS5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOmFic29sdXRlO2xlZnQ6LTExMTExcHgiLCB0LnN0eWxlLmhlaWdodCA9ICIxcHgiLCBuLnN0eWxlLmhlaWdodCA9ICI5cHgiLCByZS5hcHBlbmRDaGlsZChlKS5hcHBlbmRDaGlsZCh0KS5hcHBlbmRDaGlsZChuKSwgciA9IEMuZ2V0Q29tcHV0ZWRTdHlsZSh0KSwgYSA9IDMgPCBwYXJzZUludChyLmhlaWdodCksIHJlLnJlbW92ZUNoaWxkKGUpKSwgYSB9IH0pKSB9KCk7IHZhciBfZSA9IFsiV2Via2l0IiwgIk1veiIsICJtcyJdLCB6ZSA9IEUuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsIFVlID0ge307IGZ1bmN0aW9uIFhlKGUpIHsgdmFyIHQgPSBTLmNzc1Byb3BzW2VdIHx8IFVlW2VdOyByZXR1cm4gdCB8fCAoZSBpbiB6ZSA/IGUgOiBVZVtlXSA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZVswXS50b1VwcGVyQ2FzZSgpICsgZS5zbGljZSgxKSwgbiA9IF9lLmxlbmd0aDsgd2hpbGUgKG4tLSkgaWYgKChlID0gX2Vbbl0gKyB0KSBpbiB6ZSkgcmV0dXJuIGUgfShlKSB8fCBlKSB9IHZhciBWZSA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywgR2UgPSAvXi0tLywgWWUgPSB7IHBvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheTogImJsb2NrIiB9LCBRZSA9IHsgbGV0dGVyU3BhY2luZzogIjAiLCBmb250V2VpZ2h0OiAiNDAwIiB9OyBmdW5jdGlvbiBKZShlLCB0LCBuKSB7IHZhciByID0gdGUuZXhlYyh0KTsgcmV0dXJuIHIgPyBNYXRoLm1heCgwLCByWzJdIC0gKG4gfHwgMCkpICsgKHJbM10gfHwgInB4IikgOiB0IH0gZnVuY3Rpb24gS2UoZSwgdCwgbiwgciwgaSwgbykgeyB2YXIgYSA9ICJ3aWR0aCIgPT09IHQgPyAxIDogMCwgcyA9IDAsIHUgPSAwOyBpZiAobiA9PT0gKHIgPyAiYm9yZGVyIiA6ICJjb250ZW50IikpIHJldHVybiAwOyBmb3IgKDsgYSA8IDQ7IGEgKz0gMikibWFyZ2luIiA9PT0gbiAmJiAodSArPSBTLmNzcyhlLCBuICsgbmVbYV0sICEwLCBpKSksIHIgPyAoImNvbnRlbnQiID09PSBuICYmICh1IC09IFMuY3NzKGUsICJwYWRkaW5nIiArIG5lW2FdLCAhMCwgaSkpLCAibWFyZ2luIiAhPT0gbiAmJiAodSAtPSBTLmNzcyhlLCAiYm9yZGVyIiArIG5lW2FdICsgIldpZHRoIiwgITAsIGkpKSkgOiAodSArPSBTLmNzcyhlLCAicGFkZGluZyIgKyBuZVthXSwgITAsIGkpLCAicGFkZGluZyIgIT09IG4gPyB1ICs9IFMuY3NzKGUsICJib3JkZXIiICsgbmVbYV0gKyAiV2lkdGgiLCAhMCwgaSkgOiBzICs9IFMuY3NzKGUsICJib3JkZXIiICsgbmVbYV0gKyAiV2lkdGgiLCAhMCwgaSkpOyByZXR1cm4gIXIgJiYgMCA8PSBvICYmICh1ICs9IE1hdGgubWF4KDAsIE1hdGguY2VpbChlWyJvZmZzZXQiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKV0gLSBvIC0gdSAtIHMgLSAuNSkpIHx8IDApLCB1IH0gZnVuY3Rpb24gWmUoZSwgdCwgbikgeyB2YXIgciA9IEllKGUpLCBpID0gKCF5LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgbikgJiYgImJvcmRlci1ib3giID09PSBTLmNzcyhlLCAiYm94U2l6aW5nIiwgITEsIHIpLCBvID0gaSwgYSA9IEJlKGUsIHQsIHIpLCBzID0gIm9mZnNldCIgKyB0WzBdLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpOyBpZiAoTWUudGVzdChhKSkgeyBpZiAoIW4pIHJldHVybiBhOyBhID0gImF1dG8iIH0gcmV0dXJuICgheS5ib3hTaXppbmdSZWxpYWJsZSgpICYmIGkgfHwgIXkucmVsaWFibGVUckRpbWVuc2lvbnMoKSAmJiBBKGUsICJ0ciIpIHx8ICJhdXRvIiA9PT0gYSB8fCAhcGFyc2VGbG9hdChhKSAmJiAiaW5saW5lIiA9PT0gUy5jc3MoZSwgImRpc3BsYXkiLCAhMSwgcikpICYmIGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggJiYgKGkgPSAiYm9yZGVyLWJveCIgPT09IFMuY3NzKGUsICJib3hTaXppbmciLCAhMSwgciksIChvID0gcyBpbiBlKSAmJiAoYSA9IGVbc10pKSwgKGEgPSBwYXJzZUZsb2F0KGEpIHx8IDApICsgS2UoZSwgdCwgbiB8fCAoaSA/ICJib3JkZXIiIDogImNvbnRlbnQiKSwgbywgciwgYSkgKyAicHgiIH0gZnVuY3Rpb24gZXQoZSwgdCwgbiwgciwgaSkgeyByZXR1cm4gbmV3IGV0LnByb3RvdHlwZS5pbml0KGUsIHQsIG4sIHIsIGkpIH0gUy5leHRlbmQoeyBjc3NIb29rczogeyBvcGFjaXR5OiB7IGdldDogZnVuY3Rpb24gKGUsIHQpIHsgaWYgKHQpIHsgdmFyIG4gPSBCZShlLCAib3BhY2l0eSIpOyByZXR1cm4gIiIgPT09IG4gPyAiMSIgOiBuIH0gfSB9IH0sIGNzc051bWJlcjogeyBhbmltYXRpb25JdGVyYXRpb25Db3VudDogITAsIGNvbHVtbkNvdW50OiAhMCwgZmlsbE9wYWNpdHk6ICEwLCBmbGV4R3JvdzogITAsIGZsZXhTaHJpbms6ICEwLCBmb250V2VpZ2h0OiAhMCwgZ3JpZEFyZWE6ICEwLCBncmlkQ29sdW1uOiAhMCwgZ3JpZENvbHVtbkVuZDogITAsIGdyaWRDb2x1bW5TdGFydDogITAsIGdyaWRSb3c6ICEwLCBncmlkUm93RW5kOiAhMCwgZ3JpZFJvd1N0YXJ0OiAhMCwgbGluZUhlaWdodDogITAsIG9wYWNpdHk6ICEwLCBvcmRlcjogITAsIG9ycGhhbnM6ICEwLCB3aWRvd3M6ICEwLCB6SW5kZXg6ICEwLCB6b29tOiAhMCB9LCBjc3NQcm9wczoge30sIHN0eWxlOiBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyBpZiAoZSAmJiAzICE9PSBlLm5vZGVUeXBlICYmIDggIT09IGUubm9kZVR5cGUgJiYgZS5zdHlsZSkgeyB2YXIgaSwgbywgYSwgcyA9IFgodCksIHUgPSBHZS50ZXN0KHQpLCBsID0gZS5zdHlsZTsgaWYgKHUgfHwgKHQgPSBYZShzKSksIGEgPSBTLmNzc0hvb2tzW3RdIHx8IFMuY3NzSG9va3Nbc10sIHZvaWQgMCA9PT0gbikgcmV0dXJuIGEgJiYgImdldCIgaW4gYSAmJiB2b2lkIDAgIT09IChpID0gYS5nZXQoZSwgITEsIHIpKSA/IGkgOiBsW3RdOyAic3RyaW5nIiA9PT0gKG8gPSB0eXBlb2YgbikgJiYgKGkgPSB0ZS5leGVjKG4pKSAmJiBpWzFdICYmIChuID0gc2UoZSwgdCwgaSksIG8gPSAibnVtYmVyIiksIG51bGwgIT0gbiAmJiBuID09IG4gJiYgKCJudW1iZXIiICE9PSBvIHx8IHUgfHwgKG4gKz0gaSAmJiBpWzNdIHx8IChTLmNzc051bWJlcltzXSA/ICIiIDogInB4IikpLCB5LmNsZWFyQ2xvbmVTdHlsZSB8fCAiIiAhPT0gbiB8fCAwICE9PSB0LmluZGV4T2YoImJhY2tncm91bmQiKSB8fCAobFt0XSA9ICJpbmhlcml0IiksIGEgJiYgInNldCIgaW4gYSAmJiB2b2lkIDAgPT09IChuID0gYS5zZXQoZSwgbiwgcikpIHx8ICh1ID8gbC5zZXRQcm9wZXJ0eSh0LCBuKSA6IGxbdF0gPSBuKSkgfSB9LCBjc3M6IGZ1bmN0aW9uIChlLCB0LCBuLCByKSB7IHZhciBpLCBvLCBhLCBzID0gWCh0KTsgcmV0dXJuIEdlLnRlc3QodCkgfHwgKHQgPSBYZShzKSksIChhID0gUy5jc3NIb29rc1t0XSB8fCBTLmNzc0hvb2tzW3NdKSAmJiAiZ2V0IiBpbiBhICYmIChpID0gYS5nZXQoZSwgITAsIG4pKSwgdm9pZCAwID09PSBpICYmIChpID0gQmUoZSwgdCwgcikpLCAibm9ybWFsIiA9PT0gaSAmJiB0IGluIFFlICYmIChpID0gUWVbdF0pLCAiIiA9PT0gbiB8fCBuID8gKG8gPSBwYXJzZUZsb2F0KGkpLCAhMCA9PT0gbiB8fCBpc0Zpbml0ZShvKSA/IG8gfHwgMCA6IGkpIDogaSB9IH0pLCBTLmVhY2goWyJoZWlnaHQiLCAid2lkdGgiXSwgZnVuY3Rpb24gKGUsIHUpIHsgUy5jc3NIb29rc1t1XSA9IHsgZ2V0OiBmdW5jdGlvbiAoZSwgdCwgbikgeyBpZiAodCkgcmV0dXJuICFWZS50ZXN0KFMuY3NzKGUsICJkaXNwbGF5IikpIHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggJiYgZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCA/IFplKGUsIHUsIG4pIDogV2UoZSwgWWUsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIFplKGUsIHUsIG4pIH0pIH0sIHNldDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGkgPSBJZShlKSwgbyA9ICF5LnNjcm9sbGJveFNpemUoKSAmJiAiYWJzb2x1dGUiID09PSBpLnBvc2l0aW9uLCBhID0gKG8gfHwgbikgJiYgImJvcmRlci1ib3giID09PSBTLmNzcyhlLCAiYm94U2l6aW5nIiwgITEsIGkpLCBzID0gbiA/IEtlKGUsIHUsIG4sIGEsIGkpIDogMDsgcmV0dXJuIGEgJiYgbyAmJiAocyAtPSBNYXRoLmNlaWwoZVsib2Zmc2V0IiArIHVbMF0udG9VcHBlckNhc2UoKSArIHUuc2xpY2UoMSldIC0gcGFyc2VGbG9hdChpW3VdKSAtIEtlKGUsIHUsICJib3JkZXIiLCAhMSwgaSkgLSAuNSkpLCBzICYmIChyID0gdGUuZXhlYyh0KSkgJiYgInB4IiAhPT0gKHJbM10gfHwgInB4IikgJiYgKGUuc3R5bGVbdV0gPSB0LCB0ID0gUy5jc3MoZSwgdSkpLCBKZSgwLCB0LCBzKSB9IH0gfSksIFMuY3NzSG9va3MubWFyZ2luTGVmdCA9ICRlKHkucmVsaWFibGVNYXJnaW5MZWZ0LCBmdW5jdGlvbiAoZSwgdCkgeyBpZiAodCkgcmV0dXJuIChwYXJzZUZsb2F0KEJlKGUsICJtYXJnaW5MZWZ0IikpIHx8IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIFdlKGUsIHsgbWFyZ2luTGVmdDogMCB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgfSkpICsgInB4IiB9KSwgUy5lYWNoKHsgbWFyZ2luOiAiIiwgcGFkZGluZzogIiIsIGJvcmRlcjogIldpZHRoIiB9LCBmdW5jdGlvbiAoaSwgbykgeyBTLmNzc0hvb2tzW2kgKyBvXSA9IHsgZXhwYW5kOiBmdW5jdGlvbiAoZSkgeyBmb3IgKHZhciB0ID0gMCwgbiA9IHt9LCByID0gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBlLnNwbGl0KCIgIikgOiBbZV07IHQgPCA0OyB0KyspbltpICsgbmVbdF0gKyBvXSA9IHJbdF0gfHwgclt0IC0gMl0gfHwgclswXTsgcmV0dXJuIG4gfSB9LCAibWFyZ2luIiAhPT0gaSAmJiAoUy5jc3NIb29rc1tpICsgb10uc2V0ID0gSmUpIH0pLCBTLmZuLmV4dGVuZCh7IGNzczogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICQodGhpcywgZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8gPSB7fSwgYSA9IDA7IGlmIChBcnJheS5pc0FycmF5KHQpKSB7IGZvciAociA9IEllKGUpLCBpID0gdC5sZW5ndGg7IGEgPCBpOyBhKyspb1t0W2FdXSA9IFMuY3NzKGUsIHRbYV0sICExLCByKTsgcmV0dXJuIG8gfSByZXR1cm4gdm9pZCAwICE9PSBuID8gUy5zdHlsZShlLCB0LCBuKSA6IFMuY3NzKGUsIHQpIH0sIGUsIHQsIDEgPCBhcmd1bWVudHMubGVuZ3RoKSB9IH0pLCAoKFMuVHdlZW4gPSBldCkucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogZXQsIGluaXQ6IGZ1bmN0aW9uIChlLCB0LCBuLCByLCBpLCBvKSB7IHRoaXMuZWxlbSA9IGUsIHRoaXMucHJvcCA9IG4sIHRoaXMuZWFzaW5nID0gaSB8fCBTLmVhc2luZy5fZGVmYXVsdCwgdGhpcy5vcHRpb25zID0gdCwgdGhpcy5zdGFydCA9IHRoaXMubm93ID0gdGhpcy5jdXIoKSwgdGhpcy5lbmQgPSByLCB0aGlzLnVuaXQgPSBvIHx8IChTLmNzc051bWJlcltuXSA/ICIiIDogInB4IikgfSwgY3VyOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gZXQucHJvcEhvb2tzW3RoaXMucHJvcF07IHJldHVybiBlICYmIGUuZ2V0ID8gZS5nZXQodGhpcykgOiBldC5wcm9wSG9va3MuX2RlZmF1bHQuZ2V0KHRoaXMpIH0sIHJ1bjogZnVuY3Rpb24gKGUpIHsgdmFyIHQsIG4gPSBldC5wcm9wSG9va3NbdGhpcy5wcm9wXTsgcmV0dXJuIHRoaXMub3B0aW9ucy5kdXJhdGlvbiA/IHRoaXMucG9zID0gdCA9IFMuZWFzaW5nW3RoaXMuZWFzaW5nXShlLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBlLCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pIDogdGhpcy5wb3MgPSB0ID0gZSwgdGhpcy5ub3cgPSAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHQgKyB0aGlzLnN0YXJ0LCB0aGlzLm9wdGlvbnMuc3RlcCAmJiB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMpLCBuICYmIG4uc2V0ID8gbi5zZXQodGhpcykgOiBldC5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLCB0aGlzIH0gfSkuaW5pdC5wcm90b3R5cGUgPSBldC5wcm90b3R5cGUsIChldC5wcm9wSG9va3MgPSB7IF9kZWZhdWx0OiB7IGdldDogZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IHJldHVybiAxICE9PSBlLmVsZW0ubm9kZVR5cGUgfHwgbnVsbCAhPSBlLmVsZW1bZS5wcm9wXSAmJiBudWxsID09IGUuZWxlbS5zdHlsZVtlLnByb3BdID8gZS5lbGVtW2UucHJvcF0gOiAodCA9IFMuY3NzKGUuZWxlbSwgZS5wcm9wLCAiIikpICYmICJhdXRvIiAhPT0gdCA/IHQgOiAwIH0sIHNldDogZnVuY3Rpb24gKGUpIHsgUy5meC5zdGVwW2UucHJvcF0gPyBTLmZ4LnN0ZXBbZS5wcm9wXShlKSA6IDEgIT09IGUuZWxlbS5ub2RlVHlwZSB8fCAhUy5jc3NIb29rc1tlLnByb3BdICYmIG51bGwgPT0gZS5lbGVtLnN0eWxlW1hlKGUucHJvcCldID8gZS5lbGVtW2UucHJvcF0gPSBlLm5vdyA6IFMuc3R5bGUoZS5lbGVtLCBlLnByb3AsIGUubm93ICsgZS51bml0KSB9IH0gfSkuc2Nyb2xsVG9wID0gZXQucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7IHNldDogZnVuY3Rpb24gKGUpIHsgZS5lbGVtLm5vZGVUeXBlICYmIGUuZWxlbS5wYXJlbnROb2RlICYmIChlLmVsZW1bZS5wcm9wXSA9IGUubm93KSB9IH0sIFMuZWFzaW5nID0geyBsaW5lYXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlIH0sIHN3aW5nOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gLjUgLSBNYXRoLmNvcyhlICogTWF0aC5QSSkgLyAyIH0sIF9kZWZhdWx0OiAic3dpbmciIH0sIFMuZnggPSBldC5wcm90b3R5cGUuaW5pdCwgUy5meC5zdGVwID0ge307IHZhciB0dCwgbnQsIHJ0LCBpdCwgb3QgPSAvXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sIGF0ID0gL3F1ZXVlSG9va3MkLzsgZnVuY3Rpb24gc3QoKSB7IG50ICYmICghMSA9PT0gRS5oaWRkZW4gJiYgQy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyBDLnJlcXVlc3RBbmltYXRpb25GcmFtZShzdCkgOiBDLnNldFRpbWVvdXQoc3QsIFMuZnguaW50ZXJ2YWwpLCBTLmZ4LnRpY2soKSkgfSBmdW5jdGlvbiB1dCgpIHsgcmV0dXJuIEMuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHR0ID0gdm9pZCAwIH0pLCB0dCA9IERhdGUubm93KCkgfSBmdW5jdGlvbiBsdChlLCB0KSB7IHZhciBuLCByID0gMCwgaSA9IHsgaGVpZ2h0OiBlIH07IGZvciAodCA9IHQgPyAxIDogMDsgciA8IDQ7IHIgKz0gMiAtIHQpaVsibWFyZ2luIiArIChuID0gbmVbcl0pXSA9IGlbInBhZGRpbmciICsgbl0gPSBlOyByZXR1cm4gdCAmJiAoaS5vcGFjaXR5ID0gaS53aWR0aCA9IGUpLCBpIH0gZnVuY3Rpb24gY3QoZSwgdCwgbikgeyBmb3IgKHZhciByLCBpID0gKGZ0LnR3ZWVuZXJzW3RdIHx8IFtdKS5jb25jYXQoZnQudHdlZW5lcnNbIioiXSksIG8gPSAwLCBhID0gaS5sZW5ndGg7IG8gPCBhOyBvKyspaWYgKHIgPSBpW29dLmNhbGwobiwgdCwgZSkpIHJldHVybiByIH0gZnVuY3Rpb24gZnQobywgZSwgdCkgeyB2YXIgbiwgYSwgciA9IDAsIGkgPSBmdC5wcmVmaWx0ZXJzLmxlbmd0aCwgcyA9IFMuRGVmZXJyZWQoKS5hbHdheXMoZnVuY3Rpb24gKCkgeyBkZWxldGUgdS5lbGVtIH0pLCB1ID0gZnVuY3Rpb24gKCkgeyBpZiAoYSkgcmV0dXJuICExOyBmb3IgKHZhciBlID0gdHQgfHwgdXQoKSwgdCA9IE1hdGgubWF4KDAsIGwuc3RhcnRUaW1lICsgbC5kdXJhdGlvbiAtIGUpLCBuID0gMSAtICh0IC8gbC5kdXJhdGlvbiB8fCAwKSwgciA9IDAsIGkgPSBsLnR3ZWVucy5sZW5ndGg7IHIgPCBpOyByKyspbC50d2VlbnNbcl0ucnVuKG4pOyByZXR1cm4gcy5ub3RpZnlXaXRoKG8sIFtsLCBuLCB0XSksIG4gPCAxICYmIGkgPyB0IDogKGkgfHwgcy5ub3RpZnlXaXRoKG8sIFtsLCAxLCAwXSksIHMucmVzb2x2ZVdpdGgobywgW2xdKSwgITEpIH0sIGwgPSBzLnByb21pc2UoeyBlbGVtOiBvLCBwcm9wczogUy5leHRlbmQoe30sIGUpLCBvcHRzOiBTLmV4dGVuZCghMCwgeyBzcGVjaWFsRWFzaW5nOiB7fSwgZWFzaW5nOiBTLmVhc2luZy5fZGVmYXVsdCB9LCB0KSwgb3JpZ2luYWxQcm9wZXJ0aWVzOiBlLCBvcmlnaW5hbE9wdGlvbnM6IHQsIHN0YXJ0VGltZTogdHQgfHwgdXQoKSwgZHVyYXRpb246IHQuZHVyYXRpb24sIHR3ZWVuczogW10sIGNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiA9IFMuVHdlZW4obywgbC5vcHRzLCBlLCB0LCBsLm9wdHMuc3BlY2lhbEVhc2luZ1tlXSB8fCBsLm9wdHMuZWFzaW5nKTsgcmV0dXJuIGwudHdlZW5zLnB1c2gobiksIG4gfSwgc3RvcDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSAwLCBuID0gZSA/IGwudHdlZW5zLmxlbmd0aCA6IDA7IGlmIChhKSByZXR1cm4gdGhpczsgZm9yIChhID0gITA7IHQgPCBuOyB0KyspbC50d2VlbnNbdF0ucnVuKDEpOyByZXR1cm4gZSA/IChzLm5vdGlmeVdpdGgobywgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChvLCBbbCwgZV0pKSA6IHMucmVqZWN0V2l0aChvLCBbbCwgZV0pLCB0aGlzIH0gfSksIGMgPSBsLnByb3BzOyBmb3IgKCFmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiwgciwgaSwgbywgYTsgZm9yIChuIGluIGUpIGlmIChpID0gdFtyID0gWChuKV0sIG8gPSBlW25dLCBBcnJheS5pc0FycmF5KG8pICYmIChpID0gb1sxXSwgbyA9IGVbbl0gPSBvWzBdKSwgbiAhPT0gciAmJiAoZVtyXSA9IG8sIGRlbGV0ZSBlW25dKSwgKGEgPSBTLmNzc0hvb2tzW3JdKSAmJiAiZXhwYW5kIiBpbiBhKSBmb3IgKG4gaW4gbyA9IGEuZXhwYW5kKG8pLCBkZWxldGUgZVtyXSwgbykgbiBpbiBlIHx8IChlW25dID0gb1tuXSwgdFtuXSA9IGkpOyBlbHNlIHRbcl0gPSBpIH0oYywgbC5vcHRzLnNwZWNpYWxFYXNpbmcpOyByIDwgaTsgcisrKWlmIChuID0gZnQucHJlZmlsdGVyc1tyXS5jYWxsKGwsIG8sIGMsIGwub3B0cykpIHJldHVybiBtKG4uc3RvcCkgJiYgKFMuX3F1ZXVlSG9va3MobC5lbGVtLCBsLm9wdHMucXVldWUpLnN0b3AgPSBuLnN0b3AuYmluZChuKSksIG47IHJldHVybiBTLm1hcChjLCBjdCwgbCksIG0obC5vcHRzLnN0YXJ0KSAmJiBsLm9wdHMuc3RhcnQuY2FsbChvLCBsKSwgbC5wcm9ncmVzcyhsLm9wdHMucHJvZ3Jlc3MpLmRvbmUobC5vcHRzLmRvbmUsIGwub3B0cy5jb21wbGV0ZSkuZmFpbChsLm9wdHMuZmFpbCkuYWx3YXlzKGwub3B0cy5hbHdheXMpLCBTLmZ4LnRpbWVyKFMuZXh0ZW5kKHUsIHsgZWxlbTogbywgYW5pbTogbCwgcXVldWU6IGwub3B0cy5xdWV1ZSB9KSksIGwgfSBTLkFuaW1hdGlvbiA9IFMuZXh0ZW5kKGZ0LCB7IHR3ZWVuZXJzOiB7ICIqIjogW2Z1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gdGhpcy5jcmVhdGVUd2VlbihlLCB0KTsgcmV0dXJuIHNlKG4uZWxlbSwgZSwgdGUuZXhlYyh0KSwgbiksIG4gfV0gfSwgdHdlZW5lcjogZnVuY3Rpb24gKGUsIHQpIHsgbShlKSA/ICh0ID0gZSwgZSA9IFsiKiJdKSA6IGUgPSBlLm1hdGNoKFApOyBmb3IgKHZhciBuLCByID0gMCwgaSA9IGUubGVuZ3RoOyByIDwgaTsgcisrKW4gPSBlW3JdLCBmdC50d2VlbmVyc1tuXSA9IGZ0LnR3ZWVuZXJzW25dIHx8IFtdLCBmdC50d2VlbmVyc1tuXS51bnNoaWZ0KHQpIH0sIHByZWZpbHRlcnM6IFtmdW5jdGlvbiAoZSwgdCwgbikgeyB2YXIgciwgaSwgbywgYSwgcywgdSwgbCwgYywgZiA9ICJ3aWR0aCIgaW4gdCB8fCAiaGVpZ2h0IiBpbiB0LCBwID0gdGhpcywgZCA9IHt9LCBoID0gZS5zdHlsZSwgZyA9IGUubm9kZVR5cGUgJiYgYWUoZSksIHYgPSBZLmdldChlLCAiZnhzaG93Iik7IGZvciAociBpbiBuLnF1ZXVlIHx8IChudWxsID09IChhID0gUy5fcXVldWVIb29rcyhlLCAiZngiKSkudW5xdWV1ZWQgJiYgKGEudW5xdWV1ZWQgPSAwLCBzID0gYS5lbXB0eS5maXJlLCBhLmVtcHR5LmZpcmUgPSBmdW5jdGlvbiAoKSB7IGEudW5xdWV1ZWQgfHwgcygpIH0pLCBhLnVucXVldWVkKysgLCBwLmFsd2F5cyhmdW5jdGlvbiAoKSB7IHAuYWx3YXlzKGZ1bmN0aW9uICgpIHsgYS51bnF1ZXVlZC0tICwgUy5xdWV1ZShlLCAiZngiKS5sZW5ndGggfHwgYS5lbXB0eS5maXJlKCkgfSkgfSkpLCB0KSBpZiAoaSA9IHRbcl0sIG90LnRlc3QoaSkpIHsgaWYgKGRlbGV0ZSB0W3JdLCBvID0gbyB8fCAidG9nZ2xlIiA9PT0gaSwgaSA9PT0gKGcgPyAiaGlkZSIgOiAic2hvdyIpKSB7IGlmICgic2hvdyIgIT09IGkgfHwgIXYgfHwgdm9pZCAwID09PSB2W3JdKSBjb250aW51ZTsgZyA9ICEwIH0gZFtyXSA9IHYgJiYgdltyXSB8fCBTLnN0eWxlKGUsIHIpIH0gaWYgKCh1ID0gIVMuaXNFbXB0eU9iamVjdCh0KSkgfHwgIVMuaXNFbXB0eU9iamVjdChkKSkgZm9yIChyIGluIGYgJiYgMSA9PT0gZS5ub2RlVHlwZSAmJiAobi5vdmVyZmxvdyA9IFtoLm92ZXJmbG93LCBoLm92ZXJmbG93WCwgaC5vdmVyZmxvd1ldLCBudWxsID09IChsID0gdiAmJiB2LmRpc3BsYXkpICYmIChsID0gWS5nZXQoZSwgImRpc3BsYXkiKSksICJub25lIiA9PT0gKGMgPSBTLmNzcyhlLCAiZGlzcGxheSIpKSAmJiAobCA/IGMgPSBsIDogKGxlKFtlXSwgITApLCBsID0gZS5zdHlsZS5kaXNwbGF5IHx8IGwsIGMgPSBTLmNzcyhlLCAiZGlzcGxheSIpLCBsZShbZV0pKSksICgiaW5saW5lIiA9PT0gYyB8fCAiaW5saW5lLWJsb2NrIiA9PT0gYyAmJiBudWxsICE9IGwpICYmICJub25lIiA9PT0gUy5jc3MoZSwgImZsb2F0IikgJiYgKHUgfHwgKHAuZG9uZShmdW5jdGlvbiAoKSB7IGguZGlzcGxheSA9IGwgfSksIG51bGwgPT0gbCAmJiAoYyA9IGguZGlzcGxheSwgbCA9ICJub25lIiA9PT0gYyA/ICIiIDogYykpLCBoLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikpLCBuLm92ZXJmbG93ICYmIChoLm92ZXJmbG93ID0gImhpZGRlbiIsIHAuYWx3YXlzKGZ1bmN0aW9uICgpIHsgaC5vdmVyZmxvdyA9IG4ub3ZlcmZsb3dbMF0sIGgub3ZlcmZsb3dYID0gbi5vdmVyZmxvd1sxXSwgaC5vdmVyZmxvd1kgPSBuLm92ZXJmbG93WzJdIH0pKSwgdSA9ICExLCBkKSB1IHx8ICh2ID8gImhpZGRlbiIgaW4gdiAmJiAoZyA9IHYuaGlkZGVuKSA6IHYgPSBZLmFjY2VzcyhlLCAiZnhzaG93IiwgeyBkaXNwbGF5OiBsIH0pLCBvICYmICh2LmhpZGRlbiA9ICFnKSwgZyAmJiBsZShbZV0sICEwKSwgcC5kb25lKGZ1bmN0aW9uICgpIHsgZm9yIChyIGluIGcgfHwgbGUoW2VdKSwgWS5yZW1vdmUoZSwgImZ4c2hvdyIpLCBkKSBTLnN0eWxlKGUsIHIsIGRbcl0pIH0pKSwgdSA9IGN0KGcgPyB2W3JdIDogMCwgciwgcCksIHIgaW4gdiB8fCAodltyXSA9IHUuc3RhcnQsIGcgJiYgKHUuZW5kID0gdS5zdGFydCwgdS5zdGFydCA9IDApKSB9XSwgcHJlZmlsdGVyOiBmdW5jdGlvbiAoZSwgdCkgeyB0ID8gZnQucHJlZmlsdGVycy51bnNoaWZ0KGUpIDogZnQucHJlZmlsdGVycy5wdXNoKGUpIH0gfSksIFMuc3BlZWQgPSBmdW5jdGlvbiAoZSwgdCwgbikgeyB2YXIgciA9IGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUgPyBTLmV4dGVuZCh7fSwgZSkgOiB7IGNvbXBsZXRlOiBuIHx8ICFuICYmIHQgfHwgbShlKSAmJiBlLCBkdXJhdGlvbjogZSwgZWFzaW5nOiBuICYmIHQgfHwgdCAmJiAhbSh0KSAmJiB0IH07IHJldHVybiBTLmZ4Lm9mZiA/IHIuZHVyYXRpb24gPSAwIDogIm51bWJlciIgIT0gdHlwZW9mIHIuZHVyYXRpb24gJiYgKHIuZHVyYXRpb24gaW4gUy5meC5zcGVlZHMgPyByLmR1cmF0aW9uID0gUy5meC5zcGVlZHNbci5kdXJhdGlvbl0gOiByLmR1cmF0aW9uID0gUy5meC5zcGVlZHMuX2RlZmF1bHQpLCBudWxsICE9IHIucXVldWUgJiYgITAgIT09IHIucXVldWUgfHwgKHIucXVldWUgPSAiZngiKSwgci5vbGQgPSByLmNvbXBsZXRlLCByLmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyBtKHIub2xkKSAmJiByLm9sZC5jYWxsKHRoaXMpLCByLnF1ZXVlICYmIFMuZGVxdWV1ZSh0aGlzLCByLnF1ZXVlKSB9LCByIH0sIFMuZm4uZXh0ZW5kKHsgZmFkZVRvOiBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyByZXR1cm4gdGhpcy5maWx0ZXIoYWUpLmNzcygib3BhY2l0eSIsIDApLnNob3coKS5lbmQoKS5hbmltYXRlKHsgb3BhY2l0eTogdCB9LCBlLCBuLCByKSB9LCBhbmltYXRlOiBmdW5jdGlvbiAodCwgZSwgbiwgcikgeyB2YXIgaSA9IFMuaXNFbXB0eU9iamVjdCh0KSwgbyA9IFMuc3BlZWQoZSwgbiwgciksIGEgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gZnQodGhpcywgUy5leHRlbmQoe30sIHQpLCBvKTsgKGkgfHwgWS5nZXQodGhpcywgImZpbmlzaCIpKSAmJiBlLnN0b3AoITApIH07IHJldHVybiBhLmZpbmlzaCA9IGEsIGkgfHwgITEgPT09IG8ucXVldWUgPyB0aGlzLmVhY2goYSkgOiB0aGlzLnF1ZXVlKG8ucXVldWUsIGEpIH0sIHN0b3A6IGZ1bmN0aW9uIChpLCBlLCBvKSB7IHZhciBhID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnN0b3A7IGRlbGV0ZSBlLnN0b3AsIHQobykgfTsgcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBpICYmIChvID0gZSwgZSA9IGksIGkgPSB2b2lkIDApLCBlICYmIHRoaXMucXVldWUoaSB8fCAiZngiLCBbXSksIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBlID0gITAsIHQgPSBudWxsICE9IGkgJiYgaSArICJxdWV1ZUhvb2tzIiwgbiA9IFMudGltZXJzLCByID0gWS5nZXQodGhpcyk7IGlmICh0KSByW3RdICYmIHJbdF0uc3RvcCAmJiBhKHJbdF0pOyBlbHNlIGZvciAodCBpbiByKSByW3RdICYmIHJbdF0uc3RvcCAmJiBhdC50ZXN0KHQpICYmIGEoclt0XSk7IGZvciAodCA9IG4ubGVuZ3RoOyB0LS07KW5bdF0uZWxlbSAhPT0gdGhpcyB8fCBudWxsICE9IGkgJiYgblt0XS5xdWV1ZSAhPT0gaSB8fCAoblt0XS5hbmltLnN0b3AobyksIGUgPSAhMSwgbi5zcGxpY2UodCwgMSkpOyAhZSAmJiBvIHx8IFMuZGVxdWV1ZSh0aGlzLCBpKSB9KSB9LCBmaW5pc2g6IGZ1bmN0aW9uIChhKSB7IHJldHVybiAhMSAhPT0gYSAmJiAoYSA9IGEgfHwgImZ4IiksIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBlLCB0ID0gWS5nZXQodGhpcyksIG4gPSB0W2EgKyAicXVldWUiXSwgciA9IHRbYSArICJxdWV1ZUhvb2tzIl0sIGkgPSBTLnRpbWVycywgbyA9IG4gPyBuLmxlbmd0aCA6IDA7IGZvciAodC5maW5pc2ggPSAhMCwgUy5xdWV1ZSh0aGlzLCBhLCBbXSksIHIgJiYgci5zdG9wICYmIHIuc3RvcC5jYWxsKHRoaXMsICEwKSwgZSA9IGkubGVuZ3RoOyBlLS07KWlbZV0uZWxlbSA9PT0gdGhpcyAmJiBpW2VdLnF1ZXVlID09PSBhICYmIChpW2VdLmFuaW0uc3RvcCghMCksIGkuc3BsaWNlKGUsIDEpKTsgZm9yIChlID0gMDsgZSA8IG87IGUrKyluW2VdICYmIG5bZV0uZmluaXNoICYmIG5bZV0uZmluaXNoLmNhbGwodGhpcyk7IGRlbGV0ZSB0LmZpbmlzaCB9KSB9IH0pLCBTLmVhY2goWyJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIl0sIGZ1bmN0aW9uIChlLCByKSB7IHZhciBpID0gUy5mbltyXTsgUy5mbltyXSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiBudWxsID09IGUgfHwgImJvb2xlYW4iID09IHR5cGVvZiBlID8gaS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogdGhpcy5hbmltYXRlKGx0KHIsICEwKSwgZSwgdCwgbikgfSB9KSwgUy5lYWNoKHsgc2xpZGVEb3duOiBsdCgic2hvdyIpLCBzbGlkZVVwOiBsdCgiaGlkZSIpLCBzbGlkZVRvZ2dsZTogbHQoInRvZ2dsZSIpLCBmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sIGZhZGVPdXQ6IHsgb3BhY2l0eTogImhpZGUiIH0sIGZhZGVUb2dnbGU6IHsgb3BhY2l0eTogInRvZ2dsZSIgfSB9LCBmdW5jdGlvbiAoZSwgcikgeyBTLmZuW2VdID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIHRoaXMuYW5pbWF0ZShyLCBlLCB0LCBuKSB9IH0pLCBTLnRpbWVycyA9IFtdLCBTLmZ4LnRpY2sgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCB0ID0gMCwgbiA9IFMudGltZXJzOyBmb3IgKHR0ID0gRGF0ZS5ub3coKTsgdCA8IG4ubGVuZ3RoOyB0KyspKGUgPSBuW3RdKSgpIHx8IG5bdF0gIT09IGUgfHwgbi5zcGxpY2UodC0tLCAxKTsgbi5sZW5ndGggfHwgUy5meC5zdG9wKCksIHR0ID0gdm9pZCAwIH0sIFMuZngudGltZXIgPSBmdW5jdGlvbiAoZSkgeyBTLnRpbWVycy5wdXNoKGUpLCBTLmZ4LnN0YXJ0KCkgfSwgUy5meC5pbnRlcnZhbCA9IDEzLCBTLmZ4LnN0YXJ0ID0gZnVuY3Rpb24gKCkgeyBudCB8fCAobnQgPSAhMCwgc3QoKSkgfSwgUy5meC5zdG9wID0gZnVuY3Rpb24gKCkgeyBudCA9IG51bGwgfSwgUy5meC5zcGVlZHMgPSB7IHNsb3c6IDYwMCwgZmFzdDogMjAwLCBfZGVmYXVsdDogNDAwIH0sIFMuZm4uZGVsYXkgPSBmdW5jdGlvbiAociwgZSkgeyByZXR1cm4gciA9IFMuZnggJiYgUy5meC5zcGVlZHNbcl0gfHwgciwgZSA9IGUgfHwgImZ4IiwgdGhpcy5xdWV1ZShlLCBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiA9IEMuc2V0VGltZW91dChlLCByKTsgdC5zdG9wID0gZnVuY3Rpb24gKCkgeyBDLmNsZWFyVGltZW91dChuKSB9IH0pIH0sIHJ0ID0gRS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLCBpdCA9IEUuY3JlYXRlRWxlbWVudCgic2VsZWN0IikuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksIHJ0LnR5cGUgPSAiY2hlY2tib3giLCB5LmNoZWNrT24gPSAiIiAhPT0gcnQudmFsdWUsIHkub3B0U2VsZWN0ZWQgPSBpdC5zZWxlY3RlZCwgKHJ0ID0gRS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS52YWx1ZSA9ICJ0IiwgcnQudHlwZSA9ICJyYWRpbyIsIHkucmFkaW9WYWx1ZSA9ICJ0IiA9PT0gcnQudmFsdWU7IHZhciBwdCwgZHQgPSBTLmV4cHIuYXR0ckhhbmRsZTsgUy5mbi5leHRlbmQoeyBhdHRyOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gJCh0aGlzLCBTLmF0dHIsIGUsIHQsIDEgPCBhcmd1bWVudHMubGVuZ3RoKSB9LCByZW1vdmVBdHRyOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUy5yZW1vdmVBdHRyKHRoaXMsIGUpIH0pIH0gfSksIFMuZXh0ZW5kKHsgYXR0cjogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8gPSBlLm5vZGVUeXBlOyBpZiAoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgPyBTLnByb3AoZSwgdCwgbikgOiAoMSA9PT0gbyAmJiBTLmlzWE1MRG9jKGUpIHx8IChpID0gUy5hdHRySG9va3NbdC50b0xvd2VyQ2FzZSgpXSB8fCAoUy5leHByLm1hdGNoLmJvb2wudGVzdCh0KSA/IHB0IDogdm9pZCAwKSksIHZvaWQgMCAhPT0gbiA/IG51bGwgPT09IG4gPyB2b2lkIFMucmVtb3ZlQXR0cihlLCB0KSA6IGkgJiYgInNldCIgaW4gaSAmJiB2b2lkIDAgIT09IChyID0gaS5zZXQoZSwgbiwgdCkpID8gciA6IChlLnNldEF0dHJpYnV0ZSh0LCBuICsgIiIpLCBuKSA6IGkgJiYgImdldCIgaW4gaSAmJiBudWxsICE9PSAociA9IGkuZ2V0KGUsIHQpKSA/IHIgOiBudWxsID09IChyID0gUy5maW5kLmF0dHIoZSwgdCkpID8gdm9pZCAwIDogcikgfSwgYXR0ckhvb2tzOiB7IHR5cGU6IHsgc2V0OiBmdW5jdGlvbiAoZSwgdCkgeyBpZiAoIXkucmFkaW9WYWx1ZSAmJiAicmFkaW8iID09PSB0ICYmIEEoZSwgImlucHV0IikpIHsgdmFyIG4gPSBlLnZhbHVlOyByZXR1cm4gZS5zZXRBdHRyaWJ1dGUoInR5cGUiLCB0KSwgbiAmJiAoZS52YWx1ZSA9IG4pLCB0IH0gfSB9IH0sIHJlbW92ZUF0dHI6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuLCByID0gMCwgaSA9IHQgJiYgdC5tYXRjaChQKTsgaWYgKGkgJiYgMSA9PT0gZS5ub2RlVHlwZSkgd2hpbGUgKG4gPSBpW3IrK10pIGUucmVtb3ZlQXR0cmlidXRlKG4pIH0gfSksIHB0ID0geyBzZXQ6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiAhMSA9PT0gdCA/IFMucmVtb3ZlQXR0cihlLCBuKSA6IGUuc2V0QXR0cmlidXRlKG4sIG4pLCBuIH0gfSwgUy5lYWNoKFMuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCgvXHcrL2cpLCBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgYSA9IGR0W3RdIHx8IFMuZmluZC5hdHRyOyBkdFt0XSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvID0gdC50b0xvd2VyQ2FzZSgpOyByZXR1cm4gbiB8fCAoaSA9IGR0W29dLCBkdFtvXSA9IHIsIHIgPSBudWxsICE9IGEoZSwgdCwgbikgPyBvIDogbnVsbCwgZHRbb10gPSBpKSwgciB9IH0pOyB2YXIgaHQgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLCBndCA9IC9eKD86YXxhcmVhKSQvaTsgZnVuY3Rpb24gdnQoZSkgeyByZXR1cm4gKGUubWF0Y2goUCkgfHwgW10pLmpvaW4oIiAiKSB9IGZ1bmN0aW9uIHl0KGUpIHsgcmV0dXJuIGUuZ2V0QXR0cmlidXRlICYmIGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiIH0gZnVuY3Rpb24gbXQoZSkgeyByZXR1cm4gQXJyYXkuaXNBcnJheShlKSA/IGUgOiAic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiBlLm1hdGNoKFApIHx8IFtdIH0gUy5mbi5leHRlbmQoeyBwcm9wOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gJCh0aGlzLCBTLnByb3AsIGUsIHQsIDEgPCBhcmd1bWVudHMubGVuZ3RoKSB9LCByZW1vdmVQcm9wOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgZGVsZXRlIHRoaXNbUy5wcm9wRml4W2VdIHx8IGVdIH0pIH0gfSksIFMuZXh0ZW5kKHsgcHJvcDogZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8gPSBlLm5vZGVUeXBlOyBpZiAoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAxID09PSBvICYmIFMuaXNYTUxEb2MoZSkgfHwgKHQgPSBTLnByb3BGaXhbdF0gfHwgdCwgaSA9IFMucHJvcEhvb2tzW3RdKSwgdm9pZCAwICE9PSBuID8gaSAmJiAic2V0IiBpbiBpICYmIHZvaWQgMCAhPT0gKHIgPSBpLnNldChlLCBuLCB0KSkgPyByIDogZVt0XSA9IG4gOiBpICYmICJnZXQiIGluIGkgJiYgbnVsbCAhPT0gKHIgPSBpLmdldChlLCB0KSkgPyByIDogZVt0XSB9LCBwcm9wSG9va3M6IHsgdGFiSW5kZXg6IHsgZ2V0OiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ0YWJpbmRleCIpOyByZXR1cm4gdCA/IHBhcnNlSW50KHQsIDEwKSA6IGh0LnRlc3QoZS5ub2RlTmFtZSkgfHwgZ3QudGVzdChlLm5vZGVOYW1lKSAmJiBlLmhyZWYgPyAwIDogLTEgfSB9IH0sIHByb3BGaXg6IHsgImZvciI6ICJodG1sRm9yIiwgImNsYXNzIjogImNsYXNzTmFtZSIgfSB9KSwgeS5vcHRTZWxlY3RlZCB8fCAoUy5wcm9wSG9va3Muc2VsZWN0ZWQgPSB7IGdldDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnBhcmVudE5vZGU7IHJldHVybiB0ICYmIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgbnVsbCB9LCBzZXQ6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5wYXJlbnROb2RlOyB0ICYmICh0LnNlbGVjdGVkSW5kZXgsIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCkgfSB9KSwgUy5lYWNoKFsidGFiSW5kZXgiLCAicmVhZE9ubHkiLCAibWF4TGVuZ3RoIiwgImNlbGxTcGFjaW5nIiwgImNlbGxQYWRkaW5nIiwgInJvd1NwYW4iLCAiY29sU3BhbiIsICJ1c2VNYXAiLCAiZnJhbWVCb3JkZXIiLCAiY29udGVudEVkaXRhYmxlIl0sIGZ1bmN0aW9uICgpIHsgUy5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV0gPSB0aGlzIH0pLCBTLmZuLmV4dGVuZCh7IGFkZENsYXNzOiBmdW5jdGlvbiAodCkgeyB2YXIgZSwgbiwgciwgaSwgbywgYSwgcywgdSA9IDA7IGlmIChtKHQpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChlKSB7IFModGhpcykuYWRkQ2xhc3ModC5jYWxsKHRoaXMsIGUsIHl0KHRoaXMpKSkgfSk7IGlmICgoZSA9IG10KHQpKS5sZW5ndGgpIHdoaWxlIChuID0gdGhpc1t1KytdKSBpZiAoaSA9IHl0KG4pLCByID0gMSA9PT0gbi5ub2RlVHlwZSAmJiAiICIgKyB2dChpKSArICIgIikgeyBhID0gMDsgd2hpbGUgKG8gPSBlW2ErK10pIHIuaW5kZXhPZigiICIgKyBvICsgIiAiKSA8IDAgJiYgKHIgKz0gbyArICIgIik7IGkgIT09IChzID0gdnQocikpICYmIG4uc2V0QXR0cmlidXRlKCJjbGFzcyIsIHMpIH0gcmV0dXJuIHRoaXMgfSwgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uICh0KSB7IHZhciBlLCBuLCByLCBpLCBvLCBhLCBzLCB1ID0gMDsgaWYgKG0odCkpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsgUyh0aGlzKS5yZW1vdmVDbGFzcyh0LmNhbGwodGhpcywgZSwgeXQodGhpcykpKSB9KTsgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5hdHRyKCJjbGFzcyIsICIiKTsgaWYgKChlID0gbXQodCkpLmxlbmd0aCkgd2hpbGUgKG4gPSB0aGlzW3UrK10pIGlmIChpID0geXQobiksIHIgPSAxID09PSBuLm5vZGVUeXBlICYmICIgIiArIHZ0KGkpICsgIiAiKSB7IGEgPSAwOyB3aGlsZSAobyA9IGVbYSsrXSkgd2hpbGUgKC0xIDwgci5pbmRleE9mKCIgIiArIG8gKyAiICIpKSByID0gci5yZXBsYWNlKCIgIiArIG8gKyAiICIsICIgIik7IGkgIT09IChzID0gdnQocikpICYmIG4uc2V0QXR0cmlidXRlKCJjbGFzcyIsIHMpIH0gcmV0dXJuIHRoaXMgfSwgdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uIChpLCB0KSB7IHZhciBvID0gdHlwZW9mIGksIGEgPSAic3RyaW5nIiA9PT0gbyB8fCBBcnJheS5pc0FycmF5KGkpOyByZXR1cm4gImJvb2xlYW4iID09IHR5cGVvZiB0ICYmIGEgPyB0ID8gdGhpcy5hZGRDbGFzcyhpKSA6IHRoaXMucmVtb3ZlQ2xhc3MoaSkgOiBtKGkpID8gdGhpcy5lYWNoKGZ1bmN0aW9uIChlKSB7IFModGhpcykudG9nZ2xlQ2xhc3MoaS5jYWxsKHRoaXMsIGUsIHl0KHRoaXMpLCB0KSwgdCkgfSkgOiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCwgbiwgcjsgaWYgKGEpIHsgdCA9IDAsIG4gPSBTKHRoaXMpLCByID0gbXQoaSk7IHdoaWxlIChlID0gclt0KytdKSBuLmhhc0NsYXNzKGUpID8gbi5yZW1vdmVDbGFzcyhlKSA6IG4uYWRkQ2xhc3MoZSkgfSBlbHNlIHZvaWQgMCAhPT0gaSAmJiAiYm9vbGVhbiIgIT09IG8gfHwgKChlID0geXQodGhpcykpICYmIFkuc2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgZSksIHRoaXMuc2V0QXR0cmlidXRlICYmIHRoaXMuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGUgfHwgITEgPT09IGkgPyAiIiA6IFkuZ2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIikgfHwgIiIpKSB9KSB9LCBoYXNDbGFzczogZnVuY3Rpb24gKGUpIHsgdmFyIHQsIG4sIHIgPSAwOyB0ID0gIiAiICsgZSArICIgIjsgd2hpbGUgKG4gPSB0aGlzW3IrK10pIGlmICgxID09PSBuLm5vZGVUeXBlICYmIC0xIDwgKCIgIiArIHZ0KHl0KG4pKSArICIgIikuaW5kZXhPZih0KSkgcmV0dXJuICEwOyByZXR1cm4gITEgfSB9KTsgdmFyIHh0ID0gL1xyL2c7IFMuZm4uZXh0ZW5kKHsgdmFsOiBmdW5jdGlvbiAobikgeyB2YXIgciwgZSwgaSwgdCA9IHRoaXNbMF07IHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGkgPSBtKG4pLCB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IDEgPT09IHRoaXMubm9kZVR5cGUgJiYgKG51bGwgPT0gKHQgPSBpID8gbi5jYWxsKHRoaXMsIGUsIFModGhpcykudmFsKCkpIDogbikgPyB0ID0gIiIgOiAibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHQgKz0gIiIgOiBBcnJheS5pc0FycmF5KHQpICYmICh0ID0gUy5tYXAodCwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG51bGwgPT0gZSA/ICIiIDogZSArICIiIH0pKSwgKHIgPSBTLnZhbEhvb2tzW3RoaXMudHlwZV0gfHwgUy52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiAic2V0IiBpbiByICYmIHZvaWQgMCAhPT0gci5zZXQodGhpcywgdCwgInZhbHVlIikgfHwgKHRoaXMudmFsdWUgPSB0KSkgfSkpIDogdCA/IChyID0gUy52YWxIb29rc1t0LnR5cGVdIHx8IFMudmFsSG9va3NbdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSkgJiYgImdldCIgaW4gciAmJiB2b2lkIDAgIT09IChlID0gci5nZXQodCwgInZhbHVlIikpID8gZSA6ICJzdHJpbmciID09IHR5cGVvZiAoZSA9IHQudmFsdWUpID8gZS5yZXBsYWNlKHh0LCAiIikgOiBudWxsID09IGUgPyAiIiA6IGUgOiB2b2lkIDAgfSB9KSwgUy5leHRlbmQoeyB2YWxIb29rczogeyBvcHRpb246IHsgZ2V0OiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ2YWx1ZSIpOyByZXR1cm4gbnVsbCAhPSB0ID8gdCA6IHZ0KFMudGV4dChlKSkgfSB9LCBzZWxlY3Q6IHsgZ2V0OiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgbiwgciwgaSA9IGUub3B0aW9ucywgbyA9IGUuc2VsZWN0ZWRJbmRleCwgYSA9ICJzZWxlY3Qtb25lIiA9PT0gZS50eXBlLCBzID0gYSA/IG51bGwgOiBbXSwgdSA9IGEgPyBvICsgMSA6IGkubGVuZ3RoOyBmb3IgKHIgPSBvIDwgMCA/IHUgOiBhID8gbyA6IDA7IHIgPCB1OyByKyspaWYgKCgobiA9IGlbcl0pLnNlbGVjdGVkIHx8IHIgPT09IG8pICYmICFuLmRpc2FibGVkICYmICghbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFBKG4ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIikpKSB7IGlmICh0ID0gUyhuKS52YWwoKSwgYSkgcmV0dXJuIHQ7IHMucHVzaCh0KSB9IHJldHVybiBzIH0sIHNldDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIsIGkgPSBlLm9wdGlvbnMsIG8gPSBTLm1ha2VBcnJheSh0KSwgYSA9IGkubGVuZ3RoOyB3aGlsZSAoYS0tKSAoKHIgPSBpW2FdKS5zZWxlY3RlZCA9IC0xIDwgUy5pbkFycmF5KFMudmFsSG9va3Mub3B0aW9uLmdldChyKSwgbykpICYmIChuID0gITApOyByZXR1cm4gbiB8fCAoZS5zZWxlY3RlZEluZGV4ID0gLTEpLCBvIH0gfSB9IH0pLCBTLmVhY2goWyJyYWRpbyIsICJjaGVja2JveCJdLCBmdW5jdGlvbiAoKSB7IFMudmFsSG9va3NbdGhpc10gPSB7IHNldDogZnVuY3Rpb24gKGUsIHQpIHsgaWYgKEFycmF5LmlzQXJyYXkodCkpIHJldHVybiBlLmNoZWNrZWQgPSAtMSA8IFMuaW5BcnJheShTKGUpLnZhbCgpLCB0KSB9IH0sIHkuY2hlY2tPbiB8fCAoUy52YWxIb29rc1t0aGlzXS5nZXQgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbnVsbCA9PT0gZS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPyAib24iIDogZS52YWx1ZSB9KSB9KSwgeS5mb2N1c2luID0gIm9uZm9jdXNpbiIgaW4gQzsgdmFyIGJ0ID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLCB3dCA9IGZ1bmN0aW9uIChlKSB7IGUuc3RvcFByb3BhZ2F0aW9uKCkgfTsgUy5leHRlbmQoUy5ldmVudCwgeyB0cmlnZ2VyOiBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyB2YXIgaSwgbywgYSwgcywgdSwgbCwgYywgZiwgcCA9IFtuIHx8IEVdLCBkID0gdi5jYWxsKGUsICJ0eXBlIikgPyBlLnR5cGUgOiBlLCBoID0gdi5jYWxsKGUsICJuYW1lc3BhY2UiKSA/IGUubmFtZXNwYWNlLnNwbGl0KCIuIikgOiBbXTsgaWYgKG8gPSBmID0gYSA9IG4gPSBuIHx8IEUsIDMgIT09IG4ubm9kZVR5cGUgJiYgOCAhPT0gbi5ub2RlVHlwZSAmJiAhYnQudGVzdChkICsgUy5ldmVudC50cmlnZ2VyZWQpICYmICgtMSA8IGQuaW5kZXhPZigiLiIpICYmIChkID0gKGggPSBkLnNwbGl0KCIuIikpLnNoaWZ0KCksIGguc29ydCgpKSwgdSA9IGQuaW5kZXhPZigiOiIpIDwgMCAmJiAib24iICsgZCwgKGUgPSBlW1MuZXhwYW5kb10gPyBlIDogbmV3IFMuRXZlbnQoZCwgIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZSkpLmlzVHJpZ2dlciA9IHIgPyAyIDogMywgZS5uYW1lc3BhY2UgPSBoLmpvaW4oIi4iKSwgZS5ybmFtZXNwYWNlID0gZS5uYW1lc3BhY2UgPyBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSA6IG51bGwsIGUucmVzdWx0ID0gdm9pZCAwLCBlLnRhcmdldCB8fCAoZS50YXJnZXQgPSBuKSwgdCA9IG51bGwgPT0gdCA/IFtlXSA6IFMubWFrZUFycmF5KHQsIFtlXSksIGMgPSBTLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIHIgfHwgIWMudHJpZ2dlciB8fCAhMSAhPT0gYy50cmlnZ2VyLmFwcGx5KG4sIHQpKSkgeyBpZiAoIXIgJiYgIWMubm9CdWJibGUgJiYgIXgobikpIHsgZm9yIChzID0gYy5kZWxlZ2F0ZVR5cGUgfHwgZCwgYnQudGVzdChzICsgZCkgfHwgKG8gPSBvLnBhcmVudE5vZGUpOyBvOyBvID0gby5wYXJlbnROb2RlKXAucHVzaChvKSwgYSA9IG87IGEgPT09IChuLm93bmVyRG9jdW1lbnQgfHwgRSkgJiYgcC5wdXNoKGEuZGVmYXVsdFZpZXcgfHwgYS5wYXJlbnRXaW5kb3cgfHwgQykgfSBpID0gMDsgd2hpbGUgKChvID0gcFtpKytdKSAmJiAhZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBmID0gbywgZS50eXBlID0gMSA8IGkgPyBzIDogYy5iaW5kVHlwZSB8fCBkLCAobCA9IChZLmdldChvLCAiZXZlbnRzIikgfHwgT2JqZWN0LmNyZWF0ZShudWxsKSlbZS50eXBlXSAmJiBZLmdldChvLCAiaGFuZGxlIikpICYmIGwuYXBwbHkobywgdCksIChsID0gdSAmJiBvW3VdKSAmJiBsLmFwcGx5ICYmIFYobykgJiYgKGUucmVzdWx0ID0gbC5hcHBseShvLCB0KSwgITEgPT09IGUucmVzdWx0ICYmIGUucHJldmVudERlZmF1bHQoKSk7IHJldHVybiBlLnR5cGUgPSBkLCByIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgYy5fZGVmYXVsdCAmJiAhMSAhPT0gYy5fZGVmYXVsdC5hcHBseShwLnBvcCgpLCB0KSB8fCAhVihuKSB8fCB1ICYmIG0obltkXSkgJiYgIXgobikgJiYgKChhID0gblt1XSkgJiYgKG5bdV0gPSBudWxsKSwgUy5ldmVudC50cmlnZ2VyZWQgPSBkLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5hZGRFdmVudExpc3RlbmVyKGQsIHd0KSwgbltkXSgpLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5yZW1vdmVFdmVudExpc3RlbmVyKGQsIHd0KSwgUy5ldmVudC50cmlnZ2VyZWQgPSB2b2lkIDAsIGEgJiYgKG5bdV0gPSBhKSksIGUucmVzdWx0IH0gfSwgc2ltdWxhdGU6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByID0gUy5leHRlbmQobmV3IFMuRXZlbnQsIG4sIHsgdHlwZTogZSwgaXNTaW11bGF0ZWQ6ICEwIH0pOyBTLmV2ZW50LnRyaWdnZXIociwgbnVsbCwgdCkgfSB9KSwgUy5mbi5leHRlbmQoeyB0cmlnZ2VyOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgUy5ldmVudC50cmlnZ2VyKGUsIHQsIHRoaXMpIH0pIH0sIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgbiA9IHRoaXNbMF07IGlmIChuKSByZXR1cm4gUy5ldmVudC50cmlnZ2VyKGUsIHQsIG4sICEwKSB9IH0pLCB5LmZvY3VzaW4gfHwgUy5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiAobiwgcikgeyB2YXIgaSA9IGZ1bmN0aW9uIChlKSB7IFMuZXZlbnQuc2ltdWxhdGUociwgZS50YXJnZXQsIFMuZXZlbnQuZml4KGUpKSB9OyBTLmV2ZW50LnNwZWNpYWxbcl0gPSB7IHNldHVwOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpOyB0IHx8IGUuYWRkRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkuYWNjZXNzKGUsIHIsICh0IHx8IDApICsgMSkgfSwgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcy5kb2N1bWVudCB8fCB0aGlzLCB0ID0gWS5hY2Nlc3MoZSwgcikgLSAxOyB0ID8gWS5hY2Nlc3MoZSwgciwgdCkgOiAoZS5yZW1vdmVFdmVudExpc3RlbmVyKG4sIGksICEwKSwgWS5yZW1vdmUoZSwgcikpIH0gfSB9KTsgdmFyIFR0ID0gQy5sb2NhdGlvbiwgQ3QgPSB7IGd1aWQ6IERhdGUubm93KCkgfSwgRXQgPSAvXD8vOyBTLnBhcnNlWE1MID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IGlmICghZSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgZSkgcmV0dXJuIG51bGw7IHRyeSB7IHQgPSAobmV3IEMuRE9NUGFyc2VyKS5wYXJzZUZyb21TdHJpbmcoZSwgInRleHQveG1sIikgfSBjYXRjaCAoZSkgeyB0ID0gdm9pZCAwIH0gcmV0dXJuIHQgJiYgIXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInBhcnNlcmVycm9yIikubGVuZ3RoIHx8IFMuZXJyb3IoIkludmFsaWQgWE1MOiAiICsgZSksIHQgfTsgdmFyIFN0ID0gL1xbXF0kLywga3QgPSAvXHI/XG4vZywgQXQgPSAvXig/OnN1Ym1pdHxidXR0b258aW1hZ2V8cmVzZXR8ZmlsZSkkL2ksIE50ID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOyBmdW5jdGlvbiBEdChuLCBlLCByLCBpKSB7IHZhciB0OyBpZiAoQXJyYXkuaXNBcnJheShlKSkgUy5lYWNoKGUsIGZ1bmN0aW9uIChlLCB0KSB7IHIgfHwgU3QudGVzdChuKSA/IGkobiwgdCkgOiBEdChuICsgIlsiICsgKCJvYmplY3QiID09IHR5cGVvZiB0ICYmIG51bGwgIT0gdCA/IGUgOiAiIikgKyAiXSIsIHQsIHIsIGkpIH0pOyBlbHNlIGlmIChyIHx8ICJvYmplY3QiICE9PSB3KGUpKSBpKG4sIGUpOyBlbHNlIGZvciAodCBpbiBlKSBEdChuICsgIlsiICsgdCArICJdIiwgZVt0XSwgciwgaSkgfSBTLnBhcmFtID0gZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIgPSBbXSwgaSA9IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gbSh0KSA/IHQoKSA6IHQ7IHJbci5sZW5ndGhdID0gZW5jb2RlVVJJQ29tcG9uZW50KGUpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG51bGwgPT0gbiA/ICIiIDogbikgfTsgaWYgKG51bGwgPT0gZSkgcmV0dXJuICIiOyBpZiAoQXJyYXkuaXNBcnJheShlKSB8fCBlLmpxdWVyeSAmJiAhUy5pc1BsYWluT2JqZWN0KGUpKSBTLmVhY2goZSwgZnVuY3Rpb24gKCkgeyBpKHRoaXMubmFtZSwgdGhpcy52YWx1ZSkgfSk7IGVsc2UgZm9yIChuIGluIGUpIER0KG4sIGVbbl0sIHQsIGkpOyByZXR1cm4gci5qb2luKCImIikgfSwgUy5mbi5leHRlbmQoeyBzZXJpYWxpemU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFMucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKSB9LCBzZXJpYWxpemVBcnJheTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFMucHJvcCh0aGlzLCAiZWxlbWVudHMiKTsgcmV0dXJuIGUgPyBTLm1ha2VBcnJheShlKSA6IHRoaXMgfSkuZmlsdGVyKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLnR5cGU7IHJldHVybiB0aGlzLm5hbWUgJiYgIVModGhpcykuaXMoIjpkaXNhYmxlZCIpICYmIE50LnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIUF0LnRlc3QoZSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhcGUudGVzdChlKSkgfSkubWFwKGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gUyh0aGlzKS52YWwoKTsgcmV0dXJuIG51bGwgPT0gbiA/IG51bGwgOiBBcnJheS5pc0FycmF5KG4pID8gUy5tYXAobiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHsgbmFtZTogdC5uYW1lLCB2YWx1ZTogZS5yZXBsYWNlKGt0LCAiXHJcbiIpIH0gfSkgOiB7IG5hbWU6IHQubmFtZSwgdmFsdWU6IG4ucmVwbGFjZShrdCwgIlxyXG4iKSB9IH0pLmdldCgpIH0gfSk7IHZhciBqdCA9IC8lMjAvZywgcXQgPSAvIy4qJC8sIEx0ID0gLyhbPyZdKV89W14mXSovLCBIdCA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sIE90ID0gL14oPzpHRVR8SEVBRCkkLywgUHQgPSAvXlwvXC8vLCBSdCA9IHt9LCBNdCA9IHt9LCBJdCA9ICIqLyIuY29uY2F0KCIqIiksIFd0ID0gRS5jcmVhdGVFbGVtZW50KCJhIik7IGZ1bmN0aW9uIEZ0KG8pIHsgcmV0dXJuIGZ1bmN0aW9uIChlLCB0KSB7ICJzdHJpbmciICE9IHR5cGVvZiBlICYmICh0ID0gZSwgZSA9ICIqIik7IHZhciBuLCByID0gMCwgaSA9IGUudG9Mb3dlckNhc2UoKS5tYXRjaChQKSB8fCBbXTsgaWYgKG0odCkpIHdoaWxlIChuID0gaVtyKytdKSAiKyIgPT09IG5bMF0gPyAobiA9IG4uc2xpY2UoMSkgfHwgIioiLCAob1tuXSA9IG9bbl0gfHwgW10pLnVuc2hpZnQodCkpIDogKG9bbl0gPSBvW25dIHx8IFtdKS5wdXNoKHQpIH0gfSBmdW5jdGlvbiBCdCh0LCBpLCBvLCBhKSB7IHZhciBzID0ge30sIHUgPSB0ID09PSBNdDsgZnVuY3Rpb24gbChlKSB7IHZhciByOyByZXR1cm4gc1tlXSA9ICEwLCBTLmVhY2godFtlXSB8fCBbXSwgZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4gPSB0KGksIG8sIGEpOyByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIG4gfHwgdSB8fCBzW25dID8gdSA/ICEociA9IG4pIDogdm9pZCAwIDogKGkuZGF0YVR5cGVzLnVuc2hpZnQobiksIGwobiksICExKSB9KSwgciB9IHJldHVybiBsKGkuZGF0YVR5cGVzWzBdKSB8fCAhc1siKiJdICYmIGwoIioiKSB9IGZ1bmN0aW9uICR0KGUsIHQpIHsgdmFyIG4sIHIsIGkgPSBTLmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9ucyB8fCB7fTsgZm9yIChuIGluIHQpIHZvaWQgMCAhPT0gdFtuXSAmJiAoKGlbbl0gPyBlIDogciB8fCAociA9IHt9KSlbbl0gPSB0W25dKTsgcmV0dXJuIHIgJiYgUy5leHRlbmQoITAsIGUsIHIpLCBlIH0gV3QuaHJlZiA9IFR0LmhyZWYsIFMuZXh0ZW5kKHsgYWN0aXZlOiAwLCBsYXN0TW9kaWZpZWQ6IHt9LCBldGFnOiB7fSwgYWpheFNldHRpbmdzOiB7IHVybDogVHQuaHJlZiwgdHlwZTogIkdFVCIsIGlzTG9jYWw6IC9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLnRlc3QoVHQucHJvdG9jb2wpLCBnbG9iYWw6ICEwLCBwcm9jZXNzRGF0YTogITAsIGFzeW5jOiAhMCwgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgiLCBhY2NlcHRzOiB7ICIqIjogSXQsIHRleHQ6ICJ0ZXh0L3BsYWluIiwgaHRtbDogInRleHQvaHRtbCIsIHhtbDogImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLCBqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IiB9LCBjb250ZW50czogeyB4bWw6IC9cYnhtbFxiLywgaHRtbDogL1xiaHRtbC8sIGpzb246IC9cYmpzb25cYi8gfSwgcmVzcG9uc2VGaWVsZHM6IHsgeG1sOiAicmVzcG9uc2VYTUwiLCB0ZXh0OiAicmVzcG9uc2VUZXh0IiwganNvbjogInJlc3BvbnNlSlNPTiIgfSwgY29udmVydGVyczogeyAiKiB0ZXh0IjogU3RyaW5nLCAidGV4dCBodG1sIjogITAsICJ0ZXh0IGpzb24iOiBKU09OLnBhcnNlLCAidGV4dCB4bWwiOiBTLnBhcnNlWE1MIH0sIGZsYXRPcHRpb25zOiB7IHVybDogITAsIGNvbnRleHQ6ICEwIH0gfSwgYWpheFNldHVwOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdCA/ICR0KCR0KGUsIFMuYWpheFNldHRpbmdzKSwgdCkgOiAkdChTLmFqYXhTZXR0aW5ncywgZSkgfSwgYWpheFByZWZpbHRlcjogRnQoUnQpLCBhamF4VHJhbnNwb3J0OiBGdChNdCksIGFqYXg6IGZ1bmN0aW9uIChlLCB0KSB7ICJvYmplY3QiID09IHR5cGVvZiBlICYmICh0ID0gZSwgZSA9IHZvaWQgMCksIHQgPSB0IHx8IHt9OyB2YXIgYywgZiwgcCwgbiwgZCwgciwgaCwgZywgaSwgbywgdiA9IFMuYWpheFNldHVwKHt9LCB0KSwgeSA9IHYuY29udGV4dCB8fCB2LCBtID0gdi5jb250ZXh0ICYmICh5Lm5vZGVUeXBlIHx8IHkuanF1ZXJ5KSA/IFMoeSkgOiBTLmV2ZW50LCB4ID0gUy5EZWZlcnJlZCgpLCBiID0gUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIHcgPSB2LnN0YXR1c0NvZGUgfHwge30sIGEgPSB7fSwgcyA9IHt9LCB1ID0gImNhbmNlbGVkIiwgVCA9IHsgcmVhZHlTdGF0ZTogMCwgZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uIChlKSB7IHZhciB0OyBpZiAoaCkgeyBpZiAoIW4pIHsgbiA9IHt9OyB3aGlsZSAodCA9IEh0LmV4ZWMocCkpIG5bdFsxXS50b0xvd2VyQ2FzZSgpICsgIiAiXSA9IChuW3RbMV0udG9Mb3dlckNhc2UoKSArICIgIl0gfHwgW10pLmNvbmNhdCh0WzJdKSB9IHQgPSBuW2UudG9Mb3dlckNhc2UoKSArICIgIl0gfSByZXR1cm4gbnVsbCA9PSB0ID8gbnVsbCA6IHQuam9pbigiLCAiKSB9LCBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGggPyBwIDogbnVsbCB9LCBzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gbnVsbCA9PSBoICYmIChlID0gc1tlLnRvTG93ZXJDYXNlKCldID0gc1tlLnRvTG93ZXJDYXNlKCldIHx8IGUsIGFbZV0gPSB0KSwgdGhpcyB9LCBvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbnVsbCA9PSBoICYmICh2Lm1pbWVUeXBlID0gZSksIHRoaXMgfSwgc3RhdHVzQ29kZTogZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IGlmIChlKSBpZiAoaCkgVC5hbHdheXMoZVtULnN0YXR1c10pOyBlbHNlIGZvciAodCBpbiBlKSB3W3RdID0gW3dbdF0sIGVbdF1dOyByZXR1cm4gdGhpcyB9LCBhYm9ydDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlIHx8IHU7IHJldHVybiBjICYmIGMuYWJvcnQodCksIGwoMCwgdCksIHRoaXMgfSB9OyBpZiAoeC5wcm9taXNlKFQpLCB2LnVybCA9ICgoZSB8fCB2LnVybCB8fCBUdC5ocmVmKSArICIiKS5yZXBsYWNlKFB0LCBUdC5wcm90b2NvbCArICIvLyIpLCB2LnR5cGUgPSB0Lm1ldGhvZCB8fCB0LnR5cGUgfHwgdi5tZXRob2QgfHwgdi50eXBlLCB2LmRhdGFUeXBlcyA9ICh2LmRhdGFUeXBlIHx8ICIqIikudG9Mb3dlckNhc2UoKS5tYXRjaChQKSB8fCBbIiJdLCBudWxsID09IHYuY3Jvc3NEb21haW4pIHsgciA9IEUuY3JlYXRlRWxlbWVudCgiYSIpOyB0cnkgeyByLmhyZWYgPSB2LnVybCwgci5ocmVmID0gci5ocmVmLCB2LmNyb3NzRG9tYWluID0gV3QucHJvdG9jb2wgKyAiLy8iICsgV3QuaG9zdCAhPSByLnByb3RvY29sICsgIi8vIiArIHIuaG9zdCB9IGNhdGNoIChlKSB7IHYuY3Jvc3NEb21haW4gPSAhMCB9IH0gaWYgKHYuZGF0YSAmJiB2LnByb2Nlc3NEYXRhICYmICJzdHJpbmciICE9IHR5cGVvZiB2LmRhdGEgJiYgKHYuZGF0YSA9IFMucGFyYW0odi5kYXRhLCB2LnRyYWRpdGlvbmFsKSksIEJ0KFJ0LCB2LCB0LCBUKSwgaCkgcmV0dXJuIFQ7IGZvciAoaSBpbiAoZyA9IFMuZXZlbnQgJiYgdi5nbG9iYWwpICYmIDAgPT0gUy5hY3RpdmUrKyAmJiBTLmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpLCB2LnR5cGUgPSB2LnR5cGUudG9VcHBlckNhc2UoKSwgdi5oYXNDb250ZW50ID0gIU90LnRlc3Qodi50eXBlKSwgZiA9IHYudXJsLnJlcGxhY2UocXQsICIiKSwgdi5oYXNDb250ZW50ID8gdi5kYXRhICYmIHYucHJvY2Vzc0RhdGEgJiYgMCA9PT0gKHYuY29udGVudFR5cGUgfHwgIiIpLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmICh2LmRhdGEgPSB2LmRhdGEucmVwbGFjZShqdCwgIisiKSkgOiAobyA9IHYudXJsLnNsaWNlKGYubGVuZ3RoKSwgdi5kYXRhICYmICh2LnByb2Nlc3NEYXRhIHx8ICJzdHJpbmciID09IHR5cGVvZiB2LmRhdGEpICYmIChmICs9IChFdC50ZXN0KGYpID8gIiYiIDogIj8iKSArIHYuZGF0YSwgZGVsZXRlIHYuZGF0YSksICExID09PSB2LmNhY2hlICYmIChmID0gZi5yZXBsYWNlKEx0LCAiJDEiKSwgbyA9IChFdC50ZXN0KGYpID8gIiYiIDogIj8iKSArICJfPSIgKyBDdC5ndWlkKysgKyBvKSwgdi51cmwgPSBmICsgbyksIHYuaWZNb2RpZmllZCAmJiAoUy5sYXN0TW9kaWZpZWRbZl0gJiYgVC5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Nb2RpZmllZC1TaW5jZSIsIFMubGFzdE1vZGlmaWVkW2ZdKSwgUy5ldGFnW2ZdICYmIFQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsIFMuZXRhZ1tmXSkpLCAodi5kYXRhICYmIHYuaGFzQ29udGVudCAmJiAhMSAhPT0gdi5jb250ZW50VHlwZSB8fCB0LmNvbnRlbnRUeXBlKSAmJiBULnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsIHYuY29udGVudFR5cGUpLCBULnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsIHYuZGF0YVR5cGVzWzBdICYmIHYuYWNjZXB0c1t2LmRhdGFUeXBlc1swXV0gPyB2LmFjY2VwdHNbdi5kYXRhVHlwZXNbMF1dICsgKCIqIiAhPT0gdi5kYXRhVHlwZXNbMF0gPyAiLCAiICsgSXQgKyAiOyBxPTAuMDEiIDogIiIpIDogdi5hY2NlcHRzWyIqIl0pLCB2LmhlYWRlcnMpIFQuc2V0UmVxdWVzdEhlYWRlcihpLCB2LmhlYWRlcnNbaV0pOyBpZiAodi5iZWZvcmVTZW5kICYmICghMSA9PT0gdi5iZWZvcmVTZW5kLmNhbGwoeSwgVCwgdikgfHwgaCkpIHJldHVybiBULmFib3J0KCk7IGlmICh1ID0gImFib3J0IiwgYi5hZGQodi5jb21wbGV0ZSksIFQuZG9uZSh2LnN1Y2Nlc3MpLCBULmZhaWwodi5lcnJvciksIGMgPSBCdChNdCwgdiwgdCwgVCkpIHsgaWYgKFQucmVhZHlTdGF0ZSA9IDEsIGcgJiYgbS50cmlnZ2VyKCJhamF4U2VuZCIsIFtULCB2XSksIGgpIHJldHVybiBUOyB2LmFzeW5jICYmIDAgPCB2LnRpbWVvdXQgJiYgKGQgPSBDLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBULmFib3J0KCJ0aW1lb3V0IikgfSwgdi50aW1lb3V0KSk7IHRyeSB7IGggPSAhMSwgYy5zZW5kKGEsIGwpIH0gY2F0Y2ggKGUpIHsgaWYgKGgpIHRocm93IGU7IGwoLTEsIGUpIH0gfSBlbHNlIGwoLTEsICJObyBUcmFuc3BvcnQiKTsgZnVuY3Rpb24gbChlLCB0LCBuLCByKSB7IHZhciBpLCBvLCBhLCBzLCB1LCBsID0gdDsgaCB8fCAoaCA9ICEwLCBkICYmIEMuY2xlYXJUaW1lb3V0KGQpLCBjID0gdm9pZCAwLCBwID0gciB8fCAiIiwgVC5yZWFkeVN0YXRlID0gMCA8IGUgPyA0IDogMCwgaSA9IDIwMCA8PSBlICYmIGUgPCAzMDAgfHwgMzA0ID09PSBlLCBuICYmIChzID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8sIGEsIHMgPSBlLmNvbnRlbnRzLCB1ID0gZS5kYXRhVHlwZXM7IHdoaWxlICgiKiIgPT09IHVbMF0pIHUuc2hpZnQoKSwgdm9pZCAwID09PSByICYmIChyID0gZS5taW1lVHlwZSB8fCB0LmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKSk7IGlmIChyKSBmb3IgKGkgaW4gcykgaWYgKHNbaV0gJiYgc1tpXS50ZXN0KHIpKSB7IHUudW5zaGlmdChpKTsgYnJlYWsgfSBpZiAodVswXSBpbiBuKSBvID0gdVswXTsgZWxzZSB7IGZvciAoaSBpbiBuKSB7IGlmICghdVswXSB8fCBlLmNvbnZlcnRlcnNbaSArICIgIiArIHVbMF1dKSB7IG8gPSBpOyBicmVhayB9IGEgfHwgKGEgPSBpKSB9IG8gPSBvIHx8IGEgfSBpZiAobykgcmV0dXJuIG8gIT09IHVbMF0gJiYgdS51bnNoaWZ0KG8pLCBuW29dIH0odiwgVCwgbikpLCAhaSAmJiAtMSA8IFMuaW5BcnJheSgic2NyaXB0Iiwgdi5kYXRhVHlwZXMpICYmICh2LmNvbnZlcnRlcnNbInRleHQgc2NyaXB0Il0gPSBmdW5jdGlvbiAoKSB7IH0pLCBzID0gZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHsgdmFyIGksIG8sIGEsIHMsIHUsIGwgPSB7fSwgYyA9IGUuZGF0YVR5cGVzLnNsaWNlKCk7IGlmIChjWzFdKSBmb3IgKGEgaW4gZS5jb252ZXJ0ZXJzKSBsW2EudG9Mb3dlckNhc2UoKV0gPSBlLmNvbnZlcnRlcnNbYV07IG8gPSBjLnNoaWZ0KCk7IHdoaWxlIChvKSBpZiAoZS5yZXNwb25zZUZpZWxkc1tvXSAmJiAobltlLnJlc3BvbnNlRmllbGRzW29dXSA9IHQpLCAhdSAmJiByICYmIGUuZGF0YUZpbHRlciAmJiAodCA9IGUuZGF0YUZpbHRlcih0LCBlLmRhdGFUeXBlKSksIHUgPSBvLCBvID0gYy5zaGlmdCgpKSBpZiAoIioiID09PSBvKSBvID0gdTsgZWxzZSBpZiAoIioiICE9PSB1ICYmIHUgIT09IG8pIHsgaWYgKCEoYSA9IGxbdSArICIgIiArIG9dIHx8IGxbIiogIiArIG9dKSkgZm9yIChpIGluIGwpIGlmICgocyA9IGkuc3BsaXQoIiAiKSlbMV0gPT09IG8gJiYgKGEgPSBsW3UgKyAiICIgKyBzWzBdXSB8fCBsWyIqICIgKyBzWzBdXSkpIHsgITAgPT09IGEgPyBhID0gbFtpXSA6ICEwICE9PSBsW2ldICYmIChvID0gc1swXSwgYy51bnNoaWZ0KHNbMV0pKTsgYnJlYWsgfSBpZiAoITAgIT09IGEpIGlmIChhICYmIGVbInRocm93cyJdKSB0ID0gYSh0KTsgZWxzZSB0cnkgeyB0ID0gYSh0KSB9IGNhdGNoIChlKSB7IHJldHVybiB7IHN0YXRlOiAicGFyc2VyZXJyb3IiLCBlcnJvcjogYSA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyB1ICsgIiB0byAiICsgbyB9IH0gfSByZXR1cm4geyBzdGF0ZTogInN1Y2Nlc3MiLCBkYXRhOiB0IH0gfSh2LCBzLCBULCBpKSwgaSA/ICh2LmlmTW9kaWZpZWQgJiYgKCh1ID0gVC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKSAmJiAoUy5sYXN0TW9kaWZpZWRbZl0gPSB1KSwgKHUgPSBULmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIikpICYmIChTLmV0YWdbZl0gPSB1KSksIDIwNCA9PT0gZSB8fCAiSEVBRCIgPT09IHYudHlwZSA/IGwgPSAibm9jb250ZW50IiA6IDMwNCA9PT0gZSA/IGwgPSAibm90bW9kaWZpZWQiIDogKGwgPSBzLnN0YXRlLCBvID0gcy5kYXRhLCBpID0gIShhID0gcy5lcnJvcikpKSA6IChhID0gbCwgIWUgJiYgbCB8fCAobCA9ICJlcnJvciIsIGUgPCAwICYmIChlID0gMCkpKSwgVC5zdGF0dXMgPSBlLCBULnN0YXR1c1RleHQgPSAodCB8fCBsKSArICIiLCBpID8geC5yZXNvbHZlV2l0aCh5LCBbbywgbCwgVF0pIDogeC5yZWplY3RXaXRoKHksIFtULCBsLCBhXSksIFQuc3RhdHVzQ29kZSh3KSwgdyA9IHZvaWQgMCwgZyAmJiBtLnRyaWdnZXIoaSA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwgW1QsIHYsIGkgPyBvIDogYV0pLCBiLmZpcmVXaXRoKHksIFtULCBsXSksIGcgJiYgKG0udHJpZ2dlcigiYWpheENvbXBsZXRlIiwgW1QsIHZdKSwgLS1TLmFjdGl2ZSB8fCBTLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikpKSB9IHJldHVybiBUIH0sIGdldEpTT046IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiBTLmdldChlLCB0LCBuLCAianNvbiIpIH0sIGdldFNjcmlwdDogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIFMuZ2V0KGUsIHZvaWQgMCwgdCwgInNjcmlwdCIpIH0gfSksIFMuZWFjaChbImdldCIsICJwb3N0Il0sIGZ1bmN0aW9uIChlLCBpKSB7IFNbaV0gPSBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyByZXR1cm4gbSh0KSAmJiAociA9IHIgfHwgbiwgbiA9IHQsIHQgPSB2b2lkIDApLCBTLmFqYXgoUy5leHRlbmQoeyB1cmw6IGUsIHR5cGU6IGksIGRhdGFUeXBlOiByLCBkYXRhOiB0LCBzdWNjZXNzOiBuIH0sIFMuaXNQbGFpbk9iamVjdChlKSAmJiBlKSkgfSB9KSwgUy5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uIChlKSB7IHZhciB0OyBmb3IgKHQgaW4gZS5oZWFkZXJzKSAiY29udGVudC10eXBlIiA9PT0gdC50b0xvd2VyQ2FzZSgpICYmIChlLmNvbnRlbnRUeXBlID0gZS5oZWFkZXJzW3RdIHx8ICIiKSB9KSwgUy5fZXZhbFVybCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHJldHVybiBTLmFqYXgoeyB1cmw6IGUsIHR5cGU6ICJHRVQiLCBkYXRhVHlwZTogInNjcmlwdCIsIGNhY2hlOiAhMCwgYXN5bmM6ICExLCBnbG9iYWw6ICExLCBjb252ZXJ0ZXJzOiB7ICJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uICgpIHsgfSB9LCBkYXRhRmlsdGVyOiBmdW5jdGlvbiAoZSkgeyBTLmdsb2JhbEV2YWwoZSwgdCwgbikgfSB9KSB9LCBTLmZuLmV4dGVuZCh7IHdyYXBBbGw6IGZ1bmN0aW9uIChlKSB7IHZhciB0OyByZXR1cm4gdGhpc1swXSAmJiAobShlKSAmJiAoZSA9IGUuY2FsbCh0aGlzWzBdKSksIHQgPSBTKGUsIHRoaXNbMF0ub3duZXJEb2N1bWVudCkuZXEoMCkuY2xvbmUoITApLCB0aGlzWzBdLnBhcmVudE5vZGUgJiYgdC5pbnNlcnRCZWZvcmUodGhpc1swXSksIHQubWFwKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzOyB3aGlsZSAoZS5maXJzdEVsZW1lbnRDaGlsZCkgZSA9IGUuZmlyc3RFbGVtZW50Q2hpbGQ7IHJldHVybiBlIH0pLmFwcGVuZCh0aGlzKSksIHRoaXMgfSwgd3JhcElubmVyOiBmdW5jdGlvbiAobikgeyByZXR1cm4gbShuKSA/IHRoaXMuZWFjaChmdW5jdGlvbiAoZSkgeyBTKHRoaXMpLndyYXBJbm5lcihuLmNhbGwodGhpcywgZSkpIH0pIDogdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBTKHRoaXMpLCB0ID0gZS5jb250ZW50cygpOyB0Lmxlbmd0aCA/IHQud3JhcEFsbChuKSA6IGUuYXBwZW5kKG4pIH0pIH0sIHdyYXA6IGZ1bmN0aW9uICh0KSB7IHZhciBuID0gbSh0KTsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoZSkgeyBTKHRoaXMpLndyYXBBbGwobiA/IHQuY2FsbCh0aGlzLCBlKSA6IHQpIH0pIH0sIHVud3JhcDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMucGFyZW50KGUpLm5vdCgiYm9keSIpLmVhY2goZnVuY3Rpb24gKCkgeyBTKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2RlcykgfSksIHRoaXMgfSB9KSwgUy5leHByLnBzZXVkb3MuaGlkZGVuID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuICFTLmV4cHIucHNldWRvcy52aXNpYmxlKGUpIH0sIFMuZXhwci5wc2V1ZG9zLnZpc2libGUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISEoZS5vZmZzZXRXaWR0aCB8fCBlLm9mZnNldEhlaWdodCB8fCBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoKSB9LCBTLmFqYXhTZXR0aW5ncy54aHIgPSBmdW5jdGlvbiAoKSB7IHRyeSB7IHJldHVybiBuZXcgQy5YTUxIdHRwUmVxdWVzdCB9IGNhdGNoIChlKSB7IH0gfTsgdmFyIF90ID0geyAwOiAyMDAsIDEyMjM6IDIwNCB9LCB6dCA9IFMuYWpheFNldHRpbmdzLnhocigpOyB5LmNvcnMgPSAhIXp0ICYmICJ3aXRoQ3JlZGVudGlhbHMiIGluIHp0LCB5LmFqYXggPSB6dCA9ICEhenQsIFMuYWpheFRyYW5zcG9ydChmdW5jdGlvbiAoaSkgeyB2YXIgbywgYTsgaWYgKHkuY29ycyB8fCB6dCAmJiAhaS5jcm9zc0RvbWFpbikgcmV0dXJuIHsgc2VuZDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIgPSBpLnhocigpOyBpZiAoci5vcGVuKGkudHlwZSwgaS51cmwsIGkuYXN5bmMsIGkudXNlcm5hbWUsIGkucGFzc3dvcmQpLCBpLnhockZpZWxkcykgZm9yIChuIGluIGkueGhyRmllbGRzKSByW25dID0gaS54aHJGaWVsZHNbbl07IGZvciAobiBpbiBpLm1pbWVUeXBlICYmIHIub3ZlcnJpZGVNaW1lVHlwZSAmJiByLm92ZXJyaWRlTWltZVR5cGUoaS5taW1lVHlwZSksIGkuY3Jvc3NEb21haW4gfHwgZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdIHx8IChlWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiKSwgZSkgci5zZXRSZXF1ZXN0SGVhZGVyKG4sIGVbbl0pOyBvID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgbyAmJiAobyA9IGEgPSByLm9ubG9hZCA9IHIub25lcnJvciA9IHIub25hYm9ydCA9IHIub250aW1lb3V0ID0gci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsLCAiYWJvcnQiID09PSBlID8gci5hYm9ydCgpIDogImVycm9yIiA9PT0gZSA/ICJudW1iZXIiICE9IHR5cGVvZiByLnN0YXR1cyA/IHQoMCwgImVycm9yIikgOiB0KHIuc3RhdHVzLCByLnN0YXR1c1RleHQpIDogdChfdFtyLnN0YXR1c10gfHwgci5zdGF0dXMsIHIuc3RhdHVzVGV4dCwgInRleHQiICE9PSAoci5yZXNwb25zZVR5cGUgfHwgInRleHQiKSB8fCAic3RyaW5nIiAhPSB0eXBlb2Ygci5yZXNwb25zZVRleHQgPyB7IGJpbmFyeTogci5yZXNwb25zZSB9IDogeyB0ZXh0OiByLnJlc3BvbnNlVGV4dCB9LCByLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSkgfSB9LCByLm9ubG9hZCA9IG8oKSwgYSA9IHIub25lcnJvciA9IHIub250aW1lb3V0ID0gbygiZXJyb3IiKSwgdm9pZCAwICE9PSByLm9uYWJvcnQgPyByLm9uYWJvcnQgPSBhIDogci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7IDQgPT09IHIucmVhZHlTdGF0ZSAmJiBDLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBvICYmIGEoKSB9KSB9LCBvID0gbygiYWJvcnQiKTsgdHJ5IHsgci5zZW5kKGkuaGFzQ29udGVudCAmJiBpLmRhdGEgfHwgbnVsbCkgfSBjYXRjaCAoZSkgeyBpZiAobykgdGhyb3cgZSB9IH0sIGFib3J0OiBmdW5jdGlvbiAoKSB7IG8gJiYgbygpIH0gfSB9KSwgUy5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uIChlKSB7IGUuY3Jvc3NEb21haW4gJiYgKGUuY29udGVudHMuc2NyaXB0ID0gITEpIH0pLCBTLmFqYXhTZXR1cCh7IGFjY2VwdHM6IHsgc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiIH0sIGNvbnRlbnRzOiB7IHNjcmlwdDogL1xiKD86amF2YXxlY21hKXNjcmlwdFxiLyB9LCBjb252ZXJ0ZXJzOiB7ICJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBTLmdsb2JhbEV2YWwoZSksIGUgfSB9IH0pLCBTLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsIGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZS5jYWNoZSAmJiAoZS5jYWNoZSA9ICExKSwgZS5jcm9zc0RvbWFpbiAmJiAoZS50eXBlID0gIkdFVCIpIH0pLCBTLmFqYXhUcmFuc3BvcnQoInNjcmlwdCIsIGZ1bmN0aW9uIChuKSB7IHZhciByLCBpOyBpZiAobi5jcm9zc0RvbWFpbiB8fCBuLnNjcmlwdEF0dHJzKSByZXR1cm4geyBzZW5kOiBmdW5jdGlvbiAoZSwgdCkgeyByID0gUygiPHNjcmlwdD4iKS5hdHRyKG4uc2NyaXB0QXR0cnMgfHwge30pLnByb3AoeyBjaGFyc2V0OiBuLnNjcmlwdENoYXJzZXQsIHNyYzogbi51cmwgfSkub24oImxvYWQgZXJyb3IiLCBpID0gZnVuY3Rpb24gKGUpIHsgci5yZW1vdmUoKSwgaSA9IG51bGwsIGUgJiYgdCgiZXJyb3IiID09PSBlLnR5cGUgPyA0MDQgOiAyMDAsIGUudHlwZSkgfSksIEUuaGVhZC5hcHBlbmRDaGlsZChyWzBdKSB9LCBhYm9ydDogZnVuY3Rpb24gKCkgeyBpICYmIGkoKSB9IH0gfSk7IHZhciBVdCwgWHQgPSBbXSwgVnQgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOyBTLmFqYXhTZXR1cCh7IGpzb25wOiAiY2FsbGJhY2siLCBqc29ucENhbGxiYWNrOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gWHQucG9wKCkgfHwgUy5leHBhbmRvICsgIl8iICsgQ3QuZ3VpZCsrOyByZXR1cm4gdGhpc1tlXSA9ICEwLCBlIH0gfSksIFMuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsIGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhID0gITEgIT09IGUuanNvbnAgJiYgKFZ0LnRlc3QoZS51cmwpID8gInVybCIgOiAic3RyaW5nIiA9PSB0eXBlb2YgZS5kYXRhICYmIDAgPT09IChlLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiBWdC50ZXN0KGUuZGF0YSkgJiYgImRhdGEiKTsgaWYgKGEgfHwgImpzb25wIiA9PT0gZS5kYXRhVHlwZXNbMF0pIHJldHVybiByID0gZS5qc29ucENhbGxiYWNrID0gbShlLmpzb25wQ2FsbGJhY2spID8gZS5qc29ucENhbGxiYWNrKCkgOiBlLmpzb25wQ2FsbGJhY2ssIGEgPyBlW2FdID0gZVthXS5yZXBsYWNlKFZ0LCAiJDEiICsgcikgOiAhMSAhPT0gZS5qc29ucCAmJiAoZS51cmwgKz0gKEV0LnRlc3QoZS51cmwpID8gIiYiIDogIj8iKSArIGUuanNvbnAgKyAiPSIgKyByKSwgZS5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbyB8fCBTLmVycm9yKHIgKyAiIHdhcyBub3QgY2FsbGVkIiksIG9bMF0gfSwgZS5kYXRhVHlwZXNbMF0gPSAianNvbiIsIGkgPSBDW3JdLCBDW3JdID0gZnVuY3Rpb24gKCkgeyBvID0gYXJndW1lbnRzIH0sIG4uYWx3YXlzKGZ1bmN0aW9uICgpIHsgdm9pZCAwID09PSBpID8gUyhDKS5yZW1vdmVQcm9wKHIpIDogQ1tyXSA9IGksIGVbcl0gJiYgKGUuanNvbnBDYWxsYmFjayA9IHQuanNvbnBDYWxsYmFjaywgWHQucHVzaChyKSksIG8gJiYgbShpKSAmJiBpKG9bMF0pLCBvID0gaSA9IHZvaWQgMCB9KSwgInNjcmlwdCIgfSksIHkuY3JlYXRlSFRNTERvY3VtZW50ID0gKChVdCA9IEUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUwgPSAiPGZvcm0+PC9mb3JtPjxmb3JtPjwvZm9ybT4iLCAyID09PSBVdC5jaGlsZE5vZGVzLmxlbmd0aCksIFMucGFyc2VIVE1MID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBlID8gW10gOiAoImJvb2xlYW4iID09IHR5cGVvZiB0ICYmIChuID0gdCwgdCA9ICExKSwgdCB8fCAoeS5jcmVhdGVIVE1MRG9jdW1lbnQgPyAoKHIgPSAodCA9IEUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKSkuY3JlYXRlRWxlbWVudCgiYmFzZSIpKS5ocmVmID0gRS5sb2NhdGlvbi5ocmVmLCB0LmhlYWQuYXBwZW5kQ2hpbGQocikpIDogdCA9IEUpLCBvID0gIW4gJiYgW10sIChpID0gTi5leGVjKGUpKSA/IFt0LmNyZWF0ZUVsZW1lbnQoaVsxXSldIDogKGkgPSB4ZShbZV0sIHQsIG8pLCBvICYmIG8ubGVuZ3RoICYmIFMobykucmVtb3ZlKCksIFMubWVyZ2UoW10sIGkuY2hpbGROb2RlcykpKTsgdmFyIHIsIGksIG8gfSwgUy5mbi5sb2FkID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHIsIGksIG8sIGEgPSB0aGlzLCBzID0gZS5pbmRleE9mKCIgIik7IHJldHVybiAtMSA8IHMgJiYgKHIgPSB2dChlLnNsaWNlKHMpKSwgZSA9IGUuc2xpY2UoMCwgcykpLCBtKHQpID8gKG4gPSB0LCB0ID0gdm9pZCAwKSA6IHQgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHQgJiYgKGkgPSAiUE9TVCIpLCAwIDwgYS5sZW5ndGggJiYgUy5hamF4KHsgdXJsOiBlLCB0eXBlOiBpIHx8ICJHRVQiLCBkYXRhVHlwZTogImh0bWwiLCBkYXRhOiB0IH0pLmRvbmUoZnVuY3Rpb24gKGUpIHsgbyA9IGFyZ3VtZW50cywgYS5odG1sKHIgPyBTKCI8ZGl2PiIpLmFwcGVuZChTLnBhcnNlSFRNTChlKSkuZmluZChyKSA6IGUpIH0pLmFsd2F5cyhuICYmIGZ1bmN0aW9uIChlLCB0KSB7IGEuZWFjaChmdW5jdGlvbiAoKSB7IG4uYXBwbHkodGhpcywgbyB8fCBbZS5yZXNwb25zZVRleHQsIHQsIGVdKSB9KSB9KSwgdGhpcyB9LCBTLmV4cHIucHNldWRvcy5hbmltYXRlZCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBTLmdyZXAoUy50aW1lcnMsIGZ1bmN0aW9uIChlKSB7IHJldHVybiB0ID09PSBlLmVsZW0gfSkubGVuZ3RoIH0sIFMub2Zmc2V0ID0geyBzZXRPZmZzZXQ6IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByLCBpLCBvLCBhLCBzLCB1LCBsID0gUy5jc3MoZSwgInBvc2l0aW9uIiksIGMgPSBTKGUpLCBmID0ge307ICJzdGF0aWMiID09PSBsICYmIChlLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIiksIHMgPSBjLm9mZnNldCgpLCBvID0gUy5jc3MoZSwgInRvcCIpLCB1ID0gUy5jc3MoZSwgImxlZnQiKSwgKCJhYnNvbHV0ZSIgPT09IGwgfHwgImZpeGVkIiA9PT0gbCkgJiYgLTEgPCAobyArIHUpLmluZGV4T2YoImF1dG8iKSA/IChhID0gKHIgPSBjLnBvc2l0aW9uKCkpLnRvcCwgaSA9IHIubGVmdCkgOiAoYSA9IHBhcnNlRmxvYXQobykgfHwgMCwgaSA9IHBhcnNlRmxvYXQodSkgfHwgMCksIG0odCkgJiYgKHQgPSB0LmNhbGwoZSwgbiwgUy5leHRlbmQoe30sIHMpKSksIG51bGwgIT0gdC50b3AgJiYgKGYudG9wID0gdC50b3AgLSBzLnRvcCArIGEpLCBudWxsICE9IHQubGVmdCAmJiAoZi5sZWZ0ID0gdC5sZWZ0IC0gcy5sZWZ0ICsgaSksICJ1c2luZyIgaW4gdCA/IHQudXNpbmcuY2FsbChlLCBmKSA6ICgibnVtYmVyIiA9PSB0eXBlb2YgZi50b3AgJiYgKGYudG9wICs9ICJweCIpLCAibnVtYmVyIiA9PSB0eXBlb2YgZi5sZWZ0ICYmIChmLmxlZnQgKz0gInB4IiksIGMuY3NzKGYpKSB9IH0sIFMuZm4uZXh0ZW5kKHsgb2Zmc2V0OiBmdW5jdGlvbiAodCkgeyBpZiAoYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZvaWQgMCA9PT0gdCA/IHRoaXMgOiB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsgUy5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsIHQsIGUpIH0pOyB2YXIgZSwgbiwgciA9IHRoaXNbMF07IHJldHVybiByID8gci5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCA/IChlID0gci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgbiA9IHIub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldywgeyB0b3A6IGUudG9wICsgbi5wYWdlWU9mZnNldCwgbGVmdDogZS5sZWZ0ICsgbi5wYWdlWE9mZnNldCB9KSA6IHsgdG9wOiAwLCBsZWZ0OiAwIH0gOiB2b2lkIDAgfSwgcG9zaXRpb246IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXNbMF0pIHsgdmFyIGUsIHQsIG4sIHIgPSB0aGlzWzBdLCBpID0geyB0b3A6IDAsIGxlZnQ6IDAgfTsgaWYgKCJmaXhlZCIgPT09IFMuY3NzKHIsICJwb3NpdGlvbiIpKSB0ID0gci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgZWxzZSB7IHQgPSB0aGlzLm9mZnNldCgpLCBuID0gci5vd25lckRvY3VtZW50LCBlID0gci5vZmZzZXRQYXJlbnQgfHwgbi5kb2N1bWVudEVsZW1lbnQ7IHdoaWxlIChlICYmIChlID09PSBuLmJvZHkgfHwgZSA9PT0gbi5kb2N1bWVudEVsZW1lbnQpICYmICJzdGF0aWMiID09PSBTLmNzcyhlLCAicG9zaXRpb24iKSkgZSA9IGUucGFyZW50Tm9kZTsgZSAmJiBlICE9PSByICYmIDEgPT09IGUubm9kZVR5cGUgJiYgKChpID0gUyhlKS5vZmZzZXQoKSkudG9wICs9IFMuY3NzKGUsICJib3JkZXJUb3BXaWR0aCIsICEwKSwgaS5sZWZ0ICs9IFMuY3NzKGUsICJib3JkZXJMZWZ0V2lkdGgiLCAhMCkpIH0gcmV0dXJuIHsgdG9wOiB0LnRvcCAtIGkudG9wIC0gUy5jc3MociwgIm1hcmdpblRvcCIsICEwKSwgbGVmdDogdC5sZWZ0IC0gaS5sZWZ0IC0gUy5jc3MociwgIm1hcmdpbkxlZnQiLCAhMCkgfSB9IH0sIG9mZnNldFBhcmVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMub2Zmc2V0UGFyZW50OyB3aGlsZSAoZSAmJiAic3RhdGljIiA9PT0gUy5jc3MoZSwgInBvc2l0aW9uIikpIGUgPSBlLm9mZnNldFBhcmVudDsgcmV0dXJuIGUgfHwgcmUgfSkgfSB9KSwgUy5lYWNoKHsgc2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0Iiwgc2Nyb2xsVG9wOiAicGFnZVlPZmZzZXQiIH0sIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBvID0gInBhZ2VZT2Zmc2V0IiA9PT0gaTsgUy5mblt0XSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAkKHRoaXMsIGZ1bmN0aW9uIChlLCB0LCBuKSB7IHZhciByOyBpZiAoeChlKSA/IHIgPSBlIDogOSA9PT0gZS5ub2RlVHlwZSAmJiAociA9IGUuZGVmYXVsdFZpZXcpLCB2b2lkIDAgPT09IG4pIHJldHVybiByID8gcltpXSA6IGVbdF07IHIgPyByLnNjcm9sbFRvKG8gPyByLnBhZ2VYT2Zmc2V0IDogbiwgbyA/IG4gOiByLnBhZ2VZT2Zmc2V0KSA6IGVbdF0gPSBuIH0sIHQsIGUsIGFyZ3VtZW50cy5sZW5ndGgpIH0gfSksIFMuZWFjaChbInRvcCIsICJsZWZ0Il0sIGZ1bmN0aW9uIChlLCBuKSB7IFMuY3NzSG9va3Nbbl0gPSAkZSh5LnBpeGVsUG9zaXRpb24sIGZ1bmN0aW9uIChlLCB0KSB7IGlmICh0KSByZXR1cm4gdCA9IEJlKGUsIG4pLCBNZS50ZXN0KHQpID8gUyhlKS5wb3NpdGlvbigpW25dICsgInB4IiA6IHQgfSkgfSksIFMuZWFjaCh7IEhlaWdodDogImhlaWdodCIsIFdpZHRoOiAid2lkdGgiIH0sIGZ1bmN0aW9uIChhLCBzKSB7IFMuZWFjaCh7IHBhZGRpbmc6ICJpbm5lciIgKyBhLCBjb250ZW50OiBzLCAiIjogIm91dGVyIiArIGEgfSwgZnVuY3Rpb24gKHIsIG8pIHsgUy5mbltvXSA9IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCAmJiAociB8fCAiYm9vbGVhbiIgIT0gdHlwZW9mIGUpLCBpID0gciB8fCAoITAgPT09IGUgfHwgITAgPT09IHQgPyAibWFyZ2luIiA6ICJib3JkZXIiKTsgcmV0dXJuICQodGhpcywgZnVuY3Rpb24gKGUsIHQsIG4pIHsgdmFyIHI7IHJldHVybiB4KGUpID8gMCA9PT0gby5pbmRleE9mKCJvdXRlciIpID8gZVsiaW5uZXIiICsgYV0gOiBlLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IiArIGFdIDogOSA9PT0gZS5ub2RlVHlwZSA/IChyID0gZS5kb2N1bWVudEVsZW1lbnQsIE1hdGgubWF4KGUuYm9keVsic2Nyb2xsIiArIGFdLCByWyJzY3JvbGwiICsgYV0sIGUuYm9keVsib2Zmc2V0IiArIGFdLCByWyJvZmZzZXQiICsgYV0sIHJbImNsaWVudCIgKyBhXSkpIDogdm9pZCAwID09PSBuID8gUy5jc3MoZSwgdCwgaSkgOiBTLnN0eWxlKGUsIHQsIG4sIGkpIH0sIHMsIG4gPyBlIDogdm9pZCAwLCBuKSB9IH0pIH0pLCBTLmVhY2goWyJhamF4U3RhcnQiLCAiYWpheFN0b3AiLCAiYWpheENvbXBsZXRlIiwgImFqYXhFcnJvciIsICJhamF4U3VjY2VzcyIsICJhamF4U2VuZCJdLCBmdW5jdGlvbiAoZSwgdCkgeyBTLmZuW3RdID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMub24odCwgZSkgfSB9KSwgUy5mbi5leHRlbmQoeyBiaW5kOiBmdW5jdGlvbiAoZSwgdCwgbikgeyByZXR1cm4gdGhpcy5vbihlLCBudWxsLCB0LCBuKSB9LCB1bmJpbmQ6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiB0aGlzLm9mZihlLCBudWxsLCB0KSB9LCBkZWxlZ2F0ZTogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHsgcmV0dXJuIHRoaXMub24odCwgZSwgbiwgcikgfSwgdW5kZWxlZ2F0ZTogZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLm9mZihlLCAiKioiKSA6IHRoaXMub2ZmKHQsIGUgfHwgIioqIiwgbikgfSwgaG92ZXI6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiB0aGlzLm1vdXNlZW50ZXIoZSkubW91c2VsZWF2ZSh0IHx8IGUpIH0gfSksIFMuZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IHJlc2l6ZSBzY3JvbGwgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKGUsIG4pIHsgUy5mbltuXSA9IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiAwIDwgYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMub24obiwgbnVsbCwgZSwgdCkgOiB0aGlzLnRyaWdnZXIobikgfSB9KTsgdmFyIEd0ID0gL15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nOyBTLnByb3h5ID0gZnVuY3Rpb24gKGUsIHQpIHsgdmFyIG4sIHIsIGk7IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiAobiA9IGVbdF0sIHQgPSBlLCBlID0gbiksIG0oZSkpIHJldHVybiByID0gcy5jYWxsKGFyZ3VtZW50cywgMiksIChpID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZS5hcHBseSh0IHx8IHRoaXMsIHIuY29uY2F0KHMuY2FsbChhcmd1bWVudHMpKSkgfSkuZ3VpZCA9IGUuZ3VpZCA9IGUuZ3VpZCB8fCBTLmd1aWQrKyAsIGkgfSwgUy5ob2xkUmVhZHkgPSBmdW5jdGlvbiAoZSkgeyBlID8gUy5yZWFkeVdhaXQrKyA6IFMucmVhZHkoITApIH0sIFMuaXNBcnJheSA9IEFycmF5LmlzQXJyYXksIFMucGFyc2VKU09OID0gSlNPTi5wYXJzZSwgUy5ub2RlTmFtZSA9IEEsIFMuaXNGdW5jdGlvbiA9IG0sIFMuaXNXaW5kb3cgPSB4LCBTLmNhbWVsQ2FzZSA9IFgsIFMudHlwZSA9IHcsIFMubm93ID0gRGF0ZS5ub3csIFMuaXNOdW1lcmljID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBTLnR5cGUoZSk7IHJldHVybiAoIm51bWJlciIgPT09IHQgfHwgInN0cmluZyIgPT09IHQpICYmICFpc05hTihlIC0gcGFyc2VGbG9hdChlKSkgfSwgUy50cmltID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG51bGwgPT0gZSA/ICIiIDogKGUgKyAiIikucmVwbGFjZShHdCwgIiIpIH0sICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kICYmIGRlZmluZSgianF1ZXJ5IiwgW10sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIFMgfSk7IHZhciBZdCA9IEMualF1ZXJ5LCBRdCA9IEMuJDsgcmV0dXJuIFMubm9Db25mbGljdCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBDLiQgPT09IFMgJiYgKEMuJCA9IFF0KSwgZSAmJiBDLmpRdWVyeSA9PT0gUyAmJiAoQy5qUXVlcnkgPSBZdCksIFMgfSwgInVuZGVmaW5lZCIgPT0gdHlwZW9mIGUgJiYgKEMualF1ZXJ5ID0gQy4kID0gUyksIFMgfSk7DQoNCiAgICB4YUpxdWVyeSA9IGpRdWVyeTsNCg0KICAgIHhhSnF1ZXJ5VUkgPSBmdW5jdGlvbiAoalF1ZXJ5KSB7DQoJCS8qISBqUXVlcnkgVUkgLSB2MS4xMi4xIC0gMjAxOC0wMi0xMQ0KCQkqIGh0dHA6Ly9qcXVlcnl1aS5jb20NCgkJKiBJbmNsdWRlczogd2lkZ2V0LmpzLCBwb3NpdGlvbi5qcywgZGF0YS5qcywgZGlzYWJsZS1zZWxlY3Rpb24uanMsIGZvY3VzYWJsZS5qcywgZm9ybS1yZXNldC1taXhpbi5qcywganF1ZXJ5LTEtNy5qcywga2V5Y29kZS5qcywgbGFiZWxzLmpzLCBzY3JvbGwtcGFyZW50LmpzLCB0YWJiYWJsZS5qcywgdW5pcXVlLWlkLmpzLCB3aWRnZXRzL2RyYWdnYWJsZS5qcywgd2lkZ2V0cy9kcm9wcGFibGUuanMsIHdpZGdldHMvcmVzaXphYmxlLmpzLCB3aWRnZXRzL3NlbGVjdGFibGUuanMsIHdpZGdldHMvc29ydGFibGUuanMsIHdpZGdldHMvYWNjb3JkaW9uLmpzLCB3aWRnZXRzL2F1dG9jb21wbGV0ZS5qcywgd2lkZ2V0cy9idXR0b24uanMsIHdpZGdldHMvY2hlY2tib3hyYWRpby5qcywgd2lkZ2V0cy9jb250cm9sZ3JvdXAuanMsIHdpZGdldHMvZGF0ZXBpY2tlci5qcywgd2lkZ2V0cy9kaWFsb2cuanMsIHdpZGdldHMvbWVudS5qcywgd2lkZ2V0cy9tb3VzZS5qcywgd2lkZ2V0cy9wcm9ncmVzc2Jhci5qcywgd2lkZ2V0cy9zZWxlY3RtZW51LmpzLCB3aWRnZXRzL3NsaWRlci5qcywgd2lkZ2V0cy9zcGlubmVyLmpzLCB3aWRnZXRzL3RhYnMuanMsIHdpZGdldHMvdG9vbHRpcC5qcywgZWZmZWN0LmpzLCBlZmZlY3RzL2VmZmVjdC1ibGluZC5qcywgZWZmZWN0cy9lZmZlY3QtYm91bmNlLmpzLCBlZmZlY3RzL2VmZmVjdC1jbGlwLmpzLCBlZmZlY3RzL2VmZmVjdC1kcm9wLmpzLCBlZmZlY3RzL2VmZmVjdC1leHBsb2RlLmpzLCBlZmZlY3RzL2VmZmVjdC1mYWRlLmpzLCBlZmZlY3RzL2VmZmVjdC1mb2xkLmpzLCBlZmZlY3RzL2VmZmVjdC1oaWdobGlnaHQuanMsIGVmZmVjdHMvZWZmZWN0LXB1ZmYuanMsIGVmZmVjdHMvZWZmZWN0LXB1bHNhdGUuanMsIGVmZmVjdHMvZWZmZWN0LXNjYWxlLmpzLCBlZmZlY3RzL2VmZmVjdC1zaGFrZS5qcywgZWZmZWN0cy9lZmZlY3Qtc2l6ZS5qcywgZWZmZWN0cy9lZmZlY3Qtc2xpZGUuanMsIGVmZmVjdHMvZWZmZWN0LXRyYW5zZmVyLmpzDQoJCSogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVCAqLw0KDQogICAgICAgIChmdW5jdGlvbiAoZSkgeyAiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbImpxdWVyeSJdLCBlKSA6IGUoalF1ZXJ5KSB9KShmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgZnVuY3Rpb24gdChlKSB7IGZvciAodmFyIHQgPSBlLmNzcygidmlzaWJpbGl0eSIpOyAiaW5oZXJpdCIgPT09IHQ7KWUgPSBlLnBhcmVudCgpLCB0ID0gZS5jc3MoInZpc2liaWxpdHkiKTsgcmV0dXJuICJoaWRkZW4iICE9PSB0IH0gZnVuY3Rpb24gaShlKSB7IGZvciAodmFyIHQsIGk7IGUubGVuZ3RoICYmIGVbMF0gIT09IGRvY3VtZW50OykgeyBpZiAodCA9IGUuY3NzKCJwb3NpdGlvbiIpLCAoImFic29sdXRlIiA9PT0gdCB8fCAicmVsYXRpdmUiID09PSB0IHx8ICJmaXhlZCIgPT09IHQpICYmIChpID0gcGFyc2VJbnQoZS5jc3MoInpJbmRleCIpLCAxMCksICFpc05hTihpKSAmJiAwICE9PSBpKSkgcmV0dXJuIGk7IGUgPSBlLnBhcmVudCgpIH0gcmV0dXJuIDAgfSBmdW5jdGlvbiBzKCkgeyB0aGlzLl9jdXJJbnN0ID0gbnVsbCwgdGhpcy5fa2V5RXZlbnQgPSAhMSwgdGhpcy5fZGlzYWJsZWRJbnB1dHMgPSBbXSwgdGhpcy5fZGF0ZXBpY2tlclNob3dpbmcgPSAhMSwgdGhpcy5faW5EaWFsb2cgPSAhMSwgdGhpcy5fbWFpbkRpdklkID0gInVpLWRhdGVwaWNrZXItZGl2IiwgdGhpcy5faW5saW5lQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1pbmxpbmUiLCB0aGlzLl9hcHBlbmRDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWFwcGVuZCIsIHRoaXMuX3RyaWdnZXJDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLXRyaWdnZXIiLCB0aGlzLl9kaWFsb2dDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRpYWxvZyIsIHRoaXMuX2Rpc2FibGVDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRpc2FibGVkIiwgdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MgPSAidWktZGF0ZXBpY2tlci11bnNlbGVjdGFibGUiLCB0aGlzLl9jdXJyZW50Q2xhc3MgPSAidWktZGF0ZXBpY2tlci1jdXJyZW50LWRheSIsIHRoaXMuX2RheU92ZXJDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRheXMtY2VsbC1vdmVyIiwgdGhpcy5yZWdpb25hbCA9IFtdLCB0aGlzLnJlZ2lvbmFsWyIiXSA9IHsgY2xvc2VUZXh0OiAiRG9uZSIsIHByZXZUZXh0OiAiUHJldiIsIG5leHRUZXh0OiAiTmV4dCIsIGN1cnJlbnRUZXh0OiAiVG9kYXkiLCBtb250aE5hbWVzOiBbIkphbnVhcnkiLCAiRmVicnVhcnkiLCAiTWFyY2giLCAiQXByaWwiLCAiTWF5IiwgIkp1bmUiLCAiSnVseSIsICJBdWd1c3QiLCAiU2VwdGVtYmVyIiwgIk9jdG9iZXIiLCAiTm92ZW1iZXIiLCAiRGVjZW1iZXIiXSwgbW9udGhOYW1lc1Nob3J0OiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sIGRheU5hbWVzOiBbIlN1bmRheSIsICJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5Il0sIGRheU5hbWVzU2hvcnQ6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sIGRheU5hbWVzTWluOiBbIlN1IiwgIk1vIiwgIlR1IiwgIldlIiwgIlRoIiwgIkZyIiwgIlNhIl0sIHdlZWtIZWFkZXI6ICJXayIsIGRhdGVGb3JtYXQ6ICJtbS9kZC95eSIsIGZpcnN0RGF5OiAwLCBpc1JUTDogITEsIHNob3dNb250aEFmdGVyWWVhcjogITEsIHllYXJTdWZmaXg6ICIiIH0sIHRoaXMuX2RlZmF1bHRzID0geyBzaG93T246ICJmb2N1cyIsIHNob3dBbmltOiAiZmFkZUluIiwgc2hvd09wdGlvbnM6IHt9LCBkZWZhdWx0RGF0ZTogbnVsbCwgYXBwZW5kVGV4dDogIiIsIGJ1dHRvblRleHQ6ICIuLi4iLCBidXR0b25JbWFnZTogIiIsIGJ1dHRvbkltYWdlT25seTogITEsIGhpZGVJZk5vUHJldk5leHQ6ICExLCBuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0OiAhMSwgZ290b0N1cnJlbnQ6ICExLCBjaGFuZ2VNb250aDogITEsIGNoYW5nZVllYXI6ICExLCB5ZWFyUmFuZ2U6ICJjLTEwOmMrMTAiLCBzaG93T3RoZXJNb250aHM6ICExLCBzZWxlY3RPdGhlck1vbnRoczogITEsIHNob3dXZWVrOiAhMSwgY2FsY3VsYXRlV2VlazogdGhpcy5pc284NjAxV2Vlaywgc2hvcnRZZWFyQ3V0b2ZmOiAiKzEwIiwgbWluRGF0ZTogbnVsbCwgbWF4RGF0ZTogbnVsbCwgZHVyYXRpb246ICJmYXN0IiwgYmVmb3JlU2hvd0RheTogbnVsbCwgYmVmb3JlU2hvdzogbnVsbCwgb25TZWxlY3Q6IG51bGwsIG9uQ2hhbmdlTW9udGhZZWFyOiBudWxsLCBvbkNsb3NlOiBudWxsLCBudW1iZXJPZk1vbnRoczogMSwgc2hvd0N1cnJlbnRBdFBvczogMCwgc3RlcE1vbnRoczogMSwgc3RlcEJpZ01vbnRoczogMTIsIGFsdEZpZWxkOiAiIiwgYWx0Rm9ybWF0OiAiIiwgY29uc3RyYWluSW5wdXQ6ICEwLCBzaG93QnV0dG9uUGFuZWw6ICExLCBhdXRvU2l6ZTogITEsIGRpc2FibGVkOiAhMSB9LCBlLmV4dGVuZCh0aGlzLl9kZWZhdWx0cywgdGhpcy5yZWdpb25hbFsiIl0pLCB0aGlzLnJlZ2lvbmFsLmVuID0gZS5leHRlbmQoITAsIHt9LCB0aGlzLnJlZ2lvbmFsWyIiXSksIHRoaXMucmVnaW9uYWxbImVuLVVTIl0gPSBlLmV4dGVuZCghMCwge30sIHRoaXMucmVnaW9uYWwuZW4pLCB0aGlzLmRwRGl2ID0gYShlKCI8ZGl2IGlkPSciICsgdGhpcy5fbWFpbkRpdklkICsgIicgY2xhc3M9J3VpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSkgfSBmdW5jdGlvbiBhKHQpIHsgdmFyIGkgPSAiYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhIjsgcmV0dXJuIHQub24oIm1vdXNlb3V0IiwgaSwgZnVuY3Rpb24gKCkgeyBlKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLCAtMSAhPT0gdGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1wcmV2IikgJiYgZSh0aGlzKS5yZW1vdmVDbGFzcygidWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIiksIC0xICE9PSB0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLW5leHQiKSAmJiBlKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1kYXRlcGlja2VyLW5leHQtaG92ZXIiKSB9KS5vbigibW91c2VvdmVyIiwgaSwgbikgfSBmdW5jdGlvbiBuKCkgeyBlLmRhdGVwaWNrZXIuX2lzRGlzYWJsZWREYXRlcGlja2VyKHAuaW5saW5lID8gcC5kcERpdi5wYXJlbnQoKVswXSA6IHAuaW5wdXRbMF0pIHx8IChlKHRoaXMpLnBhcmVudHMoIi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIikuZmluZCgiYSIpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLCBlKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLCAtMSAhPT0gdGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1wcmV2IikgJiYgZSh0aGlzKS5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIiksIC0xICE9PSB0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLW5leHQiKSAmJiBlKHRoaXMpLmFkZENsYXNzKCJ1aS1kYXRlcGlja2VyLW5leHQtaG92ZXIiKSkgfSBmdW5jdGlvbiByKHQsIGkpIHsgZS5leHRlbmQodCwgaSk7IGZvciAodmFyIHMgaW4gaSkgbnVsbCA9PSBpW3NdICYmICh0W3NdID0gaVtzXSk7IHJldHVybiB0IH0gZnVuY3Rpb24gbyhlKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5lbGVtZW50LnZhbCgpOyBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX3JlZnJlc2goKSwgdCAhPT0gdGhpcy5lbGVtZW50LnZhbCgpICYmIHRoaXMuX3RyaWdnZXIoImNoYW5nZSIpIH0gfSBlLnVpID0gZS51aSB8fCB7fSwgZS51aS52ZXJzaW9uID0gIjEuMTIuMSI7IHZhciBsID0gMCwgaCA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsgZS5jbGVhbkRhdGEgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGkpIHsgdmFyIHMsIGEsIG47IGZvciAobiA9IDA7IG51bGwgIT0gKGEgPSBpW25dKTsgbisrKXRyeSB7IHMgPSBlLl9kYXRhKGEsICJldmVudHMiKSwgcyAmJiBzLnJlbW92ZSAmJiBlKGEpLnRyaWdnZXJIYW5kbGVyKCJyZW1vdmUiKSB9IGNhdGNoIChyKSB7IH0gdChpKSB9IH0oZS5jbGVhbkRhdGEpLCBlLndpZGdldCA9IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuLCByLCBvID0ge30sIGwgPSB0LnNwbGl0KCIuIilbMF07IHQgPSB0LnNwbGl0KCIuIilbMV07IHZhciBoID0gbCArICItIiArIHQ7IHJldHVybiBzIHx8IChzID0gaSwgaSA9IGUuV2lkZ2V0KSwgZS5pc0FycmF5KHMpICYmIChzID0gZS5leHRlbmQuYXBwbHkobnVsbCwgW3t9XS5jb25jYXQocykpKSwgZS5leHByWyI6Il1baC50b0xvd2VyQ2FzZSgpXSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiAhIWUuZGF0YSh0LCBoKSB9LCBlW2xdID0gZVtsXSB8fCB7fSwgYSA9IGVbbF1bdF0sIG4gPSBlW2xdW3RdID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHRoaXMuX2NyZWF0ZVdpZGdldCA/IChhcmd1bWVudHMubGVuZ3RoICYmIHRoaXMuX2NyZWF0ZVdpZGdldChlLCB0KSwgdm9pZCAwKSA6IG5ldyBuKGUsIHQpIH0sIGUuZXh0ZW5kKG4sIGEsIHsgdmVyc2lvbjogcy52ZXJzaW9uLCBfcHJvdG86IGUuZXh0ZW5kKHt9LCBzKSwgX2NoaWxkQ29uc3RydWN0b3JzOiBbXSB9KSwgciA9IG5ldyBpLCByLm9wdGlvbnMgPSBlLndpZGdldC5leHRlbmQoe30sIHIub3B0aW9ucyksIGUuZWFjaChzLCBmdW5jdGlvbiAodCwgcykgeyByZXR1cm4gZS5pc0Z1bmN0aW9uKHMpID8gKG9bdF0gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoKSB7IHJldHVybiBpLnByb3RvdHlwZVt0XS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gZnVuY3Rpb24gYShlKSB7IHJldHVybiBpLnByb3RvdHlwZVt0XS5hcHBseSh0aGlzLCBlKSB9IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpID0gdGhpcy5fc3VwZXIsIG4gPSB0aGlzLl9zdXBlckFwcGx5OyByZXR1cm4gdGhpcy5fc3VwZXIgPSBlLCB0aGlzLl9zdXBlckFwcGx5ID0gYSwgdCA9IHMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGhpcy5fc3VwZXIgPSBpLCB0aGlzLl9zdXBlckFwcGx5ID0gbiwgdCB9IH0oKSwgdm9pZCAwKSA6IChvW3RdID0gcywgdm9pZCAwKSB9KSwgbi5wcm90b3R5cGUgPSBlLndpZGdldC5leHRlbmQociwgeyB3aWRnZXRFdmVudFByZWZpeDogYSA/IHIud2lkZ2V0RXZlbnRQcmVmaXggfHwgdCA6IHQgfSwgbywgeyBjb25zdHJ1Y3RvcjogbiwgbmFtZXNwYWNlOiBsLCB3aWRnZXROYW1lOiB0LCB3aWRnZXRGdWxsTmFtZTogaCB9KSwgYSA/IChlLmVhY2goYS5fY2hpbGRDb25zdHJ1Y3RvcnMsIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gaS5wcm90b3R5cGU7IGUud2lkZ2V0KHMubmFtZXNwYWNlICsgIi4iICsgcy53aWRnZXROYW1lLCBuLCBpLl9wcm90bykgfSksIGRlbGV0ZSBhLl9jaGlsZENvbnN0cnVjdG9ycykgOiBpLl9jaGlsZENvbnN0cnVjdG9ycy5wdXNoKG4pLCBlLndpZGdldC5icmlkZ2UodCwgbiksIG4gfSwgZS53aWRnZXQuZXh0ZW5kID0gZnVuY3Rpb24gKHQpIHsgZm9yICh2YXIgaSwgcywgYSA9IGguY2FsbChhcmd1bWVudHMsIDEpLCBuID0gMCwgciA9IGEubGVuZ3RoOyByID4gbjsgbisrKWZvciAoaSBpbiBhW25dKSBzID0gYVtuXVtpXSwgYVtuXS5oYXNPd25Qcm9wZXJ0eShpKSAmJiB2b2lkIDAgIT09IHMgJiYgKHRbaV0gPSBlLmlzUGxhaW5PYmplY3QocykgPyBlLmlzUGxhaW5PYmplY3QodFtpXSkgPyBlLndpZGdldC5leHRlbmQoe30sIHRbaV0sIHMpIDogZS53aWRnZXQuZXh0ZW5kKHt9LCBzKSA6IHMpOyByZXR1cm4gdCB9LCBlLndpZGdldC5icmlkZ2UgPSBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IGkucHJvdG90eXBlLndpZGdldEZ1bGxOYW1lIHx8IHQ7IGUuZm5bdF0gPSBmdW5jdGlvbiAoYSkgeyB2YXIgbiA9ICJzdHJpbmciID09IHR5cGVvZiBhLCByID0gaC5jYWxsKGFyZ3VtZW50cywgMSksIG8gPSB0aGlzOyByZXR1cm4gbiA/IHRoaXMubGVuZ3RoIHx8ICJpbnN0YW5jZSIgIT09IGEgPyB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgaSwgbiA9IGUuZGF0YSh0aGlzLCBzKTsgcmV0dXJuICJpbnN0YW5jZSIgPT09IGEgPyAobyA9IG4sICExKSA6IG4gPyBlLmlzRnVuY3Rpb24oblthXSkgJiYgIl8iICE9PSBhLmNoYXJBdCgwKSA/IChpID0gblthXS5hcHBseShuLCByKSwgaSAhPT0gbiAmJiB2b2lkIDAgIT09IGkgPyAobyA9IGkgJiYgaS5qcXVlcnkgPyBvLnB1c2hTdGFjayhpLmdldCgpKSA6IGksICExKSA6IHZvaWQgMCkgOiBlLmVycm9yKCJubyBzdWNoIG1ldGhvZCAnIiArIGEgKyAiJyBmb3IgIiArIHQgKyAiIHdpZGdldCBpbnN0YW5jZSIpIDogZS5lcnJvcigiY2Fubm90IGNhbGwgbWV0aG9kcyBvbiAiICsgdCArICIgcHJpb3IgdG8gaW5pdGlhbGl6YXRpb247ICIgKyAiYXR0ZW1wdGVkIHRvIGNhbGwgbWV0aG9kICciICsgYSArICInIikgfSkgOiBvID0gdm9pZCAwIDogKHIubGVuZ3RoICYmIChhID0gZS53aWRnZXQuZXh0ZW5kLmFwcGx5KG51bGwsIFthXS5jb25jYXQocikpKSwgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlLmRhdGEodGhpcywgcyk7IHQgPyAodC5vcHRpb24oYSB8fCB7fSksIHQuX2luaXQgJiYgdC5faW5pdCgpKSA6IGUuZGF0YSh0aGlzLCBzLCBuZXcgaShhLCB0aGlzKSkgfSkpLCBvIH0gfSwgZS5XaWRnZXQgPSBmdW5jdGlvbiAoKSB7IH0sIGUuV2lkZ2V0Ll9jaGlsZENvbnN0cnVjdG9ycyA9IFtdLCBlLldpZGdldC5wcm90b3R5cGUgPSB7IHdpZGdldE5hbWU6ICJ3aWRnZXQiLCB3aWRnZXRFdmVudFByZWZpeDogIiIsIGRlZmF1bHRFbGVtZW50OiAiPGRpdj4iLCBvcHRpb25zOiB7IGNsYXNzZXM6IHt9LCBkaXNhYmxlZDogITEsIGNyZWF0ZTogbnVsbCB9LCBfY3JlYXRlV2lkZ2V0OiBmdW5jdGlvbiAodCwgaSkgeyBpID0gZShpIHx8IHRoaXMuZGVmYXVsdEVsZW1lbnQgfHwgdGhpcylbMF0sIHRoaXMuZWxlbWVudCA9IGUoaSksIHRoaXMudXVpZCA9IGwrKyAsIHRoaXMuZXZlbnROYW1lc3BhY2UgPSAiLiIgKyB0aGlzLndpZGdldE5hbWUgKyB0aGlzLnV1aWQsIHRoaXMuYmluZGluZ3MgPSBlKCksIHRoaXMuaG92ZXJhYmxlID0gZSgpLCB0aGlzLmZvY3VzYWJsZSA9IGUoKSwgdGhpcy5jbGFzc2VzRWxlbWVudExvb2t1cCA9IHt9LCBpICE9PSB0aGlzICYmIChlLmRhdGEoaSwgdGhpcy53aWRnZXRGdWxsTmFtZSwgdGhpcyksIHRoaXMuX29uKCEwLCB0aGlzLmVsZW1lbnQsIHsgcmVtb3ZlOiBmdW5jdGlvbiAoZSkgeyBlLnRhcmdldCA9PT0gaSAmJiB0aGlzLmRlc3Ryb3koKSB9IH0pLCB0aGlzLmRvY3VtZW50ID0gZShpLnN0eWxlID8gaS5vd25lckRvY3VtZW50IDogaS5kb2N1bWVudCB8fCBpKSwgdGhpcy53aW5kb3cgPSBlKHRoaXMuZG9jdW1lbnRbMF0uZGVmYXVsdFZpZXcgfHwgdGhpcy5kb2N1bWVudFswXS5wYXJlbnRXaW5kb3cpKSwgdGhpcy5vcHRpb25zID0gZS53aWRnZXQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSwgdCksIHRoaXMuX2NyZWF0ZSgpLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy5fc2V0T3B0aW9uRGlzYWJsZWQodGhpcy5vcHRpb25zLmRpc2FibGVkKSwgdGhpcy5fdHJpZ2dlcigiY3JlYXRlIiwgbnVsbCwgdGhpcy5fZ2V0Q3JlYXRlRXZlbnREYXRhKCkpLCB0aGlzLl9pbml0KCkgfSwgX2dldENyZWF0ZU9wdGlvbnM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHt9IH0sIF9nZXRDcmVhdGVFdmVudERhdGE6IGUubm9vcCwgX2NyZWF0ZTogZS5ub29wLCBfaW5pdDogZS5ub29wLCBkZXN0cm95OiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpczsgdGhpcy5fZGVzdHJveSgpLCBlLmVhY2godGhpcy5jbGFzc2VzRWxlbWVudExvb2t1cCwgZnVuY3Rpb24gKGUsIGkpIHsgdC5fcmVtb3ZlQ2xhc3MoaSwgZSkgfSksIHRoaXMuZWxlbWVudC5vZmYodGhpcy5ldmVudE5hbWVzcGFjZSkucmVtb3ZlRGF0YSh0aGlzLndpZGdldEZ1bGxOYW1lKSwgdGhpcy53aWRnZXQoKS5vZmYodGhpcy5ldmVudE5hbWVzcGFjZSkucmVtb3ZlQXR0cigiYXJpYS1kaXNhYmxlZCIpLCB0aGlzLmJpbmRpbmdzLm9mZih0aGlzLmV2ZW50TmFtZXNwYWNlKSB9LCBfZGVzdHJveTogZS5ub29wLCB3aWRnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZWxlbWVudCB9LCBvcHRpb246IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzLCBhLCBuLCByID0gdDsgaWYgKDAgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBlLndpZGdldC5leHRlbmQoe30sIHRoaXMub3B0aW9ucyk7IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCkgaWYgKHIgPSB7fSwgcyA9IHQuc3BsaXQoIi4iKSwgdCA9IHMuc2hpZnQoKSwgcy5sZW5ndGgpIHsgZm9yIChhID0gclt0XSA9IGUud2lkZ2V0LmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zW3RdKSwgbiA9IDA7IHMubGVuZ3RoIC0gMSA+IG47IG4rKylhW3Nbbl1dID0gYVtzW25dXSB8fCB7fSwgYSA9IGFbc1tuXV07IGlmICh0ID0gcy5wb3AoKSwgMSA9PT0gYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZvaWQgMCA9PT0gYVt0XSA/IG51bGwgOiBhW3RdOyBhW3RdID0gaSB9IGVsc2UgeyBpZiAoMSA9PT0gYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZvaWQgMCA9PT0gdGhpcy5vcHRpb25zW3RdID8gbnVsbCA6IHRoaXMub3B0aW9uc1t0XTsgclt0XSA9IGkgfSByZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyhyKSwgdGhpcyB9LCBfc2V0T3B0aW9uczogZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IGZvciAodCBpbiBlKSB0aGlzLl9zZXRPcHRpb24odCwgZVt0XSk7IHJldHVybiB0aGlzIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiAiY2xhc3NlcyIgPT09IGUgJiYgdGhpcy5fc2V0T3B0aW9uQ2xhc3Nlcyh0KSwgdGhpcy5vcHRpb25zW2VdID0gdCwgImRpc2FibGVkIiA9PT0gZSAmJiB0aGlzLl9zZXRPcHRpb25EaXNhYmxlZCh0KSwgdGhpcyB9LCBfc2V0T3B0aW9uQ2xhc3NlczogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGE7IGZvciAoaSBpbiB0KSBhID0gdGhpcy5jbGFzc2VzRWxlbWVudExvb2t1cFtpXSwgdFtpXSAhPT0gdGhpcy5vcHRpb25zLmNsYXNzZXNbaV0gJiYgYSAmJiBhLmxlbmd0aCAmJiAocyA9IGUoYS5nZXQoKSksIHRoaXMuX3JlbW92ZUNsYXNzKGEsIGkpLCBzLmFkZENsYXNzKHRoaXMuX2NsYXNzZXMoeyBlbGVtZW50OiBzLCBrZXlzOiBpLCBjbGFzc2VzOiB0LCBhZGQ6ICEwIH0pKSkgfSwgX3NldE9wdGlvbkRpc2FibGVkOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl90b2dnbGVDbGFzcyh0aGlzLndpZGdldCgpLCB0aGlzLndpZGdldEZ1bGxOYW1lICsgIi1kaXNhYmxlZCIsIG51bGwsICEhZSksIGUgJiYgKHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuaG92ZXJhYmxlLCBudWxsLCAidWktc3RhdGUtaG92ZXIiKSwgdGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5mb2N1c2FibGUsIG51bGwsICJ1aS1zdGF0ZS1mb2N1cyIpKSB9LCBlbmFibGU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX3NldE9wdGlvbnMoeyBkaXNhYmxlZDogITEgfSkgfSwgZGlzYWJsZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyh7IGRpc2FibGVkOiAhMCB9KSB9LCBfY2xhc3NlczogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gaShpLCBuKSB7IHZhciByLCBvOyBmb3IgKG8gPSAwOyBpLmxlbmd0aCA+IG87IG8rKylyID0gYS5jbGFzc2VzRWxlbWVudExvb2t1cFtpW29dXSB8fCBlKCksIHIgPSB0LmFkZCA/IGUoZS51bmlxdWUoci5nZXQoKS5jb25jYXQodC5lbGVtZW50LmdldCgpKSkpIDogZShyLm5vdCh0LmVsZW1lbnQpLmdldCgpKSwgYS5jbGFzc2VzRWxlbWVudExvb2t1cFtpW29dXSA9IHIsIHMucHVzaChpW29dKSwgbiAmJiB0LmNsYXNzZXNbaVtvXV0gJiYgcy5wdXNoKHQuY2xhc3Nlc1tpW29dXSkgfSB2YXIgcyA9IFtdLCBhID0gdGhpczsgcmV0dXJuIHQgPSBlLmV4dGVuZCh7IGVsZW1lbnQ6IHRoaXMuZWxlbWVudCwgY2xhc3NlczogdGhpcy5vcHRpb25zLmNsYXNzZXMgfHwge30gfSwgdCksIHRoaXMuX29uKHQuZWxlbWVudCwgeyByZW1vdmU6ICJfdW50cmFja0NsYXNzZXNFbGVtZW50IiB9KSwgdC5rZXlzICYmIGkodC5rZXlzLm1hdGNoKC9cUysvZykgfHwgW10sICEwKSwgdC5leHRyYSAmJiBpKHQuZXh0cmEubWF0Y2goL1xTKy9nKSB8fCBbXSksIHMuam9pbigiICIpIH0sIF91bnRyYWNrQ2xhc3Nlc0VsZW1lbnQ6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpczsgZS5lYWNoKGkuY2xhc3Nlc0VsZW1lbnRMb29rdXAsIGZ1bmN0aW9uIChzLCBhKSB7IC0xICE9PSBlLmluQXJyYXkodC50YXJnZXQsIGEpICYmIChpLmNsYXNzZXNFbGVtZW50TG9va3VwW3NdID0gZShhLm5vdCh0LnRhcmdldCkuZ2V0KCkpKSB9KSB9LCBfcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uIChlLCB0LCBpKSB7IHJldHVybiB0aGlzLl90b2dnbGVDbGFzcyhlLCB0LCBpLCAhMSkgfSwgX2FkZENsYXNzOiBmdW5jdGlvbiAoZSwgdCwgaSkgeyByZXR1cm4gdGhpcy5fdG9nZ2xlQ2xhc3MoZSwgdCwgaSwgITApIH0sIF90b2dnbGVDbGFzczogZnVuY3Rpb24gKGUsIHQsIGksIHMpIHsgcyA9ICJib29sZWFuIiA9PSB0eXBlb2YgcyA/IHMgOiBpOyB2YXIgYSA9ICJzdHJpbmciID09IHR5cGVvZiBlIHx8IG51bGwgPT09IGUsIG4gPSB7IGV4dHJhOiBhID8gdCA6IGksIGtleXM6IGEgPyBlIDogdCwgZWxlbWVudDogYSA/IHRoaXMuZWxlbWVudCA6IGUsIGFkZDogcyB9OyByZXR1cm4gbi5lbGVtZW50LnRvZ2dsZUNsYXNzKHRoaXMuX2NsYXNzZXMobiksIHMpLCB0aGlzIH0sIF9vbjogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEsIG4gPSB0aGlzOyAiYm9vbGVhbiIgIT0gdHlwZW9mIHQgJiYgKHMgPSBpLCBpID0gdCwgdCA9ICExKSwgcyA/IChpID0gYSA9IGUoaSksIHRoaXMuYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzLmFkZChpKSkgOiAocyA9IGksIGkgPSB0aGlzLmVsZW1lbnQsIGEgPSB0aGlzLndpZGdldCgpKSwgZS5lYWNoKHMsIGZ1bmN0aW9uIChzLCByKSB7IGZ1bmN0aW9uIG8oKSB7IHJldHVybiB0IHx8IG4ub3B0aW9ucy5kaXNhYmxlZCAhPT0gITAgJiYgIWUodGhpcykuaGFzQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIikgPyAoInN0cmluZyIgPT0gdHlwZW9mIHIgPyBuW3JdIDogcikuYXBwbHkobiwgYXJndW1lbnRzKSA6IHZvaWQgMCB9ICJzdHJpbmciICE9IHR5cGVvZiByICYmIChvLmd1aWQgPSByLmd1aWQgPSByLmd1aWQgfHwgby5ndWlkIHx8IGUuZ3VpZCsrKTsgdmFyIGwgPSBzLm1hdGNoKC9eKFtcdzotXSopXHMqKC4qKSQvKSwgaCA9IGxbMV0gKyBuLmV2ZW50TmFtZXNwYWNlLCB1ID0gbFsyXTsgdSA/IGEub24oaCwgdSwgbykgOiBpLm9uKGgsIG8pIH0pIH0sIF9vZmY6IGZ1bmN0aW9uICh0LCBpKSB7IGkgPSAoaSB8fCAiIikuc3BsaXQoIiAiKS5qb2luKHRoaXMuZXZlbnROYW1lc3BhY2UgKyAiICIpICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgdC5vZmYoaSkub2ZmKGkpLCB0aGlzLmJpbmRpbmdzID0gZSh0aGlzLmJpbmRpbmdzLm5vdCh0KS5nZXQoKSksIHRoaXMuZm9jdXNhYmxlID0gZSh0aGlzLmZvY3VzYWJsZS5ub3QodCkuZ2V0KCkpLCB0aGlzLmhvdmVyYWJsZSA9IGUodGhpcy5ob3ZlcmFibGUubm90KHQpLmdldCgpKSB9LCBfZGVsYXk6IGZ1bmN0aW9uIChlLCB0KSB7IGZ1bmN0aW9uIGkoKSB7IHJldHVybiAoInN0cmluZyIgPT0gdHlwZW9mIGUgPyBzW2VdIDogZSkuYXBwbHkocywgYXJndW1lbnRzKSB9IHZhciBzID0gdGhpczsgcmV0dXJuIHNldFRpbWVvdXQoaSwgdCB8fCAwKSB9LCBfaG92ZXJhYmxlOiBmdW5jdGlvbiAodCkgeyB0aGlzLmhvdmVyYWJsZSA9IHRoaXMuaG92ZXJhYmxlLmFkZCh0KSwgdGhpcy5fb24odCwgeyBtb3VzZWVudGVyOiBmdW5jdGlvbiAodCkgeyB0aGlzLl9hZGRDbGFzcyhlKHQuY3VycmVudFRhcmdldCksIG51bGwsICJ1aS1zdGF0ZS1ob3ZlciIpIH0sIG1vdXNlbGVhdmU6IGZ1bmN0aW9uICh0KSB7IHRoaXMuX3JlbW92ZUNsYXNzKGUodC5jdXJyZW50VGFyZ2V0KSwgbnVsbCwgInVpLXN0YXRlLWhvdmVyIikgfSB9KSB9LCBfZm9jdXNhYmxlOiBmdW5jdGlvbiAodCkgeyB0aGlzLmZvY3VzYWJsZSA9IHRoaXMuZm9jdXNhYmxlLmFkZCh0KSwgdGhpcy5fb24odCwgeyBmb2N1c2luOiBmdW5jdGlvbiAodCkgeyB0aGlzLl9hZGRDbGFzcyhlKHQuY3VycmVudFRhcmdldCksIG51bGwsICJ1aS1zdGF0ZS1mb2N1cyIpIH0sIGZvY3Vzb3V0OiBmdW5jdGlvbiAodCkgeyB0aGlzLl9yZW1vdmVDbGFzcyhlKHQuY3VycmVudFRhcmdldCksIG51bGwsICJ1aS1zdGF0ZS1mb2N1cyIpIH0gfSkgfSwgX3RyaWdnZXI6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuLCByID0gdGhpcy5vcHRpb25zW3RdOyBpZiAocyA9IHMgfHwge30sIGkgPSBlLkV2ZW50KGkpLCBpLnR5cGUgPSAodCA9PT0gdGhpcy53aWRnZXRFdmVudFByZWZpeCA/IHQgOiB0aGlzLndpZGdldEV2ZW50UHJlZml4ICsgdCkudG9Mb3dlckNhc2UoKSwgaS50YXJnZXQgPSB0aGlzLmVsZW1lbnRbMF0sIG4gPSBpLm9yaWdpbmFsRXZlbnQpIGZvciAoYSBpbiBuKSBhIGluIGkgfHwgKGlbYV0gPSBuW2FdKTsgcmV0dXJuIHRoaXMuZWxlbWVudC50cmlnZ2VyKGksIHMpLCAhKGUuaXNGdW5jdGlvbihyKSAmJiByLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2ldLmNvbmNhdChzKSkgPT09ICExIHx8IGkuaXNEZWZhdWx0UHJldmVudGVkKCkpIH0gfSwgZS5lYWNoKHsgc2hvdzogImZhZGVJbiIsIGhpZGU6ICJmYWRlT3V0IiB9LCBmdW5jdGlvbiAodCwgaSkgeyBlLldpZGdldC5wcm90b3R5cGVbIl8iICsgdF0gPSBmdW5jdGlvbiAocywgYSwgbikgeyAic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiAoYSA9IHsgZWZmZWN0OiBhIH0pOyB2YXIgciwgbyA9IGEgPyBhID09PSAhMCB8fCAibnVtYmVyIiA9PSB0eXBlb2YgYSA/IGkgOiBhLmVmZmVjdCB8fCBpIDogdDsgYSA9IGEgfHwge30sICJudW1iZXIiID09IHR5cGVvZiBhICYmIChhID0geyBkdXJhdGlvbjogYSB9KSwgciA9ICFlLmlzRW1wdHlPYmplY3QoYSksIGEuY29tcGxldGUgPSBuLCBhLmRlbGF5ICYmIHMuZGVsYXkoYS5kZWxheSksIHIgJiYgZS5lZmZlY3RzICYmIGUuZWZmZWN0cy5lZmZlY3Rbb10gPyBzW3RdKGEpIDogbyAhPT0gdCAmJiBzW29dID8gc1tvXShhLmR1cmF0aW9uLCBhLmVhc2luZywgbikgOiBzLnF1ZXVlKGZ1bmN0aW9uIChpKSB7IGUodGhpcylbdF0oKSwgbiAmJiBuLmNhbGwoc1swXSksIGkoKSB9KSB9IH0pLCBlLndpZGdldCwgZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KGUsIHQsIGkpIHsgcmV0dXJuIFtwYXJzZUZsb2F0KGVbMF0pICogKGQudGVzdChlWzBdKSA/IHQgLyAxMDAgOiAxKSwgcGFyc2VGbG9hdChlWzFdKSAqIChkLnRlc3QoZVsxXSkgPyBpIC8gMTAwIDogMSldIH0gZnVuY3Rpb24gaSh0LCBpKSB7IHJldHVybiBwYXJzZUludChlLmNzcyh0LCBpKSwgMTApIHx8IDAgfSBmdW5jdGlvbiBzKHQpIHsgdmFyIGkgPSB0WzBdOyByZXR1cm4gOSA9PT0gaS5ub2RlVHlwZSA/IHsgd2lkdGg6IHQud2lkdGgoKSwgaGVpZ2h0OiB0LmhlaWdodCgpLCBvZmZzZXQ6IHsgdG9wOiAwLCBsZWZ0OiAwIH0gfSA6IGUuaXNXaW5kb3coaSkgPyB7IHdpZHRoOiB0LndpZHRoKCksIGhlaWdodDogdC5oZWlnaHQoKSwgb2Zmc2V0OiB7IHRvcDogdC5zY3JvbGxUb3AoKSwgbGVmdDogdC5zY3JvbGxMZWZ0KCkgfSB9IDogaS5wcmV2ZW50RGVmYXVsdCA/IHsgd2lkdGg6IDAsIGhlaWdodDogMCwgb2Zmc2V0OiB7IHRvcDogaS5wYWdlWSwgbGVmdDogaS5wYWdlWCB9IH0gOiB7IHdpZHRoOiB0Lm91dGVyV2lkdGgoKSwgaGVpZ2h0OiB0Lm91dGVySGVpZ2h0KCksIG9mZnNldDogdC5vZmZzZXQoKSB9IH0gdmFyIGEsIG4gPSBNYXRoLm1heCwgciA9IE1hdGguYWJzLCBvID0gL2xlZnR8Y2VudGVyfHJpZ2h0LywgbCA9IC90b3B8Y2VudGVyfGJvdHRvbS8sIGggPSAvW1wrXC1dXGQrKFwuW1xkXSspPyU/LywgdSA9IC9eXHcrLywgZCA9IC8lJC8sIGMgPSBlLmZuLnBvc2l0aW9uOyBlLnBvc2l0aW9uID0geyBzY3JvbGxiYXJXaWR0aDogZnVuY3Rpb24gKCkgeyBpZiAodm9pZCAwICE9PSBhKSByZXR1cm4gYTsgdmFyIHQsIGksIHMgPSBlKCI8ZGl2IHN0eWxlPSdkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjUwcHg7aGVpZ2h0OjUwcHg7b3ZlcmZsb3c6aGlkZGVuOyc+PGRpdiBzdHlsZT0naGVpZ2h0OjEwMHB4O3dpZHRoOmF1dG87Jz48L2Rpdj48L2Rpdj4iKSwgbiA9IHMuY2hpbGRyZW4oKVswXTsgcmV0dXJuIGUoImJvZHkiKS5hcHBlbmQocyksIHQgPSBuLm9mZnNldFdpZHRoLCBzLmNzcygib3ZlcmZsb3ciLCAic2Nyb2xsIiksIGkgPSBuLm9mZnNldFdpZHRoLCB0ID09PSBpICYmIChpID0gc1swXS5jbGllbnRXaWR0aCksIHMucmVtb3ZlKCksIGEgPSB0IC0gaSB9LCBnZXRTY3JvbGxJbmZvOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHQuaXNXaW5kb3cgfHwgdC5pc0RvY3VtZW50ID8gIiIgOiB0LmVsZW1lbnQuY3NzKCJvdmVyZmxvdy14IiksIHMgPSB0LmlzV2luZG93IHx8IHQuaXNEb2N1bWVudCA/ICIiIDogdC5lbGVtZW50LmNzcygib3ZlcmZsb3cteSIpLCBhID0gInNjcm9sbCIgPT09IGkgfHwgImF1dG8iID09PSBpICYmIHQud2lkdGggPCB0LmVsZW1lbnRbMF0uc2Nyb2xsV2lkdGgsIG4gPSAic2Nyb2xsIiA9PT0gcyB8fCAiYXV0byIgPT09IHMgJiYgdC5oZWlnaHQgPCB0LmVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0OyByZXR1cm4geyB3aWR0aDogbiA/IGUucG9zaXRpb24uc2Nyb2xsYmFyV2lkdGgoKSA6IDAsIGhlaWdodDogYSA/IGUucG9zaXRpb24uc2Nyb2xsYmFyV2lkdGgoKSA6IDAgfSB9LCBnZXRXaXRoaW5JbmZvOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUodCB8fCB3aW5kb3cpLCBzID0gZS5pc1dpbmRvdyhpWzBdKSwgYSA9ICEhaVswXSAmJiA5ID09PSBpWzBdLm5vZGVUeXBlLCBuID0gIXMgJiYgIWE7IHJldHVybiB7IGVsZW1lbnQ6IGksIGlzV2luZG93OiBzLCBpc0RvY3VtZW50OiBhLCBvZmZzZXQ6IG4gPyBlKHQpLm9mZnNldCgpIDogeyBsZWZ0OiAwLCB0b3A6IDAgfSwgc2Nyb2xsTGVmdDogaS5zY3JvbGxMZWZ0KCksIHNjcm9sbFRvcDogaS5zY3JvbGxUb3AoKSwgd2lkdGg6IGkub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6IGkub3V0ZXJIZWlnaHQoKSB9IH0gfSwgZS5mbi5wb3NpdGlvbiA9IGZ1bmN0aW9uIChhKSB7IGlmICghYSB8fCAhYS5vZikgcmV0dXJuIGMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgYSA9IGUuZXh0ZW5kKHt9LCBhKTsgdmFyIGQsIHAsIG0sIGYsIGcsIHYsIHkgPSBlKGEub2YpLCBfID0gZS5wb3NpdGlvbi5nZXRXaXRoaW5JbmZvKGEud2l0aGluKSwgYiA9IGUucG9zaXRpb24uZ2V0U2Nyb2xsSW5mbyhfKSwgayA9IChhLmNvbGxpc2lvbiB8fCAiZmxpcCIpLnNwbGl0KCIgIiksIHggPSB7fTsgcmV0dXJuIHYgPSBzKHkpLCB5WzBdLnByZXZlbnREZWZhdWx0ICYmIChhLmF0ID0gImxlZnQgdG9wIiksIHAgPSB2LndpZHRoLCBtID0gdi5oZWlnaHQsIGYgPSB2Lm9mZnNldCwgZyA9IGUuZXh0ZW5kKHt9LCBmKSwgZS5lYWNoKFsibXkiLCAiYXQiXSwgZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCwgaSA9IChhW3RoaXNdIHx8ICIiKS5zcGxpdCgiICIpOyAxID09PSBpLmxlbmd0aCAmJiAoaSA9IG8udGVzdChpWzBdKSA/IGkuY29uY2F0KFsiY2VudGVyIl0pIDogbC50ZXN0KGlbMF0pID8gWyJjZW50ZXIiXS5jb25jYXQoaSkgOiBbImNlbnRlciIsICJjZW50ZXIiXSksIGlbMF0gPSBvLnRlc3QoaVswXSkgPyBpWzBdIDogImNlbnRlciIsIGlbMV0gPSBsLnRlc3QoaVsxXSkgPyBpWzFdIDogImNlbnRlciIsIGUgPSBoLmV4ZWMoaVswXSksIHQgPSBoLmV4ZWMoaVsxXSksIHhbdGhpc10gPSBbZSA/IGVbMF0gOiAwLCB0ID8gdFswXSA6IDBdLCBhW3RoaXNdID0gW3UuZXhlYyhpWzBdKVswXSwgdS5leGVjKGlbMV0pWzBdXSB9KSwgMSA9PT0gay5sZW5ndGggJiYgKGtbMV0gPSBrWzBdKSwgInJpZ2h0IiA9PT0gYS5hdFswXSA/IGcubGVmdCArPSBwIDogImNlbnRlciIgPT09IGEuYXRbMF0gJiYgKGcubGVmdCArPSBwIC8gMiksICJib3R0b20iID09PSBhLmF0WzFdID8gZy50b3AgKz0gbSA6ICJjZW50ZXIiID09PSBhLmF0WzFdICYmIChnLnRvcCArPSBtIC8gMiksIGQgPSB0KHguYXQsIHAsIG0pLCBnLmxlZnQgKz0gZFswXSwgZy50b3AgKz0gZFsxXSwgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHMsIG8sIGwgPSBlKHRoaXMpLCBoID0gbC5vdXRlcldpZHRoKCksIHUgPSBsLm91dGVySGVpZ2h0KCksIGMgPSBpKHRoaXMsICJtYXJnaW5MZWZ0IiksIHYgPSBpKHRoaXMsICJtYXJnaW5Ub3AiKSwgRCA9IGggKyBjICsgaSh0aGlzLCAibWFyZ2luUmlnaHQiKSArIGIud2lkdGgsIHcgPSB1ICsgdiArIGkodGhpcywgIm1hcmdpbkJvdHRvbSIpICsgYi5oZWlnaHQsIFQgPSBlLmV4dGVuZCh7fSwgZyksIFMgPSB0KHgubXksIGwub3V0ZXJXaWR0aCgpLCBsLm91dGVySGVpZ2h0KCkpOyAicmlnaHQiID09PSBhLm15WzBdID8gVC5sZWZ0IC09IGggOiAiY2VudGVyIiA9PT0gYS5teVswXSAmJiAoVC5sZWZ0IC09IGggLyAyKSwgImJvdHRvbSIgPT09IGEubXlbMV0gPyBULnRvcCAtPSB1IDogImNlbnRlciIgPT09IGEubXlbMV0gJiYgKFQudG9wIC09IHUgLyAyKSwgVC5sZWZ0ICs9IFNbMF0sIFQudG9wICs9IFNbMV0sIHMgPSB7IG1hcmdpbkxlZnQ6IGMsIG1hcmdpblRvcDogdiB9LCBlLmVhY2goWyJsZWZ0IiwgInRvcCJdLCBmdW5jdGlvbiAodCwgaSkgeyBlLnVpLnBvc2l0aW9uW2tbdF1dICYmIGUudWkucG9zaXRpb25ba1t0XV1baV0oVCwgeyB0YXJnZXRXaWR0aDogcCwgdGFyZ2V0SGVpZ2h0OiBtLCBlbGVtV2lkdGg6IGgsIGVsZW1IZWlnaHQ6IHUsIGNvbGxpc2lvblBvc2l0aW9uOiBzLCBjb2xsaXNpb25XaWR0aDogRCwgY29sbGlzaW9uSGVpZ2h0OiB3LCBvZmZzZXQ6IFtkWzBdICsgU1swXSwgZFsxXSArIFNbMV1dLCBteTogYS5teSwgYXQ6IGEuYXQsIHdpdGhpbjogXywgZWxlbTogbCB9KSB9KSwgYS51c2luZyAmJiAobyA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZi5sZWZ0IC0gVC5sZWZ0LCBpID0gdCArIHAgLSBoLCBzID0gZi50b3AgLSBULnRvcCwgbyA9IHMgKyBtIC0gdSwgZCA9IHsgdGFyZ2V0OiB7IGVsZW1lbnQ6IHksIGxlZnQ6IGYubGVmdCwgdG9wOiBmLnRvcCwgd2lkdGg6IHAsIGhlaWdodDogbSB9LCBlbGVtZW50OiB7IGVsZW1lbnQ6IGwsIGxlZnQ6IFQubGVmdCwgdG9wOiBULnRvcCwgd2lkdGg6IGgsIGhlaWdodDogdSB9LCBob3Jpem9udGFsOiAwID4gaSA/ICJsZWZ0IiA6IHQgPiAwID8gInJpZ2h0IiA6ICJjZW50ZXIiLCB2ZXJ0aWNhbDogMCA+IG8gPyAidG9wIiA6IHMgPiAwID8gImJvdHRvbSIgOiAibWlkZGxlIiB9OyBoID4gcCAmJiBwID4gcih0ICsgaSkgJiYgKGQuaG9yaXpvbnRhbCA9ICJjZW50ZXIiKSwgdSA+IG0gJiYgbSA+IHIocyArIG8pICYmIChkLnZlcnRpY2FsID0gIm1pZGRsZSIpLCBkLmltcG9ydGFudCA9IG4ocih0KSwgcihpKSkgPiBuKHIocyksIHIobykpID8gImhvcml6b250YWwiIDogInZlcnRpY2FsIiwgYS51c2luZy5jYWxsKHRoaXMsIGUsIGQpIH0pLCBsLm9mZnNldChlLmV4dGVuZChULCB7IHVzaW5nOiBvIH0pKSB9KSB9LCBlLnVpLnBvc2l0aW9uID0geyBmaXQ6IHsgbGVmdDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGksIHMgPSB0LndpdGhpbiwgYSA9IHMuaXNXaW5kb3cgPyBzLnNjcm9sbExlZnQgOiBzLm9mZnNldC5sZWZ0LCByID0gcy53aWR0aCwgbyA9IGUubGVmdCAtIHQuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCwgbCA9IGEgLSBvLCBoID0gbyArIHQuY29sbGlzaW9uV2lkdGggLSByIC0gYTsgdC5jb2xsaXNpb25XaWR0aCA+IHIgPyBsID4gMCAmJiAwID49IGggPyAoaSA9IGUubGVmdCArIGwgKyB0LmNvbGxpc2lvbldpZHRoIC0gciAtIGEsIGUubGVmdCArPSBsIC0gaSkgOiBlLmxlZnQgPSBoID4gMCAmJiAwID49IGwgPyBhIDogbCA+IGggPyBhICsgciAtIHQuY29sbGlzaW9uV2lkdGggOiBhIDogbCA+IDAgPyBlLmxlZnQgKz0gbCA6IGggPiAwID8gZS5sZWZ0IC09IGggOiBlLmxlZnQgPSBuKGUubGVmdCAtIG8sIGUubGVmdCkgfSwgdG9wOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSwgcyA9IHQud2l0aGluLCBhID0gcy5pc1dpbmRvdyA/IHMuc2Nyb2xsVG9wIDogcy5vZmZzZXQudG9wLCByID0gdC53aXRoaW4uaGVpZ2h0LCBvID0gZS50b3AgLSB0LmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpblRvcCwgbCA9IGEgLSBvLCBoID0gbyArIHQuY29sbGlzaW9uSGVpZ2h0IC0gciAtIGE7IHQuY29sbGlzaW9uSGVpZ2h0ID4gciA/IGwgPiAwICYmIDAgPj0gaCA/IChpID0gZS50b3AgKyBsICsgdC5jb2xsaXNpb25IZWlnaHQgLSByIC0gYSwgZS50b3AgKz0gbCAtIGkpIDogZS50b3AgPSBoID4gMCAmJiAwID49IGwgPyBhIDogbCA+IGggPyBhICsgciAtIHQuY29sbGlzaW9uSGVpZ2h0IDogYSA6IGwgPiAwID8gZS50b3AgKz0gbCA6IGggPiAwID8gZS50b3AgLT0gaCA6IGUudG9wID0gbihlLnRvcCAtIG8sIGUudG9wKSB9IH0sIGZsaXA6IHsgbGVmdDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGksIHMsIGEgPSB0LndpdGhpbiwgbiA9IGEub2Zmc2V0LmxlZnQgKyBhLnNjcm9sbExlZnQsIG8gPSBhLndpZHRoLCBsID0gYS5pc1dpbmRvdyA/IGEuc2Nyb2xsTGVmdCA6IGEub2Zmc2V0LmxlZnQsIGggPSBlLmxlZnQgLSB0LmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpbkxlZnQsIHUgPSBoIC0gbCwgZCA9IGggKyB0LmNvbGxpc2lvbldpZHRoIC0gbyAtIGwsIGMgPSAibGVmdCIgPT09IHQubXlbMF0gPyAtdC5lbGVtV2lkdGggOiAicmlnaHQiID09PSB0Lm15WzBdID8gdC5lbGVtV2lkdGggOiAwLCBwID0gImxlZnQiID09PSB0LmF0WzBdID8gdC50YXJnZXRXaWR0aCA6ICJyaWdodCIgPT09IHQuYXRbMF0gPyAtdC50YXJnZXRXaWR0aCA6IDAsIG0gPSAtMiAqIHQub2Zmc2V0WzBdOyAwID4gdSA/IChpID0gZS5sZWZ0ICsgYyArIHAgKyBtICsgdC5jb2xsaXNpb25XaWR0aCAtIG8gLSBuLCAoMCA+IGkgfHwgcih1KSA+IGkpICYmIChlLmxlZnQgKz0gYyArIHAgKyBtKSkgOiBkID4gMCAmJiAocyA9IGUubGVmdCAtIHQuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCArIGMgKyBwICsgbSAtIGwsIChzID4gMCB8fCBkID4gcihzKSkgJiYgKGUubGVmdCArPSBjICsgcCArIG0pKSB9LCB0b3A6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpLCBzLCBhID0gdC53aXRoaW4sIG4gPSBhLm9mZnNldC50b3AgKyBhLnNjcm9sbFRvcCwgbyA9IGEuaGVpZ2h0LCBsID0gYS5pc1dpbmRvdyA/IGEuc2Nyb2xsVG9wIDogYS5vZmZzZXQudG9wLCBoID0gZS50b3AgLSB0LmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpblRvcCwgdSA9IGggLSBsLCBkID0gaCArIHQuY29sbGlzaW9uSGVpZ2h0IC0gbyAtIGwsIGMgPSAidG9wIiA9PT0gdC5teVsxXSwgcCA9IGMgPyAtdC5lbGVtSGVpZ2h0IDogImJvdHRvbSIgPT09IHQubXlbMV0gPyB0LmVsZW1IZWlnaHQgOiAwLCBtID0gInRvcCIgPT09IHQuYXRbMV0gPyB0LnRhcmdldEhlaWdodCA6ICJib3R0b20iID09PSB0LmF0WzFdID8gLXQudGFyZ2V0SGVpZ2h0IDogMCwgZiA9IC0yICogdC5vZmZzZXRbMV07IDAgPiB1ID8gKHMgPSBlLnRvcCArIHAgKyBtICsgZiArIHQuY29sbGlzaW9uSGVpZ2h0IC0gbyAtIG4sICgwID4gcyB8fCByKHUpID4gcykgJiYgKGUudG9wICs9IHAgKyBtICsgZikpIDogZCA+IDAgJiYgKGkgPSBlLnRvcCAtIHQuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luVG9wICsgcCArIG0gKyBmIC0gbCwgKGkgPiAwIHx8IGQgPiByKGkpKSAmJiAoZS50b3AgKz0gcCArIG0gKyBmKSkgfSB9LCBmbGlwZml0OiB7IGxlZnQ6IGZ1bmN0aW9uICgpIHsgZS51aS5wb3NpdGlvbi5mbGlwLmxlZnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgZS51aS5wb3NpdGlvbi5maXQubGVmdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0sIHRvcDogZnVuY3Rpb24gKCkgeyBlLnVpLnBvc2l0aW9uLmZsaXAudG9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGUudWkucG9zaXRpb24uZml0LnRvcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSB9IH0oKSwgZS51aS5wb3NpdGlvbiwgZS5leHRlbmQoZS5leHByWyI6Il0sIHsgZGF0YTogZS5leHByLmNyZWF0ZVBzZXVkbyA/IGUuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChpKSB7IHJldHVybiAhIWUuZGF0YShpLCB0KSB9IH0pIDogZnVuY3Rpb24gKHQsIGksIHMpIHsgcmV0dXJuICEhZS5kYXRhKHQsIHNbM10pIH0gfSksIGUuZm4uZXh0ZW5kKHsgZGlzYWJsZVNlbGVjdGlvbjogZnVuY3Rpb24gKCkgeyB2YXIgZSA9ICJvbnNlbGVjdHN0YXJ0IiBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSA/ICJzZWxlY3RzdGFydCIgOiAibW91c2Vkb3duIjsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMub24oZSArICIudWktZGlzYWJsZVNlbGVjdGlvbiIsIGZ1bmN0aW9uIChlKSB7IGUucHJldmVudERlZmF1bHQoKSB9KSB9IH0oKSwgZW5hYmxlU2VsZWN0aW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm9mZigiLnVpLWRpc2FibGVTZWxlY3Rpb24iKSB9IH0pLCBlLnVpLmZvY3VzYWJsZSA9IGZ1bmN0aW9uIChpLCBzKSB7IHZhciBhLCBuLCByLCBvLCBsLCBoID0gaS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOyByZXR1cm4gImFyZWEiID09PSBoID8gKGEgPSBpLnBhcmVudE5vZGUsIG4gPSBhLm5hbWUsIGkuaHJlZiAmJiBuICYmICJtYXAiID09PSBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPyAociA9IGUoImltZ1t1c2VtYXA9JyMiICsgbiArICInXSIpLCByLmxlbmd0aCA+IDAgJiYgci5pcygiOnZpc2libGUiKSkgOiAhMSkgOiAoL14oaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QpJC8udGVzdChoKSA/IChvID0gIWkuZGlzYWJsZWQsIG8gJiYgKGwgPSBlKGkpLmNsb3Nlc3QoImZpZWxkc2V0IilbMF0sIGwgJiYgKG8gPSAhbC5kaXNhYmxlZCkpKSA6IG8gPSAiYSIgPT09IGggPyBpLmhyZWYgfHwgcyA6IHMsIG8gJiYgZShpKS5pcygiOnZpc2libGUiKSAmJiB0KGUoaSkpKSB9LCBlLmV4dGVuZChlLmV4cHJbIjoiXSwgeyBmb2N1c2FibGU6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBlLnVpLmZvY3VzYWJsZSh0LCBudWxsICE9IGUuYXR0cih0LCAidGFiaW5kZXgiKSkgfSB9KSwgZS51aS5mb2N1c2FibGUsIGUuZm4uZm9ybSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiB0aGlzWzBdLmZvcm0gPyB0aGlzLmNsb3Nlc3QoImZvcm0iKSA6IGUodGhpc1swXS5mb3JtKSB9LCBlLnVpLmZvcm1SZXNldE1peGluID0geyBfZm9ybVJlc2V0SGFuZGxlcjogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyB2YXIgaSA9IHQuZGF0YSgidWktZm9ybS1yZXNldC1pbnN0YW5jZXMiKTsgZS5lYWNoKGksIGZ1bmN0aW9uICgpIHsgdGhpcy5yZWZyZXNoKCkgfSkgfSkgfSwgX2JpbmRGb3JtUmVzZXRIYW5kbGVyOiBmdW5jdGlvbiAoKSB7IGlmICh0aGlzLmZvcm0gPSB0aGlzLmVsZW1lbnQuZm9ybSgpLCB0aGlzLmZvcm0ubGVuZ3RoKSB7IHZhciBlID0gdGhpcy5mb3JtLmRhdGEoInVpLWZvcm0tcmVzZXQtaW5zdGFuY2VzIikgfHwgW107IGUubGVuZ3RoIHx8IHRoaXMuZm9ybS5vbigicmVzZXQudWktZm9ybS1yZXNldCIsIHRoaXMuX2Zvcm1SZXNldEhhbmRsZXIpLCBlLnB1c2godGhpcyksIHRoaXMuZm9ybS5kYXRhKCJ1aS1mb3JtLXJlc2V0LWluc3RhbmNlcyIsIGUpIH0gfSwgX3VuYmluZEZvcm1SZXNldEhhbmRsZXI6IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuZm9ybS5sZW5ndGgpIHsgdmFyIHQgPSB0aGlzLmZvcm0uZGF0YSgidWktZm9ybS1yZXNldC1pbnN0YW5jZXMiKTsgdC5zcGxpY2UoZS5pbkFycmF5KHRoaXMsIHQpLCAxKSwgdC5sZW5ndGggPyB0aGlzLmZvcm0uZGF0YSgidWktZm9ybS1yZXNldC1pbnN0YW5jZXMiLCB0KSA6IHRoaXMuZm9ybS5yZW1vdmVEYXRhKCJ1aS1mb3JtLXJlc2V0LWluc3RhbmNlcyIpLm9mZigicmVzZXQudWktZm9ybS1yZXNldCIpIH0gfSB9LCAiMS43IiA9PT0gZS5mbi5qcXVlcnkuc3Vic3RyaW5nKDAsIDMpICYmIChlLmVhY2goWyJXaWR0aCIsICJIZWlnaHQiXSwgZnVuY3Rpb24gKHQsIGkpIHsgZnVuY3Rpb24gcyh0LCBpLCBzLCBuKSB7IHJldHVybiBlLmVhY2goYSwgZnVuY3Rpb24gKCkgeyBpIC09IHBhcnNlRmxvYXQoZS5jc3ModCwgInBhZGRpbmciICsgdGhpcykpIHx8IDAsIHMgJiYgKGkgLT0gcGFyc2VGbG9hdChlLmNzcyh0LCAiYm9yZGVyIiArIHRoaXMgKyAiV2lkdGgiKSkgfHwgMCksIG4gJiYgKGkgLT0gcGFyc2VGbG9hdChlLmNzcyh0LCAibWFyZ2luIiArIHRoaXMpKSB8fCAwKSB9KSwgaSB9IHZhciBhID0gIldpZHRoIiA9PT0gaSA/IFsiTGVmdCIsICJSaWdodCJdIDogWyJUb3AiLCAiQm90dG9tIl0sIG4gPSBpLnRvTG93ZXJDYXNlKCksIHIgPSB7IGlubmVyV2lkdGg6IGUuZm4uaW5uZXJXaWR0aCwgaW5uZXJIZWlnaHQ6IGUuZm4uaW5uZXJIZWlnaHQsIG91dGVyV2lkdGg6IGUuZm4ub3V0ZXJXaWR0aCwgb3V0ZXJIZWlnaHQ6IGUuZm4ub3V0ZXJIZWlnaHQgfTsgZS5mblsiaW5uZXIiICsgaV0gPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ID8gclsiaW5uZXIiICsgaV0uY2FsbCh0aGlzKSA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IGUodGhpcykuY3NzKG4sIHModGhpcywgdCkgKyAicHgiKSB9KSB9LCBlLmZuWyJvdXRlciIgKyBpXSA9IGZ1bmN0aW9uICh0LCBhKSB7IHJldHVybiAibnVtYmVyIiAhPSB0eXBlb2YgdCA/IHJbIm91dGVyIiArIGldLmNhbGwodGhpcywgdCkgOiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBlKHRoaXMpLmNzcyhuLCBzKHRoaXMsIHQsICEwLCBhKSArICJweCIpIH0pIH0gfSksIGUuZm4uYWRkQmFjayA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLmFkZChudWxsID09IGUgPyB0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKGUpKSB9KSwgZS51aS5rZXlDb2RlID0geyBCQUNLU1BBQ0U6IDgsIENPTU1BOiAxODgsIERFTEVURTogNDYsIERPV046IDQwLCBFTkQ6IDM1LCBFTlRFUjogMTMsIEVTQ0FQRTogMjcsIEhPTUU6IDM2LCBMRUZUOiAzNywgUEFHRV9ET1dOOiAzNCwgUEFHRV9VUDogMzMsIFBFUklPRDogMTkwLCBSSUdIVDogMzksIFNQQUNFOiAzMiwgVEFCOiA5LCBVUDogMzggfSwgZS51aS5lc2NhcGVTZWxlY3RvciA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSAvKFshIiMkJSYnKCkqKywuLzo7PD0+P0BbXF1eYHt8fX5dKS9nOyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQucmVwbGFjZShlLCAiXFwkMSIpIH0gfSgpLCBlLmZuLmxhYmVscyA9IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGksIHMsIGEsIG47IHJldHVybiB0aGlzWzBdLmxhYmVscyAmJiB0aGlzWzBdLmxhYmVscy5sZW5ndGggPyB0aGlzLnB1c2hTdGFjayh0aGlzWzBdLmxhYmVscykgOiAoYSA9IHRoaXMuZXEoMCkucGFyZW50cygibGFiZWwiKSwgcyA9IHRoaXMuYXR0cigiaWQiKSwgcyAmJiAodCA9IHRoaXMuZXEoMCkucGFyZW50cygpLmxhc3QoKSwgbiA9IHQuYWRkKHQubGVuZ3RoID8gdC5zaWJsaW5ncygpIDogdGhpcy5zaWJsaW5ncygpKSwgaSA9ICJsYWJlbFtmb3I9JyIgKyBlLnVpLmVzY2FwZVNlbGVjdG9yKHMpICsgIiddIiwgYSA9IGEuYWRkKG4uZmluZChpKS5hZGRCYWNrKGkpKSksIHRoaXMucHVzaFN0YWNrKGEpKSB9LCBlLmZuLnNjcm9sbFBhcmVudCA9IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5jc3MoInBvc2l0aW9uIiksIHMgPSAiYWJzb2x1dGUiID09PSBpLCBhID0gdCA/IC8oYXV0b3xzY3JvbGx8aGlkZGVuKS8gOiAvKGF1dG98c2Nyb2xsKS8sIG4gPSB0aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHJldHVybiBzICYmICJzdGF0aWMiID09PSB0LmNzcygicG9zaXRpb24iKSA/ICExIDogYS50ZXN0KHQuY3NzKCJvdmVyZmxvdyIpICsgdC5jc3MoIm92ZXJmbG93LXkiKSArIHQuY3NzKCJvdmVyZmxvdy14IikpIH0pLmVxKDApOyByZXR1cm4gImZpeGVkIiAhPT0gaSAmJiBuLmxlbmd0aCA/IG4gOiBlKHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgfSwgZS5leHRlbmQoZS5leHByWyI6Il0sIHsgdGFiYmFibGU6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gZS5hdHRyKHQsICJ0YWJpbmRleCIpLCBzID0gbnVsbCAhPSBpOyByZXR1cm4gKCFzIHx8IGkgPj0gMCkgJiYgZS51aS5mb2N1c2FibGUodCwgcykgfSB9KSwgZS5mbi5leHRlbmQoeyB1bmlxdWVJZDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IDA7IHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyB0aGlzLmlkIHx8ICh0aGlzLmlkID0gInVpLWlkLSIgKyArK2UpIH0pIH0gfSgpLCByZW1vdmVVbmlxdWVJZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgL151aS1pZC1cZCskLy50ZXN0KHRoaXMuaWQpICYmIGUodGhpcykucmVtb3ZlQXR0cigiaWQiKSB9KSB9IH0pLCBlLnVpLmllID0gISEvbXNpZSBbXHcuXSsvLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKTsgdmFyIHUgPSAhMTsgZShkb2N1bWVudCkub24oIm1vdXNldXAiLCBmdW5jdGlvbiAoKSB7IHUgPSAhMSB9KSwgZS53aWRnZXQoInVpLm1vdXNlIiwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgb3B0aW9uczogeyBjYW5jZWw6ICJpbnB1dCwgdGV4dGFyZWEsIGJ1dHRvbiwgc2VsZWN0LCBvcHRpb24iLCBkaXN0YW5jZTogMSwgZGVsYXk6IDAgfSwgX21vdXNlSW5pdDogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXM7IHRoaXMuZWxlbWVudC5vbigibW91c2Vkb3duLiIgKyB0aGlzLndpZGdldE5hbWUsIGZ1bmN0aW9uIChlKSB7IHJldHVybiB0Ll9tb3VzZURvd24oZSkgfSkub24oImNsaWNrLiIgKyB0aGlzLndpZGdldE5hbWUsIGZ1bmN0aW9uIChpKSB7IHJldHVybiAhMCA9PT0gZS5kYXRhKGkudGFyZ2V0LCB0LndpZGdldE5hbWUgKyAiLnByZXZlbnRDbGlja0V2ZW50IikgPyAoZS5yZW1vdmVEYXRhKGkudGFyZ2V0LCB0LndpZGdldE5hbWUgKyAiLnByZXZlbnRDbGlja0V2ZW50IiksIGkuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksICExKSA6IHZvaWQgMCB9KSwgdGhpcy5zdGFydGVkID0gITEgfSwgX21vdXNlRGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLmVsZW1lbnQub2ZmKCIuIiArIHRoaXMud2lkZ2V0TmFtZSksIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlICYmIHRoaXMuZG9jdW1lbnQub2ZmKCJtb3VzZW1vdmUuIiArIHRoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLm9mZigibW91c2V1cC4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpIH0sIF9tb3VzZURvd246IGZ1bmN0aW9uICh0KSB7IGlmICghdSkgeyB0aGlzLl9tb3VzZU1vdmVkID0gITEsIHRoaXMuX21vdXNlU3RhcnRlZCAmJiB0aGlzLl9tb3VzZVVwKHQpLCB0aGlzLl9tb3VzZURvd25FdmVudCA9IHQ7IHZhciBpID0gdGhpcywgcyA9IDEgPT09IHQud2hpY2gsIGEgPSAic3RyaW5nIiA9PSB0eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbCAmJiB0LnRhcmdldC5ub2RlTmFtZSA/IGUodC50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoIDogITE7IHJldHVybiBzICYmICFhICYmIHRoaXMuX21vdXNlQ2FwdHVyZSh0KSA/ICh0aGlzLm1vdXNlRGVsYXlNZXQgPSAhdGhpcy5vcHRpb25zLmRlbGF5LCB0aGlzLm1vdXNlRGVsYXlNZXQgfHwgKHRoaXMuX21vdXNlRGVsYXlUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBpLm1vdXNlRGVsYXlNZXQgPSAhMCB9LCB0aGlzLm9wdGlvbnMuZGVsYXkpKSwgdGhpcy5fbW91c2VEaXN0YW5jZU1ldCh0KSAmJiB0aGlzLl9tb3VzZURlbGF5TWV0KHQpICYmICh0aGlzLl9tb3VzZVN0YXJ0ZWQgPSB0aGlzLl9tb3VzZVN0YXJ0KHQpICE9PSAhMSwgIXRoaXMuX21vdXNlU3RhcnRlZCkgPyAodC5wcmV2ZW50RGVmYXVsdCgpLCAhMCkgOiAoITAgPT09IGUuZGF0YSh0LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIpICYmIGUucmVtb3ZlRGF0YSh0LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIpLCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBpLl9tb3VzZU1vdmUoZSkgfSwgdGhpcy5fbW91c2VVcERlbGVnYXRlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGkuX21vdXNlVXAoZSkgfSwgdGhpcy5kb2N1bWVudC5vbigibW91c2Vtb3ZlLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS5vbigibW91c2V1cC4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLCB0LnByZXZlbnREZWZhdWx0KCksIHUgPSAhMCwgITApKSA6ICEwIH0gfSwgX21vdXNlTW92ZTogZnVuY3Rpb24gKHQpIHsgaWYgKHRoaXMuX21vdXNlTW92ZWQpIHsgaWYgKGUudWkuaWUgJiYgKCFkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgOSA+IGRvY3VtZW50LmRvY3VtZW50TW9kZSkgJiYgIXQuYnV0dG9uKSByZXR1cm4gdGhpcy5fbW91c2VVcCh0KTsgaWYgKCF0LndoaWNoKSBpZiAodC5vcmlnaW5hbEV2ZW50LmFsdEtleSB8fCB0Lm9yaWdpbmFsRXZlbnQuY3RybEtleSB8fCB0Lm9yaWdpbmFsRXZlbnQubWV0YUtleSB8fCB0Lm9yaWdpbmFsRXZlbnQuc2hpZnRLZXkpIHRoaXMuaWdub3JlTWlzc2luZ1doaWNoID0gITA7IGVsc2UgaWYgKCF0aGlzLmlnbm9yZU1pc3NpbmdXaGljaCkgcmV0dXJuIHRoaXMuX21vdXNlVXAodCkgfSByZXR1cm4gKHQud2hpY2ggfHwgdC5idXR0b24pICYmICh0aGlzLl9tb3VzZU1vdmVkID0gITApLCB0aGlzLl9tb3VzZVN0YXJ0ZWQgPyAodGhpcy5fbW91c2VEcmFnKHQpLCB0LnByZXZlbnREZWZhdWx0KCkpIDogKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQodCkgJiYgdGhpcy5fbW91c2VEZWxheU1ldCh0KSAmJiAodGhpcy5fbW91c2VTdGFydGVkID0gdGhpcy5fbW91c2VTdGFydCh0aGlzLl9tb3VzZURvd25FdmVudCwgdCkgIT09ICExLCB0aGlzLl9tb3VzZVN0YXJ0ZWQgPyB0aGlzLl9tb3VzZURyYWcodCkgOiB0aGlzLl9tb3VzZVVwKHQpKSwgIXRoaXMuX21vdXNlU3RhcnRlZCkgfSwgX21vdXNlVXA6IGZ1bmN0aW9uICh0KSB7IHRoaXMuZG9jdW1lbnQub2ZmKCJtb3VzZW1vdmUuIiArIHRoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLm9mZigibW91c2V1cC4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLCB0aGlzLl9tb3VzZVN0YXJ0ZWQgJiYgKHRoaXMuX21vdXNlU3RhcnRlZCA9ICExLCB0LnRhcmdldCA9PT0gdGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0ICYmIGUuZGF0YSh0LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIsICEwKSwgdGhpcy5fbW91c2VTdG9wKHQpKSwgdGhpcy5fbW91c2VEZWxheVRpbWVyICYmIChjbGVhclRpbWVvdXQodGhpcy5fbW91c2VEZWxheVRpbWVyKSwgZGVsZXRlIHRoaXMuX21vdXNlRGVsYXlUaW1lciksIHRoaXMuaWdub3JlTWlzc2luZ1doaWNoID0gITEsIHUgPSAhMSwgdC5wcmV2ZW50RGVmYXVsdCgpIH0sIF9tb3VzZURpc3RhbmNlTWV0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVggLSBlLnBhZ2VYKSwgTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVkgLSBlLnBhZ2VZKSkgPj0gdGhpcy5vcHRpb25zLmRpc3RhbmNlIH0sIF9tb3VzZURlbGF5TWV0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm1vdXNlRGVsYXlNZXQgfSwgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uICgpIHsgfSwgX21vdXNlRHJhZzogZnVuY3Rpb24gKCkgeyB9LCBfbW91c2VTdG9wOiBmdW5jdGlvbiAoKSB7IH0sIF9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwIH0gfSksIGUudWkucGx1Z2luID0geyBhZGQ6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuID0gZS51aVt0XS5wcm90b3R5cGU7IGZvciAoYSBpbiBzKSBuLnBsdWdpbnNbYV0gPSBuLnBsdWdpbnNbYV0gfHwgW10sIG4ucGx1Z2luc1thXS5wdXNoKFtpLCBzW2FdXSkgfSwgY2FsbDogZnVuY3Rpb24gKGUsIHQsIGksIHMpIHsgdmFyIGEsIG4gPSBlLnBsdWdpbnNbdF07IGlmIChuICYmIChzIHx8IGUuZWxlbWVudFswXS5wYXJlbnROb2RlICYmIDExICE9PSBlLmVsZW1lbnRbMF0ucGFyZW50Tm9kZS5ub2RlVHlwZSkpIGZvciAoYSA9IDA7IG4ubGVuZ3RoID4gYTsgYSsrKWUub3B0aW9uc1tuW2FdWzBdXSAmJiBuW2FdWzFdLmFwcGx5KGUuZWxlbWVudCwgaSkgfSB9LCBlLnVpLnNhZmVBY3RpdmVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IHRyeSB7IHQgPSBlLmFjdGl2ZUVsZW1lbnQgfSBjYXRjaCAoaSkgeyB0ID0gZS5ib2R5IH0gcmV0dXJuIHQgfHwgKHQgPSBlLmJvZHkpLCB0Lm5vZGVOYW1lIHx8ICh0ID0gZS5ib2R5KSwgdCB9LCBlLnVpLnNhZmVCbHVyID0gZnVuY3Rpb24gKHQpIHsgdCAmJiAiYm9keSIgIT09IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiBlKHQpLnRyaWdnZXIoImJsdXIiKSB9LCBlLndpZGdldCgidWkuZHJhZ2dhYmxlIiwgZS51aS5tb3VzZSwgew0KICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjEyLjEiLCB3aWRnZXRFdmVudFByZWZpeDogImRyYWciLCBvcHRpb25zOiB7IGFkZENsYXNzZXM6ICEwLCBhcHBlbmRUbzogInBhcmVudCIsIGF4aXM6ICExLCBjb25uZWN0VG9Tb3J0YWJsZTogITEsIGNvbnRhaW5tZW50OiAhMSwgY3Vyc29yOiAiYXV0byIsIGN1cnNvckF0OiAhMSwgZ3JpZDogITEsIGhhbmRsZTogITEsIGhlbHBlcjogIm9yaWdpbmFsIiwgaWZyYW1lRml4OiAhMSwgb3BhY2l0eTogITEsIHJlZnJlc2hQb3NpdGlvbnM6ICExLCByZXZlcnQ6ICExLCByZXZlcnREdXJhdGlvbjogNTAwLCBzY29wZTogImRlZmF1bHQiLCBzY3JvbGw6ICEwLCBzY3JvbGxTZW5zaXRpdml0eTogMjAsIHNjcm9sbFNwZWVkOiAyMCwgc25hcDogITEsIHNuYXBNb2RlOiAiYm90aCIsIHNuYXBUb2xlcmFuY2U6IDIwLCBzdGFjazogITEsIHpJbmRleDogITEsIGRyYWc6IG51bGwsIHN0YXJ0OiBudWxsLCBzdG9wOiBudWxsIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgIm9yaWdpbmFsIiA9PT0gdGhpcy5vcHRpb25zLmhlbHBlciAmJiB0aGlzLl9zZXRQb3NpdGlvblJlbGF0aXZlKCksIHRoaXMub3B0aW9ucy5hZGRDbGFzc2VzICYmIHRoaXMuX2FkZENsYXNzKCJ1aS1kcmFnZ2FibGUiKSwgdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMuX21vdXNlSW5pdCgpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IHRoaXMuX3N1cGVyKGUsIHQpLCAiaGFuZGxlIiA9PT0gZSAmJiAodGhpcy5fcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMuaGVscGVyIHx8IHRoaXMuZWxlbWVudCkuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKSA/ICh0aGlzLmRlc3Ryb3lPbkNsZWFyID0gITAsIHZvaWQgMCkgOiAodGhpcy5fcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMuX21vdXNlRGVzdHJveSgpLCB2b2lkIDApIH0sIF9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5vcHRpb25zOyByZXR1cm4gdGhpcy5oZWxwZXIgfHwgaS5kaXNhYmxlZCB8fCBlKHQudGFyZ2V0KS5jbG9zZXN0KCIudWktcmVzaXphYmxlLWhhbmRsZSIpLmxlbmd0aCA+IDAgPyAhMSA6ICh0aGlzLmhhbmRsZSA9IHRoaXMuX2dldEhhbmRsZSh0KSwgdGhpcy5oYW5kbGUgPyAodGhpcy5fYmx1ckFjdGl2ZUVsZW1lbnQodCksIHRoaXMuX2Jsb2NrRnJhbWVzKGkuaWZyYW1lRml4ID09PSAhMCA/ICJpZnJhbWUiIDogaS5pZnJhbWVGaXgpLCAhMCkgOiAhMSkgfSwgX2Jsb2NrRnJhbWVzOiBmdW5jdGlvbiAodCkgeyB0aGlzLmlmcmFtZUJsb2NrcyA9IHRoaXMuZG9jdW1lbnQuZmluZCh0KS5tYXAoZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHJldHVybiBlKCI8ZGl2PiIpLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKS5hcHBlbmRUbyh0LnBhcmVudCgpKS5vdXRlcldpZHRoKHQub3V0ZXJXaWR0aCgpKS5vdXRlckhlaWdodCh0Lm91dGVySGVpZ2h0KCkpLm9mZnNldCh0Lm9mZnNldCgpKVswXSB9KSB9LCBfdW5ibG9ja0ZyYW1lczogZnVuY3Rpb24gKCkgeyB0aGlzLmlmcmFtZUJsb2NrcyAmJiAodGhpcy5pZnJhbWVCbG9ja3MucmVtb3ZlKCksIGRlbGV0ZSB0aGlzLmlmcmFtZUJsb2NrcykgfSwgX2JsdXJBY3RpdmVFbGVtZW50OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUudWkuc2FmZUFjdGl2ZUVsZW1lbnQodGhpcy5kb2N1bWVudFswXSksIHMgPSBlKHQudGFyZ2V0KTsgcy5jbG9zZXN0KGkpLmxlbmd0aCB8fCBlLnVpLnNhZmVCbHVyKGkpIH0sIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMub3B0aW9uczsgcmV0dXJuIHRoaXMuaGVscGVyID0gdGhpcy5fY3JlYXRlSGVscGVyKHQpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLmhlbHBlciwgInVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpLCB0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCksIGUudWkuZGRtYW5hZ2VyICYmIChlLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpcyksIHRoaXMuX2NhY2hlTWFyZ2lucygpLCB0aGlzLmNzc1Bvc2l0aW9uID0gdGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIpLCB0aGlzLnNjcm9sbFBhcmVudCA9IHRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCghMCksIHRoaXMub2Zmc2V0UGFyZW50ID0gdGhpcy5oZWxwZXIub2Zmc2V0UGFyZW50KCksIHRoaXMuaGFzRml4ZWRBbmNlc3RvciA9IHRoaXMuaGVscGVyLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gImZpeGVkIiA9PT0gZSh0aGlzKS5jc3MoInBvc2l0aW9uIikgfSkubGVuZ3RoID4gMCwgdGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuZWxlbWVudC5vZmZzZXQoKSwgdGhpcy5fcmVmcmVzaE9mZnNldHModCksIHRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKHQsICExKSwgdGhpcy5vcmlnaW5hbFBhZ2VYID0gdC5wYWdlWCwgdGhpcy5vcmlnaW5hbFBhZ2VZID0gdC5wYWdlWSwgaS5jdXJzb3JBdCAmJiB0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKGkuY3Vyc29yQXQpLCB0aGlzLl9zZXRDb250YWlubWVudCgpLCB0aGlzLl90cmlnZ2VyKCJzdGFydCIsIHQpID09PSAhMSA/ICh0aGlzLl9jbGVhcigpLCAhMSkgOiAodGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpLCBlLnVpLmRkbWFuYWdlciAmJiAhaS5kcm9wQmVoYXZpb3VyICYmIGUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsIHQpLCB0aGlzLl9tb3VzZURyYWcodCwgITApLCBlLnVpLmRkbWFuYWdlciAmJiBlLnVpLmRkbWFuYWdlci5kcmFnU3RhcnQodGhpcywgdCksICEwKSB9LCBfcmVmcmVzaE9mZnNldHM6IGZ1bmN0aW9uIChlKSB7IHRoaXMub2Zmc2V0ID0geyB0b3A6IHRoaXMucG9zaXRpb25BYnMudG9wIC0gdGhpcy5tYXJnaW5zLnRvcCwgbGVmdDogdGhpcy5wb3NpdGlvbkFicy5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQsIHNjcm9sbDogITEsIHBhcmVudDogdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCksIHJlbGF0aXZlOiB0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpIH0sIHRoaXMub2Zmc2V0LmNsaWNrID0geyBsZWZ0OiBlLnBhZ2VYIC0gdGhpcy5vZmZzZXQubGVmdCwgdG9wOiBlLnBhZ2VZIC0gdGhpcy5vZmZzZXQudG9wIH0gfSwgX21vdXNlRHJhZzogZnVuY3Rpb24gKHQsIGkpIHsgaWYgKHRoaXMuaGFzRml4ZWRBbmNlc3RvciAmJiAodGhpcy5vZmZzZXQucGFyZW50ID0gdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkpLCB0aGlzLnBvc2l0aW9uID0gdGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0LCAhMCksIHRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKSwgIWkpIHsgdmFyIHMgPSB0aGlzLl91aUhhc2goKTsgaWYgKHRoaXMuX3RyaWdnZXIoImRyYWciLCB0LCBzKSA9PT0gITEpIHJldHVybiB0aGlzLl9tb3VzZVVwKG5ldyBlLkV2ZW50KCJtb3VzZXVwIiwgdCkpLCAhMTsgdGhpcy5wb3NpdGlvbiA9IHMucG9zaXRpb24gfSByZXR1cm4gdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdCA9IHRoaXMucG9zaXRpb24ubGVmdCArICJweCIsIHRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcCA9IHRoaXMucG9zaXRpb24udG9wICsgInB4IiwgZS51aS5kZG1hbmFnZXIgJiYgZS51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLCB0KSwgITEgfSwgX21vdXNlU3RvcDogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLCBzID0gITE7IHJldHVybiBlLnVpLmRkbWFuYWdlciAmJiAhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXIgJiYgKHMgPSBlLnVpLmRkbWFuYWdlci5kcm9wKHRoaXMsIHQpKSwgdGhpcy5kcm9wcGVkICYmIChzID0gdGhpcy5kcm9wcGVkLCB0aGlzLmRyb3BwZWQgPSAhMSksICJpbnZhbGlkIiA9PT0gdGhpcy5vcHRpb25zLnJldmVydCAmJiAhcyB8fCAidmFsaWQiID09PSB0aGlzLm9wdGlvbnMucmV2ZXJ0ICYmIHMgfHwgdGhpcy5vcHRpb25zLnJldmVydCA9PT0gITAgfHwgZS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5yZXZlcnQpICYmIHRoaXMub3B0aW9ucy5yZXZlcnQuY2FsbCh0aGlzLmVsZW1lbnQsIHMpID8gZSh0aGlzLmhlbHBlcikuYW5pbWF0ZSh0aGlzLm9yaWdpbmFsUG9zaXRpb24sIHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwgMTApLCBmdW5jdGlvbiAoKSB7IGkuX3RyaWdnZXIoInN0b3AiLCB0KSAhPT0gITEgJiYgaS5fY2xlYXIoKSB9KSA6IHRoaXMuX3RyaWdnZXIoInN0b3AiLCB0KSAhPT0gITEgJiYgdGhpcy5fY2xlYXIoKSwgITEgfSwgX21vdXNlVXA6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0aGlzLl91bmJsb2NrRnJhbWVzKCksIGUudWkuZGRtYW5hZ2VyICYmIGUudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsIHQpLCB0aGlzLmhhbmRsZUVsZW1lbnQuaXModC50YXJnZXQpICYmIHRoaXMuZWxlbWVudC50cmlnZ2VyKCJmb2N1cyIpLCBlLnVpLm1vdXNlLnByb3RvdHlwZS5fbW91c2VVcC5jYWxsKHRoaXMsIHQpIH0sIGNhbmNlbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5oZWxwZXIuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKSA/IHRoaXMuX21vdXNlVXAobmV3IGUuRXZlbnQoIm1vdXNldXAiLCB7IHRhcmdldDogdGhpcy5lbGVtZW50WzBdIH0pKSA6IHRoaXMuX2NsZWFyKCksIHRoaXMgfSwgX2dldEhhbmRsZTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMub3B0aW9ucy5oYW5kbGUgPyAhIWUodC50YXJnZXQpLmNsb3Nlc3QodGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmhhbmRsZSkpLmxlbmd0aCA6ICEwIH0sIF9zZXRIYW5kbGVDbGFzc05hbWU6IGZ1bmN0aW9uICgpIHsgdGhpcy5oYW5kbGVFbGVtZW50ID0gdGhpcy5vcHRpb25zLmhhbmRsZSA/IHRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5oYW5kbGUpIDogdGhpcy5lbGVtZW50LCB0aGlzLl9hZGRDbGFzcyh0aGlzLmhhbmRsZUVsZW1lbnQsICJ1aS1kcmFnZ2FibGUtaGFuZGxlIikgfSwgX3JlbW92ZUhhbmRsZUNsYXNzTmFtZTogZnVuY3Rpb24gKCkgeyB0aGlzLl9yZW1vdmVDbGFzcyh0aGlzLmhhbmRsZUVsZW1lbnQsICJ1aS1kcmFnZ2FibGUtaGFuZGxlIikgfSwgX2NyZWF0ZUhlbHBlcjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLm9wdGlvbnMsIHMgPSBlLmlzRnVuY3Rpb24oaS5oZWxwZXIpLCBhID0gcyA/IGUoaS5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLCBbdF0pKSA6ICJjbG9uZSIgPT09IGkuaGVscGVyID8gdGhpcy5lbGVtZW50LmNsb25lKCkucmVtb3ZlQXR0cigiaWQiKSA6IHRoaXMuZWxlbWVudDsgcmV0dXJuIGEucGFyZW50cygiYm9keSIpLmxlbmd0aCB8fCBhLmFwcGVuZFRvKCJwYXJlbnQiID09PSBpLmFwcGVuZFRvID8gdGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGUgOiBpLmFwcGVuZFRvKSwgcyAmJiBhWzBdID09PSB0aGlzLmVsZW1lbnRbMF0gJiYgdGhpcy5fc2V0UG9zaXRpb25SZWxhdGl2ZSgpLCBhWzBdID09PSB0aGlzLmVsZW1lbnRbMF0gfHwgLyhmaXhlZHxhYnNvbHV0ZSkvLnRlc3QoYS5jc3MoInBvc2l0aW9uIikpIHx8IGEuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpLCBhIH0sIF9zZXRQb3NpdGlvblJlbGF0aXZlOiBmdW5jdGlvbiAoKSB7IC9eKD86cnxhfGYpLy50ZXN0KHRoaXMuZWxlbWVudC5jc3MoInBvc2l0aW9uIikpIHx8ICh0aGlzLmVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiKSB9LCBfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjogZnVuY3Rpb24gKHQpIHsgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKHQgPSB0LnNwbGl0KCIgIikpLCBlLmlzQXJyYXkodCkgJiYgKHQgPSB7IGxlZnQ6ICt0WzBdLCB0b3A6ICt0WzFdIHx8IDAgfSksICJsZWZ0IiBpbiB0ICYmICh0aGlzLm9mZnNldC5jbGljay5sZWZ0ID0gdC5sZWZ0ICsgdGhpcy5tYXJnaW5zLmxlZnQpLCAicmlnaHQiIGluIHQgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdC5yaWdodCArIHRoaXMubWFyZ2lucy5sZWZ0KSwgInRvcCIgaW4gdCAmJiAodGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdC50b3AgKyB0aGlzLm1hcmdpbnMudG9wKSwgImJvdHRvbSIgaW4gdCAmJiAodGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSB0LmJvdHRvbSArIHRoaXMubWFyZ2lucy50b3ApIH0sIF9pc1Jvb3ROb2RlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gLyhodG1sfGJvZHkpL2kudGVzdChlLnRhZ05hbWUpIHx8IGUgPT09IHRoaXMuZG9jdW1lbnRbMF0gfSwgX2dldFBhcmVudE9mZnNldDogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpLCBpID0gdGhpcy5kb2N1bWVudFswXTsgcmV0dXJuICJhYnNvbHV0ZSIgPT09IHRoaXMuY3NzUG9zaXRpb24gJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGkgJiYgZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pICYmICh0LmxlZnQgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpLCB0LnRvcCArPSB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksIHRoaXMuX2lzUm9vdE5vZGUodGhpcy5vZmZzZXRQYXJlbnRbMF0pICYmICh0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSksIHsgdG9wOiB0LnRvcCArIChwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlclRvcFdpZHRoIiksIDEwKSB8fCAwKSwgbGVmdDogdC5sZWZ0ICsgKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyTGVmdFdpZHRoIiksIDEwKSB8fCAwKSB9IH0sIF9nZXRSZWxhdGl2ZU9mZnNldDogZnVuY3Rpb24gKCkgeyBpZiAoInJlbGF0aXZlIiAhPT0gdGhpcy5jc3NQb3NpdGlvbikgcmV0dXJuIHsgdG9wOiAwLCBsZWZ0OiAwIH07IHZhciBlID0gdGhpcy5lbGVtZW50LnBvc2l0aW9uKCksIHQgPSB0aGlzLl9pc1Jvb3ROb2RlKHRoaXMuc2Nyb2xsUGFyZW50WzBdKTsgcmV0dXJuIHsgdG9wOiBlLnRvcCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoInRvcCIpLCAxMCkgfHwgMCkgKyAodCA/IDAgOiB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksIGxlZnQ6IGUubGVmdCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSwgMTApIHx8IDApICsgKHQgPyAwIDogdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpKSB9IH0sIF9jYWNoZU1hcmdpbnM6IGZ1bmN0aW9uICgpIHsgdGhpcy5tYXJnaW5zID0geyBsZWZ0OiBwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5MZWZ0IiksIDEwKSB8fCAwLCB0b3A6IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLCAxMCkgfHwgMCwgcmlnaHQ6IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblJpZ2h0IiksIDEwKSB8fCAwLCBib3R0b206IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpLCAxMCkgfHwgMCB9IH0sIF9jYWNoZUhlbHBlclByb3BvcnRpb25zOiBmdW5jdGlvbiAoKSB7IHRoaXMuaGVscGVyUHJvcG9ydGlvbnMgPSB7IHdpZHRoOiB0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksIGhlaWdodDogdGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKSB9IH0sIF9zZXRDb250YWlubWVudDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCwgaSwgcywgYSA9IHRoaXMub3B0aW9ucywgbiA9IHRoaXMuZG9jdW1lbnRbMF07IHJldHVybiB0aGlzLnJlbGF0aXZlQ29udGFpbmVyID0gbnVsbCwgYS5jb250YWlubWVudCA/ICJ3aW5kb3ciID09PSBhLmNvbnRhaW5tZW50ID8gKHRoaXMuY29udGFpbm1lbnQgPSBbZSh3aW5kb3cpLnNjcm9sbExlZnQoKSAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQgLSB0aGlzLm9mZnNldC5wYXJlbnQubGVmdCwgZSh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCwgZSh3aW5kb3cpLnNjcm9sbExlZnQoKSArIGUod2luZG93KS53aWR0aCgpIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0LCBlKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyAoZSh3aW5kb3cpLmhlaWdodCgpIHx8IG4uYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3BdLCB2b2lkIDApIDogImRvY3VtZW50IiA9PT0gYS5jb250YWlubWVudCA/ICh0aGlzLmNvbnRhaW5tZW50ID0gWzAsIDAsIGUobikud2lkdGgoKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwgKGUobikuaGVpZ2h0KCkgfHwgbi5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcF0sIHZvaWQgMCkgOiBhLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yID09PSBBcnJheSA/ICh0aGlzLmNvbnRhaW5tZW50ID0gYS5jb250YWlubWVudCwgdm9pZCAwKSA6ICgicGFyZW50IiA9PT0gYS5jb250YWlubWVudCAmJiAoYS5jb250YWlubWVudCA9IHRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUpLCBpID0gZShhLmNvbnRhaW5tZW50KSwgcyA9IGlbMF0sIHMgJiYgKHQgPSAvKHNjcm9sbHxhdXRvKS8udGVzdChpLmNzcygib3ZlcmZsb3ciKSksIHRoaXMuY29udGFpbm1lbnQgPSBbKHBhcnNlSW50KGkuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwgMTApIHx8IDApICsgKHBhcnNlSW50KGkuY3NzKCJwYWRkaW5nTGVmdCIpLCAxMCkgfHwgMCksIChwYXJzZUludChpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApICsgKHBhcnNlSW50KGkuY3NzKCJwYWRkaW5nVG9wIiksIDEwKSB8fCAwKSwgKHQgPyBNYXRoLm1heChzLnNjcm9sbFdpZHRoLCBzLm9mZnNldFdpZHRoKSA6IHMub2Zmc2V0V2lkdGgpIC0gKHBhcnNlSW50KGkuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksIDEwKSB8fCAwKSAtIChwYXJzZUludChpLmNzcygicGFkZGluZ1JpZ2h0IiksIDEwKSB8fCAwKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCAtIHRoaXMubWFyZ2lucy5yaWdodCwgKHQgPyBNYXRoLm1heChzLnNjcm9sbEhlaWdodCwgcy5vZmZzZXRIZWlnaHQpIDogcy5vZmZzZXRIZWlnaHQpIC0gKHBhcnNlSW50KGkuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLCAxMCkgfHwgMCkgLSAocGFyc2VJbnQoaS5jc3MoInBhZGRpbmdCb3R0b20iKSwgMTApIHx8IDApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSB0aGlzLm1hcmdpbnMudG9wIC0gdGhpcy5tYXJnaW5zLmJvdHRvbV0sIHRoaXMucmVsYXRpdmVDb250YWluZXIgPSBpKSwgdm9pZCAwKSA6ICh0aGlzLmNvbnRhaW5tZW50ID0gbnVsbCwgdm9pZCAwKQ0KICAgICAgICAgICAgICAgIH0sIF9jb252ZXJ0UG9zaXRpb25UbzogZnVuY3Rpb24gKGUsIHQpIHsgdCB8fCAodCA9IHRoaXMucG9zaXRpb24pOyB2YXIgaSA9ICJhYnNvbHV0ZSIgPT09IGUgPyAxIDogLTEsIHMgPSB0aGlzLl9pc1Jvb3ROb2RlKHRoaXMuc2Nyb2xsUGFyZW50WzBdKTsgcmV0dXJuIHsgdG9wOiB0LnRvcCArIHRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAqIGkgKyB0aGlzLm9mZnNldC5wYXJlbnQudG9wICogaSAtICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMub2Zmc2V0LnNjcm9sbC50b3AgOiBzID8gMCA6IHRoaXMub2Zmc2V0LnNjcm9sbC50b3ApICogaSwgbGVmdDogdC5sZWZ0ICsgdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAqIGkgKyB0aGlzLm9mZnNldC5wYXJlbnQubGVmdCAqIGkgLSAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLm9mZnNldC5zY3JvbGwubGVmdCA6IHMgPyAwIDogdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQpICogaSB9IH0sIF9nZW5lcmF0ZVBvc2l0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSwgcywgYSwgbiwgciA9IHRoaXMub3B0aW9ucywgbyA9IHRoaXMuX2lzUm9vdE5vZGUodGhpcy5zY3JvbGxQYXJlbnRbMF0pLCBsID0gZS5wYWdlWCwgaCA9IGUucGFnZVk7IHJldHVybiBvICYmIHRoaXMub2Zmc2V0LnNjcm9sbCB8fCAodGhpcy5vZmZzZXQuc2Nyb2xsID0geyB0b3A6IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLCBsZWZ0OiB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgfSksIHQgJiYgKHRoaXMuY29udGFpbm1lbnQgJiYgKHRoaXMucmVsYXRpdmVDb250YWluZXIgPyAocyA9IHRoaXMucmVsYXRpdmVDb250YWluZXIub2Zmc2V0KCksIGkgPSBbdGhpcy5jb250YWlubWVudFswXSArIHMubGVmdCwgdGhpcy5jb250YWlubWVudFsxXSArIHMudG9wLCB0aGlzLmNvbnRhaW5tZW50WzJdICsgcy5sZWZ0LCB0aGlzLmNvbnRhaW5tZW50WzNdICsgcy50b3BdKSA6IGkgPSB0aGlzLmNvbnRhaW5tZW50LCBlLnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8IGlbMF0gJiYgKGwgPSBpWzBdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCksIGUucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPCBpWzFdICYmIChoID0gaVsxXSArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCksIGUucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gaVsyXSAmJiAobCA9IGlbMl0gKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0KSwgZS5wYWdlWSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IGlbM10gJiYgKGggPSBpWzNdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wKSksIHIuZ3JpZCAmJiAoYSA9IHIuZ3JpZFsxXSA/IHRoaXMub3JpZ2luYWxQYWdlWSArIE1hdGgucm91bmQoKGggLSB0aGlzLm9yaWdpbmFsUGFnZVkpIC8gci5ncmlkWzFdKSAqIHIuZ3JpZFsxXSA6IHRoaXMub3JpZ2luYWxQYWdlWSwgaCA9IGkgPyBhIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID49IGlbMV0gfHwgYSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IGlbM10gPyBhIDogYSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSBpWzFdID8gYSAtIHIuZ3JpZFsxXSA6IGEgKyByLmdyaWRbMV0gOiBhLCBuID0gci5ncmlkWzBdID8gdGhpcy5vcmlnaW5hbFBhZ2VYICsgTWF0aC5yb3VuZCgobCAtIHRoaXMub3JpZ2luYWxQYWdlWCkgLyByLmdyaWRbMF0pICogci5ncmlkWzBdIDogdGhpcy5vcmlnaW5hbFBhZ2VYLCBsID0gaSA/IG4gLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IGlbMF0gfHwgbiAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPiBpWzJdID8gbiA6IG4gLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IGlbMF0gPyBuIC0gci5ncmlkWzBdIDogbiArIHIuZ3JpZFswXSA6IG4pLCAieSIgPT09IHIuYXhpcyAmJiAobCA9IHRoaXMub3JpZ2luYWxQYWdlWCksICJ4IiA9PT0gci5heGlzICYmIChoID0gdGhpcy5vcmlnaW5hbFBhZ2VZKSksIHsgdG9wOiBoIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCArICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMub2Zmc2V0LnNjcm9sbC50b3AgOiBvID8gMCA6IHRoaXMub2Zmc2V0LnNjcm9sbC50b3ApLCBsZWZ0OiBsIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQgLSB0aGlzLm9mZnNldC5wYXJlbnQubGVmdCArICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMub2Zmc2V0LnNjcm9sbC5sZWZ0IDogbyA/IDAgOiB0aGlzLm9mZnNldC5zY3JvbGwubGVmdCkgfSB9LCBfY2xlYXI6IGZ1bmN0aW9uICgpIHsgdGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5oZWxwZXIsICJ1aS1kcmFnZ2FibGUtZHJhZ2dpbmciKSwgdGhpcy5oZWxwZXJbMF0gPT09IHRoaXMuZWxlbWVudFswXSB8fCB0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwgfHwgdGhpcy5oZWxwZXIucmVtb3ZlKCksIHRoaXMuaGVscGVyID0gbnVsbCwgdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsID0gITEsIHRoaXMuZGVzdHJveU9uQ2xlYXIgJiYgdGhpcy5kZXN0cm95KCkgfSwgX3RyaWdnZXI6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHJldHVybiBzID0gcyB8fCB0aGlzLl91aUhhc2goKSwgZS51aS5wbHVnaW4uY2FsbCh0aGlzLCB0LCBbaSwgcywgdGhpc10sICEwKSwgL14oZHJhZ3xzdGFydHxzdG9wKS8udGVzdCh0KSAmJiAodGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpLCBzLm9mZnNldCA9IHRoaXMucG9zaXRpb25BYnMpLCBlLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuY2FsbCh0aGlzLCB0LCBpLCBzKSB9LCBwbHVnaW5zOiB7fSwgX3VpSGFzaDogZnVuY3Rpb24gKCkgeyByZXR1cm4geyBoZWxwZXI6IHRoaXMuaGVscGVyLCBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwgb3JpZ2luYWxQb3NpdGlvbjogdGhpcy5vcmlnaW5hbFBvc2l0aW9uLCBvZmZzZXQ6IHRoaXMucG9zaXRpb25BYnMgfSB9DQogICAgICAgICAgICB9KSwgZS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAiY29ubmVjdFRvU29ydGFibGUiLCB7IHN0YXJ0OiBmdW5jdGlvbiAodCwgaSwgcykgeyB2YXIgYSA9IGUuZXh0ZW5kKHt9LCBpLCB7IGl0ZW06IHMuZWxlbWVudCB9KTsgcy5zb3J0YWJsZXMgPSBbXSwgZShzLm9wdGlvbnMuY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgaSA9IGUodGhpcykuc29ydGFibGUoImluc3RhbmNlIik7IGkgJiYgIWkub3B0aW9ucy5kaXNhYmxlZCAmJiAocy5zb3J0YWJsZXMucHVzaChpKSwgaS5yZWZyZXNoUG9zaXRpb25zKCksIGkuX3RyaWdnZXIoImFjdGl2YXRlIiwgdCwgYSkpIH0pIH0sIHN0b3A6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gZS5leHRlbmQoe30sIGksIHsgaXRlbTogcy5lbGVtZW50IH0pOyBzLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMSwgZS5lYWNoKHMuc29ydGFibGVzLCBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpczsgZS5pc092ZXIgPyAoZS5pc092ZXIgPSAwLCBzLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMCwgZS5jYW5jZWxIZWxwZXJSZW1vdmFsID0gITEsIGUuX3N0b3JlZENTUyA9IHsgcG9zaXRpb246IGUucGxhY2Vob2xkZXIuY3NzKCJwb3NpdGlvbiIpLCB0b3A6IGUucGxhY2Vob2xkZXIuY3NzKCJ0b3AiKSwgbGVmdDogZS5wbGFjZWhvbGRlci5jc3MoImxlZnQiKSB9LCBlLl9tb3VzZVN0b3AodCksIGUub3B0aW9ucy5oZWxwZXIgPSBlLm9wdGlvbnMuX2hlbHBlcikgOiAoZS5jYW5jZWxIZWxwZXJSZW1vdmFsID0gITAsIGUuX3RyaWdnZXIoImRlYWN0aXZhdGUiLCB0LCBhKSkgfSkgfSwgZHJhZzogZnVuY3Rpb24gKHQsIGksIHMpIHsgZS5lYWNoKHMuc29ydGFibGVzLCBmdW5jdGlvbiAoKSB7IHZhciBhID0gITEsIG4gPSB0aGlzOyBuLnBvc2l0aW9uQWJzID0gcy5wb3NpdGlvbkFicywgbi5oZWxwZXJQcm9wb3J0aW9ucyA9IHMuaGVscGVyUHJvcG9ydGlvbnMsIG4ub2Zmc2V0LmNsaWNrID0gcy5vZmZzZXQuY2xpY2ssIG4uX2ludGVyc2VjdHNXaXRoKG4uY29udGFpbmVyQ2FjaGUpICYmIChhID0gITAsIGUuZWFjaChzLnNvcnRhYmxlcywgZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5wb3NpdGlvbkFicyA9IHMucG9zaXRpb25BYnMsIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMgPSBzLmhlbHBlclByb3BvcnRpb25zLCB0aGlzLm9mZnNldC5jbGljayA9IHMub2Zmc2V0LmNsaWNrLCB0aGlzICE9PSBuICYmIHRoaXMuX2ludGVyc2VjdHNXaXRoKHRoaXMuY29udGFpbmVyQ2FjaGUpICYmIGUuY29udGFpbnMobi5lbGVtZW50WzBdLCB0aGlzLmVsZW1lbnRbMF0pICYmIChhID0gITEpLCBhIH0pKSwgYSA/IChuLmlzT3ZlciB8fCAobi5pc092ZXIgPSAxLCBzLl9wYXJlbnQgPSBpLmhlbHBlci5wYXJlbnQoKSwgbi5jdXJyZW50SXRlbSA9IGkuaGVscGVyLmFwcGVuZFRvKG4uZWxlbWVudCkuZGF0YSgidWktc29ydGFibGUtaXRlbSIsICEwKSwgbi5vcHRpb25zLl9oZWxwZXIgPSBuLm9wdGlvbnMuaGVscGVyLCBuLm9wdGlvbnMuaGVscGVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaS5oZWxwZXJbMF0gfSwgdC50YXJnZXQgPSBuLmN1cnJlbnRJdGVtWzBdLCBuLl9tb3VzZUNhcHR1cmUodCwgITApLCBuLl9tb3VzZVN0YXJ0KHQsICEwLCAhMCksIG4ub2Zmc2V0LmNsaWNrLnRvcCA9IHMub2Zmc2V0LmNsaWNrLnRvcCwgbi5vZmZzZXQuY2xpY2subGVmdCA9IHMub2Zmc2V0LmNsaWNrLmxlZnQsIG4ub2Zmc2V0LnBhcmVudC5sZWZ0IC09IHMub2Zmc2V0LnBhcmVudC5sZWZ0IC0gbi5vZmZzZXQucGFyZW50LmxlZnQsIG4ub2Zmc2V0LnBhcmVudC50b3AgLT0gcy5vZmZzZXQucGFyZW50LnRvcCAtIG4ub2Zmc2V0LnBhcmVudC50b3AsIHMuX3RyaWdnZXIoInRvU29ydGFibGUiLCB0KSwgcy5kcm9wcGVkID0gbi5lbGVtZW50LCBlLmVhY2gocy5zb3J0YWJsZXMsIGZ1bmN0aW9uICgpIHsgdGhpcy5yZWZyZXNoUG9zaXRpb25zKCkgfSksIHMuY3VycmVudEl0ZW0gPSBzLmVsZW1lbnQsIG4uZnJvbU91dHNpZGUgPSBzKSwgbi5jdXJyZW50SXRlbSAmJiAobi5fbW91c2VEcmFnKHQpLCBpLnBvc2l0aW9uID0gbi5wb3NpdGlvbikpIDogbi5pc092ZXIgJiYgKG4uaXNPdmVyID0gMCwgbi5jYW5jZWxIZWxwZXJSZW1vdmFsID0gITAsIG4ub3B0aW9ucy5fcmV2ZXJ0ID0gbi5vcHRpb25zLnJldmVydCwgbi5vcHRpb25zLnJldmVydCA9ICExLCBuLl90cmlnZ2VyKCJvdXQiLCB0LCBuLl91aUhhc2gobikpLCBuLl9tb3VzZVN0b3AodCwgITApLCBuLm9wdGlvbnMucmV2ZXJ0ID0gbi5vcHRpb25zLl9yZXZlcnQsIG4ub3B0aW9ucy5oZWxwZXIgPSBuLm9wdGlvbnMuX2hlbHBlciwgbi5wbGFjZWhvbGRlciAmJiBuLnBsYWNlaG9sZGVyLnJlbW92ZSgpLCBpLmhlbHBlci5hcHBlbmRUbyhzLl9wYXJlbnQpLCBzLl9yZWZyZXNoT2Zmc2V0cyh0KSwgaS5wb3NpdGlvbiA9IHMuX2dlbmVyYXRlUG9zaXRpb24odCwgITApLCBzLl90cmlnZ2VyKCJmcm9tU29ydGFibGUiLCB0KSwgcy5kcm9wcGVkID0gITEsIGUuZWFjaChzLnNvcnRhYmxlcywgZnVuY3Rpb24gKCkgeyB0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKSB9KSkgfSkgfSB9KSwgZS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAiY3Vyc29yIiwgeyBzdGFydDogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEgPSBlKCJib2R5IiksIG4gPSBzLm9wdGlvbnM7IGEuY3NzKCJjdXJzb3IiKSAmJiAobi5fY3Vyc29yID0gYS5jc3MoImN1cnNvciIpKSwgYS5jc3MoImN1cnNvciIsIG4uY3Vyc29yKSB9LCBzdG9wOiBmdW5jdGlvbiAodCwgaSwgcykgeyB2YXIgYSA9IHMub3B0aW9uczsgYS5fY3Vyc29yICYmIGUoImJvZHkiKS5jc3MoImN1cnNvciIsIGEuX2N1cnNvcikgfSB9KSwgZS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAib3BhY2l0eSIsIHsgc3RhcnQ6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gZShpLmhlbHBlciksIG4gPSBzLm9wdGlvbnM7IGEuY3NzKCJvcGFjaXR5IikgJiYgKG4uX29wYWNpdHkgPSBhLmNzcygib3BhY2l0eSIpKSwgYS5jc3MoIm9wYWNpdHkiLCBuLm9wYWNpdHkpIH0sIHN0b3A6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gcy5vcHRpb25zOyBhLl9vcGFjaXR5ICYmIGUoaS5oZWxwZXIpLmNzcygib3BhY2l0eSIsIGEuX29wYWNpdHkpIH0gfSksIGUudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInNjcm9sbCIsIHsgc3RhcnQ6IGZ1bmN0aW9uIChlLCB0LCBpKSB7IGkuc2Nyb2xsUGFyZW50Tm90SGlkZGVuIHx8IChpLnNjcm9sbFBhcmVudE5vdEhpZGRlbiA9IGkuaGVscGVyLnNjcm9sbFBhcmVudCghMSkpLCBpLnNjcm9sbFBhcmVudE5vdEhpZGRlblswXSAhPT0gaS5kb2N1bWVudFswXSAmJiAiSFRNTCIgIT09IGkuc2Nyb2xsUGFyZW50Tm90SGlkZGVuWzBdLnRhZ05hbWUgJiYgKGkub3ZlcmZsb3dPZmZzZXQgPSBpLnNjcm9sbFBhcmVudE5vdEhpZGRlbi5vZmZzZXQoKSkgfSwgZHJhZzogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEgPSBzLm9wdGlvbnMsIG4gPSAhMSwgciA9IHMuc2Nyb2xsUGFyZW50Tm90SGlkZGVuWzBdLCBvID0gcy5kb2N1bWVudFswXTsgciAhPT0gbyAmJiAiSFRNTCIgIT09IHIudGFnTmFtZSA/IChhLmF4aXMgJiYgIngiID09PSBhLmF4aXMgfHwgKHMub3ZlcmZsb3dPZmZzZXQudG9wICsgci5vZmZzZXRIZWlnaHQgLSB0LnBhZ2VZIDwgYS5zY3JvbGxTZW5zaXRpdml0eSA/IHIuc2Nyb2xsVG9wID0gbiA9IHIuc2Nyb2xsVG9wICsgYS5zY3JvbGxTcGVlZCA6IHQucGFnZVkgLSBzLm92ZXJmbG93T2Zmc2V0LnRvcCA8IGEuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKHIuc2Nyb2xsVG9wID0gbiA9IHIuc2Nyb2xsVG9wIC0gYS5zY3JvbGxTcGVlZCkpLCBhLmF4aXMgJiYgInkiID09PSBhLmF4aXMgfHwgKHMub3ZlcmZsb3dPZmZzZXQubGVmdCArIHIub2Zmc2V0V2lkdGggLSB0LnBhZ2VYIDwgYS5zY3JvbGxTZW5zaXRpdml0eSA/IHIuc2Nyb2xsTGVmdCA9IG4gPSByLnNjcm9sbExlZnQgKyBhLnNjcm9sbFNwZWVkIDogdC5wYWdlWCAtIHMub3ZlcmZsb3dPZmZzZXQubGVmdCA8IGEuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKHIuc2Nyb2xsTGVmdCA9IG4gPSByLnNjcm9sbExlZnQgLSBhLnNjcm9sbFNwZWVkKSkpIDogKGEuYXhpcyAmJiAieCIgPT09IGEuYXhpcyB8fCAodC5wYWdlWSAtIGUobykuc2Nyb2xsVG9wKCkgPCBhLnNjcm9sbFNlbnNpdGl2aXR5ID8gbiA9IGUobykuc2Nyb2xsVG9wKGUobykuc2Nyb2xsVG9wKCkgLSBhLnNjcm9sbFNwZWVkKSA6IGUod2luZG93KS5oZWlnaHQoKSAtICh0LnBhZ2VZIC0gZShvKS5zY3JvbGxUb3AoKSkgPCBhLnNjcm9sbFNlbnNpdGl2aXR5ICYmIChuID0gZShvKS5zY3JvbGxUb3AoZShvKS5zY3JvbGxUb3AoKSArIGEuc2Nyb2xsU3BlZWQpKSksIGEuYXhpcyAmJiAieSIgPT09IGEuYXhpcyB8fCAodC5wYWdlWCAtIGUobykuc2Nyb2xsTGVmdCgpIDwgYS5zY3JvbGxTZW5zaXRpdml0eSA/IG4gPSBlKG8pLnNjcm9sbExlZnQoZShvKS5zY3JvbGxMZWZ0KCkgLSBhLnNjcm9sbFNwZWVkKSA6IGUod2luZG93KS53aWR0aCgpIC0gKHQucGFnZVggLSBlKG8pLnNjcm9sbExlZnQoKSkgPCBhLnNjcm9sbFNlbnNpdGl2aXR5ICYmIChuID0gZShvKS5zY3JvbGxMZWZ0KGUobykuc2Nyb2xsTGVmdCgpICsgYS5zY3JvbGxTcGVlZCkpKSksIG4gIT09ICExICYmIGUudWkuZGRtYW5hZ2VyICYmICFhLmRyb3BCZWhhdmlvdXIgJiYgZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMocywgdCkgfSB9KSwgZS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic25hcCIsIHsgc3RhcnQ6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gcy5vcHRpb25zOyBzLnNuYXBFbGVtZW50cyA9IFtdLCBlKGEuc25hcC5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nID8gYS5zbmFwLml0ZW1zIHx8ICI6ZGF0YSh1aS1kcmFnZ2FibGUpIiA6IGEuc25hcCkuZWFjaChmdW5jdGlvbiAoKSB7IHZhciB0ID0gZSh0aGlzKSwgaSA9IHQub2Zmc2V0KCk7IHRoaXMgIT09IHMuZWxlbWVudFswXSAmJiBzLnNuYXBFbGVtZW50cy5wdXNoKHsgaXRlbTogdGhpcywgd2lkdGg6IHQub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6IHQub3V0ZXJIZWlnaHQoKSwgdG9wOiBpLnRvcCwgbGVmdDogaS5sZWZ0IH0pIH0pIH0sIGRyYWc6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuLCByLCBvLCBsLCBoLCB1LCBkLCBjLCBwLCBtID0gcy5vcHRpb25zLCBmID0gbS5zbmFwVG9sZXJhbmNlLCBnID0gaS5vZmZzZXQubGVmdCwgdiA9IGcgKyBzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLCB5ID0gaS5vZmZzZXQudG9wLCBfID0geSArIHMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0OyBmb3IgKGMgPSBzLnNuYXBFbGVtZW50cy5sZW5ndGggLSAxOyBjID49IDA7IGMtLSlsID0gcy5zbmFwRWxlbWVudHNbY10ubGVmdCAtIHMubWFyZ2lucy5sZWZ0LCBoID0gbCArIHMuc25hcEVsZW1lbnRzW2NdLndpZHRoLCB1ID0gcy5zbmFwRWxlbWVudHNbY10udG9wIC0gcy5tYXJnaW5zLnRvcCwgZCA9IHUgKyBzLnNuYXBFbGVtZW50c1tjXS5oZWlnaHQsIGwgLSBmID4gdiB8fCBnID4gaCArIGYgfHwgdSAtIGYgPiBfIHx8IHkgPiBkICsgZiB8fCAhZS5jb250YWlucyhzLnNuYXBFbGVtZW50c1tjXS5pdGVtLm93bmVyRG9jdW1lbnQsIHMuc25hcEVsZW1lbnRzW2NdLml0ZW0pID8gKHMuc25hcEVsZW1lbnRzW2NdLnNuYXBwaW5nICYmIHMub3B0aW9ucy5zbmFwLnJlbGVhc2UgJiYgcy5vcHRpb25zLnNuYXAucmVsZWFzZS5jYWxsKHMuZWxlbWVudCwgdCwgZS5leHRlbmQocy5fdWlIYXNoKCksIHsgc25hcEl0ZW06IHMuc25hcEVsZW1lbnRzW2NdLml0ZW0gfSkpLCBzLnNuYXBFbGVtZW50c1tjXS5zbmFwcGluZyA9ICExKSA6ICgiaW5uZXIiICE9PSBtLnNuYXBNb2RlICYmIChhID0gZiA+PSBNYXRoLmFicyh1IC0gXyksIG4gPSBmID49IE1hdGguYWJzKGQgLSB5KSwgciA9IGYgPj0gTWF0aC5hYnMobCAtIHYpLCBvID0gZiA+PSBNYXRoLmFicyhoIC0gZyksIGEgJiYgKGkucG9zaXRpb24udG9wID0gcy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IHUgLSBzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCwgbGVmdDogMCB9KS50b3ApLCBuICYmIChpLnBvc2l0aW9uLnRvcCA9IHMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiBkLCBsZWZ0OiAwIH0pLnRvcCksIHIgJiYgKGkucG9zaXRpb24ubGVmdCA9IHMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiAwLCBsZWZ0OiBsIC0gcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCB9KS5sZWZ0KSwgbyAmJiAoaS5wb3NpdGlvbi5sZWZ0ID0gcy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IDAsIGxlZnQ6IGggfSkubGVmdCkpLCBwID0gYSB8fCBuIHx8IHIgfHwgbywgIm91dGVyIiAhPT0gbS5zbmFwTW9kZSAmJiAoYSA9IGYgPj0gTWF0aC5hYnModSAtIHkpLCBuID0gZiA+PSBNYXRoLmFicyhkIC0gXyksIHIgPSBmID49IE1hdGguYWJzKGwgLSBnKSwgbyA9IGYgPj0gTWF0aC5hYnMoaCAtIHYpLCBhICYmIChpLnBvc2l0aW9uLnRvcCA9IHMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiB1LCBsZWZ0OiAwIH0pLnRvcCksIG4gJiYgKGkucG9zaXRpb24udG9wID0gcy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IGQgLSBzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCwgbGVmdDogMCB9KS50b3ApLCByICYmIChpLnBvc2l0aW9uLmxlZnQgPSBzLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogbCB9KS5sZWZ0KSwgbyAmJiAoaS5wb3NpdGlvbi5sZWZ0ID0gcy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IDAsIGxlZnQ6IGggLSBzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIH0pLmxlZnQpKSwgIXMuc25hcEVsZW1lbnRzW2NdLnNuYXBwaW5nICYmIChhIHx8IG4gfHwgciB8fCBvIHx8IHApICYmIHMub3B0aW9ucy5zbmFwLnNuYXAgJiYgcy5vcHRpb25zLnNuYXAuc25hcC5jYWxsKHMuZWxlbWVudCwgdCwgZS5leHRlbmQocy5fdWlIYXNoKCksIHsgc25hcEl0ZW06IHMuc25hcEVsZW1lbnRzW2NdLml0ZW0gfSkpLCBzLnNuYXBFbGVtZW50c1tjXS5zbmFwcGluZyA9IGEgfHwgbiB8fCByIHx8IG8gfHwgcCkgfSB9KSwgZS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic3RhY2siLCB7IHN0YXJ0OiBmdW5jdGlvbiAodCwgaSwgcykgeyB2YXIgYSwgbiA9IHMub3B0aW9ucywgciA9IGUubWFrZUFycmF5KGUobi5zdGFjaykpLnNvcnQoZnVuY3Rpb24gKHQsIGkpIHsgcmV0dXJuIChwYXJzZUludChlKHQpLmNzcygiekluZGV4IiksIDEwKSB8fCAwKSAtIChwYXJzZUludChlKGkpLmNzcygiekluZGV4IiksIDEwKSB8fCAwKSB9KTsgci5sZW5ndGggJiYgKGEgPSBwYXJzZUludChlKHJbMF0pLmNzcygiekluZGV4IiksIDEwKSB8fCAwLCBlKHIpLmVhY2goZnVuY3Rpb24gKHQpIHsgZSh0aGlzKS5jc3MoInpJbmRleCIsIGEgKyB0KSB9KSwgdGhpcy5jc3MoInpJbmRleCIsIGEgKyByLmxlbmd0aCkpIH0gfSksIGUudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInpJbmRleCIsIHsgc3RhcnQ6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gZShpLmhlbHBlciksIG4gPSBzLm9wdGlvbnM7IGEuY3NzKCJ6SW5kZXgiKSAmJiAobi5fekluZGV4ID0gYS5jc3MoInpJbmRleCIpKSwgYS5jc3MoInpJbmRleCIsIG4uekluZGV4KSB9LCBzdG9wOiBmdW5jdGlvbiAodCwgaSwgcykgeyB2YXIgYSA9IHMub3B0aW9uczsgYS5fekluZGV4ICYmIGUoaS5oZWxwZXIpLmNzcygiekluZGV4IiwgYS5fekluZGV4KSB9IH0pLCBlLnVpLmRyYWdnYWJsZSwgZS53aWRnZXQoInVpLmRyb3BwYWJsZSIsIHsgdmVyc2lvbjogIjEuMTIuMSIsIHdpZGdldEV2ZW50UHJlZml4OiAiZHJvcCIsIG9wdGlvbnM6IHsgYWNjZXB0OiAiKiIsIGFkZENsYXNzZXM6ICEwLCBncmVlZHk6ICExLCBzY29wZTogImRlZmF1bHQiLCB0b2xlcmFuY2U6ICJpbnRlcnNlY3QiLCBhY3RpdmF0ZTogbnVsbCwgZGVhY3RpdmF0ZTogbnVsbCwgZHJvcDogbnVsbCwgb3V0OiBudWxsLCBvdmVyOiBudWxsIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGkgPSB0aGlzLm9wdGlvbnMsIHMgPSBpLmFjY2VwdDsgdGhpcy5pc292ZXIgPSAhMSwgdGhpcy5pc291dCA9ICEwLCB0aGlzLmFjY2VwdCA9IGUuaXNGdW5jdGlvbihzKSA/IHMgOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pcyhzKSB9LCB0aGlzLnByb3BvcnRpb25zID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0ID0gYXJndW1lbnRzWzBdLCB2b2lkIDApIDogdCA/IHQgOiB0ID0geyB3aWR0aDogdGhpcy5lbGVtZW50WzBdLm9mZnNldFdpZHRoLCBoZWlnaHQ6IHRoaXMuZWxlbWVudFswXS5vZmZzZXRIZWlnaHQgfSB9LCB0aGlzLl9hZGRUb01hbmFnZXIoaS5zY29wZSksIGkuYWRkQ2xhc3NlcyAmJiB0aGlzLl9hZGRDbGFzcygidWktZHJvcHBhYmxlIikgfSwgX2FkZFRvTWFuYWdlcjogZnVuY3Rpb24gKHQpIHsgZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0XSA9IGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdF0gfHwgW10sIGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdF0ucHVzaCh0aGlzKSB9LCBfc3BsaWNlOiBmdW5jdGlvbiAoZSkgeyBmb3IgKHZhciB0ID0gMDsgZS5sZW5ndGggPiB0OyB0KyspZVt0XSA9PT0gdGhpcyAmJiBlLnNwbGljZSh0LCAxKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXTsgdGhpcy5fc3BsaWNlKHQpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uICh0LCBpKSB7IGlmICgiYWNjZXB0IiA9PT0gdCkgdGhpcy5hY2NlcHQgPSBlLmlzRnVuY3Rpb24oaSkgPyBpIDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuaXMoaSkgfTsgZWxzZSBpZiAoInNjb3BlIiA9PT0gdCkgeyB2YXIgcyA9IGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXTsgdGhpcy5fc3BsaWNlKHMpLCB0aGlzLl9hZGRUb01hbmFnZXIoaSkgfSB0aGlzLl9zdXBlcih0LCBpKSB9LCBfYWN0aXZhdGU6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gZS51aS5kZG1hbmFnZXIuY3VycmVudDsgdGhpcy5fYWRkQWN0aXZlQ2xhc3MoKSwgaSAmJiB0aGlzLl90cmlnZ2VyKCJhY3RpdmF0ZSIsIHQsIHRoaXMudWkoaSkpIH0sIF9kZWFjdGl2YXRlOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7IHRoaXMuX3JlbW92ZUFjdGl2ZUNsYXNzKCksIGkgJiYgdGhpcy5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIHQsIHRoaXMudWkoaSkpIH0sIF9vdmVyOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7IGkgJiYgKGkuY3VycmVudEl0ZW0gfHwgaS5lbGVtZW50KVswXSAhPT0gdGhpcy5lbGVtZW50WzBdICYmIHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLCBpLmN1cnJlbnRJdGVtIHx8IGkuZWxlbWVudCkgJiYgKHRoaXMuX2FkZEhvdmVyQ2xhc3MoKSwgdGhpcy5fdHJpZ2dlcigib3ZlciIsIHQsIHRoaXMudWkoaSkpKSB9LCBfb3V0OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7IGkgJiYgKGkuY3VycmVudEl0ZW0gfHwgaS5lbGVtZW50KVswXSAhPT0gdGhpcy5lbGVtZW50WzBdICYmIHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLCBpLmN1cnJlbnRJdGVtIHx8IGkuZWxlbWVudCkgJiYgKHRoaXMuX3JlbW92ZUhvdmVyQ2xhc3MoKSwgdGhpcy5fdHJpZ2dlcigib3V0IiwgdCwgdGhpcy51aShpKSkpIH0sIF9kcm9wOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IGkgfHwgZS51aS5kZG1hbmFnZXIuY3VycmVudCwgYSA9ICExOyByZXR1cm4gcyAmJiAocy5jdXJyZW50SXRlbSB8fCBzLmVsZW1lbnQpWzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gPyAodGhpcy5lbGVtZW50LmZpbmQoIjpkYXRhKHVpLWRyb3BwYWJsZSkiKS5ub3QoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGkgPSBlKHRoaXMpLmRyb3BwYWJsZSgiaW5zdGFuY2UiKTsgcmV0dXJuIGkub3B0aW9ucy5ncmVlZHkgJiYgIWkub3B0aW9ucy5kaXNhYmxlZCAmJiBpLm9wdGlvbnMuc2NvcGUgPT09IHMub3B0aW9ucy5zY29wZSAmJiBpLmFjY2VwdC5jYWxsKGkuZWxlbWVudFswXSwgcy5jdXJyZW50SXRlbSB8fCBzLmVsZW1lbnQpICYmIGQocywgZS5leHRlbmQoaSwgeyBvZmZzZXQ6IGkuZWxlbWVudC5vZmZzZXQoKSB9KSwgaS5vcHRpb25zLnRvbGVyYW5jZSwgdCkgPyAoYSA9ICEwLCAhMSkgOiB2b2lkIDAgfSksIGEgPyAhMSA6IHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLCBzLmN1cnJlbnRJdGVtIHx8IHMuZWxlbWVudCkgPyAodGhpcy5fcmVtb3ZlQWN0aXZlQ2xhc3MoKSwgdGhpcy5fcmVtb3ZlSG92ZXJDbGFzcygpLCB0aGlzLl90cmlnZ2VyKCJkcm9wIiwgdCwgdGhpcy51aShzKSksIHRoaXMuZWxlbWVudCkgOiAhMSkgOiAhMSB9LCB1aTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHsgZHJhZ2dhYmxlOiBlLmN1cnJlbnRJdGVtIHx8IGUuZWxlbWVudCwgaGVscGVyOiBlLmhlbHBlciwgcG9zaXRpb246IGUucG9zaXRpb24sIG9mZnNldDogZS5wb3NpdGlvbkFicyB9IH0sIF9hZGRIb3ZlckNsYXNzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX2FkZENsYXNzKCJ1aS1kcm9wcGFibGUtaG92ZXIiKSB9LCBfcmVtb3ZlSG92ZXJDbGFzczogZnVuY3Rpb24gKCkgeyB0aGlzLl9yZW1vdmVDbGFzcygidWktZHJvcHBhYmxlLWhvdmVyIikgfSwgX2FkZEFjdGl2ZUNsYXNzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX2FkZENsYXNzKCJ1aS1kcm9wcGFibGUtYWN0aXZlIikgfSwgX3JlbW92ZUFjdGl2ZUNsYXNzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlbW92ZUNsYXNzKCJ1aS1kcm9wcGFibGUtYWN0aXZlIikgfSB9KTsgdmFyIGQgPSBlLnVpLmludGVyc2VjdCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZShlLCB0LCBpKSB7IHJldHVybiBlID49IHQgJiYgdCArIGkgPiBlIH0gcmV0dXJuIGZ1bmN0aW9uICh0LCBpLCBzLCBhKSB7IGlmICghaS5vZmZzZXQpIHJldHVybiAhMTsgdmFyIG4gPSAodC5wb3NpdGlvbkFicyB8fCB0LnBvc2l0aW9uLmFic29sdXRlKS5sZWZ0ICsgdC5tYXJnaW5zLmxlZnQsIHIgPSAodC5wb3NpdGlvbkFicyB8fCB0LnBvc2l0aW9uLmFic29sdXRlKS50b3AgKyB0Lm1hcmdpbnMudG9wLCBvID0gbiArIHQuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsIGwgPSByICsgdC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsIGggPSBpLm9mZnNldC5sZWZ0LCB1ID0gaS5vZmZzZXQudG9wLCBkID0gaCArIGkucHJvcG9ydGlvbnMoKS53aWR0aCwgYyA9IHUgKyBpLnByb3BvcnRpb25zKCkuaGVpZ2h0OyBzd2l0Y2ggKHMpIHsgY2FzZSAiZml0IjogcmV0dXJuIG4gPj0gaCAmJiBkID49IG8gJiYgciA+PSB1ICYmIGMgPj0gbDsgY2FzZSAiaW50ZXJzZWN0IjogcmV0dXJuIG4gKyB0LmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMiA+IGggJiYgZCA+IG8gLSB0LmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMiAmJiByICsgdC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLyAyID4gdSAmJiBjID4gbCAtIHQuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC8gMjsgY2FzZSAicG9pbnRlciI6IHJldHVybiBlKGEucGFnZVksIHUsIGkucHJvcG9ydGlvbnMoKS5oZWlnaHQpICYmIGUoYS5wYWdlWCwgaCwgaS5wcm9wb3J0aW9ucygpLndpZHRoKTsgY2FzZSAidG91Y2giOiByZXR1cm4gKHIgPj0gdSAmJiBjID49IHIgfHwgbCA+PSB1ICYmIGMgPj0gbCB8fCB1ID4gciAmJiBsID4gYykgJiYgKG4gPj0gaCAmJiBkID49IG4gfHwgbyA+PSBoICYmIGQgPj0gbyB8fCBoID4gbiAmJiBvID4gZCk7IGRlZmF1bHQ6IHJldHVybiAhMSB9IH0gfSgpOyBlLnVpLmRkbWFuYWdlciA9IHsgY3VycmVudDogbnVsbCwgZHJvcHBhYmxlczogeyAiZGVmYXVsdCI6IFtdIH0sIHByZXBhcmVPZmZzZXRzOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSwgbiA9IGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdC5vcHRpb25zLnNjb3BlXSB8fCBbXSwgciA9IGkgPyBpLnR5cGUgOiBudWxsLCBvID0gKHQuY3VycmVudEl0ZW0gfHwgdC5lbGVtZW50KS5maW5kKCI6ZGF0YSh1aS1kcm9wcGFibGUpIikuYWRkQmFjaygpOyBlOiBmb3IgKHMgPSAwOyBuLmxlbmd0aCA+IHM7IHMrKylpZiAoIShuW3NdLm9wdGlvbnMuZGlzYWJsZWQgfHwgdCAmJiAhbltzXS5hY2NlcHQuY2FsbChuW3NdLmVsZW1lbnRbMF0sIHQuY3VycmVudEl0ZW0gfHwgdC5lbGVtZW50KSkpIHsgZm9yIChhID0gMDsgby5sZW5ndGggPiBhOyBhKyspaWYgKG9bYV0gPT09IG5bc10uZWxlbWVudFswXSkgeyBuW3NdLnByb3BvcnRpb25zKCkuaGVpZ2h0ID0gMDsgY29udGludWUgZSB9IG5bc10udmlzaWJsZSA9ICJub25lIiAhPT0gbltzXS5lbGVtZW50LmNzcygiZGlzcGxheSIpLCBuW3NdLnZpc2libGUgJiYgKCJtb3VzZWRvd24iID09PSByICYmIG5bc10uX2FjdGl2YXRlLmNhbGwobltzXSwgaSksIG5bc10ub2Zmc2V0ID0gbltzXS5lbGVtZW50Lm9mZnNldCgpLCBuW3NdLnByb3BvcnRpb25zKHsgd2lkdGg6IG5bc10uZWxlbWVudFswXS5vZmZzZXRXaWR0aCwgaGVpZ2h0OiBuW3NdLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0IH0pKSB9IH0sIGRyb3A6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gITE7IHJldHVybiBlLmVhY2goKGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdC5vcHRpb25zLnNjb3BlXSB8fCBbXSkuc2xpY2UoKSwgZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbnMgJiYgKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy52aXNpYmxlICYmIGQodCwgdGhpcywgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSwgaSkgJiYgKHMgPSB0aGlzLl9kcm9wLmNhbGwodGhpcywgaSkgfHwgcyksICF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy52aXNpYmxlICYmIHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLCB0LmN1cnJlbnRJdGVtIHx8IHQuZWxlbWVudCkgJiYgKHRoaXMuaXNvdXQgPSAhMCwgdGhpcy5pc292ZXIgPSAhMSwgdGhpcy5fZGVhY3RpdmF0ZS5jYWxsKHRoaXMsIGkpKSkgfSksIHMgfSwgZHJhZ1N0YXJ0OiBmdW5jdGlvbiAodCwgaSkgeyB0LmVsZW1lbnQucGFyZW50c1VudGlsKCJib2R5Iikub24oInNjcm9sbC5kcm9wcGFibGUiLCBmdW5jdGlvbiAoKSB7IHQub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zIHx8IGUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHQsIGkpIH0pIH0sIGRyYWc6IGZ1bmN0aW9uICh0LCBpKSB7IHQub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zICYmIGUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHQsIGkpLCBlLmVhY2goZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0Lm9wdGlvbnMuc2NvcGVdIHx8IFtdLCBmdW5jdGlvbiAoKSB7IGlmICghdGhpcy5vcHRpb25zLmRpc2FibGVkICYmICF0aGlzLmdyZWVkeUNoaWxkICYmIHRoaXMudmlzaWJsZSkgeyB2YXIgcywgYSwgbiwgciA9IGQodCwgdGhpcywgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSwgaSksIG8gPSAhciAmJiB0aGlzLmlzb3ZlciA/ICJpc291dCIgOiByICYmICF0aGlzLmlzb3ZlciA/ICJpc292ZXIiIDogbnVsbDsgbyAmJiAodGhpcy5vcHRpb25zLmdyZWVkeSAmJiAoYSA9IHRoaXMub3B0aW9ucy5zY29wZSwgbiA9IHRoaXMuZWxlbWVudC5wYXJlbnRzKCI6ZGF0YSh1aS1kcm9wcGFibGUpIikuZmlsdGVyKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUodGhpcykuZHJvcHBhYmxlKCJpbnN0YW5jZSIpLm9wdGlvbnMuc2NvcGUgPT09IGEgfSksIG4ubGVuZ3RoICYmIChzID0gZShuWzBdKS5kcm9wcGFibGUoImluc3RhbmNlIiksIHMuZ3JlZWR5Q2hpbGQgPSAiaXNvdmVyIiA9PT0gbykpLCBzICYmICJpc292ZXIiID09PSBvICYmIChzLmlzb3ZlciA9ICExLCBzLmlzb3V0ID0gITAsIHMuX291dC5jYWxsKHMsIGkpKSwgdGhpc1tvXSA9ICEwLCB0aGlzWyJpc291dCIgPT09IG8gPyAiaXNvdmVyIiA6ICJpc291dCJdID0gITEsIHRoaXNbImlzb3ZlciIgPT09IG8gPyAiX292ZXIiIDogIl9vdXQiXS5jYWxsKHRoaXMsIGkpLCBzICYmICJpc291dCIgPT09IG8gJiYgKHMuaXNvdXQgPSAhMSwgcy5pc292ZXIgPSAhMCwgcy5fb3Zlci5jYWxsKHMsIGkpKSkgfSB9KSB9LCBkcmFnU3RvcDogZnVuY3Rpb24gKHQsIGkpIHsgdC5lbGVtZW50LnBhcmVudHNVbnRpbCgiYm9keSIpLm9mZigic2Nyb2xsLmRyb3BwYWJsZSIpLCB0Lm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucyB8fCBlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0LCBpKSB9IH0sIGUudWlCYWNrQ29tcGF0ICE9PSAhMSAmJiBlLndpZGdldCgidWkuZHJvcHBhYmxlIiwgZS51aS5kcm9wcGFibGUsIHsgb3B0aW9uczogeyBob3ZlckNsYXNzOiAhMSwgYWN0aXZlQ2xhc3M6ICExIH0sIF9hZGRBY3RpdmVDbGFzczogZnVuY3Rpb24gKCkgeyB0aGlzLl9zdXBlcigpLCB0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgJiYgdGhpcy5lbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcykgfSwgX3JlbW92ZUFjdGl2ZUNsYXNzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3N1cGVyKCksIHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyAmJiB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKSB9LCBfYWRkSG92ZXJDbGFzczogZnVuY3Rpb24gKCkgeyB0aGlzLl9zdXBlcigpLCB0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyAmJiB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpIH0sIF9yZW1vdmVIb3ZlckNsYXNzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3N1cGVyKCksIHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzICYmIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcykgfSB9KSwgZS51aS5kcm9wcGFibGUsIGUud2lkZ2V0KCJ1aS5yZXNpemFibGUiLCBlLnVpLm1vdXNlLCB7IHZlcnNpb246ICIxLjEyLjEiLCB3aWRnZXRFdmVudFByZWZpeDogInJlc2l6ZSIsIG9wdGlvbnM6IHsgYWxzb1Jlc2l6ZTogITEsIGFuaW1hdGU6ICExLCBhbmltYXRlRHVyYXRpb246ICJzbG93IiwgYW5pbWF0ZUVhc2luZzogInN3aW5nIiwgYXNwZWN0UmF0aW86ICExLCBhdXRvSGlkZTogITEsIGNsYXNzZXM6IHsgInVpLXJlc2l6YWJsZS1zZSI6ICJ1aS1pY29uIHVpLWljb24tZ3JpcHNtYWxsLWRpYWdvbmFsLXNlIiB9LCBjb250YWlubWVudDogITEsIGdob3N0OiAhMSwgZ3JpZDogITEsIGhhbmRsZXM6ICJlLHMsc2UiLCBoZWxwZXI6ICExLCBtYXhIZWlnaHQ6IG51bGwsIG1heFdpZHRoOiBudWxsLCBtaW5IZWlnaHQ6IDEwLCBtaW5XaWR0aDogMTAsIHpJbmRleDogOTAsIHJlc2l6ZTogbnVsbCwgc3RhcnQ6IG51bGwsIHN0b3A6IG51bGwgfSwgX251bTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHBhcnNlRmxvYXQoZSkgfHwgMCB9LCBfaXNOdW1iZXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChlKSkgfSwgX2hhc1Njcm9sbDogZnVuY3Rpb24gKHQsIGkpIHsgaWYgKCJoaWRkZW4iID09PSBlKHQpLmNzcygib3ZlcmZsb3ciKSkgcmV0dXJuICExOyB2YXIgcyA9IGkgJiYgImxlZnQiID09PSBpID8gInNjcm9sbExlZnQiIDogInNjcm9sbFRvcCIsIGEgPSAhMTsgcmV0dXJuIHRbc10gPiAwID8gITAgOiAodFtzXSA9IDEsIGEgPSB0W3NdID4gMCwgdFtzXSA9IDAsIGEpIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGkgPSB0aGlzLm9wdGlvbnMsIHMgPSB0aGlzOyB0aGlzLl9hZGRDbGFzcygidWktcmVzaXphYmxlIiksIGUuZXh0ZW5kKHRoaXMsIHsgX2FzcGVjdFJhdGlvOiAhIWkuYXNwZWN0UmF0aW8sIGFzcGVjdFJhdGlvOiBpLmFzcGVjdFJhdGlvLCBvcmlnaW5hbEVsZW1lbnQ6IHRoaXMuZWxlbWVudCwgX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHM6IFtdLCBfaGVscGVyOiBpLmhlbHBlciB8fCBpLmdob3N0IHx8IGkuYW5pbWF0ZSA/IGkuaGVscGVyIHx8ICJ1aS1yZXNpemFibGUtaGVscGVyIiA6IG51bGwgfSksIHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS5tYXRjaCgvXihjYW52YXN8dGV4dGFyZWF8aW5wdXR8c2VsZWN0fGJ1dHRvbnxpbWcpJC9pKSAmJiAodGhpcy5lbGVtZW50LndyYXAoZSgiPGRpdiBjbGFzcz0ndWktd3JhcHBlcicgc3R5bGU9J292ZXJmbG93OiBoaWRkZW47Jz48L2Rpdj4iKS5jc3MoeyBwb3NpdGlvbjogdGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSwgd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksIGhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCksIHRvcDogdGhpcy5lbGVtZW50LmNzcygidG9wIiksIGxlZnQ6IHRoaXMuZWxlbWVudC5jc3MoImxlZnQiKSB9KSksIHRoaXMuZWxlbWVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKCJ1aS1yZXNpemFibGUiLCB0aGlzLmVsZW1lbnQucmVzaXphYmxlKCJpbnN0YW5jZSIpKSwgdGhpcy5lbGVtZW50SXNXcmFwcGVyID0gITAsIHQgPSB7IG1hcmdpblRvcDogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5Ub3AiKSwgbWFyZ2luUmlnaHQ6IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luUmlnaHQiKSwgbWFyZ2luQm90dG9tOiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpLCBtYXJnaW5MZWZ0OiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSB9LCB0aGlzLmVsZW1lbnQuY3NzKHQpLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbiIsIDApLCB0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUgPSB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIpLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIsICJub25lIiksIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMucHVzaCh0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoeyBwb3NpdGlvbjogInN0YXRpYyIsIHpvb206IDEsIGRpc3BsYXk6ICJibG9jayIgfSkpLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3ModCksIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCkpLCB0aGlzLl9zZXR1cEhhbmRsZXMoKSwgaS5hdXRvSGlkZSAmJiBlKHRoaXMuZWxlbWVudCkub24oIm1vdXNlZW50ZXIiLCBmdW5jdGlvbiAoKSB7IGkuZGlzYWJsZWQgfHwgKHMuX3JlbW92ZUNsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKSwgcy5faGFuZGxlcy5zaG93KCkpIH0pLm9uKCJtb3VzZWxlYXZlIiwgZnVuY3Rpb24gKCkgeyBpLmRpc2FibGVkIHx8IHMucmVzaXppbmcgfHwgKHMuX2FkZENsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKSwgcy5faGFuZGxlcy5oaWRlKCkpIH0pLCB0aGlzLl9tb3VzZUluaXQoKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLl9tb3VzZURlc3Ryb3koKTsgdmFyIHQsIGkgPSBmdW5jdGlvbiAodCkgeyBlKHQpLnJlbW92ZURhdGEoInJlc2l6YWJsZSIpLnJlbW92ZURhdGEoInVpLXJlc2l6YWJsZSIpLm9mZigiLnJlc2l6YWJsZSIpLmZpbmQoIi51aS1yZXNpemFibGUtaGFuZGxlIikucmVtb3ZlKCkgfTsgcmV0dXJuIHRoaXMuZWxlbWVudElzV3JhcHBlciAmJiAoaSh0aGlzLmVsZW1lbnQpLCB0ID0gdGhpcy5lbGVtZW50LCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoeyBwb3NpdGlvbjogdC5jc3MoInBvc2l0aW9uIiksIHdpZHRoOiB0Lm91dGVyV2lkdGgoKSwgaGVpZ2h0OiB0Lm91dGVySGVpZ2h0KCksIHRvcDogdC5jc3MoInRvcCIpLCBsZWZ0OiB0LmNzcygibGVmdCIpIH0pLmluc2VydEFmdGVyKHQpLCB0LnJlbW92ZSgpKSwgdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiLCB0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUpLCBpKHRoaXMub3JpZ2luYWxFbGVtZW50KSwgdGhpcyB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyBzd2l0Y2ggKHRoaXMuX3N1cGVyKGUsIHQpLCBlKSB7IGNhc2UgImhhbmRsZXMiOiB0aGlzLl9yZW1vdmVIYW5kbGVzKCksIHRoaXMuX3NldHVwSGFuZGxlcygpOyBicmVhazsgZGVmYXVsdDogfSB9LCBfc2V0dXBIYW5kbGVzOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpLCBzLCBhLCBuLCByID0gdGhpcy5vcHRpb25zLCBvID0gdGhpczsgaWYgKHRoaXMuaGFuZGxlcyA9IHIuaGFuZGxlcyB8fCAoZSgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiLCB0aGlzLmVsZW1lbnQpLmxlbmd0aCA/IHsgbjogIi51aS1yZXNpemFibGUtbiIsIGU6ICIudWktcmVzaXphYmxlLWUiLCBzOiAiLnVpLXJlc2l6YWJsZS1zIiwgdzogIi51aS1yZXNpemFibGUtdyIsIHNlOiAiLnVpLXJlc2l6YWJsZS1zZSIsIHN3OiAiLnVpLXJlc2l6YWJsZS1zdyIsIG5lOiAiLnVpLXJlc2l6YWJsZS1uZSIsIG53OiAiLnVpLXJlc2l6YWJsZS1udyIgfSA6ICJlLHMsc2UiKSwgdGhpcy5faGFuZGxlcyA9IGUoKSwgdGhpcy5oYW5kbGVzLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIGZvciAoImFsbCIgPT09IHRoaXMuaGFuZGxlcyAmJiAodGhpcy5oYW5kbGVzID0gIm4sZSxzLHcsc2Usc3csbmUsbnciKSwgcyA9IHRoaXMuaGFuZGxlcy5zcGxpdCgiLCIpLCB0aGlzLmhhbmRsZXMgPSB7fSwgaSA9IDA7IHMubGVuZ3RoID4gaTsgaSsrKXQgPSBlLnRyaW0oc1tpXSksIGEgPSAidWktcmVzaXphYmxlLSIgKyB0LCBuID0gZSgiPGRpdj4iKSwgdGhpcy5fYWRkQ2xhc3MobiwgInVpLXJlc2l6YWJsZS1oYW5kbGUgIiArIGEpLCBuLmNzcyh7IHpJbmRleDogci56SW5kZXggfSksIHRoaXMuaGFuZGxlc1t0XSA9ICIudWktcmVzaXphYmxlLSIgKyB0LCB0aGlzLmVsZW1lbnQuYXBwZW5kKG4pOyB0aGlzLl9yZW5kZXJBeGlzID0gZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG47IHQgPSB0IHx8IHRoaXMuZWxlbWVudDsgZm9yIChpIGluIHRoaXMuaGFuZGxlcykgdGhpcy5oYW5kbGVzW2ldLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyB0aGlzLmhhbmRsZXNbaV0gPSB0aGlzLmVsZW1lbnQuY2hpbGRyZW4odGhpcy5oYW5kbGVzW2ldKS5maXJzdCgpLnNob3coKSA6ICh0aGlzLmhhbmRsZXNbaV0uanF1ZXJ5IHx8IHRoaXMuaGFuZGxlc1tpXS5ub2RlVHlwZSkgJiYgKHRoaXMuaGFuZGxlc1tpXSA9IGUodGhpcy5oYW5kbGVzW2ldKSwgdGhpcy5fb24odGhpcy5oYW5kbGVzW2ldLCB7IG1vdXNlZG93bjogby5fbW91c2VEb3duIH0pKSwgdGhpcy5lbGVtZW50SXNXcmFwcGVyICYmIHRoaXMub3JpZ2luYWxFbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC9eKHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b24pJC9pKSAmJiAocyA9IGUodGhpcy5oYW5kbGVzW2ldLCB0aGlzLmVsZW1lbnQpLCBuID0gL3N3fG5lfG53fHNlfG58cy8udGVzdChpKSA/IHMub3V0ZXJIZWlnaHQoKSA6IHMub3V0ZXJXaWR0aCgpLCBhID0gWyJwYWRkaW5nIiwgL25lfG53fG4vLnRlc3QoaSkgPyAiVG9wIiA6IC9zZXxzd3xzLy50ZXN0KGkpID8gIkJvdHRvbSIgOiAvXmUkLy50ZXN0KGkpID8gIlJpZ2h0IiA6ICJMZWZ0Il0uam9pbigiIiksIHQuY3NzKGEsIG4pLCB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpKSwgdGhpcy5faGFuZGxlcyA9IHRoaXMuX2hhbmRsZXMuYWRkKHRoaXMuaGFuZGxlc1tpXSkgfSwgdGhpcy5fcmVuZGVyQXhpcyh0aGlzLmVsZW1lbnQpLCB0aGlzLl9oYW5kbGVzID0gdGhpcy5faGFuZGxlcy5hZGQodGhpcy5lbGVtZW50LmZpbmQoIi51aS1yZXNpemFibGUtaGFuZGxlIikpLCB0aGlzLl9oYW5kbGVzLmRpc2FibGVTZWxlY3Rpb24oKSwgdGhpcy5faGFuZGxlcy5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24gKCkgeyBvLnJlc2l6aW5nIHx8ICh0aGlzLmNsYXNzTmFtZSAmJiAobiA9IHRoaXMuY2xhc3NOYW1lLm1hdGNoKC91aS1yZXNpemFibGUtKHNlfHN3fG5lfG53fG58ZXxzfHcpL2kpKSwgby5heGlzID0gbiAmJiBuWzFdID8gblsxXSA6ICJzZSIpIH0pLCByLmF1dG9IaWRlICYmICh0aGlzLl9oYW5kbGVzLmhpZGUoKSwgdGhpcy5fYWRkQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpKSB9LCBfcmVtb3ZlSGFuZGxlczogZnVuY3Rpb24gKCkgeyB0aGlzLl9oYW5kbGVzLnJlbW92ZSgpIH0sIF9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhID0gITE7IGZvciAoaSBpbiB0aGlzLmhhbmRsZXMpIHMgPSBlKHRoaXMuaGFuZGxlc1tpXSlbMF0sIChzID09PSB0LnRhcmdldCB8fCBlLmNvbnRhaW5zKHMsIHQudGFyZ2V0KSkgJiYgKGEgPSAhMCk7IHJldHVybiAhdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIGEgfSwgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhLCBuID0gdGhpcy5vcHRpb25zLCByID0gdGhpcy5lbGVtZW50OyByZXR1cm4gdGhpcy5yZXNpemluZyA9ICEwLCB0aGlzLl9yZW5kZXJQcm94eSgpLCBpID0gdGhpcy5fbnVtKHRoaXMuaGVscGVyLmNzcygibGVmdCIpKSwgcyA9IHRoaXMuX251bSh0aGlzLmhlbHBlci5jc3MoInRvcCIpKSwgbi5jb250YWlubWVudCAmJiAoaSArPSBlKG4uY29udGFpbm1lbnQpLnNjcm9sbExlZnQoKSB8fCAwLCBzICs9IGUobi5jb250YWlubWVudCkuc2Nyb2xsVG9wKCkgfHwgMCksIHRoaXMub2Zmc2V0ID0gdGhpcy5oZWxwZXIub2Zmc2V0KCksIHRoaXMucG9zaXRpb24gPSB7IGxlZnQ6IGksIHRvcDogcyB9LCB0aGlzLnNpemUgPSB0aGlzLl9oZWxwZXIgPyB7IHdpZHRoOiB0aGlzLmhlbHBlci53aWR0aCgpLCBoZWlnaHQ6IHRoaXMuaGVscGVyLmhlaWdodCgpIH0gOiB7IHdpZHRoOiByLndpZHRoKCksIGhlaWdodDogci5oZWlnaHQoKSB9LCB0aGlzLm9yaWdpbmFsU2l6ZSA9IHRoaXMuX2hlbHBlciA/IHsgd2lkdGg6IHIub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6IHIub3V0ZXJIZWlnaHQoKSB9IDogeyB3aWR0aDogci53aWR0aCgpLCBoZWlnaHQ6IHIuaGVpZ2h0KCkgfSwgdGhpcy5zaXplRGlmZiA9IHsgd2lkdGg6IHIub3V0ZXJXaWR0aCgpIC0gci53aWR0aCgpLCBoZWlnaHQ6IHIub3V0ZXJIZWlnaHQoKSAtIHIuaGVpZ2h0KCkgfSwgdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0geyBsZWZ0OiBpLCB0b3A6IHMgfSwgdGhpcy5vcmlnaW5hbE1vdXNlUG9zaXRpb24gPSB7IGxlZnQ6IHQucGFnZVgsIHRvcDogdC5wYWdlWSB9LCB0aGlzLmFzcGVjdFJhdGlvID0gIm51bWJlciIgPT0gdHlwZW9mIG4uYXNwZWN0UmF0aW8gPyBuLmFzcGVjdFJhdGlvIDogdGhpcy5vcmlnaW5hbFNpemUud2lkdGggLyB0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQgfHwgMSwgYSA9IGUoIi51aS1yZXNpemFibGUtIiArIHRoaXMuYXhpcykuY3NzKCJjdXJzb3IiKSwgZSgiYm9keSIpLmNzcygiY3Vyc29yIiwgImF1dG8iID09PSBhID8gdGhpcy5heGlzICsgIi1yZXNpemUiIDogYSksIHRoaXMuX2FkZENsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKSwgdGhpcy5fcHJvcGFnYXRlKCJzdGFydCIsIHQpLCAhMCB9LCBfbW91c2VEcmFnOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcywgYSA9IHRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uLCBuID0gdGhpcy5heGlzLCByID0gdC5wYWdlWCAtIGEubGVmdCB8fCAwLCBvID0gdC5wYWdlWSAtIGEudG9wIHx8IDAsIGwgPSB0aGlzLl9jaGFuZ2Vbbl07IHJldHVybiB0aGlzLl91cGRhdGVQcmV2UHJvcGVydGllcygpLCBsID8gKGkgPSBsLmFwcGx5KHRoaXMsIFt0LCByLCBvXSksIHRoaXMuX3VwZGF0ZVZpcnR1YWxCb3VuZGFyaWVzKHQuc2hpZnRLZXkpLCAodGhpcy5fYXNwZWN0UmF0aW8gfHwgdC5zaGlmdEtleSkgJiYgKGkgPSB0aGlzLl91cGRhdGVSYXRpbyhpLCB0KSksIGkgPSB0aGlzLl9yZXNwZWN0U2l6ZShpLCB0KSwgdGhpcy5fdXBkYXRlQ2FjaGUoaSksIHRoaXMuX3Byb3BhZ2F0ZSgicmVzaXplIiwgdCksIHMgPSB0aGlzLl9hcHBseUNoYW5nZXMoKSwgIXRoaXMuX2hlbHBlciAmJiB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLmxlbmd0aCAmJiB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpLCBlLmlzRW1wdHlPYmplY3QocykgfHwgKHRoaXMuX3VwZGF0ZVByZXZQcm9wZXJ0aWVzKCksIHRoaXMuX3RyaWdnZXIoInJlc2l6ZSIsIHQsIHRoaXMudWkoKSksIHRoaXMuX2FwcGx5Q2hhbmdlcygpKSwgITEpIDogITEgfSwgX21vdXNlU3RvcDogZnVuY3Rpb24gKHQpIHsgdGhpcy5yZXNpemluZyA9ICExOyB2YXIgaSwgcywgYSwgbiwgciwgbywgbCwgaCA9IHRoaXMub3B0aW9ucywgdSA9IHRoaXM7IHJldHVybiB0aGlzLl9oZWxwZXIgJiYgKGkgPSB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLCBzID0gaS5sZW5ndGggJiYgL3RleHRhcmVhL2kudGVzdChpWzBdLm5vZGVOYW1lKSwgYSA9IHMgJiYgdGhpcy5faGFzU2Nyb2xsKGlbMF0sICJsZWZ0IikgPyAwIDogdS5zaXplRGlmZi5oZWlnaHQsIG4gPSBzID8gMCA6IHUuc2l6ZURpZmYud2lkdGgsIHIgPSB7IHdpZHRoOiB1LmhlbHBlci53aWR0aCgpIC0gbiwgaGVpZ2h0OiB1LmhlbHBlci5oZWlnaHQoKSAtIGEgfSwgbyA9IHBhcnNlRmxvYXQodS5lbGVtZW50LmNzcygibGVmdCIpKSArICh1LnBvc2l0aW9uLmxlZnQgLSB1Lm9yaWdpbmFsUG9zaXRpb24ubGVmdCkgfHwgbnVsbCwgbCA9IHBhcnNlRmxvYXQodS5lbGVtZW50LmNzcygidG9wIikpICsgKHUucG9zaXRpb24udG9wIC0gdS5vcmlnaW5hbFBvc2l0aW9uLnRvcCkgfHwgbnVsbCwgaC5hbmltYXRlIHx8IHRoaXMuZWxlbWVudC5jc3MoZS5leHRlbmQociwgeyB0b3A6IGwsIGxlZnQ6IG8gfSkpLCB1LmhlbHBlci5oZWlnaHQodS5zaXplLmhlaWdodCksIHUuaGVscGVyLndpZHRoKHUuc2l6ZS53aWR0aCksIHRoaXMuX2hlbHBlciAmJiAhaC5hbmltYXRlICYmIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCkpLCBlKCJib2R5IikuY3NzKCJjdXJzb3IiLCAiYXV0byIpLCB0aGlzLl9yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLXJlc2l6aW5nIiksIHRoaXMuX3Byb3BhZ2F0ZSgic3RvcCIsIHQpLCB0aGlzLl9oZWxwZXIgJiYgdGhpcy5oZWxwZXIucmVtb3ZlKCksICExIH0sIF91cGRhdGVQcmV2UHJvcGVydGllczogZnVuY3Rpb24gKCkgeyB0aGlzLnByZXZQb3NpdGlvbiA9IHsgdG9wOiB0aGlzLnBvc2l0aW9uLnRvcCwgbGVmdDogdGhpcy5wb3NpdGlvbi5sZWZ0IH0sIHRoaXMucHJldlNpemUgPSB7IHdpZHRoOiB0aGlzLnNpemUud2lkdGgsIGhlaWdodDogdGhpcy5zaXplLmhlaWdodCB9IH0sIF9hcHBseUNoYW5nZXM6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7fTsgcmV0dXJuIHRoaXMucG9zaXRpb24udG9wICE9PSB0aGlzLnByZXZQb3NpdGlvbi50b3AgJiYgKGUudG9wID0gdGhpcy5wb3NpdGlvbi50b3AgKyAicHgiKSwgdGhpcy5wb3NpdGlvbi5sZWZ0ICE9PSB0aGlzLnByZXZQb3NpdGlvbi5sZWZ0ICYmIChlLmxlZnQgPSB0aGlzLnBvc2l0aW9uLmxlZnQgKyAicHgiKSwgdGhpcy5zaXplLndpZHRoICE9PSB0aGlzLnByZXZTaXplLndpZHRoICYmIChlLndpZHRoID0gdGhpcy5zaXplLndpZHRoICsgInB4IiksIHRoaXMuc2l6ZS5oZWlnaHQgIT09IHRoaXMucHJldlNpemUuaGVpZ2h0ICYmIChlLmhlaWdodCA9IHRoaXMuc2l6ZS5oZWlnaHQgKyAicHgiKSwgdGhpcy5oZWxwZXIuY3NzKGUpLCBlIH0sIF91cGRhdGVWaXJ0dWFsQm91bmRhcmllczogZnVuY3Rpb24gKGUpIHsgdmFyIHQsIGksIHMsIGEsIG4sIHIgPSB0aGlzLm9wdGlvbnM7IG4gPSB7IG1pbldpZHRoOiB0aGlzLl9pc051bWJlcihyLm1pbldpZHRoKSA/IHIubWluV2lkdGggOiAwLCBtYXhXaWR0aDogdGhpcy5faXNOdW1iZXIoci5tYXhXaWR0aCkgPyByLm1heFdpZHRoIDogMSAvIDAsIG1pbkhlaWdodDogdGhpcy5faXNOdW1iZXIoci5taW5IZWlnaHQpID8gci5taW5IZWlnaHQgOiAwLCBtYXhIZWlnaHQ6IHRoaXMuX2lzTnVtYmVyKHIubWF4SGVpZ2h0KSA/IHIubWF4SGVpZ2h0IDogMSAvIDAgfSwgKHRoaXMuX2FzcGVjdFJhdGlvIHx8IGUpICYmICh0ID0gbi5taW5IZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvLCBzID0gbi5taW5XaWR0aCAvIHRoaXMuYXNwZWN0UmF0aW8sIGkgPSBuLm1heEhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW8sIGEgPSBuLm1heFdpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbywgdCA+IG4ubWluV2lkdGggJiYgKG4ubWluV2lkdGggPSB0KSwgcyA+IG4ubWluSGVpZ2h0ICYmIChuLm1pbkhlaWdodCA9IHMpLCBuLm1heFdpZHRoID4gaSAmJiAobi5tYXhXaWR0aCA9IGkpLCBuLm1heEhlaWdodCA+IGEgJiYgKG4ubWF4SGVpZ2h0ID0gYSkpLCB0aGlzLl92Qm91bmRhcmllcyA9IG4gfSwgX3VwZGF0ZUNhY2hlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLm9mZnNldCA9IHRoaXMuaGVscGVyLm9mZnNldCgpLCB0aGlzLl9pc051bWJlcihlLmxlZnQpICYmICh0aGlzLnBvc2l0aW9uLmxlZnQgPSBlLmxlZnQpLCB0aGlzLl9pc051bWJlcihlLnRvcCkgJiYgKHRoaXMucG9zaXRpb24udG9wID0gZS50b3ApLCB0aGlzLl9pc051bWJlcihlLmhlaWdodCkgJiYgKHRoaXMuc2l6ZS5oZWlnaHQgPSBlLmhlaWdodCksIHRoaXMuX2lzTnVtYmVyKGUud2lkdGgpICYmICh0aGlzLnNpemUud2lkdGggPSBlLndpZHRoKSB9LCBfdXBkYXRlUmF0aW86IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpcy5wb3NpdGlvbiwgaSA9IHRoaXMuc2l6ZSwgcyA9IHRoaXMuYXhpczsgcmV0dXJuIHRoaXMuX2lzTnVtYmVyKGUuaGVpZ2h0KSA/IGUud2lkdGggPSBlLmhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW8gOiB0aGlzLl9pc051bWJlcihlLndpZHRoKSAmJiAoZS5oZWlnaHQgPSBlLndpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbyksICJzdyIgPT09IHMgJiYgKGUubGVmdCA9IHQubGVmdCArIChpLndpZHRoIC0gZS53aWR0aCksIGUudG9wID0gbnVsbCksICJudyIgPT09IHMgJiYgKGUudG9wID0gdC50b3AgKyAoaS5oZWlnaHQgLSBlLmhlaWdodCksIGUubGVmdCA9IHQubGVmdCArIChpLndpZHRoIC0gZS53aWR0aCkpLCBlIH0sIF9yZXNwZWN0U2l6ZTogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB0aGlzLl92Qm91bmRhcmllcywgaSA9IHRoaXMuYXhpcywgcyA9IHRoaXMuX2lzTnVtYmVyKGUud2lkdGgpICYmIHQubWF4V2lkdGggJiYgdC5tYXhXaWR0aCA8IGUud2lkdGgsIGEgPSB0aGlzLl9pc051bWJlcihlLmhlaWdodCkgJiYgdC5tYXhIZWlnaHQgJiYgdC5tYXhIZWlnaHQgPCBlLmhlaWdodCwgbiA9IHRoaXMuX2lzTnVtYmVyKGUud2lkdGgpICYmIHQubWluV2lkdGggJiYgdC5taW5XaWR0aCA+IGUud2lkdGgsIHIgPSB0aGlzLl9pc051bWJlcihlLmhlaWdodCkgJiYgdC5taW5IZWlnaHQgJiYgdC5taW5IZWlnaHQgPiBlLmhlaWdodCwgbyA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0ICsgdGhpcy5vcmlnaW5hbFNpemUud2lkdGgsIGwgPSB0aGlzLm9yaWdpbmFsUG9zaXRpb24udG9wICsgdGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0LCBoID0gL3N3fG53fHcvLnRlc3QoaSksIHUgPSAvbnd8bmV8bi8udGVzdChpKTsgcmV0dXJuIG4gJiYgKGUud2lkdGggPSB0Lm1pbldpZHRoKSwgciAmJiAoZS5oZWlnaHQgPSB0Lm1pbkhlaWdodCksIHMgJiYgKGUud2lkdGggPSB0Lm1heFdpZHRoKSwgYSAmJiAoZS5oZWlnaHQgPSB0Lm1heEhlaWdodCksIG4gJiYgaCAmJiAoZS5sZWZ0ID0gbyAtIHQubWluV2lkdGgpLCBzICYmIGggJiYgKGUubGVmdCA9IG8gLSB0Lm1heFdpZHRoKSwgciAmJiB1ICYmIChlLnRvcCA9IGwgLSB0Lm1pbkhlaWdodCksIGEgJiYgdSAmJiAoZS50b3AgPSBsIC0gdC5tYXhIZWlnaHQpLCBlLndpZHRoIHx8IGUuaGVpZ2h0IHx8IGUubGVmdCB8fCAhZS50b3AgPyBlLndpZHRoIHx8IGUuaGVpZ2h0IHx8IGUudG9wIHx8ICFlLmxlZnQgfHwgKGUubGVmdCA9IG51bGwpIDogZS50b3AgPSBudWxsLCBlIH0sIF9nZXRQYWRkaW5nUGx1c0JvcmRlckRpbWVuc2lvbnM6IGZ1bmN0aW9uIChlKSB7IGZvciAodmFyIHQgPSAwLCBpID0gW10sIHMgPSBbZS5jc3MoImJvcmRlclRvcFdpZHRoIiksIGUuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksIGUuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLCBlLmNzcygiYm9yZGVyTGVmdFdpZHRoIildLCBhID0gW2UuY3NzKCJwYWRkaW5nVG9wIiksIGUuY3NzKCJwYWRkaW5nUmlnaHQiKSwgZS5jc3MoInBhZGRpbmdCb3R0b20iKSwgZS5jc3MoInBhZGRpbmdMZWZ0IildOyA0ID4gdDsgdCsrKWlbdF0gPSBwYXJzZUZsb2F0KHNbdF0pIHx8IDAsIGlbdF0gKz0gcGFyc2VGbG9hdChhW3RdKSB8fCAwOyByZXR1cm4geyBoZWlnaHQ6IGlbMF0gKyBpWzJdLCB3aWR0aDogaVsxXSArIGlbM10gfSB9LCBfcHJvcG9ydGlvbmFsbHlSZXNpemU6IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKSBmb3IgKHZhciBlLCB0ID0gMCwgaSA9IHRoaXMuaGVscGVyIHx8IHRoaXMuZWxlbWVudDsgdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGggPiB0OyB0KyspZSA9IHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHNbdF0sIHRoaXMub3V0ZXJEaW1lbnNpb25zIHx8ICh0aGlzLm91dGVyRGltZW5zaW9ucyA9IHRoaXMuX2dldFBhZGRpbmdQbHVzQm9yZGVyRGltZW5zaW9ucyhlKSksIGUuY3NzKHsgaGVpZ2h0OiBpLmhlaWdodCgpIC0gdGhpcy5vdXRlckRpbWVuc2lvbnMuaGVpZ2h0IHx8IDAsIHdpZHRoOiBpLndpZHRoKCkgLSB0aGlzLm91dGVyRGltZW5zaW9ucy53aWR0aCB8fCAwIH0pIH0sIF9yZW5kZXJQcm94eTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuZWxlbWVudCwgaSA9IHRoaXMub3B0aW9uczsgdGhpcy5lbGVtZW50T2Zmc2V0ID0gdC5vZmZzZXQoKSwgdGhpcy5faGVscGVyID8gKHRoaXMuaGVscGVyID0gdGhpcy5oZWxwZXIgfHwgZSgiPGRpdiBzdHlsZT0nb3ZlcmZsb3c6aGlkZGVuOyc+PC9kaXY+IiksIHRoaXMuX2FkZENsYXNzKHRoaXMuaGVscGVyLCB0aGlzLl9oZWxwZXIpLCB0aGlzLmhlbHBlci5jc3MoeyB3aWR0aDogdGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKSwgaGVpZ2h0OiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSwgcG9zaXRpb246ICJhYnNvbHV0ZSIsIGxlZnQ6IHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0ICsgInB4IiwgdG9wOiB0aGlzLmVsZW1lbnRPZmZzZXQudG9wICsgInB4IiwgekluZGV4OiArK2kuekluZGV4IH0pLCB0aGlzLmhlbHBlci5hcHBlbmRUbygiYm9keSIpLmRpc2FibGVTZWxlY3Rpb24oKSkgOiB0aGlzLmhlbHBlciA9IHRoaXMuZWxlbWVudCB9LCBfY2hhbmdlOiB7IGU6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiB7IHdpZHRoOiB0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCArIHQgfSB9LCB3OiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSA9IHRoaXMub3JpZ2luYWxTaXplLCBzID0gdGhpcy5vcmlnaW5hbFBvc2l0aW9uOyByZXR1cm4geyBsZWZ0OiBzLmxlZnQgKyB0LCB3aWR0aDogaS53aWR0aCAtIHQgfSB9LCBuOiBmdW5jdGlvbiAoZSwgdCwgaSkgeyB2YXIgcyA9IHRoaXMub3JpZ2luYWxTaXplLCBhID0gdGhpcy5vcmlnaW5hbFBvc2l0aW9uOyByZXR1cm4geyB0b3A6IGEudG9wICsgaSwgaGVpZ2h0OiBzLmhlaWdodCAtIGkgfSB9LCBzOiBmdW5jdGlvbiAoZSwgdCwgaSkgeyByZXR1cm4geyBoZWlnaHQ6IHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCArIGkgfSB9LCBzZTogZnVuY3Rpb24gKHQsIGksIHMpIHsgcmV0dXJuIGUuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFt0LCBpLCBzXSkpIH0sIHN3OiBmdW5jdGlvbiAodCwgaSwgcykgeyByZXR1cm4gZS5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcywgW3QsIGksIHNdKSkgfSwgbmU6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHJldHVybiBlLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLl9jaGFuZ2UuZS5hcHBseSh0aGlzLCBbdCwgaSwgc10pKSB9LCBudzogZnVuY3Rpb24gKHQsIGksIHMpIHsgcmV0dXJuIGUuZXh0ZW5kKHRoaXMuX2NoYW5nZS5uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsIFt0LCBpLCBzXSkpIH0gfSwgX3Byb3BhZ2F0ZTogZnVuY3Rpb24gKHQsIGkpIHsgZS51aS5wbHVnaW4uY2FsbCh0aGlzLCB0LCBbaSwgdGhpcy51aSgpXSksICJyZXNpemUiICE9PSB0ICYmIHRoaXMuX3RyaWdnZXIodCwgaSwgdGhpcy51aSgpKSB9LCBwbHVnaW5zOiB7fSwgdWk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgb3JpZ2luYWxFbGVtZW50OiB0aGlzLm9yaWdpbmFsRWxlbWVudCwgZWxlbWVudDogdGhpcy5lbGVtZW50LCBoZWxwZXI6IHRoaXMuaGVscGVyLCBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwgc2l6ZTogdGhpcy5zaXplLCBvcmlnaW5hbFNpemU6IHRoaXMub3JpZ2luYWxTaXplLCBvcmlnaW5hbFBvc2l0aW9uOiB0aGlzLm9yaWdpbmFsUG9zaXRpb24gfSB9IH0pLCBlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJhbmltYXRlIiwgeyBzdG9wOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLCBzID0gaS5vcHRpb25zLCBhID0gaS5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cywgbiA9IGEubGVuZ3RoICYmIC90ZXh0YXJlYS9pLnRlc3QoYVswXS5ub2RlTmFtZSksIHIgPSBuICYmIGkuX2hhc1Njcm9sbChhWzBdLCAibGVmdCIpID8gMCA6IGkuc2l6ZURpZmYuaGVpZ2h0LCBvID0gbiA/IDAgOiBpLnNpemVEaWZmLndpZHRoLCBsID0geyB3aWR0aDogaS5zaXplLndpZHRoIC0gbywgaGVpZ2h0OiBpLnNpemUuaGVpZ2h0IC0gciB9LCBoID0gcGFyc2VGbG9hdChpLmVsZW1lbnQuY3NzKCJsZWZ0IikpICsgKGkucG9zaXRpb24ubGVmdCAtIGkub3JpZ2luYWxQb3NpdGlvbi5sZWZ0KSB8fCBudWxsLCB1ID0gcGFyc2VGbG9hdChpLmVsZW1lbnQuY3NzKCJ0b3AiKSkgKyAoaS5wb3NpdGlvbi50b3AgLSBpLm9yaWdpbmFsUG9zaXRpb24udG9wKSB8fCBudWxsOyBpLmVsZW1lbnQuYW5pbWF0ZShlLmV4dGVuZChsLCB1ICYmIGggPyB7IHRvcDogdSwgbGVmdDogaCB9IDoge30pLCB7IGR1cmF0aW9uOiBzLmFuaW1hdGVEdXJhdGlvbiwgZWFzaW5nOiBzLmFuaW1hdGVFYXNpbmcsIHN0ZXA6IGZ1bmN0aW9uICgpIHsgdmFyIHMgPSB7IHdpZHRoOiBwYXJzZUZsb2F0KGkuZWxlbWVudC5jc3MoIndpZHRoIikpLCBoZWlnaHQ6IHBhcnNlRmxvYXQoaS5lbGVtZW50LmNzcygiaGVpZ2h0IikpLCB0b3A6IHBhcnNlRmxvYXQoaS5lbGVtZW50LmNzcygidG9wIikpLCBsZWZ0OiBwYXJzZUZsb2F0KGkuZWxlbWVudC5jc3MoImxlZnQiKSkgfTsgYSAmJiBhLmxlbmd0aCAmJiBlKGFbMF0pLmNzcyh7IHdpZHRoOiBzLndpZHRoLCBoZWlnaHQ6IHMuaGVpZ2h0IH0pLCBpLl91cGRhdGVDYWNoZShzKSwgaS5fcHJvcGFnYXRlKCJyZXNpemUiLCB0KSB9IH0pIH0gfSksIGUudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImNvbnRhaW5tZW50IiwgeyBzdGFydDogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSwgcywgYSwgbiwgciwgbywgbCA9IGUodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLCBoID0gbC5vcHRpb25zLCB1ID0gbC5lbGVtZW50LCBkID0gaC5jb250YWlubWVudCwgYyA9IGQgaW5zdGFuY2VvZiBlID8gZC5nZXQoMCkgOiAvcGFyZW50Ly50ZXN0KGQpID8gdS5wYXJlbnQoKS5nZXQoMCkgOiBkOyBjICYmIChsLmNvbnRhaW5lckVsZW1lbnQgPSBlKGMpLCAvZG9jdW1lbnQvLnRlc3QoZCkgfHwgZCA9PT0gZG9jdW1lbnQgPyAobC5jb250YWluZXJPZmZzZXQgPSB7IGxlZnQ6IDAsIHRvcDogMCB9LCBsLmNvbnRhaW5lclBvc2l0aW9uID0geyBsZWZ0OiAwLCB0b3A6IDAgfSwgbC5wYXJlbnREYXRhID0geyBlbGVtZW50OiBlKGRvY3VtZW50KSwgbGVmdDogMCwgdG9wOiAwLCB3aWR0aDogZShkb2N1bWVudCkud2lkdGgoKSwgaGVpZ2h0OiBlKGRvY3VtZW50KS5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0IH0pIDogKHQgPSBlKGMpLCBpID0gW10sIGUoWyJUb3AiLCAiUmlnaHQiLCAiTGVmdCIsICJCb3R0b20iXSkuZWFjaChmdW5jdGlvbiAoZSwgcykgeyBpW2VdID0gbC5fbnVtKHQuY3NzKCJwYWRkaW5nIiArIHMpKSB9KSwgbC5jb250YWluZXJPZmZzZXQgPSB0Lm9mZnNldCgpLCBsLmNvbnRhaW5lclBvc2l0aW9uID0gdC5wb3NpdGlvbigpLCBsLmNvbnRhaW5lclNpemUgPSB7IGhlaWdodDogdC5pbm5lckhlaWdodCgpIC0gaVszXSwgd2lkdGg6IHQuaW5uZXJXaWR0aCgpIC0gaVsxXSB9LCBzID0gbC5jb250YWluZXJPZmZzZXQsIGEgPSBsLmNvbnRhaW5lclNpemUuaGVpZ2h0LCBuID0gbC5jb250YWluZXJTaXplLndpZHRoLCByID0gbC5faGFzU2Nyb2xsKGMsICJsZWZ0IikgPyBjLnNjcm9sbFdpZHRoIDogbiwgbyA9IGwuX2hhc1Njcm9sbChjKSA/IGMuc2Nyb2xsSGVpZ2h0IDogYSwgbC5wYXJlbnREYXRhID0geyBlbGVtZW50OiBjLCBsZWZ0OiBzLmxlZnQsIHRvcDogcy50b3AsIHdpZHRoOiByLCBoZWlnaHQ6IG8gfSkpIH0sIHJlc2l6ZTogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG4sIHIgPSBlKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKSwgbyA9IHIub3B0aW9ucywgbCA9IHIuY29udGFpbmVyT2Zmc2V0LCBoID0gci5wb3NpdGlvbiwgdSA9IHIuX2FzcGVjdFJhdGlvIHx8IHQuc2hpZnRLZXksIGQgPSB7IHRvcDogMCwgbGVmdDogMCB9LCBjID0gci5jb250YWluZXJFbGVtZW50LCBwID0gITA7IGNbMF0gIT09IGRvY3VtZW50ICYmIC9zdGF0aWMvLnRlc3QoYy5jc3MoInBvc2l0aW9uIikpICYmIChkID0gbCksIGgubGVmdCA8IChyLl9oZWxwZXIgPyBsLmxlZnQgOiAwKSAmJiAoci5zaXplLndpZHRoID0gci5zaXplLndpZHRoICsgKHIuX2hlbHBlciA/IHIucG9zaXRpb24ubGVmdCAtIGwubGVmdCA6IHIucG9zaXRpb24ubGVmdCAtIGQubGVmdCksIHUgJiYgKHIuc2l6ZS5oZWlnaHQgPSByLnNpemUud2lkdGggLyByLmFzcGVjdFJhdGlvLCBwID0gITEpLCByLnBvc2l0aW9uLmxlZnQgPSBvLmhlbHBlciA/IGwubGVmdCA6IDApLCBoLnRvcCA8IChyLl9oZWxwZXIgPyBsLnRvcCA6IDApICYmIChyLnNpemUuaGVpZ2h0ID0gci5zaXplLmhlaWdodCArIChyLl9oZWxwZXIgPyByLnBvc2l0aW9uLnRvcCAtIGwudG9wIDogci5wb3NpdGlvbi50b3ApLCB1ICYmIChyLnNpemUud2lkdGggPSByLnNpemUuaGVpZ2h0ICogci5hc3BlY3RSYXRpbywgcCA9ICExKSwgci5wb3NpdGlvbi50b3AgPSByLl9oZWxwZXIgPyBsLnRvcCA6IDApLCBhID0gci5jb250YWluZXJFbGVtZW50LmdldCgwKSA9PT0gci5lbGVtZW50LnBhcmVudCgpLmdldCgwKSwgbiA9IC9yZWxhdGl2ZXxhYnNvbHV0ZS8udGVzdChyLmNvbnRhaW5lckVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpKSwgYSAmJiBuID8gKHIub2Zmc2V0LmxlZnQgPSByLnBhcmVudERhdGEubGVmdCArIHIucG9zaXRpb24ubGVmdCwgci5vZmZzZXQudG9wID0gci5wYXJlbnREYXRhLnRvcCArIHIucG9zaXRpb24udG9wKSA6IChyLm9mZnNldC5sZWZ0ID0gci5lbGVtZW50Lm9mZnNldCgpLmxlZnQsIHIub2Zmc2V0LnRvcCA9IHIuZWxlbWVudC5vZmZzZXQoKS50b3ApLCBpID0gTWF0aC5hYnMoci5zaXplRGlmZi53aWR0aCArIChyLl9oZWxwZXIgPyByLm9mZnNldC5sZWZ0IC0gZC5sZWZ0IDogci5vZmZzZXQubGVmdCAtIGwubGVmdCkpLCBzID0gTWF0aC5hYnMoci5zaXplRGlmZi5oZWlnaHQgKyAoci5faGVscGVyID8gci5vZmZzZXQudG9wIC0gZC50b3AgOiByLm9mZnNldC50b3AgLSBsLnRvcCkpLCBpICsgci5zaXplLndpZHRoID49IHIucGFyZW50RGF0YS53aWR0aCAmJiAoci5zaXplLndpZHRoID0gci5wYXJlbnREYXRhLndpZHRoIC0gaSwgdSAmJiAoci5zaXplLmhlaWdodCA9IHIuc2l6ZS53aWR0aCAvIHIuYXNwZWN0UmF0aW8sIHAgPSAhMSkpLCBzICsgci5zaXplLmhlaWdodCA+PSByLnBhcmVudERhdGEuaGVpZ2h0ICYmIChyLnNpemUuaGVpZ2h0ID0gci5wYXJlbnREYXRhLmhlaWdodCAtIHMsIHUgJiYgKHIuc2l6ZS53aWR0aCA9IHIuc2l6ZS5oZWlnaHQgKiByLmFzcGVjdFJhdGlvLCBwID0gITEpKSwgcCB8fCAoci5wb3NpdGlvbi5sZWZ0ID0gci5wcmV2UG9zaXRpb24ubGVmdCwgci5wb3NpdGlvbi50b3AgPSByLnByZXZQb3NpdGlvbi50b3AsIHIuc2l6ZS53aWR0aCA9IHIucHJldlNpemUud2lkdGgsIHIuc2l6ZS5oZWlnaHQgPSByLnByZXZTaXplLmhlaWdodCkgfSwgc3RvcDogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLCBpID0gdC5vcHRpb25zLCBzID0gdC5jb250YWluZXJPZmZzZXQsIGEgPSB0LmNvbnRhaW5lclBvc2l0aW9uLCBuID0gdC5jb250YWluZXJFbGVtZW50LCByID0gZSh0LmhlbHBlciksIG8gPSByLm9mZnNldCgpLCBsID0gci5vdXRlcldpZHRoKCkgLSB0LnNpemVEaWZmLndpZHRoLCBoID0gci5vdXRlckhlaWdodCgpIC0gdC5zaXplRGlmZi5oZWlnaHQ7IHQuX2hlbHBlciAmJiAhaS5hbmltYXRlICYmIC9yZWxhdGl2ZS8udGVzdChuLmNzcygicG9zaXRpb24iKSkgJiYgZSh0aGlzKS5jc3MoeyBsZWZ0OiBvLmxlZnQgLSBhLmxlZnQgLSBzLmxlZnQsIHdpZHRoOiBsLCBoZWlnaHQ6IGggfSksIHQuX2hlbHBlciAmJiAhaS5hbmltYXRlICYmIC9zdGF0aWMvLnRlc3Qobi5jc3MoInBvc2l0aW9uIikpICYmIGUodGhpcykuY3NzKHsgbGVmdDogby5sZWZ0IC0gYS5sZWZ0IC0gcy5sZWZ0LCB3aWR0aDogbCwgaGVpZ2h0OiBoIH0pIH0gfSksIGUudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImFsc29SZXNpemUiLCB7DQogICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKSwgaSA9IHQub3B0aW9uczsgZShpLmFsc29SZXNpemUpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHQuZGF0YSgidWktcmVzaXphYmxlLWFsc29yZXNpemUiLCB7IHdpZHRoOiBwYXJzZUZsb2F0KHQud2lkdGgoKSksIGhlaWdodDogcGFyc2VGbG9hdCh0LmhlaWdodCgpKSwgbGVmdDogcGFyc2VGbG9hdCh0LmNzcygibGVmdCIpKSwgdG9wOiBwYXJzZUZsb2F0KHQuY3NzKCJ0b3AiKSkgfSkgfSkgfSwgcmVzaXplOiBmdW5jdGlvbiAodCwgaSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGUodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLCBhID0gcy5vcHRpb25zLCBuID0gcy5vcmlnaW5hbFNpemUsIHIgPSBzLm9yaWdpbmFsUG9zaXRpb24sIG8gPSB7IGhlaWdodDogcy5zaXplLmhlaWdodCAtIG4uaGVpZ2h0IHx8IDAsIHdpZHRoOiBzLnNpemUud2lkdGggLSBuLndpZHRoIHx8IDAsIHRvcDogcy5wb3NpdGlvbi50b3AgLSByLnRvcCB8fCAwLCBsZWZ0OiBzLnBvc2l0aW9uLmxlZnQgLSByLmxlZnQgfHwgMCB9Ow0KICAgICAgICAgICAgICAgICAgICBlKGEuYWxzb1Jlc2l6ZSkuZWFjaChmdW5jdGlvbiAoKSB7IHZhciB0ID0gZSh0aGlzKSwgcyA9IGUodGhpcykuZGF0YSgidWktcmVzaXphYmxlLWFsc29yZXNpemUiKSwgYSA9IHt9LCBuID0gdC5wYXJlbnRzKGkub3JpZ2luYWxFbGVtZW50WzBdKS5sZW5ndGggPyBbIndpZHRoIiwgImhlaWdodCJdIDogWyJ3aWR0aCIsICJoZWlnaHQiLCAidG9wIiwgImxlZnQiXTsgZS5lYWNoKG4sIGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpID0gKHNbdF0gfHwgMCkgKyAob1t0XSB8fCAwKTsgaSAmJiBpID49IDAgJiYgKGFbdF0gPSBpIHx8IG51bGwpIH0pLCB0LmNzcyhhKSB9KQ0KICAgICAgICAgICAgICAgIH0sIHN0b3A6IGZ1bmN0aW9uICgpIHsgZSh0aGlzKS5yZW1vdmVEYXRhKCJ1aS1yZXNpemFibGUtYWxzb3Jlc2l6ZSIpIH0NCiAgICAgICAgICAgIH0pLCBlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJnaG9zdCIsIHsgc3RhcnQ6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKSwgaSA9IHQuc2l6ZTsgdC5naG9zdCA9IHQub3JpZ2luYWxFbGVtZW50LmNsb25lKCksIHQuZ2hvc3QuY3NzKHsgb3BhY2l0eTogLjI1LCBkaXNwbGF5OiAiYmxvY2siLCBwb3NpdGlvbjogInJlbGF0aXZlIiwgaGVpZ2h0OiBpLmhlaWdodCwgd2lkdGg6IGkud2lkdGgsIG1hcmdpbjogMCwgbGVmdDogMCwgdG9wOiAwIH0pLCB0Ll9hZGRDbGFzcyh0Lmdob3N0LCAidWktcmVzaXphYmxlLWdob3N0IiksIGUudWlCYWNrQ29tcGF0ICE9PSAhMSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgdC5vcHRpb25zLmdob3N0ICYmIHQuZ2hvc3QuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmdob3N0KSwgdC5naG9zdC5hcHBlbmRUbyh0LmhlbHBlcikgfSwgcmVzaXplOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gZSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIik7IHQuZ2hvc3QgJiYgdC5naG9zdC5jc3MoeyBwb3NpdGlvbjogInJlbGF0aXZlIiwgaGVpZ2h0OiB0LnNpemUuaGVpZ2h0LCB3aWR0aDogdC5zaXplLndpZHRoIH0pIH0sIHN0b3A6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKTsgdC5naG9zdCAmJiB0LmhlbHBlciAmJiB0LmhlbHBlci5nZXQoMCkucmVtb3ZlQ2hpbGQodC5naG9zdC5nZXQoMCkpIH0gfSksIGUudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImdyaWQiLCB7IHJlc2l6ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSA9IGUodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLCBzID0gaS5vcHRpb25zLCBhID0gaS5zaXplLCBuID0gaS5vcmlnaW5hbFNpemUsIHIgPSBpLm9yaWdpbmFsUG9zaXRpb24sIG8gPSBpLmF4aXMsIGwgPSAibnVtYmVyIiA9PSB0eXBlb2Ygcy5ncmlkID8gW3MuZ3JpZCwgcy5ncmlkXSA6IHMuZ3JpZCwgaCA9IGxbMF0gfHwgMSwgdSA9IGxbMV0gfHwgMSwgZCA9IE1hdGgucm91bmQoKGEud2lkdGggLSBuLndpZHRoKSAvIGgpICogaCwgYyA9IE1hdGgucm91bmQoKGEuaGVpZ2h0IC0gbi5oZWlnaHQpIC8gdSkgKiB1LCBwID0gbi53aWR0aCArIGQsIG0gPSBuLmhlaWdodCArIGMsIGYgPSBzLm1heFdpZHRoICYmIHAgPiBzLm1heFdpZHRoLCBnID0gcy5tYXhIZWlnaHQgJiYgbSA+IHMubWF4SGVpZ2h0LCB2ID0gcy5taW5XaWR0aCAmJiBzLm1pbldpZHRoID4gcCwgeSA9IHMubWluSGVpZ2h0ICYmIHMubWluSGVpZ2h0ID4gbTsgcy5ncmlkID0gbCwgdiAmJiAocCArPSBoKSwgeSAmJiAobSArPSB1KSwgZiAmJiAocCAtPSBoKSwgZyAmJiAobSAtPSB1KSwgL14oc2V8c3xlKSQvLnRlc3QobykgPyAoaS5zaXplLndpZHRoID0gcCwgaS5zaXplLmhlaWdodCA9IG0pIDogL14obmUpJC8udGVzdChvKSA/IChpLnNpemUud2lkdGggPSBwLCBpLnNpemUuaGVpZ2h0ID0gbSwgaS5wb3NpdGlvbi50b3AgPSByLnRvcCAtIGMpIDogL14oc3cpJC8udGVzdChvKSA/IChpLnNpemUud2lkdGggPSBwLCBpLnNpemUuaGVpZ2h0ID0gbSwgaS5wb3NpdGlvbi5sZWZ0ID0gci5sZWZ0IC0gZCkgOiAoKDAgPj0gbSAtIHUgfHwgMCA+PSBwIC0gaCkgJiYgKHQgPSBpLl9nZXRQYWRkaW5nUGx1c0JvcmRlckRpbWVuc2lvbnModGhpcykpLCBtIC0gdSA+IDAgPyAoaS5zaXplLmhlaWdodCA9IG0sIGkucG9zaXRpb24udG9wID0gci50b3AgLSBjKSA6IChtID0gdSAtIHQuaGVpZ2h0LCBpLnNpemUuaGVpZ2h0ID0gbSwgaS5wb3NpdGlvbi50b3AgPSByLnRvcCArIG4uaGVpZ2h0IC0gbSksIHAgLSBoID4gMCA/IChpLnNpemUud2lkdGggPSBwLCBpLnBvc2l0aW9uLmxlZnQgPSByLmxlZnQgLSBkKSA6IChwID0gaCAtIHQud2lkdGgsIGkuc2l6ZS53aWR0aCA9IHAsIGkucG9zaXRpb24ubGVmdCA9IHIubGVmdCArIG4ud2lkdGggLSBwKSkgfSB9KSwgZS51aS5yZXNpemFibGUsIGUud2lkZ2V0KCJ1aS5zZWxlY3RhYmxlIiwgZS51aS5tb3VzZSwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgb3B0aW9uczogeyBhcHBlbmRUbzogImJvZHkiLCBhdXRvUmVmcmVzaDogITAsIGRpc3RhbmNlOiAwLCBmaWx0ZXI6ICIqIiwgdG9sZXJhbmNlOiAidG91Y2giLCBzZWxlY3RlZDogbnVsbCwgc2VsZWN0aW5nOiBudWxsLCBzdGFydDogbnVsbCwgc3RvcDogbnVsbCwgdW5zZWxlY3RlZDogbnVsbCwgdW5zZWxlY3Rpbmc6IG51bGwgfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXM7IHRoaXMuX2FkZENsYXNzKCJ1aS1zZWxlY3RhYmxlIiksIHRoaXMuZHJhZ2dlZCA9ICExLCB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7IHQuZWxlbWVudFBvcyA9IGUodC5lbGVtZW50WzBdKS5vZmZzZXQoKSwgdC5zZWxlY3RlZXMgPSBlKHQub3B0aW9ucy5maWx0ZXIsIHQuZWxlbWVudFswXSksIHQuX2FkZENsYXNzKHQuc2VsZWN0ZWVzLCAidWktc2VsZWN0ZWUiKSwgdC5zZWxlY3RlZXMuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBpID0gZSh0aGlzKSwgcyA9IGkub2Zmc2V0KCksIGEgPSB7IGxlZnQ6IHMubGVmdCAtIHQuZWxlbWVudFBvcy5sZWZ0LCB0b3A6IHMudG9wIC0gdC5lbGVtZW50UG9zLnRvcCB9OyBlLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIsIHsgZWxlbWVudDogdGhpcywgJGVsZW1lbnQ6IGksIGxlZnQ6IGEubGVmdCwgdG9wOiBhLnRvcCwgcmlnaHQ6IGEubGVmdCArIGkub3V0ZXJXaWR0aCgpLCBib3R0b206IGEudG9wICsgaS5vdXRlckhlaWdodCgpLCBzdGFydHNlbGVjdGVkOiAhMSwgc2VsZWN0ZWQ6IGkuaGFzQ2xhc3MoInVpLXNlbGVjdGVkIiksIHNlbGVjdGluZzogaS5oYXNDbGFzcygidWktc2VsZWN0aW5nIiksIHVuc2VsZWN0aW5nOiBpLmhhc0NsYXNzKCJ1aS11bnNlbGVjdGluZyIpIH0pIH0pIH0sIHRoaXMucmVmcmVzaCgpLCB0aGlzLl9tb3VzZUluaXQoKSwgdGhpcy5oZWxwZXIgPSBlKCI8ZGl2PiIpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLmhlbHBlciwgInVpLXNlbGVjdGFibGUtaGVscGVyIikgfSwgX2Rlc3Ryb3k6IGZ1bmN0aW9uICgpIHsgdGhpcy5zZWxlY3RlZXMucmVtb3ZlRGF0YSgic2VsZWN0YWJsZS1pdGVtIiksIHRoaXMuX21vdXNlRGVzdHJveSgpIH0sIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMsIHMgPSB0aGlzLm9wdGlvbnM7IHRoaXMub3BvcyA9IFt0LnBhZ2VYLCB0LnBhZ2VZXSwgdGhpcy5lbGVtZW50UG9zID0gZSh0aGlzLmVsZW1lbnRbMF0pLm9mZnNldCgpLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgKHRoaXMuc2VsZWN0ZWVzID0gZShzLmZpbHRlciwgdGhpcy5lbGVtZW50WzBdKSwgdGhpcy5fdHJpZ2dlcigic3RhcnQiLCB0KSwgZShzLmFwcGVuZFRvKS5hcHBlbmQodGhpcy5oZWxwZXIpLCB0aGlzLmhlbHBlci5jc3MoeyBsZWZ0OiB0LnBhZ2VYLCB0b3A6IHQucGFnZVksIHdpZHRoOiAwLCBoZWlnaHQ6IDAgfSksIHMuYXV0b1JlZnJlc2ggJiYgdGhpcy5yZWZyZXNoKCksIHRoaXMuc2VsZWN0ZWVzLmZpbHRlcigiLnVpLXNlbGVjdGVkIikuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBzID0gZS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsgcy5zdGFydHNlbGVjdGVkID0gITAsIHQubWV0YUtleSB8fCB0LmN0cmxLZXkgfHwgKGkuX3JlbW92ZUNsYXNzKHMuJGVsZW1lbnQsICJ1aS1zZWxlY3RlZCIpLCBzLnNlbGVjdGVkID0gITEsIGkuX2FkZENsYXNzKHMuJGVsZW1lbnQsICJ1aS11bnNlbGVjdGluZyIpLCBzLnVuc2VsZWN0aW5nID0gITAsIGkuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgdCwgeyB1bnNlbGVjdGluZzogcy5lbGVtZW50IH0pKSB9KSwgZSh0LnRhcmdldCkucGFyZW50cygpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHMsIGEgPSBlLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOyByZXR1cm4gYSA/IChzID0gIXQubWV0YUtleSAmJiAhdC5jdHJsS2V5IHx8ICFhLiRlbGVtZW50Lmhhc0NsYXNzKCJ1aS1zZWxlY3RlZCIpLCBpLl9yZW1vdmVDbGFzcyhhLiRlbGVtZW50LCBzID8gInVpLXVuc2VsZWN0aW5nIiA6ICJ1aS1zZWxlY3RlZCIpLl9hZGRDbGFzcyhhLiRlbGVtZW50LCBzID8gInVpLXNlbGVjdGluZyIgOiAidWktdW5zZWxlY3RpbmciKSwgYS51bnNlbGVjdGluZyA9ICFzLCBhLnNlbGVjdGluZyA9IHMsIGEuc2VsZWN0ZWQgPSBzLCBzID8gaS5fdHJpZ2dlcigic2VsZWN0aW5nIiwgdCwgeyBzZWxlY3Rpbmc6IGEuZWxlbWVudCB9KSA6IGkuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgdCwgeyB1bnNlbGVjdGluZzogYS5lbGVtZW50IH0pLCAhMSkgOiB2b2lkIDAgfSkpIH0sIF9tb3VzZURyYWc6IGZ1bmN0aW9uICh0KSB7IGlmICh0aGlzLmRyYWdnZWQgPSAhMCwgIXRoaXMub3B0aW9ucy5kaXNhYmxlZCkgeyB2YXIgaSwgcyA9IHRoaXMsIGEgPSB0aGlzLm9wdGlvbnMsIG4gPSB0aGlzLm9wb3NbMF0sIHIgPSB0aGlzLm9wb3NbMV0sIG8gPSB0LnBhZ2VYLCBsID0gdC5wYWdlWTsgcmV0dXJuIG4gPiBvICYmIChpID0gbywgbyA9IG4sIG4gPSBpKSwgciA+IGwgJiYgKGkgPSBsLCBsID0gciwgciA9IGkpLCB0aGlzLmhlbHBlci5jc3MoeyBsZWZ0OiBuLCB0b3A6IHIsIHdpZHRoOiBvIC0gbiwgaGVpZ2h0OiBsIC0gciB9KSwgdGhpcy5zZWxlY3RlZXMuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBpID0gZS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKSwgaCA9ICExLCB1ID0ge307IGkgJiYgaS5lbGVtZW50ICE9PSBzLmVsZW1lbnRbMF0gJiYgKHUubGVmdCA9IGkubGVmdCArIHMuZWxlbWVudFBvcy5sZWZ0LCB1LnJpZ2h0ID0gaS5yaWdodCArIHMuZWxlbWVudFBvcy5sZWZ0LCB1LnRvcCA9IGkudG9wICsgcy5lbGVtZW50UG9zLnRvcCwgdS5ib3R0b20gPSBpLmJvdHRvbSArIHMuZWxlbWVudFBvcy50b3AsICJ0b3VjaCIgPT09IGEudG9sZXJhbmNlID8gaCA9ICEodS5sZWZ0ID4gbyB8fCBuID4gdS5yaWdodCB8fCB1LnRvcCA+IGwgfHwgciA+IHUuYm90dG9tKSA6ICJmaXQiID09PSBhLnRvbGVyYW5jZSAmJiAoaCA9IHUubGVmdCA+IG4gJiYgbyA+IHUucmlnaHQgJiYgdS50b3AgPiByICYmIGwgPiB1LmJvdHRvbSksIGggPyAoaS5zZWxlY3RlZCAmJiAocy5fcmVtb3ZlQ2xhc3MoaS4kZWxlbWVudCwgInVpLXNlbGVjdGVkIiksIGkuc2VsZWN0ZWQgPSAhMSksIGkudW5zZWxlY3RpbmcgJiYgKHMuX3JlbW92ZUNsYXNzKGkuJGVsZW1lbnQsICJ1aS11bnNlbGVjdGluZyIpLCBpLnVuc2VsZWN0aW5nID0gITEpLCBpLnNlbGVjdGluZyB8fCAocy5fYWRkQ2xhc3MoaS4kZWxlbWVudCwgInVpLXNlbGVjdGluZyIpLCBpLnNlbGVjdGluZyA9ICEwLCBzLl90cmlnZ2VyKCJzZWxlY3RpbmciLCB0LCB7IHNlbGVjdGluZzogaS5lbGVtZW50IH0pKSkgOiAoaS5zZWxlY3RpbmcgJiYgKCh0Lm1ldGFLZXkgfHwgdC5jdHJsS2V5KSAmJiBpLnN0YXJ0c2VsZWN0ZWQgPyAocy5fcmVtb3ZlQ2xhc3MoaS4kZWxlbWVudCwgInVpLXNlbGVjdGluZyIpLCBpLnNlbGVjdGluZyA9ICExLCBzLl9hZGRDbGFzcyhpLiRlbGVtZW50LCAidWktc2VsZWN0ZWQiKSwgaS5zZWxlY3RlZCA9ICEwKSA6IChzLl9yZW1vdmVDbGFzcyhpLiRlbGVtZW50LCAidWktc2VsZWN0aW5nIiksIGkuc2VsZWN0aW5nID0gITEsIGkuc3RhcnRzZWxlY3RlZCAmJiAocy5fYWRkQ2xhc3MoaS4kZWxlbWVudCwgInVpLXVuc2VsZWN0aW5nIiksIGkudW5zZWxlY3RpbmcgPSAhMCksIHMuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgdCwgeyB1bnNlbGVjdGluZzogaS5lbGVtZW50IH0pKSksIGkuc2VsZWN0ZWQgJiYgKHQubWV0YUtleSB8fCB0LmN0cmxLZXkgfHwgaS5zdGFydHNlbGVjdGVkIHx8IChzLl9yZW1vdmVDbGFzcyhpLiRlbGVtZW50LCAidWktc2VsZWN0ZWQiKSwgaS5zZWxlY3RlZCA9ICExLCBzLl9hZGRDbGFzcyhpLiRlbGVtZW50LCAidWktdW5zZWxlY3RpbmciKSwgaS51bnNlbGVjdGluZyA9ICEwLCBzLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsIHQsIHsgdW5zZWxlY3Rpbmc6IGkuZWxlbWVudCB9KSkpKSkgfSksICExIH0gfSwgX21vdXNlU3RvcDogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzOyByZXR1cm4gdGhpcy5kcmFnZ2VkID0gITEsIGUoIi51aS11bnNlbGVjdGluZyIsIHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBzID0gZS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsgaS5fcmVtb3ZlQ2xhc3Mocy4kZWxlbWVudCwgInVpLXVuc2VsZWN0aW5nIiksIHMudW5zZWxlY3RpbmcgPSAhMSwgcy5zdGFydHNlbGVjdGVkID0gITEsIGkuX3RyaWdnZXIoInVuc2VsZWN0ZWQiLCB0LCB7IHVuc2VsZWN0ZWQ6IHMuZWxlbWVudCB9KSB9KSwgZSgiLnVpLXNlbGVjdGluZyIsIHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBzID0gZS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsgaS5fcmVtb3ZlQ2xhc3Mocy4kZWxlbWVudCwgInVpLXNlbGVjdGluZyIpLl9hZGRDbGFzcyhzLiRlbGVtZW50LCAidWktc2VsZWN0ZWQiKSwgcy5zZWxlY3RpbmcgPSAhMSwgcy5zZWxlY3RlZCA9ICEwLCBzLnN0YXJ0c2VsZWN0ZWQgPSAhMCwgaS5fdHJpZ2dlcigic2VsZWN0ZWQiLCB0LCB7IHNlbGVjdGVkOiBzLmVsZW1lbnQgfSkgfSksIHRoaXMuX3RyaWdnZXIoInN0b3AiLCB0KSwgdGhpcy5oZWxwZXIucmVtb3ZlKCksICExIH0gfSksIGUud2lkZ2V0KCJ1aS5zb3J0YWJsZSIsIGUudWkubW91c2UsIHsgdmVyc2lvbjogIjEuMTIuMSIsIHdpZGdldEV2ZW50UHJlZml4OiAic29ydCIsIHJlYWR5OiAhMSwgb3B0aW9uczogeyBhcHBlbmRUbzogInBhcmVudCIsIGF4aXM6ICExLCBjb25uZWN0V2l0aDogITEsIGNvbnRhaW5tZW50OiAhMSwgY3Vyc29yOiAiYXV0byIsIGN1cnNvckF0OiAhMSwgZHJvcE9uRW1wdHk6ICEwLCBmb3JjZVBsYWNlaG9sZGVyU2l6ZTogITEsIGZvcmNlSGVscGVyU2l6ZTogITEsIGdyaWQ6ICExLCBoYW5kbGU6ICExLCBoZWxwZXI6ICJvcmlnaW5hbCIsIGl0ZW1zOiAiPiAqIiwgb3BhY2l0eTogITEsIHBsYWNlaG9sZGVyOiAhMSwgcmV2ZXJ0OiAhMSwgc2Nyb2xsOiAhMCwgc2Nyb2xsU2Vuc2l0aXZpdHk6IDIwLCBzY3JvbGxTcGVlZDogMjAsIHNjb3BlOiAiZGVmYXVsdCIsIHRvbGVyYW5jZTogImludGVyc2VjdCIsIHpJbmRleDogMWUzLCBhY3RpdmF0ZTogbnVsbCwgYmVmb3JlU3RvcDogbnVsbCwgY2hhbmdlOiBudWxsLCBkZWFjdGl2YXRlOiBudWxsLCBvdXQ6IG51bGwsIG92ZXI6IG51bGwsIHJlY2VpdmU6IG51bGwsIHJlbW92ZTogbnVsbCwgc29ydDogbnVsbCwgc3RhcnQ6IG51bGwsIHN0b3A6IG51bGwsIHVwZGF0ZTogbnVsbCB9LCBfaXNPdmVyQXhpczogZnVuY3Rpb24gKGUsIHQsIGkpIHsgcmV0dXJuIGUgPj0gdCAmJiB0ICsgaSA+IGUgfSwgX2lzRmxvYXRpbmc6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAvbGVmdHxyaWdodC8udGVzdChlLmNzcygiZmxvYXQiKSkgfHwgL2lubGluZXx0YWJsZS1jZWxsLy50ZXN0KGUuY3NzKCJkaXNwbGF5IikpIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdGhpcy5jb250YWluZXJDYWNoZSA9IHt9LCB0aGlzLl9hZGRDbGFzcygidWktc29ydGFibGUiKSwgdGhpcy5yZWZyZXNoKCksIHRoaXMub2Zmc2V0ID0gdGhpcy5lbGVtZW50Lm9mZnNldCgpLCB0aGlzLl9tb3VzZUluaXQoKSwgdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMucmVhZHkgPSAhMCB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyB0aGlzLl9zdXBlcihlLCB0KSwgImhhbmRsZSIgPT09IGUgJiYgdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCkgfSwgX3NldEhhbmRsZUNsYXNzTmFtZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXM7IHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuZWxlbWVudC5maW5kKCIudWktc29ydGFibGUtaGFuZGxlIiksICJ1aS1zb3J0YWJsZS1oYW5kbGUiKSwgZS5lYWNoKHRoaXMuaXRlbXMsIGZ1bmN0aW9uICgpIHsgdC5fYWRkQ2xhc3ModGhpcy5pbnN0YW5jZS5vcHRpb25zLmhhbmRsZSA/IHRoaXMuaXRlbS5maW5kKHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUpIDogdGhpcy5pdGVtLCAidWktc29ydGFibGUtaGFuZGxlIikgfSkgfSwgX2Rlc3Ryb3k6IGZ1bmN0aW9uICgpIHsgdGhpcy5fbW91c2VEZXN0cm95KCk7IGZvciAodmFyIGUgPSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7IGUgPj0gMDsgZS0tKXRoaXMuaXRlbXNbZV0uaXRlbS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0TmFtZSArICItaXRlbSIpOyByZXR1cm4gdGhpcyB9LCBfbW91c2VDYXB0dXJlOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IG51bGwsIGEgPSAhMSwgbiA9IHRoaXM7IHJldHVybiB0aGlzLnJldmVydGluZyA/ICExIDogdGhpcy5vcHRpb25zLmRpc2FibGVkIHx8ICJzdGF0aWMiID09PSB0aGlzLm9wdGlvbnMudHlwZSA/ICExIDogKHRoaXMuX3JlZnJlc2hJdGVtcyh0KSwgZSh0LnRhcmdldCkucGFyZW50cygpLmVhY2goZnVuY3Rpb24gKCkgeyByZXR1cm4gZS5kYXRhKHRoaXMsIG4ud2lkZ2V0TmFtZSArICItaXRlbSIpID09PSBuID8gKHMgPSBlKHRoaXMpLCAhMSkgOiB2b2lkIDAgfSksIGUuZGF0YSh0LnRhcmdldCwgbi53aWRnZXROYW1lICsgIi1pdGVtIikgPT09IG4gJiYgKHMgPSBlKHQudGFyZ2V0KSksIHMgPyAhdGhpcy5vcHRpb25zLmhhbmRsZSB8fCBpIHx8IChlKHRoaXMub3B0aW9ucy5oYW5kbGUsIHMpLmZpbmQoIioiKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbiAoKSB7IHRoaXMgPT09IHQudGFyZ2V0ICYmIChhID0gITApIH0pLCBhKSA/ICh0aGlzLmN1cnJlbnRJdGVtID0gcywgdGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKSwgITApIDogITEgOiAhMSkgfSwgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuLCByID0gdGhpcy5vcHRpb25zOyBpZiAodGhpcy5jdXJyZW50Q29udGFpbmVyID0gdGhpcywgdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksIHRoaXMuaGVscGVyID0gdGhpcy5fY3JlYXRlSGVscGVyKHQpLCB0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCksIHRoaXMuX2NhY2hlTWFyZ2lucygpLCB0aGlzLnNjcm9sbFBhcmVudCA9IHRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpLCB0aGlzLm9mZnNldCA9IHRoaXMuY3VycmVudEl0ZW0ub2Zmc2V0KCksIHRoaXMub2Zmc2V0ID0geyB0b3A6IHRoaXMub2Zmc2V0LnRvcCAtIHRoaXMubWFyZ2lucy50b3AsIGxlZnQ6IHRoaXMub2Zmc2V0LmxlZnQgLSB0aGlzLm1hcmdpbnMubGVmdCB9LCBlLmV4dGVuZCh0aGlzLm9mZnNldCwgeyBjbGljazogeyBsZWZ0OiB0LnBhZ2VYIC0gdGhpcy5vZmZzZXQubGVmdCwgdG9wOiB0LnBhZ2VZIC0gdGhpcy5vZmZzZXQudG9wIH0sIHBhcmVudDogdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCksIHJlbGF0aXZlOiB0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpIH0pLCB0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIiksIHRoaXMuY3NzUG9zaXRpb24gPSB0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIiksIHRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMuX2dlbmVyYXRlUG9zaXRpb24odCksIHRoaXMub3JpZ2luYWxQYWdlWCA9IHQucGFnZVgsIHRoaXMub3JpZ2luYWxQYWdlWSA9IHQucGFnZVksIHIuY3Vyc29yQXQgJiYgdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihyLmN1cnNvckF0KSwgdGhpcy5kb21Qb3NpdGlvbiA9IHsgcHJldjogdGhpcy5jdXJyZW50SXRlbS5wcmV2KClbMF0sIHBhcmVudDogdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXSB9LCB0aGlzLmhlbHBlclswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSAmJiB0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKSwgdGhpcy5fY3JlYXRlUGxhY2Vob2xkZXIoKSwgci5jb250YWlubWVudCAmJiB0aGlzLl9zZXRDb250YWlubWVudCgpLCByLmN1cnNvciAmJiAiYXV0byIgIT09IHIuY3Vyc29yICYmIChuID0gdGhpcy5kb2N1bWVudC5maW5kKCJib2R5IiksIHRoaXMuc3RvcmVkQ3Vyc29yID0gbi5jc3MoImN1cnNvciIpLCBuLmNzcygiY3Vyc29yIiwgci5jdXJzb3IpLCB0aGlzLnN0b3JlZFN0eWxlc2hlZXQgPSBlKCI8c3R5bGU+KnsgY3Vyc29yOiAiICsgci5jdXJzb3IgKyAiICFpbXBvcnRhbnQ7IH08L3N0eWxlPiIpLmFwcGVuZFRvKG4pKSwgci5vcGFjaXR5ICYmICh0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiKSAmJiAodGhpcy5fc3RvcmVkT3BhY2l0eSA9IHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIpKSwgdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5Iiwgci5vcGFjaXR5KSksIHIuekluZGV4ICYmICh0aGlzLmhlbHBlci5jc3MoInpJbmRleCIpICYmICh0aGlzLl9zdG9yZWRaSW5kZXggPSB0aGlzLmhlbHBlci5jc3MoInpJbmRleCIpKSwgdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLCByLnpJbmRleCkpLCB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXSAmJiAiSFRNTCIgIT09IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgJiYgKHRoaXMub3ZlcmZsb3dPZmZzZXQgPSB0aGlzLnNjcm9sbFBhcmVudC5vZmZzZXQoKSksIHRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgdCwgdGhpcy5fdWlIYXNoKCkpLCB0aGlzLl9wcmVzZXJ2ZUhlbHBlclByb3BvcnRpb25zIHx8IHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSwgIXMpIGZvciAoYSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBhID49IDA7IGEtLSl0aGlzLmNvbnRhaW5lcnNbYV0uX3RyaWdnZXIoImFjdGl2YXRlIiwgdCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsgcmV0dXJuIGUudWkuZGRtYW5hZ2VyICYmIChlLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpcyksIGUudWkuZGRtYW5hZ2VyICYmICFyLmRyb3BCZWhhdmlvdXIgJiYgZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcywgdCksIHRoaXMuZHJhZ2dpbmcgPSAhMCwgdGhpcy5fYWRkQ2xhc3ModGhpcy5oZWxwZXIsICJ1aS1zb3J0YWJsZS1oZWxwZXIiKSwgdGhpcy5fbW91c2VEcmFnKHQpLCAhMCB9LCBfbW91c2VEcmFnOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcywgYSwgbiwgciA9IHRoaXMub3B0aW9ucywgbyA9ICExOyBmb3IgKHRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKHQpLCB0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIiksIHRoaXMubGFzdFBvc2l0aW9uQWJzIHx8ICh0aGlzLmxhc3RQb3NpdGlvbkFicyA9IHRoaXMucG9zaXRpb25BYnMpLCB0aGlzLm9wdGlvbnMuc2Nyb2xsICYmICh0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXSAmJiAiSFRNTCIgIT09IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgPyAodGhpcy5vdmVyZmxvd09mZnNldC50b3AgKyB0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQgLSB0LnBhZ2VZIDwgci5zY3JvbGxTZW5zaXRpdml0eSA/IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCA9IG8gPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgKyByLnNjcm9sbFNwZWVkIDogdC5wYWdlWSAtIHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wIDwgci5zY3JvbGxTZW5zaXRpdml0eSAmJiAodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wID0gbyA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCAtIHIuc2Nyb2xsU3BlZWQpLCB0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQgKyB0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aCAtIHQucGFnZVggPCByLnNjcm9sbFNlbnNpdGl2aXR5ID8gdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCA9IG8gPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ICsgci5zY3JvbGxTcGVlZCA6IHQucGFnZVggLSB0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQgPCByLnNjcm9sbFNlbnNpdGl2aXR5ICYmICh0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gbyA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgLSByLnNjcm9sbFNwZWVkKSkgOiAodC5wYWdlWSAtIHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkgPCByLnNjcm9sbFNlbnNpdGl2aXR5ID8gbyA9IHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkgLSByLnNjcm9sbFNwZWVkKSA6IHRoaXMud2luZG93LmhlaWdodCgpIC0gKHQucGFnZVkgLSB0aGlzLmRvY3VtZW50LnNjcm9sbFRvcCgpKSA8IHIuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKG8gPSB0aGlzLmRvY3VtZW50LnNjcm9sbFRvcCh0aGlzLmRvY3VtZW50LnNjcm9sbFRvcCgpICsgci5zY3JvbGxTcGVlZCkpLCB0LnBhZ2VYIC0gdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCkgPCByLnNjcm9sbFNlbnNpdGl2aXR5ID8gbyA9IHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCh0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKSAtIHIuc2Nyb2xsU3BlZWQpIDogdGhpcy53aW5kb3cud2lkdGgoKSAtICh0LnBhZ2VYIC0gdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCkpIDwgci5zY3JvbGxTZW5zaXRpdml0eSAmJiAobyA9IHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCh0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKSArIHIuc2Nyb2xsU3BlZWQpKSksIG8gIT09ICExICYmIGUudWkuZGRtYW5hZ2VyICYmICFyLmRyb3BCZWhhdmlvdXIgJiYgZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcywgdCkpLCB0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIiksIHRoaXMub3B0aW9ucy5heGlzICYmICJ5IiA9PT0gdGhpcy5vcHRpb25zLmF4aXMgfHwgKHRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQgPSB0aGlzLnBvc2l0aW9uLmxlZnQgKyAicHgiKSwgdGhpcy5vcHRpb25zLmF4aXMgJiYgIngiID09PSB0aGlzLm9wdGlvbnMuYXhpcyB8fCAodGhpcy5oZWxwZXJbMF0uc3R5bGUudG9wID0gdGhpcy5wb3NpdGlvbi50b3AgKyAicHgiKSwgaSA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0paWYgKHMgPSB0aGlzLml0ZW1zW2ldLCBhID0gcy5pdGVtWzBdLCBuID0gdGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKHMpLCBuICYmIHMuaW5zdGFuY2UgPT09IHRoaXMuY3VycmVudENvbnRhaW5lciAmJiBhICE9PSB0aGlzLmN1cnJlbnRJdGVtWzBdICYmIHRoaXMucGxhY2Vob2xkZXJbMSA9PT0gbiA/ICJuZXh0IiA6ICJwcmV2Il0oKVswXSAhPT0gYSAmJiAhZS5jb250YWlucyh0aGlzLnBsYWNlaG9sZGVyWzBdLCBhKSAmJiAoInNlbWktZHluYW1pYyIgPT09IHRoaXMub3B0aW9ucy50eXBlID8gIWUuY29udGFpbnModGhpcy5lbGVtZW50WzBdLCBhKSA6ICEwKSkgeyBpZiAodGhpcy5kaXJlY3Rpb24gPSAxID09PSBuID8gImRvd24iIDogInVwIiwgInBvaW50ZXIiICE9PSB0aGlzLm9wdGlvbnMudG9sZXJhbmNlICYmICF0aGlzLl9pbnRlcnNlY3RzV2l0aFNpZGVzKHMpKSBicmVhazsgdGhpcy5fcmVhcnJhbmdlKHQsIHMpLCB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCB0LCB0aGlzLl91aUhhc2goKSk7IGJyZWFrIH0gcmV0dXJuIHRoaXMuX2NvbnRhY3RDb250YWluZXJzKHQpLCBlLnVpLmRkbWFuYWdlciAmJiBlLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsIHQpLCB0aGlzLl90cmlnZ2VyKCJzb3J0IiwgdCwgdGhpcy5fdWlIYXNoKCkpLCB0aGlzLmxhc3RQb3NpdGlvbkFicyA9IHRoaXMucG9zaXRpb25BYnMsICExIH0sIF9tb3VzZVN0b3A6IGZ1bmN0aW9uICh0LCBpKSB7IGlmICh0KSB7IGlmIChlLnVpLmRkbWFuYWdlciAmJiAhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXIgJiYgZS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLCB0KSwgdGhpcy5vcHRpb25zLnJldmVydCkgeyB2YXIgcyA9IHRoaXMsIGEgPSB0aGlzLnBsYWNlaG9sZGVyLm9mZnNldCgpLCBuID0gdGhpcy5vcHRpb25zLmF4aXMsIHIgPSB7fTsgbiAmJiAieCIgIT09IG4gfHwgKHIubGVmdCA9IGEubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQgKyAodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYm9keSA/IDAgOiB0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSksIG4gJiYgInkiICE9PSBuIHx8IChyLnRvcCA9IGEudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCAtIHRoaXMubWFyZ2lucy50b3AgKyAodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYm9keSA/IDAgOiB0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxUb3ApKSwgdGhpcy5yZXZlcnRpbmcgPSAhMCwgZSh0aGlzLmhlbHBlcikuYW5pbWF0ZShyLCBwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0LCAxMCkgfHwgNTAwLCBmdW5jdGlvbiAoKSB7IHMuX2NsZWFyKHQpIH0pIH0gZWxzZSB0aGlzLl9jbGVhcih0LCBpKTsgcmV0dXJuICExIH0gfSwgY2FuY2VsOiBmdW5jdGlvbiAoKSB7IGlmICh0aGlzLmRyYWdnaW5nKSB7IHRoaXMuX21vdXNlVXAobmV3IGUuRXZlbnQoIm1vdXNldXAiLCB7IHRhcmdldDogbnVsbCB9KSksICJvcmlnaW5hbCIgPT09IHRoaXMub3B0aW9ucy5oZWxwZXIgPyAodGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKSwgdGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5jdXJyZW50SXRlbSwgInVpLXNvcnRhYmxlLWhlbHBlciIpKSA6IHRoaXMuY3VycmVudEl0ZW0uc2hvdygpOyBmb3IgKHZhciB0ID0gdGhpcy5jb250YWluZXJzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKXRoaXMuY29udGFpbmVyc1t0XS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIG51bGwsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1t0XS5jb250YWluZXJDYWNoZS5vdmVyICYmICh0aGlzLmNvbnRhaW5lcnNbdF0uX3RyaWdnZXIoIm91dCIsIG51bGwsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1t0XS5jb250YWluZXJDYWNoZS5vdmVyID0gMCkgfSByZXR1cm4gdGhpcy5wbGFjZWhvbGRlciAmJiAodGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlICYmIHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKSwgIm9yaWdpbmFsIiAhPT0gdGhpcy5vcHRpb25zLmhlbHBlciAmJiB0aGlzLmhlbHBlciAmJiB0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlICYmIHRoaXMuaGVscGVyLnJlbW92ZSgpLCBlLmV4dGVuZCh0aGlzLCB7IGhlbHBlcjogbnVsbCwgZHJhZ2dpbmc6ICExLCByZXZlcnRpbmc6ICExLCBfbm9GaW5hbFNvcnQ6IG51bGwgfSksIHRoaXMuZG9tUG9zaXRpb24ucHJldiA/IGUodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKSA6IGUodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5jdXJyZW50SXRlbSkpLCB0aGlzIH0sIHNlcmlhbGl6ZTogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KHQgJiYgdC5jb25uZWN0ZWQpLCBzID0gW107IHJldHVybiB0ID0gdCB8fCB7fSwgZShpKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGkgPSAoZSh0Lml0ZW0gfHwgdGhpcykuYXR0cih0LmF0dHJpYnV0ZSB8fCAiaWQiKSB8fCAiIikubWF0Y2godC5leHByZXNzaW9uIHx8IC8oLispW1wtPV9dKC4rKS8pOyBpICYmIHMucHVzaCgodC5rZXkgfHwgaVsxXSArICJbXSIpICsgIj0iICsgKHQua2V5ICYmIHQuZXhwcmVzc2lvbiA/IGlbMV0gOiBpWzJdKSkgfSksICFzLmxlbmd0aCAmJiB0LmtleSAmJiBzLnB1c2godC5rZXkgKyAiPSIpLCBzLmpvaW4oIiYiKSB9LCB0b0FycmF5OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMuX2dldEl0ZW1zQXNqUXVlcnkodCAmJiB0LmNvbm5lY3RlZCksIHMgPSBbXTsgcmV0dXJuIHQgPSB0IHx8IHt9LCBpLmVhY2goZnVuY3Rpb24gKCkgeyBzLnB1c2goZSh0Lml0ZW0gfHwgdGhpcykuYXR0cih0LmF0dHJpYnV0ZSB8fCAiaWQiKSB8fCAiIikgfSksIHMgfSwgX2ludGVyc2VjdHNXaXRoOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMucG9zaXRpb25BYnMubGVmdCwgaSA9IHQgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLCBzID0gdGhpcy5wb3NpdGlvbkFicy50b3AsIGEgPSBzICsgdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsIG4gPSBlLmxlZnQsIHIgPSBuICsgZS53aWR0aCwgbyA9IGUudG9wLCBsID0gbyArIGUuaGVpZ2h0LCBoID0gdGhpcy5vZmZzZXQuY2xpY2sudG9wLCB1ID0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCwgZCA9ICJ4IiA9PT0gdGhpcy5vcHRpb25zLmF4aXMgfHwgcyArIGggPiBvICYmIGwgPiBzICsgaCwgYyA9ICJ5IiA9PT0gdGhpcy5vcHRpb25zLmF4aXMgfHwgdCArIHUgPiBuICYmIHIgPiB0ICsgdSwgcCA9IGQgJiYgYzsgcmV0dXJuICJwb2ludGVyIiA9PT0gdGhpcy5vcHRpb25zLnRvbGVyYW5jZSB8fCB0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVycyB8fCAicG9pbnRlciIgIT09IHRoaXMub3B0aW9ucy50b2xlcmFuY2UgJiYgdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nID8gIndpZHRoIiA6ICJoZWlnaHQiXSA+IGVbdGhpcy5mbG9hdGluZyA/ICJ3aWR0aCIgOiAiaGVpZ2h0Il0gPyBwIDogdCArIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLyAyID4gbiAmJiByID4gaSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLyAyICYmIHMgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIgPiBvICYmIGwgPiBhIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLyAyIH0sIF9pbnRlcnNlY3RzV2l0aFBvaW50ZXI6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBpLCBzID0gIngiID09PSB0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wLCBlLnRvcCwgZS5oZWlnaHQpLCBhID0gInkiID09PSB0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQsIGUubGVmdCwgZS53aWR0aCksIG4gPSBzICYmIGE7IHJldHVybiBuID8gKHQgPSB0aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSwgaSA9IHRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCksIHRoaXMuZmxvYXRpbmcgPyAicmlnaHQiID09PSBpIHx8ICJkb3duIiA9PT0gdCA/IDIgOiAxIDogdCAmJiAoImRvd24iID09PSB0ID8gMiA6IDEpKSA6ICExIH0sIF9pbnRlcnNlY3RzV2l0aFNpZGVzOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMuX2lzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3AgKyB0aGlzLm9mZnNldC5jbGljay50b3AsIGUudG9wICsgZS5oZWlnaHQgLyAyLCBlLmhlaWdodCksIGkgPSB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQsIGUubGVmdCArIGUud2lkdGggLyAyLCBlLndpZHRoKSwgcyA9IHRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLCBhID0gdGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTsgcmV0dXJuIHRoaXMuZmxvYXRpbmcgJiYgYSA/ICJyaWdodCIgPT09IGEgJiYgaSB8fCAibGVmdCIgPT09IGEgJiYgIWkgOiBzICYmICgiZG93biIgPT09IHMgJiYgdCB8fCAidXAiID09PSBzICYmICF0KSB9LCBfZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5wb3NpdGlvbkFicy50b3AgLSB0aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7IHJldHVybiAwICE9PSBlICYmIChlID4gMCA/ICJkb3duIiA6ICJ1cCIpIH0sIF9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbjogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMucG9zaXRpb25BYnMubGVmdCAtIHRoaXMubGFzdFBvc2l0aW9uQWJzLmxlZnQ7IHJldHVybiAwICE9PSBlICYmIChlID4gMCA/ICJyaWdodCIgOiAibGVmdCIpIH0sIHJlZnJlc2g6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLl9yZWZyZXNoSXRlbXMoZSksIHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpLCB0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKSwgdGhpcyB9LCBfY29ubmVjdFdpdGg6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLm9wdGlvbnM7IHJldHVybiBlLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBbZS5jb25uZWN0V2l0aF0gOiBlLmNvbm5lY3RXaXRoIH0sIF9nZXRJdGVtc0FzalF1ZXJ5OiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBpKCkgeyBvLnB1c2godGhpcykgfSB2YXIgcywgYSwgbiwgciwgbyA9IFtdLCBsID0gW10sIGggPSB0aGlzLl9jb25uZWN0V2l0aCgpOyBpZiAoaCAmJiB0KSBmb3IgKHMgPSBoLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKWZvciAobiA9IGUoaFtzXSwgdGhpcy5kb2N1bWVudFswXSksIGEgPSBuLmxlbmd0aCAtIDE7IGEgPj0gMDsgYS0tKXIgPSBlLmRhdGEoblthXSwgdGhpcy53aWRnZXRGdWxsTmFtZSksIHIgJiYgciAhPT0gdGhpcyAmJiAhci5vcHRpb25zLmRpc2FibGVkICYmIGwucHVzaChbZS5pc0Z1bmN0aW9uKHIub3B0aW9ucy5pdGVtcykgPyByLm9wdGlvbnMuaXRlbXMuY2FsbChyLmVsZW1lbnQpIDogZShyLm9wdGlvbnMuaXRlbXMsIHIuZWxlbWVudCkubm90KCIudWktc29ydGFibGUtaGVscGVyIikubm90KCIudWktc29ydGFibGUtcGxhY2Vob2xkZXIiKSwgcl0pOyBmb3IgKGwucHVzaChbZS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5pdGVtcykgPyB0aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnQsIG51bGwsIHsgb3B0aW9uczogdGhpcy5vcHRpb25zLCBpdGVtOiB0aGlzLmN1cnJlbnRJdGVtIH0pIDogZSh0aGlzLm9wdGlvbnMuaXRlbXMsIHRoaXMuZWxlbWVudCkubm90KCIudWktc29ydGFibGUtaGVscGVyIikubm90KCIudWktc29ydGFibGUtcGxhY2Vob2xkZXIiKSwgdGhpc10pLCBzID0gbC5sZW5ndGggLSAxOyBzID49IDA7IHMtLSlsW3NdWzBdLmVhY2goaSk7IHJldHVybiBlKG8pIH0sIF9yZW1vdmVDdXJyZW50c0Zyb21JdGVtczogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuY3VycmVudEl0ZW0uZmluZCgiOmRhdGEoIiArIHRoaXMud2lkZ2V0TmFtZSArICItaXRlbSkiKTsgdGhpcy5pdGVtcyA9IGUuZ3JlcCh0aGlzLml0ZW1zLCBmdW5jdGlvbiAoZSkgeyBmb3IgKHZhciBpID0gMDsgdC5sZW5ndGggPiBpOyBpKyspaWYgKHRbaV0gPT09IGUuaXRlbVswXSkgcmV0dXJuICExOyByZXR1cm4gITAgfSkgfSwgX3JlZnJlc2hJdGVtczogZnVuY3Rpb24gKHQpIHsgdGhpcy5pdGVtcyA9IFtdLCB0aGlzLmNvbnRhaW5lcnMgPSBbdGhpc107IHZhciBpLCBzLCBhLCBuLCByLCBvLCBsLCBoLCB1ID0gdGhpcy5pdGVtcywgZCA9IFtbZS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5pdGVtcykgPyB0aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sIHQsIHsgaXRlbTogdGhpcy5jdXJyZW50SXRlbSB9KSA6IGUodGhpcy5vcHRpb25zLml0ZW1zLCB0aGlzLmVsZW1lbnQpLCB0aGlzXV0sIGMgPSB0aGlzLl9jb25uZWN0V2l0aCgpOyBpZiAoYyAmJiB0aGlzLnJlYWR5KSBmb3IgKGkgPSBjLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKWZvciAoYSA9IGUoY1tpXSwgdGhpcy5kb2N1bWVudFswXSksIHMgPSBhLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKW4gPSBlLmRhdGEoYVtzXSwgdGhpcy53aWRnZXRGdWxsTmFtZSksIG4gJiYgbiAhPT0gdGhpcyAmJiAhbi5vcHRpb25zLmRpc2FibGVkICYmIChkLnB1c2goW2UuaXNGdW5jdGlvbihuLm9wdGlvbnMuaXRlbXMpID8gbi5vcHRpb25zLml0ZW1zLmNhbGwobi5lbGVtZW50WzBdLCB0LCB7IGl0ZW06IHRoaXMuY3VycmVudEl0ZW0gfSkgOiBlKG4ub3B0aW9ucy5pdGVtcywgbi5lbGVtZW50KSwgbl0pLCB0aGlzLmNvbnRhaW5lcnMucHVzaChuKSk7IGZvciAoaSA9IGQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pZm9yIChyID0gZFtpXVsxXSwgbyA9IGRbaV1bMF0sIHMgPSAwLCBoID0gby5sZW5ndGg7IGggPiBzOyBzKyspbCA9IGUob1tzXSksIGwuZGF0YSh0aGlzLndpZGdldE5hbWUgKyAiLWl0ZW0iLCByKSwgdS5wdXNoKHsgaXRlbTogbCwgaW5zdGFuY2U6IHIsIHdpZHRoOiAwLCBoZWlnaHQ6IDAsIGxlZnQ6IDAsIHRvcDogMCB9KSB9LCByZWZyZXNoUG9zaXRpb25zOiBmdW5jdGlvbiAodCkgeyB0aGlzLmZsb2F0aW5nID0gdGhpcy5pdGVtcy5sZW5ndGggPyAieCIgPT09IHRoaXMub3B0aW9ucy5heGlzIHx8IHRoaXMuX2lzRmxvYXRpbmcodGhpcy5pdGVtc1swXS5pdGVtKSA6ICExLCB0aGlzLm9mZnNldFBhcmVudCAmJiB0aGlzLmhlbHBlciAmJiAodGhpcy5vZmZzZXQucGFyZW50ID0gdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkpOyB2YXIgaSwgcywgYSwgbjsgZm9yIChpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlzID0gdGhpcy5pdGVtc1tpXSwgcy5pbnN0YW5jZSAhPT0gdGhpcy5jdXJyZW50Q29udGFpbmVyICYmIHRoaXMuY3VycmVudENvbnRhaW5lciAmJiBzLml0ZW1bMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0gfHwgKGEgPSB0aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudCA/IGUodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQsIHMuaXRlbSkgOiBzLml0ZW0sIHQgfHwgKHMud2lkdGggPSBhLm91dGVyV2lkdGgoKSwgcy5oZWlnaHQgPSBhLm91dGVySGVpZ2h0KCkpLCBuID0gYS5vZmZzZXQoKSwgcy5sZWZ0ID0gbi5sZWZ0LCBzLnRvcCA9IG4udG9wKTsgaWYgKHRoaXMub3B0aW9ucy5jdXN0b20gJiYgdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycykgdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycy5jYWxsKHRoaXMpOyBlbHNlIGZvciAoaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSluID0gdGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub2Zmc2V0KCksIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5sZWZ0ID0gbi5sZWZ0LCB0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUudG9wID0gbi50b3AsIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS53aWR0aCA9IHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVyV2lkdGgoKSwgdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLmhlaWdodCA9IHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVySGVpZ2h0KCk7IHJldHVybiB0aGlzIH0sIF9jcmVhdGVQbGFjZWhvbGRlcjogZnVuY3Rpb24gKHQpIHsgdCA9IHQgfHwgdGhpczsgdmFyIGksIHMgPSB0Lm9wdGlvbnM7IHMucGxhY2Vob2xkZXIgJiYgcy5wbGFjZWhvbGRlci5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nIHx8IChpID0gcy5wbGFjZWhvbGRlciwgcy5wbGFjZWhvbGRlciA9IHsgZWxlbWVudDogZnVuY3Rpb24gKCkgeyB2YXIgcyA9IHQuY3VycmVudEl0ZW1bMF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwgYSA9IGUoIjwiICsgcyArICI+IiwgdC5kb2N1bWVudFswXSk7IHJldHVybiB0Ll9hZGRDbGFzcyhhLCAidWktc29ydGFibGUtcGxhY2Vob2xkZXIiLCBpIHx8IHQuY3VycmVudEl0ZW1bMF0uY2xhc3NOYW1lKS5fcmVtb3ZlQ2xhc3MoYSwgInVpLXNvcnRhYmxlLWhlbHBlciIpLCAidGJvZHkiID09PSBzID8gdC5fY3JlYXRlVHJQbGFjZWhvbGRlcih0LmN1cnJlbnRJdGVtLmZpbmQoInRyIikuZXEoMCksIGUoIjx0cj4iLCB0LmRvY3VtZW50WzBdKS5hcHBlbmRUbyhhKSkgOiAidHIiID09PSBzID8gdC5fY3JlYXRlVHJQbGFjZWhvbGRlcih0LmN1cnJlbnRJdGVtLCBhKSA6ICJpbWciID09PSBzICYmIGEuYXR0cigic3JjIiwgdC5jdXJyZW50SXRlbS5hdHRyKCJzcmMiKSksIGkgfHwgYS5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIiksIGEgfSwgdXBkYXRlOiBmdW5jdGlvbiAoZSwgYSkgeyAoIWkgfHwgcy5mb3JjZVBsYWNlaG9sZGVyU2l6ZSkgJiYgKGEuaGVpZ2h0KCkgfHwgYS5oZWlnaHQodC5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpIC0gcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdUb3AiKSB8fCAwLCAxMCkgLSBwYXJzZUludCh0LmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ0JvdHRvbSIpIHx8IDAsIDEwKSksIGEud2lkdGgoKSB8fCBhLndpZHRoKHQuY3VycmVudEl0ZW0uaW5uZXJXaWR0aCgpIC0gcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdMZWZ0IikgfHwgMCwgMTApIC0gcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdSaWdodCIpIHx8IDAsIDEwKSkpIH0gfSksIHQucGxhY2Vob2xkZXIgPSBlKHMucGxhY2Vob2xkZXIuZWxlbWVudC5jYWxsKHQuZWxlbWVudCwgdC5jdXJyZW50SXRlbSkpLCB0LmN1cnJlbnRJdGVtLmFmdGVyKHQucGxhY2Vob2xkZXIpLCBzLnBsYWNlaG9sZGVyLnVwZGF0ZSh0LCB0LnBsYWNlaG9sZGVyKSB9LCBfY3JlYXRlVHJQbGFjZWhvbGRlcjogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSB0aGlzOyB0LmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7IGUoIjx0ZD4mIzE2MDs8L3RkPiIsIHMuZG9jdW1lbnRbMF0pLmF0dHIoImNvbHNwYW4iLCBlKHRoaXMpLmF0dHIoImNvbHNwYW4iKSB8fCAxKS5hcHBlbmRUbyhpKSB9KSB9LCBfY29udGFjdENvbnRhaW5lcnM6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhLCBuLCByLCBvLCBsLCBoLCB1LCBkLCBjID0gbnVsbCwgcCA9IG51bGw7IGZvciAoaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlpZiAoIWUuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSwgdGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnRbMF0pKSBpZiAodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlKSkgeyBpZiAoYyAmJiBlLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50WzBdLCBjLmVsZW1lbnRbMF0pKSBjb250aW51ZTsgYyA9IHRoaXMuY29udGFpbmVyc1tpXSwgcCA9IGkgfSBlbHNlIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyICYmICh0aGlzLmNvbnRhaW5lcnNbaV0uX3RyaWdnZXIoIm91dCIsIHQsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyID0gMCk7IGlmIChjKSBpZiAoMSA9PT0gdGhpcy5jb250YWluZXJzLmxlbmd0aCkgdGhpcy5jb250YWluZXJzW3BdLmNvbnRhaW5lckNhY2hlLm92ZXIgfHwgKHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcigib3ZlciIsIHQsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyID0gMSk7IGVsc2UgeyBmb3IgKGEgPSAxZTQsIG4gPSBudWxsLCB1ID0gYy5mbG9hdGluZyB8fCB0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuY3VycmVudEl0ZW0pLCByID0gdSA/ICJsZWZ0IiA6ICJ0b3AiLCBvID0gdSA/ICJ3aWR0aCIgOiAiaGVpZ2h0IiwgZCA9IHUgPyAicGFnZVgiIDogInBhZ2VZIiwgcyA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgcyA+PSAwOyBzLS0pZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudFswXSwgdGhpcy5pdGVtc1tzXS5pdGVtWzBdKSAmJiB0aGlzLml0ZW1zW3NdLml0ZW1bMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0gJiYgKGwgPSB0aGlzLml0ZW1zW3NdLml0ZW0ub2Zmc2V0KClbcl0sIGggPSAhMSwgdFtkXSAtIGwgPiB0aGlzLml0ZW1zW3NdW29dIC8gMiAmJiAoaCA9ICEwKSwgYSA+IE1hdGguYWJzKHRbZF0gLSBsKSAmJiAoYSA9IE1hdGguYWJzKHRbZF0gLSBsKSwgbiA9IHRoaXMuaXRlbXNbc10sIHRoaXMuZGlyZWN0aW9uID0gaCA/ICJ1cCIgOiAiZG93biIpKTsgaWYgKCFuICYmICF0aGlzLm9wdGlvbnMuZHJvcE9uRW1wdHkpIHJldHVybjsgaWYgKHRoaXMuY3VycmVudENvbnRhaW5lciA9PT0gdGhpcy5jb250YWluZXJzW3BdKSByZXR1cm4gdGhpcy5jdXJyZW50Q29udGFpbmVyLmNvbnRhaW5lckNhY2hlLm92ZXIgfHwgKHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcigib3ZlciIsIHQsIHRoaXMuX3VpSGFzaCgpKSwgdGhpcy5jdXJyZW50Q29udGFpbmVyLmNvbnRhaW5lckNhY2hlLm92ZXIgPSAxKSwgdm9pZCAwOyBuID8gdGhpcy5fcmVhcnJhbmdlKHQsIG4sIG51bGwsICEwKSA6IHRoaXMuX3JlYXJyYW5nZSh0LCBudWxsLCB0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudCwgITApLCB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCB0LCB0aGlzLl91aUhhc2goKSksIHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcigiY2hhbmdlIiwgdCwgdGhpcy5fdWlIYXNoKHRoaXMpKSwgdGhpcy5jdXJyZW50Q29udGFpbmVyID0gdGhpcy5jb250YWluZXJzW3BdLCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lciwgdGhpcy5wbGFjZWhvbGRlciksIHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcigib3ZlciIsIHQsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyID0gMSB9IH0sIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5vcHRpb25zLCBzID0gZS5pc0Z1bmN0aW9uKGkuaGVscGVyKSA/IGUoaS5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLCBbdCwgdGhpcy5jdXJyZW50SXRlbV0pKSA6ICJjbG9uZSIgPT09IGkuaGVscGVyID8gdGhpcy5jdXJyZW50SXRlbS5jbG9uZSgpIDogdGhpcy5jdXJyZW50SXRlbTsgcmV0dXJuIHMucGFyZW50cygiYm9keSIpLmxlbmd0aCB8fCBlKCJwYXJlbnQiICE9PSBpLmFwcGVuZFRvID8gaS5hcHBlbmRUbyA6IHRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0uYXBwZW5kQ2hpbGQoc1swXSksIHNbMF0gPT09IHRoaXMuY3VycmVudEl0ZW1bMF0gJiYgKHRoaXMuX3N0b3JlZENTUyA9IHsgd2lkdGg6IHRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUud2lkdGgsIGhlaWdodDogdGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS5oZWlnaHQsIHBvc2l0aW9uOiB0aGlzLmN1cnJlbnRJdGVtLmNzcygicG9zaXRpb24iKSwgdG9wOiB0aGlzLmN1cnJlbnRJdGVtLmNzcygidG9wIiksIGxlZnQ6IHRoaXMuY3VycmVudEl0ZW0uY3NzKCJsZWZ0IikgfSksICghc1swXS5zdHlsZS53aWR0aCB8fCBpLmZvcmNlSGVscGVyU2l6ZSkgJiYgcy53aWR0aCh0aGlzLmN1cnJlbnRJdGVtLndpZHRoKCkpLCAoIXNbMF0uc3R5bGUuaGVpZ2h0IHx8IGkuZm9yY2VIZWxwZXJTaXplKSAmJiBzLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKSwgcyB9LCBfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjogZnVuY3Rpb24gKHQpIHsgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKHQgPSB0LnNwbGl0KCIgIikpLCBlLmlzQXJyYXkodCkgJiYgKHQgPSB7IGxlZnQ6ICt0WzBdLCB0b3A6ICt0WzFdIHx8IDAgfSksICJsZWZ0IiBpbiB0ICYmICh0aGlzLm9mZnNldC5jbGljay5sZWZ0ID0gdC5sZWZ0ICsgdGhpcy5tYXJnaW5zLmxlZnQpLCAicmlnaHQiIGluIHQgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdC5yaWdodCArIHRoaXMubWFyZ2lucy5sZWZ0KSwgInRvcCIgaW4gdCAmJiAodGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdC50b3AgKyB0aGlzLm1hcmdpbnMudG9wKSwgImJvdHRvbSIgaW4gdCAmJiAodGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSB0LmJvdHRvbSArIHRoaXMubWFyZ2lucy50b3ApIH0sIF9nZXRQYXJlbnRPZmZzZXQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5vZmZzZXRQYXJlbnQgPSB0aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTsgdmFyIHQgPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTsgcmV0dXJuICJhYnNvbHV0ZSIgPT09IHRoaXMuY3NzUG9zaXRpb24gJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMuZG9jdW1lbnRbMF0gJiYgZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pICYmICh0LmxlZnQgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpLCB0LnRvcCArPSB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksICh0aGlzLm9mZnNldFBhcmVudFswXSA9PT0gdGhpcy5kb2N1bWVudFswXS5ib2R5IHx8IHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUgJiYgImh0bWwiID09PSB0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgJiYgZS51aS5pZSkgJiYgKHQgPSB7IHRvcDogMCwgbGVmdDogMCB9KSwgeyB0b3A6IHQudG9wICsgKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApLCBsZWZ0OiB0LmxlZnQgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwgMTApIHx8IDApIH0gfSwgX2dldFJlbGF0aXZlT2Zmc2V0OiBmdW5jdGlvbiAoKSB7IGlmICgicmVsYXRpdmUiID09PSB0aGlzLmNzc1Bvc2l0aW9uKSB7IHZhciBlID0gdGhpcy5jdXJyZW50SXRlbS5wb3NpdGlvbigpOyByZXR1cm4geyB0b3A6IGUudG9wIC0gKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygidG9wIiksIDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLCBsZWZ0OiBlLmxlZnQgLSAocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJsZWZ0IiksIDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSB9IH0gcmV0dXJuIHsgdG9wOiAwLCBsZWZ0OiAwIH0gfSwgX2NhY2hlTWFyZ2luczogZnVuY3Rpb24gKCkgeyB0aGlzLm1hcmdpbnMgPSB7IGxlZnQ6IHBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5MZWZ0IiksIDEwKSB8fCAwLCB0b3A6IHBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5Ub3AiKSwgMTApIHx8IDAgfSB9LCBfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczogZnVuY3Rpb24gKCkgeyB0aGlzLmhlbHBlclByb3BvcnRpb25zID0geyB3aWR0aDogdGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6IHRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCkgfSB9LCBfc2V0Q29udGFpbm1lbnQ6IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGksIHMsIGEgPSB0aGlzLm9wdGlvbnM7ICJwYXJlbnQiID09PSBhLmNvbnRhaW5tZW50ICYmIChhLmNvbnRhaW5tZW50ID0gdGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSksICgiZG9jdW1lbnQiID09PSBhLmNvbnRhaW5tZW50IHx8ICJ3aW5kb3ciID09PSBhLmNvbnRhaW5tZW50KSAmJiAodGhpcy5jb250YWlubWVudCA9IFswIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LCAwIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCwgImRvY3VtZW50IiA9PT0gYS5jb250YWlubWVudCA/IHRoaXMuZG9jdW1lbnQud2lkdGgoKSA6IHRoaXMud2luZG93LndpZHRoKCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdGhpcy5tYXJnaW5zLmxlZnQsICgiZG9jdW1lbnQiID09PSBhLmNvbnRhaW5tZW50ID8gdGhpcy5kb2N1bWVudC5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0IDogdGhpcy53aW5kb3cuaGVpZ2h0KCkgfHwgdGhpcy5kb2N1bWVudFswXS5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcF0pLCAvXihkb2N1bWVudHx3aW5kb3d8cGFyZW50KSQvLnRlc3QoYS5jb250YWlubWVudCkgfHwgKHQgPSBlKGEuY29udGFpbm1lbnQpWzBdLCBpID0gZShhLmNvbnRhaW5tZW50KS5vZmZzZXQoKSwgcyA9ICJoaWRkZW4iICE9PSBlKHQpLmNzcygib3ZlcmZsb3ciKSwgdGhpcy5jb250YWlubWVudCA9IFtpLmxlZnQgKyAocGFyc2VJbnQoZSh0KS5jc3MoImJvcmRlckxlZnRXaWR0aCIpLCAxMCkgfHwgMCkgKyAocGFyc2VJbnQoZSh0KS5jc3MoInBhZGRpbmdMZWZ0IiksIDEwKSB8fCAwKSAtIHRoaXMubWFyZ2lucy5sZWZ0LCBpLnRvcCArIChwYXJzZUludChlKHQpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApICsgKHBhcnNlSW50KGUodCkuY3NzKCJwYWRkaW5nVG9wIiksIDEwKSB8fCAwKSAtIHRoaXMubWFyZ2lucy50b3AsIGkubGVmdCArIChzID8gTWF0aC5tYXgodC5zY3JvbGxXaWR0aCwgdC5vZmZzZXRXaWR0aCkgOiB0Lm9mZnNldFdpZHRoKSAtIChwYXJzZUludChlKHQpLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksIDEwKSB8fCAwKSAtIChwYXJzZUludChlKHQpLmNzcygicGFkZGluZ1JpZ2h0IiksIDEwKSB8fCAwKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwgaS50b3AgKyAocyA/IE1hdGgubWF4KHQuc2Nyb2xsSGVpZ2h0LCB0Lm9mZnNldEhlaWdodCkgOiB0Lm9mZnNldEhlaWdodCkgLSAocGFyc2VJbnQoZSh0KS5jc3MoImJvcmRlclRvcFdpZHRoIiksIDEwKSB8fCAwKSAtIChwYXJzZUludChlKHQpLmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCkgfHwgMCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3BdKSB9LCBfY29udmVydFBvc2l0aW9uVG86IGZ1bmN0aW9uICh0LCBpKSB7IGkgfHwgKGkgPSB0aGlzLnBvc2l0aW9uKTsgdmFyIHMgPSAiYWJzb2x1dGUiID09PSB0ID8gMSA6IC0xLCBhID0gImFic29sdXRlIiAhPT0gdGhpcy5jc3NQb3NpdGlvbiB8fCB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXSAmJiBlLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLCB0aGlzLm9mZnNldFBhcmVudFswXSkgPyB0aGlzLnNjcm9sbFBhcmVudCA6IHRoaXMub2Zmc2V0UGFyZW50LCBuID0gLyhodG1sfGJvZHkpL2kudGVzdChhWzBdLnRhZ05hbWUpOyByZXR1cm4geyB0b3A6IGkudG9wICsgdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wICogcyArIHRoaXMub2Zmc2V0LnBhcmVudC50b3AgKiBzIC0gKCJmaXhlZCIgPT09IHRoaXMuY3NzUG9zaXRpb24gPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkgOiBuID8gMCA6IGEuc2Nyb2xsVG9wKCkpICogcywgbGVmdDogaS5sZWZ0ICsgdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAqIHMgKyB0aGlzLm9mZnNldC5wYXJlbnQubGVmdCAqIHMgLSAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiBuID8gMCA6IGEuc2Nyb2xsTGVmdCgpKSAqIHMgfSB9LCBfZ2VuZXJhdGVQb3NpdGlvbjogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEgPSB0aGlzLm9wdGlvbnMsIG4gPSB0LnBhZ2VYLCByID0gdC5wYWdlWSwgbyA9ICJhYnNvbHV0ZSIgIT09IHRoaXMuY3NzUG9zaXRpb24gfHwgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMuZG9jdW1lbnRbMF0gJiYgZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pID8gdGhpcy5zY3JvbGxQYXJlbnQgOiB0aGlzLm9mZnNldFBhcmVudCwgbCA9IC8oaHRtbHxib2R5KS9pLnRlc3Qob1swXS50YWdOYW1lKTsgcmV0dXJuICJyZWxhdGl2ZSIgIT09IHRoaXMuY3NzUG9zaXRpb24gfHwgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMuZG9jdW1lbnRbMF0gJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMub2Zmc2V0UGFyZW50WzBdIHx8ICh0aGlzLm9mZnNldC5yZWxhdGl2ZSA9IHRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCkpLCB0aGlzLm9yaWdpbmFsUG9zaXRpb24gJiYgKHRoaXMuY29udGFpbm1lbnQgJiYgKHQucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0IDwgdGhpcy5jb250YWlubWVudFswXSAmJiAobiA9IHRoaXMuY29udGFpbm1lbnRbMF0gKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0KSwgdC5wYWdlWSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA8IHRoaXMuY29udGFpbm1lbnRbMV0gJiYgKHIgPSB0aGlzLmNvbnRhaW5tZW50WzFdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wKSwgdC5wYWdlWCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPiB0aGlzLmNvbnRhaW5tZW50WzJdICYmIChuID0gdGhpcy5jb250YWlubWVudFsyXSArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLCB0LnBhZ2VZIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID4gdGhpcy5jb250YWlubWVudFszXSAmJiAociA9IHRoaXMuY29udGFpbm1lbnRbM10gKyB0aGlzLm9mZnNldC5jbGljay50b3ApKSwgYS5ncmlkICYmIChpID0gdGhpcy5vcmlnaW5hbFBhZ2VZICsgTWF0aC5yb3VuZCgociAtIHRoaXMub3JpZ2luYWxQYWdlWSkgLyBhLmdyaWRbMV0pICogYS5ncmlkWzFdLCByID0gdGhpcy5jb250YWlubWVudCA/IGkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPj0gdGhpcy5jb250YWlubWVudFsxXSAmJiBpIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIDw9IHRoaXMuY29udGFpbm1lbnRbM10gPyBpIDogaSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSB0aGlzLmNvbnRhaW5tZW50WzFdID8gaSAtIGEuZ3JpZFsxXSA6IGkgKyBhLmdyaWRbMV0gOiBpLCBzID0gdGhpcy5vcmlnaW5hbFBhZ2VYICsgTWF0aC5yb3VuZCgobiAtIHRoaXMub3JpZ2luYWxQYWdlWCkgLyBhLmdyaWRbMF0pICogYS5ncmlkWzBdLCBuID0gdGhpcy5jb250YWlubWVudCA/IHMgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IHRoaXMuY29udGFpbm1lbnRbMF0gJiYgcyAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPD0gdGhpcy5jb250YWlubWVudFsyXSA/IHMgOiBzIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+PSB0aGlzLmNvbnRhaW5tZW50WzBdID8gcyAtIGEuZ3JpZFswXSA6IHMgKyBhLmdyaWRbMF0gOiBzKSksIHsgdG9wOiByIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCArICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpIDogbCA/IDAgOiBvLnNjcm9sbFRvcCgpKSwgbGVmdDogbiAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0IC0gdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKyAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiBsID8gMCA6IG8uc2Nyb2xsTGVmdCgpKSB9IH0sIF9yZWFycmFuZ2U6IGZ1bmN0aW9uIChlLCB0LCBpLCBzKSB7IGkgPyBpWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pIDogdC5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sICJkb3duIiA9PT0gdGhpcy5kaXJlY3Rpb24gPyB0Lml0ZW1bMF0gOiB0Lml0ZW1bMF0ubmV4dFNpYmxpbmcpLCB0aGlzLmNvdW50ZXIgPSB0aGlzLmNvdW50ZXIgPyArK3RoaXMuY291bnRlciA6IDE7IHZhciBhID0gdGhpcy5jb3VudGVyOyB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IGEgPT09IHRoaXMuY291bnRlciAmJiB0aGlzLnJlZnJlc2hQb3NpdGlvbnMoIXMpIH0pIH0sIF9jbGVhcjogZnVuY3Rpb24gKGUsIHQpIHsgZnVuY3Rpb24gaShlLCB0LCBpKSB7IHJldHVybiBmdW5jdGlvbiAocykgeyBpLl90cmlnZ2VyKGUsIHMsIHQuX3VpSGFzaCh0KSkgfSB9IHRoaXMucmV2ZXJ0aW5nID0gITE7IHZhciBzLCBhID0gW107IGlmICghdGhpcy5fbm9GaW5hbFNvcnQgJiYgdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKS5sZW5ndGggJiYgdGhpcy5wbGFjZWhvbGRlci5iZWZvcmUodGhpcy5jdXJyZW50SXRlbSksIHRoaXMuX25vRmluYWxTb3J0ID0gbnVsbCwgdGhpcy5oZWxwZXJbMF0gPT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsgZm9yIChzIGluIHRoaXMuX3N0b3JlZENTUykgKCJhdXRvIiA9PT0gdGhpcy5fc3RvcmVkQ1NTW3NdIHx8ICJzdGF0aWMiID09PSB0aGlzLl9zdG9yZWRDU1Nbc10pICYmICh0aGlzLl9zdG9yZWRDU1Nbc10gPSAiIik7IHRoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUyksIHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuY3VycmVudEl0ZW0sICJ1aS1zb3J0YWJsZS1oZWxwZXIiKSB9IGVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7IGZvciAodGhpcy5mcm9tT3V0c2lkZSAmJiAhdCAmJiBhLnB1c2goZnVuY3Rpb24gKGUpIHsgdGhpcy5fdHJpZ2dlcigicmVjZWl2ZSIsIGUsIHRoaXMuX3VpSGFzaCh0aGlzLmZyb21PdXRzaWRlKSkgfSksICF0aGlzLmZyb21PdXRzaWRlICYmIHRoaXMuZG9tUG9zaXRpb24ucHJldiA9PT0gdGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KCIudWktc29ydGFibGUtaGVscGVyIilbMF0gJiYgdGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQgPT09IHRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0gfHwgdCB8fCBhLnB1c2goZnVuY3Rpb24gKGUpIHsgdGhpcy5fdHJpZ2dlcigidXBkYXRlIiwgZSwgdGhpcy5fdWlIYXNoKCkpIH0pLCB0aGlzICE9PSB0aGlzLmN1cnJlbnRDb250YWluZXIgJiYgKHQgfHwgKGEucHVzaChmdW5jdGlvbiAoZSkgeyB0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLCBlLCB0aGlzLl91aUhhc2goKSkgfSksIGEucHVzaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgZS5fdHJpZ2dlcigicmVjZWl2ZSIsIHQsIHRoaXMuX3VpSGFzaCh0aGlzKSkgfSB9LmNhbGwodGhpcywgdGhpcy5jdXJyZW50Q29udGFpbmVyKSksIGEucHVzaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgZS5fdHJpZ2dlcigidXBkYXRlIiwgdCwgdGhpcy5fdWlIYXNoKHRoaXMpKSB9IH0uY2FsbCh0aGlzLCB0aGlzLmN1cnJlbnRDb250YWluZXIpKSkpLCBzID0gdGhpcy5jb250YWluZXJzLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKXQgfHwgYS5wdXNoKGkoImRlYWN0aXZhdGUiLCB0aGlzLCB0aGlzLmNvbnRhaW5lcnNbc10pKSwgdGhpcy5jb250YWluZXJzW3NdLmNvbnRhaW5lckNhY2hlLm92ZXIgJiYgKGEucHVzaChpKCJvdXQiLCB0aGlzLCB0aGlzLmNvbnRhaW5lcnNbc10pKSwgdGhpcy5jb250YWluZXJzW3NdLmNvbnRhaW5lckNhY2hlLm92ZXIgPSAwKTsgaWYgKHRoaXMuc3RvcmVkQ3Vyc29yICYmICh0aGlzLmRvY3VtZW50LmZpbmQoImJvZHkiKS5jc3MoImN1cnNvciIsIHRoaXMuc3RvcmVkQ3Vyc29yKSwgdGhpcy5zdG9yZWRTdHlsZXNoZWV0LnJlbW92ZSgpKSwgdGhpcy5fc3RvcmVkT3BhY2l0eSAmJiB0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiLCB0aGlzLl9zdG9yZWRPcGFjaXR5KSwgdGhpcy5fc3RvcmVkWkluZGV4ICYmIHRoaXMuaGVscGVyLmNzcygiekluZGV4IiwgImF1dG8iID09PSB0aGlzLl9zdG9yZWRaSW5kZXggPyAiIiA6IHRoaXMuX3N0b3JlZFpJbmRleCksIHRoaXMuZHJhZ2dpbmcgPSAhMSwgdCB8fCB0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIiwgZSwgdGhpcy5fdWlIYXNoKCkpLCB0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSksIHRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCB8fCAodGhpcy5oZWxwZXJbMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0gJiYgdGhpcy5oZWxwZXIucmVtb3ZlKCksIHRoaXMuaGVscGVyID0gbnVsbCksICF0KSB7IGZvciAocyA9IDA7IGEubGVuZ3RoID4gczsgcysrKWFbc10uY2FsbCh0aGlzLCBlKTsgdGhpcy5fdHJpZ2dlcigic3RvcCIsIGUsIHRoaXMuX3VpSGFzaCgpKSB9IHJldHVybiB0aGlzLmZyb21PdXRzaWRlID0gITEsICF0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwgfSwgX3RyaWdnZXI6IGZ1bmN0aW9uICgpIHsgZS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgPT09ICExICYmIHRoaXMuY2FuY2VsKCkgfSwgX3VpSGFzaDogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0IHx8IHRoaXM7IHJldHVybiB7IGhlbHBlcjogaS5oZWxwZXIsIHBsYWNlaG9sZGVyOiBpLnBsYWNlaG9sZGVyIHx8IGUoW10pLCBwb3NpdGlvbjogaS5wb3NpdGlvbiwgb3JpZ2luYWxQb3NpdGlvbjogaS5vcmlnaW5hbFBvc2l0aW9uLCBvZmZzZXQ6IGkucG9zaXRpb25BYnMsIGl0ZW06IGkuY3VycmVudEl0ZW0sIHNlbmRlcjogdCA/IHQuZWxlbWVudCA6IG51bGwgfSB9IH0pLCBlLndpZGdldCgidWkuYWNjb3JkaW9uIiwgew0KICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjEyLjEiLCBvcHRpb25zOiB7IGFjdGl2ZTogMCwgYW5pbWF0ZToge30sIGNsYXNzZXM6IHsgInVpLWFjY29yZGlvbi1oZWFkZXIiOiAidWktY29ybmVyLXRvcCIsICJ1aS1hY2NvcmRpb24taGVhZGVyLWNvbGxhcHNlZCI6ICJ1aS1jb3JuZXItYWxsIiwgInVpLWFjY29yZGlvbi1jb250ZW50IjogInVpLWNvcm5lci1ib3R0b20iIH0sIGNvbGxhcHNpYmxlOiAhMSwgZXZlbnQ6ICJjbGljayIsIGhlYWRlcjogIj4gbGkgPiA6Zmlyc3QtY2hpbGQsID4gOm5vdChsaSk6ZXZlbiIsIGhlaWdodFN0eWxlOiAiYXV0byIsIGljb25zOiB7IGFjdGl2ZUhlYWRlcjogInVpLWljb24tdHJpYW5nbGUtMS1zIiwgaGVhZGVyOiAidWktaWNvbi10cmlhbmdsZS0xLWUiIH0sIGFjdGl2YXRlOiBudWxsLCBiZWZvcmVBY3RpdmF0ZTogbnVsbCB9LCBoaWRlUHJvcHM6IHsgYm9yZGVyVG9wV2lkdGg6ICJoaWRlIiwgYm9yZGVyQm90dG9tV2lkdGg6ICJoaWRlIiwgcGFkZGluZ1RvcDogImhpZGUiLCBwYWRkaW5nQm90dG9tOiAiaGlkZSIsIGhlaWdodDogImhpZGUiIH0sIHNob3dQcm9wczogeyBib3JkZXJUb3BXaWR0aDogInNob3ciLCBib3JkZXJCb3R0b21XaWR0aDogInNob3ciLCBwYWRkaW5nVG9wOiAic2hvdyIsIHBhZGRpbmdCb3R0b206ICJzaG93IiwgaGVpZ2h0OiAic2hvdyIgfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMub3B0aW9uczsgdGhpcy5wcmV2U2hvdyA9IHRoaXMucHJldkhpZGUgPSBlKCksIHRoaXMuX2FkZENsYXNzKCJ1aS1hY2NvcmRpb24iLCAidWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIpLCB0aGlzLmVsZW1lbnQuYXR0cigicm9sZSIsICJ0YWJsaXN0IiksIHQuY29sbGFwc2libGUgfHwgdC5hY3RpdmUgIT09ICExICYmIG51bGwgIT0gdC5hY3RpdmUgfHwgKHQuYWN0aXZlID0gMCksIHRoaXMuX3Byb2Nlc3NQYW5lbHMoKSwgMCA+IHQuYWN0aXZlICYmICh0LmFjdGl2ZSArPSB0aGlzLmhlYWRlcnMubGVuZ3RoKSwgdGhpcy5fcmVmcmVzaCgpIH0sIF9nZXRDcmVhdGVFdmVudERhdGE6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgaGVhZGVyOiB0aGlzLmFjdGl2ZSwgcGFuZWw6IHRoaXMuYWN0aXZlLmxlbmd0aCA/IHRoaXMuYWN0aXZlLm5leHQoKSA6IGUoKSB9IH0sIF9jcmVhdGVJY29uczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCwgaSwgcyA9IHRoaXMub3B0aW9ucy5pY29uczsgcyAmJiAodCA9IGUoIjxzcGFuPiIpLCB0aGlzLl9hZGRDbGFzcyh0LCAidWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiwgInVpLWljb24gIiArIHMuaGVhZGVyKSwgdC5wcmVwZW5kVG8odGhpcy5oZWFkZXJzKSwgaSA9IHRoaXMuYWN0aXZlLmNoaWxkcmVuKCIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiksIHRoaXMuX3JlbW92ZUNsYXNzKGksIHMuaGVhZGVyKS5fYWRkQ2xhc3MoaSwgbnVsbCwgcy5hY3RpdmVIZWFkZXIpLl9hZGRDbGFzcyh0aGlzLmhlYWRlcnMsICJ1aS1hY2NvcmRpb24taWNvbnMiKSkNCiAgICAgICAgICAgICAgICB9LCBfZGVzdHJveUljb25zOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuaGVhZGVycywgInVpLWFjY29yZGlvbi1pY29ucyIpLCB0aGlzLmhlYWRlcnMuY2hpbGRyZW4oIi51aS1hY2NvcmRpb24taGVhZGVyLWljb24iKS5yZW1vdmUoKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB2YXIgZTsgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoInJvbGUiKSwgdGhpcy5oZWFkZXJzLnJlbW92ZUF0dHIoInJvbGUgYXJpYS1leHBhbmRlZCBhcmlhLXNlbGVjdGVkIGFyaWEtY29udHJvbHMgdGFiSW5kZXgiKS5yZW1vdmVVbmlxdWVJZCgpLCB0aGlzLl9kZXN0cm95SWNvbnMoKSwgZSA9IHRoaXMuaGVhZGVycy5uZXh0KCkuY3NzKCJkaXNwbGF5IiwgIiIpLnJlbW92ZUF0dHIoInJvbGUgYXJpYS1oaWRkZW4gYXJpYS1sYWJlbGxlZGJ5IikucmVtb3ZlVW5pcXVlSWQoKSwgImNvbnRlbnQiICE9PSB0aGlzLm9wdGlvbnMuaGVpZ2h0U3R5bGUgJiYgZS5jc3MoImhlaWdodCIsICIiKSB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gImFjdGl2ZSIgPT09IGUgPyAodGhpcy5fYWN0aXZhdGUodCksIHZvaWQgMCkgOiAoImV2ZW50IiA9PT0gZSAmJiAodGhpcy5vcHRpb25zLmV2ZW50ICYmIHRoaXMuX29mZih0aGlzLmhlYWRlcnMsIHRoaXMub3B0aW9ucy5ldmVudCksIHRoaXMuX3NldHVwRXZlbnRzKHQpKSwgdGhpcy5fc3VwZXIoZSwgdCksICJjb2xsYXBzaWJsZSIgIT09IGUgfHwgdCB8fCB0aGlzLm9wdGlvbnMuYWN0aXZlICE9PSAhMSB8fCB0aGlzLl9hY3RpdmF0ZSgwKSwgImljb25zIiA9PT0gZSAmJiAodGhpcy5fZGVzdHJveUljb25zKCksIHQgJiYgdGhpcy5fY3JlYXRlSWNvbnMoKSksIHZvaWQgMCkgfSwgX3NldE9wdGlvbkRpc2FibGVkOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zdXBlcihlKSwgdGhpcy5lbGVtZW50LmF0dHIoImFyaWEtZGlzYWJsZWQiLCBlKSwgdGhpcy5fdG9nZ2xlQ2xhc3MobnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiwgISFlKSwgdGhpcy5fdG9nZ2xlQ2xhc3ModGhpcy5oZWFkZXJzLmFkZCh0aGlzLmhlYWRlcnMubmV4dCgpKSwgbnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiwgISFlKSB9LCBfa2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgaWYgKCF0LmFsdEtleSAmJiAhdC5jdHJsS2V5KSB7IHZhciBpID0gZS51aS5rZXlDb2RlLCBzID0gdGhpcy5oZWFkZXJzLmxlbmd0aCwgYSA9IHRoaXMuaGVhZGVycy5pbmRleCh0LnRhcmdldCksIG4gPSAhMTsgc3dpdGNoICh0LmtleUNvZGUpIHsgY2FzZSBpLlJJR0hUOiBjYXNlIGkuRE9XTjogbiA9IHRoaXMuaGVhZGVyc1soYSArIDEpICUgc107IGJyZWFrOyBjYXNlIGkuTEVGVDogY2FzZSBpLlVQOiBuID0gdGhpcy5oZWFkZXJzWyhhIC0gMSArIHMpICUgc107IGJyZWFrOyBjYXNlIGkuU1BBQ0U6IGNhc2UgaS5FTlRFUjogdGhpcy5fZXZlbnRIYW5kbGVyKHQpOyBicmVhazsgY2FzZSBpLkhPTUU6IG4gPSB0aGlzLmhlYWRlcnNbMF07IGJyZWFrOyBjYXNlIGkuRU5EOiBuID0gdGhpcy5oZWFkZXJzW3MgLSAxXSB9biAmJiAoZSh0LnRhcmdldCkuYXR0cigidGFiSW5kZXgiLCAtMSksIGUobikuYXR0cigidGFiSW5kZXgiLCAwKSwgZShuKS50cmlnZ2VyKCJmb2N1cyIpLCB0LnByZXZlbnREZWZhdWx0KCkpIH0gfSwgX3BhbmVsS2V5RG93bjogZnVuY3Rpb24gKHQpIHsgdC5rZXlDb2RlID09PSBlLnVpLmtleUNvZGUuVVAgJiYgdC5jdHJsS2V5ICYmIGUodC5jdXJyZW50VGFyZ2V0KS5wcmV2KCkudHJpZ2dlcigiZm9jdXMiKSB9LCByZWZyZXNoOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5vcHRpb25zOyB0aGlzLl9wcm9jZXNzUGFuZWxzKCksIHQuYWN0aXZlID09PSAhMSAmJiB0LmNvbGxhcHNpYmxlID09PSAhMCB8fCAhdGhpcy5oZWFkZXJzLmxlbmd0aCA/ICh0LmFjdGl2ZSA9ICExLCB0aGlzLmFjdGl2ZSA9IGUoKSkgOiB0LmFjdGl2ZSA9PT0gITEgPyB0aGlzLl9hY3RpdmF0ZSgwKSA6IHRoaXMuYWN0aXZlLmxlbmd0aCAmJiAhZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIHRoaXMuYWN0aXZlWzBdKSA/IHRoaXMuaGVhZGVycy5sZW5ndGggPT09IHRoaXMuaGVhZGVycy5maW5kKCIudWktc3RhdGUtZGlzYWJsZWQiKS5sZW5ndGggPyAodC5hY3RpdmUgPSAhMSwgdGhpcy5hY3RpdmUgPSBlKCkpIDogdGhpcy5fYWN0aXZhdGUoTWF0aC5tYXgoMCwgdC5hY3RpdmUgLSAxKSkgOiB0LmFjdGl2ZSA9IHRoaXMuaGVhZGVycy5pbmRleCh0aGlzLmFjdGl2ZSksIHRoaXMuX2Rlc3Ryb3lJY29ucygpLCB0aGlzLl9yZWZyZXNoKCkgfSwgX3Byb2Nlc3NQYW5lbHM6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLmhlYWRlcnMsIHQgPSB0aGlzLnBhbmVsczsgdGhpcy5oZWFkZXJzID0gdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmhlYWRlciksIHRoaXMuX2FkZENsYXNzKHRoaXMuaGVhZGVycywgInVpLWFjY29yZGlvbi1oZWFkZXIgdWktYWNjb3JkaW9uLWhlYWRlci1jb2xsYXBzZWQiLCAidWktc3RhdGUtZGVmYXVsdCIpLCB0aGlzLnBhbmVscyA9IHRoaXMuaGVhZGVycy5uZXh0KCkuZmlsdGVyKCI6bm90KC51aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUpIikuaGlkZSgpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLnBhbmVscywgInVpLWFjY29yZGlvbi1jb250ZW50IiwgInVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCIpLCB0ICYmICh0aGlzLl9vZmYoZS5ub3QodGhpcy5oZWFkZXJzKSksIHRoaXMuX29mZih0Lm5vdCh0aGlzLnBhbmVscykpKSB9LCBfcmVmcmVzaDogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSA9IHRoaXMub3B0aW9ucywgcyA9IGkuaGVpZ2h0U3R5bGUsIGEgPSB0aGlzLmVsZW1lbnQucGFyZW50KCk7IHRoaXMuYWN0aXZlID0gdGhpcy5fZmluZEFjdGl2ZShpLmFjdGl2ZSksIHRoaXMuX2FkZENsYXNzKHRoaXMuYWN0aXZlLCAidWktYWNjb3JkaW9uLWhlYWRlci1hY3RpdmUiLCAidWktc3RhdGUtYWN0aXZlIikuX3JlbW92ZUNsYXNzKHRoaXMuYWN0aXZlLCAidWktYWNjb3JkaW9uLWhlYWRlci1jb2xsYXBzZWQiKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5hY3RpdmUubmV4dCgpLCAidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIiksIHRoaXMuYWN0aXZlLm5leHQoKS5zaG93KCksIHRoaXMuaGVhZGVycy5hdHRyKCJyb2xlIiwgInRhYiIpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyksIGkgPSB0LnVuaXF1ZUlkKCkuYXR0cigiaWQiKSwgcyA9IHQubmV4dCgpLCBhID0gcy51bmlxdWVJZCgpLmF0dHIoImlkIik7IHQuYXR0cigiYXJpYS1jb250cm9scyIsIGEpLCBzLmF0dHIoImFyaWEtbGFiZWxsZWRieSIsIGkpIH0pLm5leHQoKS5hdHRyKCJyb2xlIiwgInRhYnBhbmVsIiksIHRoaXMuaGVhZGVycy5ub3QodGhpcy5hY3RpdmUpLmF0dHIoeyAiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIsICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiwgdGFiSW5kZXg6IC0xIH0pLm5leHQoKS5hdHRyKHsgImFyaWEtaGlkZGVuIjogInRydWUiIH0pLmhpZGUoKSwgdGhpcy5hY3RpdmUubGVuZ3RoID8gdGhpcy5hY3RpdmUuYXR0cih7ICJhcmlhLXNlbGVjdGVkIjogInRydWUiLCAiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwgdGFiSW5kZXg6IDAgfSkubmV4dCgpLmF0dHIoeyAiYXJpYS1oaWRkZW4iOiAiZmFsc2UiIH0pIDogdGhpcy5oZWFkZXJzLmVxKDApLmF0dHIoInRhYkluZGV4IiwgMCksIHRoaXMuX2NyZWF0ZUljb25zKCksIHRoaXMuX3NldHVwRXZlbnRzKGkuZXZlbnQpLCAiZmlsbCIgPT09IHMgPyAodCA9IGEuaGVpZ2h0KCksIHRoaXMuZWxlbWVudC5zaWJsaW5ncygiOnZpc2libGUiKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGkgPSBlKHRoaXMpLCBzID0gaS5jc3MoInBvc2l0aW9uIik7ICJhYnNvbHV0ZSIgIT09IHMgJiYgImZpeGVkIiAhPT0gcyAmJiAodCAtPSBpLm91dGVySGVpZ2h0KCEwKSkgfSksIHRoaXMuaGVhZGVycy5lYWNoKGZ1bmN0aW9uICgpIHsgdCAtPSBlKHRoaXMpLm91dGVySGVpZ2h0KCEwKSB9KSwgdGhpcy5oZWFkZXJzLm5leHQoKS5lYWNoKGZ1bmN0aW9uICgpIHsgZSh0aGlzKS5oZWlnaHQoTWF0aC5tYXgoMCwgdCAtIGUodGhpcykuaW5uZXJIZWlnaHQoKSArIGUodGhpcykuaGVpZ2h0KCkpKSB9KS5jc3MoIm92ZXJmbG93IiwgImF1dG8iKSkgOiAiYXV0byIgPT09IHMgJiYgKHQgPSAwLCB0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgaSA9IGUodGhpcykuaXMoIjp2aXNpYmxlIik7IGkgfHwgZSh0aGlzKS5zaG93KCksIHQgPSBNYXRoLm1heCh0LCBlKHRoaXMpLmNzcygiaGVpZ2h0IiwgIiIpLmhlaWdodCgpKSwgaSB8fCBlKHRoaXMpLmhpZGUoKSB9KS5oZWlnaHQodCkpIH0sIF9hY3RpdmF0ZTogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLl9maW5kQWN0aXZlKHQpWzBdOyBpICE9PSB0aGlzLmFjdGl2ZVswXSAmJiAoaSA9IGkgfHwgdGhpcy5hY3RpdmVbMF0sIHRoaXMuX2V2ZW50SGFuZGxlcih7IHRhcmdldDogaSwgY3VycmVudFRhcmdldDogaSwgcHJldmVudERlZmF1bHQ6IGUubm9vcCB9KSkgfSwgX2ZpbmRBY3RpdmU6IGZ1bmN0aW9uICh0KSB7IHJldHVybiAibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHRoaXMuaGVhZGVycy5lcSh0KSA6IGUoKSB9LCBfc2V0dXBFdmVudHM6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0geyBrZXlkb3duOiAiX2tleWRvd24iIH07IHQgJiYgZS5lYWNoKHQuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKGUsIHQpIHsgaVt0XSA9ICJfZXZlbnRIYW5kbGVyIiB9KSwgdGhpcy5fb2ZmKHRoaXMuaGVhZGVycy5hZGQodGhpcy5oZWFkZXJzLm5leHQoKSkpLCB0aGlzLl9vbih0aGlzLmhlYWRlcnMsIGkpLCB0aGlzLl9vbih0aGlzLmhlYWRlcnMubmV4dCgpLCB7IGtleWRvd246ICJfcGFuZWxLZXlEb3duIiB9KSwgdGhpcy5faG92ZXJhYmxlKHRoaXMuaGVhZGVycyksIHRoaXMuX2ZvY3VzYWJsZSh0aGlzLmhlYWRlcnMpIH0sIF9ldmVudEhhbmRsZXI6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhID0gdGhpcy5vcHRpb25zLCBuID0gdGhpcy5hY3RpdmUsIHIgPSBlKHQuY3VycmVudFRhcmdldCksIG8gPSByWzBdID09PSBuWzBdLCBsID0gbyAmJiBhLmNvbGxhcHNpYmxlLCBoID0gbCA/IGUoKSA6IHIubmV4dCgpLCB1ID0gbi5uZXh0KCksIGQgPSB7IG9sZEhlYWRlcjogbiwgb2xkUGFuZWw6IHUsIG5ld0hlYWRlcjogbCA/IGUoKSA6IHIsIG5ld1BhbmVsOiBoIH07IHQucHJldmVudERlZmF1bHQoKSwgbyAmJiAhYS5jb2xsYXBzaWJsZSB8fCB0aGlzLl90cmlnZ2VyKCJiZWZvcmVBY3RpdmF0ZSIsIHQsIGQpID09PSAhMSB8fCAoYS5hY3RpdmUgPSBsID8gITEgOiB0aGlzLmhlYWRlcnMuaW5kZXgociksIHRoaXMuYWN0aXZlID0gbyA/IGUoKSA6IHIsIHRoaXMuX3RvZ2dsZShkKSwgdGhpcy5fcmVtb3ZlQ2xhc3MobiwgInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIiwgInVpLXN0YXRlLWFjdGl2ZSIpLCBhLmljb25zICYmIChpID0gbi5jaGlsZHJlbigiLnVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiIpLCB0aGlzLl9yZW1vdmVDbGFzcyhpLCBudWxsLCBhLmljb25zLmFjdGl2ZUhlYWRlcikuX2FkZENsYXNzKGksIG51bGwsIGEuaWNvbnMuaGVhZGVyKSksIG8gfHwgKHRoaXMuX3JlbW92ZUNsYXNzKHIsICJ1aS1hY2NvcmRpb24taGVhZGVyLWNvbGxhcHNlZCIpLl9hZGRDbGFzcyhyLCAidWktYWNjb3JkaW9uLWhlYWRlci1hY3RpdmUiLCAidWktc3RhdGUtYWN0aXZlIiksIGEuaWNvbnMgJiYgKHMgPSByLmNoaWxkcmVuKCIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiksIHRoaXMuX3JlbW92ZUNsYXNzKHMsIG51bGwsIGEuaWNvbnMuaGVhZGVyKS5fYWRkQ2xhc3MocywgbnVsbCwgYS5pY29ucy5hY3RpdmVIZWFkZXIpKSwgdGhpcy5fYWRkQ2xhc3Moci5uZXh0KCksICJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKSkpIH0sIF90b2dnbGU6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdC5uZXdQYW5lbCwgcyA9IHRoaXMucHJldlNob3cubGVuZ3RoID8gdGhpcy5wcmV2U2hvdyA6IHQub2xkUGFuZWw7IHRoaXMucHJldlNob3cuYWRkKHRoaXMucHJldkhpZGUpLnN0b3AoITAsICEwKSwgdGhpcy5wcmV2U2hvdyA9IGksIHRoaXMucHJldkhpZGUgPSBzLCB0aGlzLm9wdGlvbnMuYW5pbWF0ZSA/IHRoaXMuX2FuaW1hdGUoaSwgcywgdCkgOiAocy5oaWRlKCksIGkuc2hvdygpLCB0aGlzLl90b2dnbGVDb21wbGV0ZSh0KSksIHMuYXR0cih7ICJhcmlhLWhpZGRlbiI6ICJ0cnVlIiB9KSwgcy5wcmV2KCkuYXR0cih7ICJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwgImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiIH0pLCBpLmxlbmd0aCAmJiBzLmxlbmd0aCA/IHMucHJldigpLmF0dHIoeyB0YWJJbmRleDogLTEsICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiB9KSA6IGkubGVuZ3RoICYmIHRoaXMuaGVhZGVycy5maWx0ZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gMCA9PT0gcGFyc2VJbnQoZSh0aGlzKS5hdHRyKCJ0YWJJbmRleCIpLCAxMCkgfSkuYXR0cigidGFiSW5kZXgiLCAtMSksIGkuYXR0cigiYXJpYS1oaWRkZW4iLCAiZmFsc2UiKS5wcmV2KCkuYXR0cih7ICJhcmlhLXNlbGVjdGVkIjogInRydWUiLCAiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwgdGFiSW5kZXg6IDAgfSkgfSwgX2FuaW1hdGU6IGZ1bmN0aW9uIChlLCB0LCBpKSB7IHZhciBzLCBhLCBuLCByID0gdGhpcywgbyA9IDAsIGwgPSBlLmNzcygiYm94LXNpemluZyIpLCBoID0gZS5sZW5ndGggJiYgKCF0Lmxlbmd0aCB8fCBlLmluZGV4KCkgPCB0LmluZGV4KCkpLCB1ID0gdGhpcy5vcHRpb25zLmFuaW1hdGUgfHwge30sIGQgPSBoICYmIHUuZG93biB8fCB1LCBjID0gZnVuY3Rpb24gKCkgeyByLl90b2dnbGVDb21wbGV0ZShpKSB9OyByZXR1cm4gIm51bWJlciIgPT0gdHlwZW9mIGQgJiYgKG4gPSBkKSwgInN0cmluZyIgPT0gdHlwZW9mIGQgJiYgKGEgPSBkKSwgYSA9IGEgfHwgZC5lYXNpbmcgfHwgdS5lYXNpbmcsIG4gPSBuIHx8IGQuZHVyYXRpb24gfHwgdS5kdXJhdGlvbiwgdC5sZW5ndGggPyBlLmxlbmd0aCA/IChzID0gZS5zaG93KCkub3V0ZXJIZWlnaHQoKSwgdC5hbmltYXRlKHRoaXMuaGlkZVByb3BzLCB7IGR1cmF0aW9uOiBuLCBlYXNpbmc6IGEsIHN0ZXA6IGZ1bmN0aW9uIChlLCB0KSB7IHQubm93ID0gTWF0aC5yb3VuZChlKSB9IH0pLCBlLmhpZGUoKS5hbmltYXRlKHRoaXMuc2hvd1Byb3BzLCB7IGR1cmF0aW9uOiBuLCBlYXNpbmc6IGEsIGNvbXBsZXRlOiBjLCBzdGVwOiBmdW5jdGlvbiAoZSwgaSkgeyBpLm5vdyA9IE1hdGgucm91bmQoZSksICJoZWlnaHQiICE9PSBpLnByb3AgPyAiY29udGVudC1ib3giID09PSBsICYmIChvICs9IGkubm93KSA6ICJjb250ZW50IiAhPT0gci5vcHRpb25zLmhlaWdodFN0eWxlICYmIChpLm5vdyA9IE1hdGgucm91bmQocyAtIHQub3V0ZXJIZWlnaHQoKSAtIG8pLCBvID0gMCkgfSB9KSwgdm9pZCAwKSA6IHQuYW5pbWF0ZSh0aGlzLmhpZGVQcm9wcywgbiwgYSwgYykgOiBlLmFuaW1hdGUodGhpcy5zaG93UHJvcHMsIG4sIGEsIGMpIH0sIF90b2dnbGVDb21wbGV0ZTogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLm9sZFBhbmVsLCBpID0gdC5wcmV2KCk7IHRoaXMuX3JlbW92ZUNsYXNzKHQsICJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKSwgdGhpcy5fcmVtb3ZlQ2xhc3MoaSwgInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIikuX2FkZENsYXNzKGksICJ1aS1hY2NvcmRpb24taGVhZGVyLWNvbGxhcHNlZCIpLCB0Lmxlbmd0aCAmJiAodC5wYXJlbnQoKVswXS5jbGFzc05hbWUgPSB0LnBhcmVudCgpWzBdLmNsYXNzTmFtZSksIHRoaXMuX3RyaWdnZXIoImFjdGl2YXRlIiwgbnVsbCwgZSkgfQ0KICAgICAgICAgICAgfSksIGUud2lkZ2V0KCJ1aS5tZW51IiwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgZGVmYXVsdEVsZW1lbnQ6ICI8dWw+IiwgZGVsYXk6IDMwMCwgb3B0aW9uczogeyBpY29uczogeyBzdWJtZW51OiAidWktaWNvbi1jYXJldC0xLWUiIH0sIGl0ZW1zOiAiPiAqIiwgbWVudXM6ICJ1bCIsIHBvc2l0aW9uOiB7IG15OiAibGVmdCB0b3AiLCBhdDogInJpZ2h0IHRvcCIgfSwgcm9sZTogIm1lbnUiLCBibHVyOiBudWxsLCBmb2N1czogbnVsbCwgc2VsZWN0OiBudWxsIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdGhpcy5hY3RpdmVNZW51ID0gdGhpcy5lbGVtZW50LCB0aGlzLm1vdXNlSGFuZGxlZCA9ICExLCB0aGlzLmVsZW1lbnQudW5pcXVlSWQoKS5hdHRyKHsgcm9sZTogdGhpcy5vcHRpb25zLnJvbGUsIHRhYkluZGV4OiAwIH0pLCB0aGlzLl9hZGRDbGFzcygidWktbWVudSIsICJ1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQiKSwgdGhpcy5fb24oeyAibW91c2Vkb3duIC51aS1tZW51LWl0ZW0iOiBmdW5jdGlvbiAoZSkgeyBlLnByZXZlbnREZWZhdWx0KCkgfSwgImNsaWNrIC51aS1tZW51LWl0ZW0iOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUodC50YXJnZXQpLCBzID0gZShlLnVpLnNhZmVBY3RpdmVFbGVtZW50KHRoaXMuZG9jdW1lbnRbMF0pKTsgIXRoaXMubW91c2VIYW5kbGVkICYmIGkubm90KCIudWktc3RhdGUtZGlzYWJsZWQiKS5sZW5ndGggJiYgKHRoaXMuc2VsZWN0KHQpLCB0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgfHwgKHRoaXMubW91c2VIYW5kbGVkID0gITApLCBpLmhhcygiLnVpLW1lbnUiKS5sZW5ndGggPyB0aGlzLmV4cGFuZCh0KSA6ICF0aGlzLmVsZW1lbnQuaXMoIjpmb2N1cyIpICYmIHMuY2xvc2VzdCgiLnVpLW1lbnUiKS5sZW5ndGggJiYgKHRoaXMuZWxlbWVudC50cmlnZ2VyKCJmb2N1cyIsIFshMF0pLCB0aGlzLmFjdGl2ZSAmJiAxID09PSB0aGlzLmFjdGl2ZS5wYXJlbnRzKCIudWktbWVudSIpLmxlbmd0aCAmJiBjbGVhclRpbWVvdXQodGhpcy50aW1lcikpKSB9LCAibW91c2VlbnRlciAudWktbWVudS1pdGVtIjogZnVuY3Rpb24gKHQpIHsgaWYgKCF0aGlzLnByZXZpb3VzRmlsdGVyKSB7IHZhciBpID0gZSh0LnRhcmdldCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSIpLCBzID0gZSh0LmN1cnJlbnRUYXJnZXQpOyBpWzBdID09PSBzWzBdICYmICh0aGlzLl9yZW1vdmVDbGFzcyhzLnNpYmxpbmdzKCkuY2hpbGRyZW4oIi51aS1zdGF0ZS1hY3RpdmUiKSwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLmZvY3VzKHQsIHMpKSB9IH0sIG1vdXNlbGVhdmU6ICJjb2xsYXBzZUFsbCIsICJtb3VzZWxlYXZlIC51aS1tZW51IjogImNvbGxhcHNlQWxsIiwgZm9jdXM6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpID0gdGhpcy5hY3RpdmUgfHwgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5lcSgwKTsgdCB8fCB0aGlzLmZvY3VzKGUsIGkpIH0sIGJsdXI6IGZ1bmN0aW9uICh0KSB7IHRoaXMuX2RlbGF5KGZ1bmN0aW9uICgpIHsgdmFyIGkgPSAhZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIGUudWkuc2FmZUFjdGl2ZUVsZW1lbnQodGhpcy5kb2N1bWVudFswXSkpOyBpICYmIHRoaXMuY29sbGFwc2VBbGwodCkgfSkgfSwga2V5ZG93bjogIl9rZXlkb3duIiB9KSwgdGhpcy5yZWZyZXNoKCksIHRoaXMuX29uKHRoaXMuZG9jdW1lbnQsIHsgY2xpY2s6IGZ1bmN0aW9uIChlKSB7IHRoaXMuX2Nsb3NlT25Eb2N1bWVudENsaWNrKGUpICYmIHRoaXMuY29sbGFwc2VBbGwoZSksIHRoaXMubW91c2VIYW5kbGVkID0gITEgfSB9KSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuZWxlbWVudC5maW5kKCIudWktbWVudS1pdGVtIikucmVtb3ZlQXR0cigicm9sZSBhcmlhLWRpc2FibGVkIiksIGkgPSB0LmNoaWxkcmVuKCIudWktbWVudS1pdGVtLXdyYXBwZXIiKS5yZW1vdmVVbmlxdWVJZCgpLnJlbW92ZUF0dHIoInRhYkluZGV4IHJvbGUgYXJpYS1oYXNwb3B1cCIpOyB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigiYXJpYS1hY3RpdmVkZXNjZW5kYW50IikuZmluZCgiLnVpLW1lbnUiKS5hZGRCYWNrKCkucmVtb3ZlQXR0cigicm9sZSBhcmlhLWxhYmVsbGVkYnkgYXJpYS1leHBhbmRlZCBhcmlhLWhpZGRlbiBhcmlhLWRpc2FibGVkIHRhYkluZGV4IikucmVtb3ZlVW5pcXVlSWQoKS5zaG93KCksIGkuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpOyB0LmRhdGEoInVpLW1lbnUtc3VibWVudS1jYXJldCIpICYmIHQucmVtb3ZlKCkgfSkgfSwgX2tleWRvd246IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhLCBuLCByID0gITA7IHN3aXRjaCAodC5rZXlDb2RlKSB7IGNhc2UgZS51aS5rZXlDb2RlLlBBR0VfVVA6IHRoaXMucHJldmlvdXNQYWdlKHQpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9ET1dOOiB0aGlzLm5leHRQYWdlKHQpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuSE9NRTogdGhpcy5fbW92ZSgiZmlyc3QiLCAiZmlyc3QiLCB0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkVORDogdGhpcy5fbW92ZSgibGFzdCIsICJsYXN0IiwgdCk7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5VUDogdGhpcy5wcmV2aW91cyh0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkRPV046IHRoaXMubmV4dCh0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkxFRlQ6IHRoaXMuY29sbGFwc2UodCk7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5SSUdIVDogdGhpcy5hY3RpdmUgJiYgIXRoaXMuYWN0aXZlLmlzKCIudWktc3RhdGUtZGlzYWJsZWQiKSAmJiB0aGlzLmV4cGFuZCh0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkVOVEVSOiBjYXNlIGUudWkua2V5Q29kZS5TUEFDRTogdGhpcy5fYWN0aXZhdGUodCk7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5FU0NBUEU6IHRoaXMuY29sbGFwc2UodCk7IGJyZWFrOyBkZWZhdWx0OiByID0gITEsIHMgPSB0aGlzLnByZXZpb3VzRmlsdGVyIHx8ICIiLCBuID0gITEsIGEgPSB0LmtleUNvZGUgPj0gOTYgJiYgMTA1ID49IHQua2V5Q29kZSA/ICIiICsgKHQua2V5Q29kZSAtIDk2KSA6IFN0cmluZy5mcm9tQ2hhckNvZGUodC5rZXlDb2RlKSwgY2xlYXJUaW1lb3V0KHRoaXMuZmlsdGVyVGltZXIpLCBhID09PSBzID8gbiA9ICEwIDogYSA9IHMgKyBhLCBpID0gdGhpcy5fZmlsdGVyTWVudUl0ZW1zKGEpLCBpID0gbiAmJiAtMSAhPT0gaS5pbmRleCh0aGlzLmFjdGl2ZS5uZXh0KCkpID8gdGhpcy5hY3RpdmUubmV4dEFsbCgiLnVpLW1lbnUtaXRlbSIpIDogaSwgaS5sZW5ndGggfHwgKGEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHQua2V5Q29kZSksIGkgPSB0aGlzLl9maWx0ZXJNZW51SXRlbXMoYSkpLCBpLmxlbmd0aCA/ICh0aGlzLmZvY3VzKHQsIGkpLCB0aGlzLnByZXZpb3VzRmlsdGVyID0gYSwgdGhpcy5maWx0ZXJUaW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uICgpIHsgZGVsZXRlIHRoaXMucHJldmlvdXNGaWx0ZXIgfSwgMWUzKSkgOiBkZWxldGUgdGhpcy5wcmV2aW91c0ZpbHRlciB9ciAmJiB0LnByZXZlbnREZWZhdWx0KCkgfSwgX2FjdGl2YXRlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLmFjdGl2ZSAmJiAhdGhpcy5hY3RpdmUuaXMoIi51aS1zdGF0ZS1kaXNhYmxlZCIpICYmICh0aGlzLmFjdGl2ZS5jaGlsZHJlbigiW2FyaWEtaGFzcG9wdXA9J3RydWUnXSIpLmxlbmd0aCA/IHRoaXMuZXhwYW5kKGUpIDogdGhpcy5zZWxlY3QoZSkpIH0sIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGksIHMsIGEsIG4sIHIgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zLmljb25zLnN1Ym1lbnUsIGwgPSB0aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMubWVudXMpOyB0aGlzLl90b2dnbGVDbGFzcygidWktbWVudS1pY29ucyIsIG51bGwsICEhdGhpcy5lbGVtZW50LmZpbmQoIi51aS1pY29uIikubGVuZ3RoKSwgcyA9IGwuZmlsdGVyKCI6bm90KC51aS1tZW51KSIpLmhpZGUoKS5hdHRyKHsgcm9sZTogdGhpcy5vcHRpb25zLnJvbGUsICJhcmlhLWhpZGRlbiI6ICJ0cnVlIiwgImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiIH0pLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyksIGkgPSB0LnByZXYoKSwgcyA9IGUoIjxzcGFuPiIpLmRhdGEoInVpLW1lbnUtc3VibWVudS1jYXJldCIsICEwKTsgci5fYWRkQ2xhc3MocywgInVpLW1lbnUtaWNvbiIsICJ1aS1pY29uICIgKyBvKSwgaS5hdHRyKCJhcmlhLWhhc3BvcHVwIiwgInRydWUiKS5wcmVwZW5kKHMpLCB0LmF0dHIoImFyaWEtbGFiZWxsZWRieSIsIGkuYXR0cigiaWQiKSkgfSksIHRoaXMuX2FkZENsYXNzKHMsICJ1aS1tZW51IiwgInVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1mcm9udCIpLCB0ID0gbC5hZGQodGhpcy5lbGVtZW50KSwgaSA9IHQuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpLCBpLm5vdCgiLnVpLW1lbnUtaXRlbSIpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHIuX2lzRGl2aWRlcih0KSAmJiByLl9hZGRDbGFzcyh0LCAidWktbWVudS1kaXZpZGVyIiwgInVpLXdpZGdldC1jb250ZW50IikgfSksIGEgPSBpLm5vdCgiLnVpLW1lbnUtaXRlbSwgLnVpLW1lbnUtZGl2aWRlciIpLCBuID0gYS5jaGlsZHJlbigpLm5vdCgiLnVpLW1lbnUiKS51bmlxdWVJZCgpLmF0dHIoeyB0YWJJbmRleDogLTEsIHJvbGU6IHRoaXMuX2l0ZW1Sb2xlKCkgfSksIHRoaXMuX2FkZENsYXNzKGEsICJ1aS1tZW51LWl0ZW0iKS5fYWRkQ2xhc3MobiwgInVpLW1lbnUtaXRlbS13cmFwcGVyIiksIGkuZmlsdGVyKCIudWktc3RhdGUtZGlzYWJsZWQiKS5hdHRyKCJhcmlhLWRpc2FibGVkIiwgInRydWUiKSwgdGhpcy5hY3RpdmUgJiYgIWUuY29udGFpbnModGhpcy5lbGVtZW50WzBdLCB0aGlzLmFjdGl2ZVswXSkgJiYgdGhpcy5ibHVyKCkgfSwgX2l0ZW1Sb2xlOiBmdW5jdGlvbiAoKSB7IHJldHVybiB7IG1lbnU6ICJtZW51aXRlbSIsIGxpc3Rib3g6ICJvcHRpb24iIH1bdGhpcy5vcHRpb25zLnJvbGVdIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IGlmICgiaWNvbnMiID09PSBlKSB7IHZhciBpID0gdGhpcy5lbGVtZW50LmZpbmQoIi51aS1tZW51LWljb24iKTsgdGhpcy5fcmVtb3ZlQ2xhc3MoaSwgbnVsbCwgdGhpcy5vcHRpb25zLmljb25zLnN1Ym1lbnUpLl9hZGRDbGFzcyhpLCBudWxsLCB0LnN1Ym1lbnUpIH0gdGhpcy5fc3VwZXIoZSwgdCkgfSwgX3NldE9wdGlvbkRpc2FibGVkOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zdXBlcihlKSwgdGhpcy5lbGVtZW50LmF0dHIoImFyaWEtZGlzYWJsZWQiLCBlICsgIiIpLCB0aGlzLl90b2dnbGVDbGFzcyhudWxsLCAidWktc3RhdGUtZGlzYWJsZWQiLCAhIWUpIH0sIGZvY3VzOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSwgcywgYTsgdGhpcy5ibHVyKGUsIGUgJiYgImZvY3VzIiA9PT0gZS50eXBlKSwgdGhpcy5fc2Nyb2xsSW50b1ZpZXcodCksIHRoaXMuYWN0aXZlID0gdC5maXJzdCgpLCBzID0gdGhpcy5hY3RpdmUuY2hpbGRyZW4oIi51aS1tZW51LWl0ZW0td3JhcHBlciIpLCB0aGlzLl9hZGRDbGFzcyhzLCBudWxsLCAidWktc3RhdGUtYWN0aXZlIiksIHRoaXMub3B0aW9ucy5yb2xlICYmIHRoaXMuZWxlbWVudC5hdHRyKCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnQiLCBzLmF0dHIoImlkIikpLCBhID0gdGhpcy5hY3RpdmUucGFyZW50KCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSIpLmNoaWxkcmVuKCIudWktbWVudS1pdGVtLXdyYXBwZXIiKSwgdGhpcy5fYWRkQ2xhc3MoYSwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCBlICYmICJrZXlkb3duIiA9PT0gZS50eXBlID8gdGhpcy5fY2xvc2UoKSA6IHRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHRoaXMuX2Nsb3NlKCkgfSwgdGhpcy5kZWxheSksIGkgPSB0LmNoaWxkcmVuKCIudWktbWVudSIpLCBpLmxlbmd0aCAmJiBlICYmIC9ebW91c2UvLnRlc3QoZS50eXBlKSAmJiB0aGlzLl9zdGFydE9wZW5pbmcoaSksIHRoaXMuYWN0aXZlTWVudSA9IHQucGFyZW50KCksIHRoaXMuX3RyaWdnZXIoImZvY3VzIiwgZSwgeyBpdGVtOiB0IH0pIH0sIF9zY3JvbGxJbnRvVmlldzogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG4sIHIsIG87IHRoaXMuX2hhc1Njcm9sbCgpICYmIChpID0gcGFyc2VGbG9hdChlLmNzcyh0aGlzLmFjdGl2ZU1lbnVbMF0sICJib3JkZXJUb3BXaWR0aCIpKSB8fCAwLCBzID0gcGFyc2VGbG9hdChlLmNzcyh0aGlzLmFjdGl2ZU1lbnVbMF0sICJwYWRkaW5nVG9wIikpIHx8IDAsIGEgPSB0Lm9mZnNldCgpLnRvcCAtIHRoaXMuYWN0aXZlTWVudS5vZmZzZXQoKS50b3AgLSBpIC0gcywgbiA9IHRoaXMuYWN0aXZlTWVudS5zY3JvbGxUb3AoKSwgciA9IHRoaXMuYWN0aXZlTWVudS5oZWlnaHQoKSwgbyA9IHQub3V0ZXJIZWlnaHQoKSwgMCA+IGEgPyB0aGlzLmFjdGl2ZU1lbnUuc2Nyb2xsVG9wKG4gKyBhKSA6IGEgKyBvID4gciAmJiB0aGlzLmFjdGl2ZU1lbnUuc2Nyb2xsVG9wKG4gKyBhIC0gciArIG8pKSB9LCBibHVyOiBmdW5jdGlvbiAoZSwgdCkgeyB0IHx8IGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKSwgdGhpcy5hY3RpdmUgJiYgKHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuYWN0aXZlLmNoaWxkcmVuKCIudWktbWVudS1pdGVtLXdyYXBwZXIiKSwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLl90cmlnZ2VyKCJibHVyIiwgZSwgeyBpdGVtOiB0aGlzLmFjdGl2ZSB9KSwgdGhpcy5hY3RpdmUgPSBudWxsKSB9LCBfc3RhcnRPcGVuaW5nOiBmdW5jdGlvbiAoZSkgeyBjbGVhclRpbWVvdXQodGhpcy50aW1lciksICJ0cnVlIiA9PT0gZS5hdHRyKCJhcmlhLWhpZGRlbiIpICYmICh0aGlzLnRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24gKCkgeyB0aGlzLl9jbG9zZSgpLCB0aGlzLl9vcGVuKGUpIH0sIHRoaXMuZGVsYXkpKSB9LCBfb3BlbjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlLmV4dGVuZCh7IG9mOiB0aGlzLmFjdGl2ZSB9LCB0aGlzLm9wdGlvbnMucG9zaXRpb24pOyBjbGVhclRpbWVvdXQodGhpcy50aW1lciksIHRoaXMuZWxlbWVudC5maW5kKCIudWktbWVudSIpLm5vdCh0LnBhcmVudHMoIi51aS1tZW51IikpLmhpZGUoKS5hdHRyKCJhcmlhLWhpZGRlbiIsICJ0cnVlIiksIHQuc2hvdygpLnJlbW92ZUF0dHIoImFyaWEtaGlkZGVuIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICJ0cnVlIikucG9zaXRpb24oaSkgfSwgY29sbGFwc2VBbGw6IGZ1bmN0aW9uICh0LCBpKSB7IGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKSwgdGhpcy50aW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uICgpIHsgdmFyIHMgPSBpID8gdGhpcy5lbGVtZW50IDogZSh0ICYmIHQudGFyZ2V0KS5jbG9zZXN0KHRoaXMuZWxlbWVudC5maW5kKCIudWktbWVudSIpKTsgcy5sZW5ndGggfHwgKHMgPSB0aGlzLmVsZW1lbnQpLCB0aGlzLl9jbG9zZShzKSwgdGhpcy5ibHVyKHQpLCB0aGlzLl9yZW1vdmVDbGFzcyhzLmZpbmQoIi51aS1zdGF0ZS1hY3RpdmUiKSwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLmFjdGl2ZU1lbnUgPSBzIH0sIHRoaXMuZGVsYXkpIH0sIF9jbG9zZTogZnVuY3Rpb24gKGUpIHsgZSB8fCAoZSA9IHRoaXMuYWN0aXZlID8gdGhpcy5hY3RpdmUucGFyZW50KCkgOiB0aGlzLmVsZW1lbnQpLCBlLmZpbmQoIi51aS1tZW51IikuaGlkZSgpLmF0dHIoImFyaWEtaGlkZGVuIiwgInRydWUiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIikgfSwgX2Nsb3NlT25Eb2N1bWVudENsaWNrOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gIWUodC50YXJnZXQpLmNsb3Nlc3QoIi51aS1tZW51IikubGVuZ3RoIH0sIF9pc0RpdmlkZXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhL1teXC1cdTIwMTRcdTIwMTNcc10vLnRlc3QoZS50ZXh0KCkpIH0sIGNvbGxhcHNlOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMuYWN0aXZlICYmIHRoaXMuYWN0aXZlLnBhcmVudCgpLmNsb3Nlc3QoIi51aS1tZW51LWl0ZW0iLCB0aGlzLmVsZW1lbnQpOyB0ICYmIHQubGVuZ3RoICYmICh0aGlzLl9jbG9zZSgpLCB0aGlzLmZvY3VzKGUsIHQpKSB9LCBleHBhbmQ6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpcy5hY3RpdmUgJiYgdGhpcy5hY3RpdmUuY2hpbGRyZW4oIi51aS1tZW51ICIpLmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5maXJzdCgpOyB0ICYmIHQubGVuZ3RoICYmICh0aGlzLl9vcGVuKHQucGFyZW50KCkpLCB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHRoaXMuZm9jdXMoZSwgdCkgfSkpIH0sIG5leHQ6IGZ1bmN0aW9uIChlKSB7IHRoaXMuX21vdmUoIm5leHQiLCAiZmlyc3QiLCBlKSB9LCBwcmV2aW91czogZnVuY3Rpb24gKGUpIHsgdGhpcy5fbW92ZSgicHJldiIsICJsYXN0IiwgZSkgfSwgaXNGaXJzdEl0ZW06IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5wcmV2QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RoIH0sIGlzTGFzdEl0ZW06IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5uZXh0QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RoIH0sIF9tb3ZlOiBmdW5jdGlvbiAoZSwgdCwgaSkgeyB2YXIgczsgdGhpcy5hY3RpdmUgJiYgKHMgPSAiZmlyc3QiID09PSBlIHx8ICJsYXN0IiA9PT0gZSA/IHRoaXMuYWN0aXZlWyJmaXJzdCIgPT09IGUgPyAicHJldkFsbCIgOiAibmV4dEFsbCJdKCIudWktbWVudS1pdGVtIikuZXEoLTEpIDogdGhpcy5hY3RpdmVbZSArICJBbGwiXSgiLnVpLW1lbnUtaXRlbSIpLmVxKDApKSwgcyAmJiBzLmxlbmd0aCAmJiB0aGlzLmFjdGl2ZSB8fCAocyA9IHRoaXMuYWN0aXZlTWVudS5maW5kKHRoaXMub3B0aW9ucy5pdGVtcylbdF0oKSksIHRoaXMuZm9jdXMoaSwgcykgfSwgbmV4dFBhZ2U6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhOyByZXR1cm4gdGhpcy5hY3RpdmUgPyAodGhpcy5pc0xhc3RJdGVtKCkgfHwgKHRoaXMuX2hhc1Njcm9sbCgpID8gKHMgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsIGEgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCksIHRoaXMuYWN0aXZlLm5leHRBbGwoIi51aS1tZW51LWl0ZW0iKS5lYWNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGkgPSBlKHRoaXMpLCAwID4gaS5vZmZzZXQoKS50b3AgLSBzIC0gYSB9KSwgdGhpcy5mb2N1cyh0LCBpKSkgOiB0aGlzLmZvY3VzKHQsIHRoaXMuYWN0aXZlTWVudS5maW5kKHRoaXMub3B0aW9ucy5pdGVtcylbdGhpcy5hY3RpdmUgPyAibGFzdCIgOiAiZmlyc3QiXSgpKSksIHZvaWQgMCkgOiAodGhpcy5uZXh0KHQpLCB2b2lkIDApIH0sIHByZXZpb3VzUGFnZTogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGE7IHJldHVybiB0aGlzLmFjdGl2ZSA/ICh0aGlzLmlzRmlyc3RJdGVtKCkgfHwgKHRoaXMuX2hhc1Njcm9sbCgpID8gKHMgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsIGEgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCksIHRoaXMuYWN0aXZlLnByZXZBbGwoIi51aS1tZW51LWl0ZW0iKS5lYWNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGkgPSBlKHRoaXMpLCBpLm9mZnNldCgpLnRvcCAtIHMgKyBhID4gMCB9KSwgdGhpcy5mb2N1cyh0LCBpKSkgOiB0aGlzLmZvY3VzKHQsIHRoaXMuYWN0aXZlTWVudS5maW5kKHRoaXMub3B0aW9ucy5pdGVtcykuZmlyc3QoKSkpLCB2b2lkIDApIDogKHRoaXMubmV4dCh0KSwgdm9pZCAwKSB9LCBfaGFzU2Nyb2xsOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSA8IHRoaXMuZWxlbWVudC5wcm9wKCJzY3JvbGxIZWlnaHQiKSB9LCBzZWxlY3Q6IGZ1bmN0aW9uICh0KSB7IHRoaXMuYWN0aXZlID0gdGhpcy5hY3RpdmUgfHwgZSh0LnRhcmdldCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSIpOyB2YXIgaSA9IHsgaXRlbTogdGhpcy5hY3RpdmUgfTsgdGhpcy5hY3RpdmUuaGFzKCIudWktbWVudSIpLmxlbmd0aCB8fCB0aGlzLmNvbGxhcHNlQWxsKHQsICEwKSwgdGhpcy5fdHJpZ2dlcigic2VsZWN0IiwgdCwgaSkgfSwgX2ZpbHRlck1lbnVJdGVtczogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0LnJlcGxhY2UoL1tcLVxbXF17fSgpKis/LixcXFxeJHwjXHNdL2csICJcXCQmIiksIHMgPSBSZWdFeHAoIl4iICsgaSwgImkiKTsgcmV0dXJuIHRoaXMuYWN0aXZlTWVudS5maW5kKHRoaXMub3B0aW9ucy5pdGVtcykuZmlsdGVyKCIudWktbWVudS1pdGVtIikuZmlsdGVyKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHMudGVzdChlLnRyaW0oZSh0aGlzKS5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbS13cmFwcGVyIikudGV4dCgpKSkgfSkgfSB9KSwgZS53aWRnZXQoInVpLmF1dG9jb21wbGV0ZSIsIHsgdmVyc2lvbjogIjEuMTIuMSIsIGRlZmF1bHRFbGVtZW50OiAiPGlucHV0PiIsIG9wdGlvbnM6IHsgYXBwZW5kVG86IG51bGwsIGF1dG9Gb2N1czogITEsIGRlbGF5OiAzMDAsIG1pbkxlbmd0aDogMSwgcG9zaXRpb246IHsgbXk6ICJsZWZ0IHRvcCIsIGF0OiAibGVmdCBib3R0b20iLCBjb2xsaXNpb246ICJub25lIiB9LCBzb3VyY2U6IG51bGwsIGNoYW5nZTogbnVsbCwgY2xvc2U6IG51bGwsIGZvY3VzOiBudWxsLCBvcGVuOiBudWxsLCByZXNwb25zZTogbnVsbCwgc2VhcmNoOiBudWxsLCBzZWxlY3Q6IG51bGwgfSwgcmVxdWVzdEluZGV4OiAwLCBwZW5kaW5nOiAwLCBfY3JlYXRlOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpLCBzLCBhID0gdGhpcy5lbGVtZW50WzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIG4gPSAidGV4dGFyZWEiID09PSBhLCByID0gImlucHV0IiA9PT0gYTsgdGhpcy5pc011bHRpTGluZSA9IG4gfHwgIXIgJiYgdGhpcy5faXNDb250ZW50RWRpdGFibGUodGhpcy5lbGVtZW50KSwgdGhpcy52YWx1ZU1ldGhvZCA9IHRoaXMuZWxlbWVudFtuIHx8IHIgPyAidmFsIiA6ICJ0ZXh0Il0sIHRoaXMuaXNOZXdNZW51ID0gITAsIHRoaXMuX2FkZENsYXNzKCJ1aS1hdXRvY29tcGxldGUtaW5wdXQiKSwgdGhpcy5lbGVtZW50LmF0dHIoImF1dG9jb21wbGV0ZSIsICJvZmYiKSwgdGhpcy5fb24odGhpcy5lbGVtZW50LCB7IGtleWRvd246IGZ1bmN0aW9uIChhKSB7IGlmICh0aGlzLmVsZW1lbnQucHJvcCgicmVhZE9ubHkiKSkgcmV0dXJuIHQgPSAhMCwgcyA9ICEwLCBpID0gITAsIHZvaWQgMDsgdCA9ICExLCBzID0gITEsIGkgPSAhMTsgdmFyIG4gPSBlLnVpLmtleUNvZGU7IHN3aXRjaCAoYS5rZXlDb2RlKSB7IGNhc2Ugbi5QQUdFX1VQOiB0ID0gITAsIHRoaXMuX21vdmUoInByZXZpb3VzUGFnZSIsIGEpOyBicmVhazsgY2FzZSBuLlBBR0VfRE9XTjogdCA9ICEwLCB0aGlzLl9tb3ZlKCJuZXh0UGFnZSIsIGEpOyBicmVhazsgY2FzZSBuLlVQOiB0ID0gITAsIHRoaXMuX2tleUV2ZW50KCJwcmV2aW91cyIsIGEpOyBicmVhazsgY2FzZSBuLkRPV046IHQgPSAhMCwgdGhpcy5fa2V5RXZlbnQoIm5leHQiLCBhKTsgYnJlYWs7IGNhc2Ugbi5FTlRFUjogdGhpcy5tZW51LmFjdGl2ZSAmJiAodCA9ICEwLCBhLnByZXZlbnREZWZhdWx0KCksIHRoaXMubWVudS5zZWxlY3QoYSkpOyBicmVhazsgY2FzZSBuLlRBQjogdGhpcy5tZW51LmFjdGl2ZSAmJiB0aGlzLm1lbnUuc2VsZWN0KGEpOyBicmVhazsgY2FzZSBuLkVTQ0FQRTogdGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikgJiYgKHRoaXMuaXNNdWx0aUxpbmUgfHwgdGhpcy5fdmFsdWUodGhpcy50ZXJtKSwgdGhpcy5jbG9zZShhKSwgYS5wcmV2ZW50RGVmYXVsdCgpKTsgYnJlYWs7IGRlZmF1bHQ6IGkgPSAhMCwgdGhpcy5fc2VhcmNoVGltZW91dChhKSB9IH0sIGtleXByZXNzOiBmdW5jdGlvbiAocykgeyBpZiAodCkgcmV0dXJuIHQgPSAhMSwgKCF0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpKSAmJiBzLnByZXZlbnREZWZhdWx0KCksIHZvaWQgMDsgaWYgKCFpKSB7IHZhciBhID0gZS51aS5rZXlDb2RlOyBzd2l0Y2ggKHMua2V5Q29kZSkgeyBjYXNlIGEuUEFHRV9VUDogdGhpcy5fbW92ZSgicHJldmlvdXNQYWdlIiwgcyk7IGJyZWFrOyBjYXNlIGEuUEFHRV9ET1dOOiB0aGlzLl9tb3ZlKCJuZXh0UGFnZSIsIHMpOyBicmVhazsgY2FzZSBhLlVQOiB0aGlzLl9rZXlFdmVudCgicHJldmlvdXMiLCBzKTsgYnJlYWs7IGNhc2UgYS5ET1dOOiB0aGlzLl9rZXlFdmVudCgibmV4dCIsIHMpIH0gfSB9LCBpbnB1dDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHMgPyAocyA9ICExLCBlLnByZXZlbnREZWZhdWx0KCksIHZvaWQgMCkgOiAodGhpcy5fc2VhcmNoVGltZW91dChlKSwgdm9pZCAwKSB9LCBmb2N1czogZnVuY3Rpb24gKCkgeyB0aGlzLnNlbGVjdGVkSXRlbSA9IG51bGwsIHRoaXMucHJldmlvdXMgPSB0aGlzLl92YWx1ZSgpIH0sIGJsdXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLmNhbmNlbEJsdXIgPyAoZGVsZXRlIHRoaXMuY2FuY2VsQmx1ciwgdm9pZCAwKSA6IChjbGVhclRpbWVvdXQodGhpcy5zZWFyY2hpbmcpLCB0aGlzLmNsb3NlKGUpLCB0aGlzLl9jaGFuZ2UoZSksIHZvaWQgMCkgfSB9KSwgdGhpcy5faW5pdFNvdXJjZSgpLCB0aGlzLm1lbnUgPSBlKCI8dWw+IikuYXBwZW5kVG8odGhpcy5fYXBwZW5kVG8oKSkubWVudSh7IHJvbGU6IG51bGwgfSkuaGlkZSgpLm1lbnUoImluc3RhbmNlIiksIHRoaXMuX2FkZENsYXNzKHRoaXMubWVudS5lbGVtZW50LCAidWktYXV0b2NvbXBsZXRlIiwgInVpLWZyb250IiksIHRoaXMuX29uKHRoaXMubWVudS5lbGVtZW50LCB7IG1vdXNlZG93bjogZnVuY3Rpb24gKHQpIHsgdC5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLmNhbmNlbEJsdXIgPSAhMCwgdGhpcy5fZGVsYXkoZnVuY3Rpb24gKCkgeyBkZWxldGUgdGhpcy5jYW5jZWxCbHVyLCB0aGlzLmVsZW1lbnRbMF0gIT09IGUudWkuc2FmZUFjdGl2ZUVsZW1lbnQodGhpcy5kb2N1bWVudFswXSkgJiYgdGhpcy5lbGVtZW50LnRyaWdnZXIoImZvY3VzIikgfSkgfSwgbWVudWZvY3VzOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYTsgcmV0dXJuIHRoaXMuaXNOZXdNZW51ICYmICh0aGlzLmlzTmV3TWVudSA9ICExLCB0Lm9yaWdpbmFsRXZlbnQgJiYgL15tb3VzZS8udGVzdCh0Lm9yaWdpbmFsRXZlbnQudHlwZSkpID8gKHRoaXMubWVudS5ibHVyKCksIHRoaXMuZG9jdW1lbnQub25lKCJtb3VzZW1vdmUiLCBmdW5jdGlvbiAoKSB7IGUodC50YXJnZXQpLnRyaWdnZXIodC5vcmlnaW5hbEV2ZW50KSB9KSwgdm9pZCAwKSA6IChhID0gaS5pdGVtLmRhdGEoInVpLWF1dG9jb21wbGV0ZS1pdGVtIiksICExICE9PSB0aGlzLl90cmlnZ2VyKCJmb2N1cyIsIHQsIHsgaXRlbTogYSB9KSAmJiB0Lm9yaWdpbmFsRXZlbnQgJiYgL15rZXkvLnRlc3QodC5vcmlnaW5hbEV2ZW50LnR5cGUpICYmIHRoaXMuX3ZhbHVlKGEudmFsdWUpLCBzID0gaS5pdGVtLmF0dHIoImFyaWEtbGFiZWwiKSB8fCBhLnZhbHVlLCBzICYmIGUudHJpbShzKS5sZW5ndGggJiYgKHRoaXMubGl2ZVJlZ2lvbi5jaGlsZHJlbigpLmhpZGUoKSwgZSgiPGRpdj4iKS50ZXh0KHMpLmFwcGVuZFRvKHRoaXMubGl2ZVJlZ2lvbikpLCB2b2lkIDApIH0sIG1lbnVzZWxlY3Q6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gaS5pdGVtLmRhdGEoInVpLWF1dG9jb21wbGV0ZS1pdGVtIiksIGEgPSB0aGlzLnByZXZpb3VzOyB0aGlzLmVsZW1lbnRbMF0gIT09IGUudWkuc2FmZUFjdGl2ZUVsZW1lbnQodGhpcy5kb2N1bWVudFswXSkgJiYgKHRoaXMuZWxlbWVudC50cmlnZ2VyKCJmb2N1cyIpLCB0aGlzLnByZXZpb3VzID0gYSwgdGhpcy5fZGVsYXkoZnVuY3Rpb24gKCkgeyB0aGlzLnByZXZpb3VzID0gYSwgdGhpcy5zZWxlY3RlZEl0ZW0gPSBzIH0pKSwgITEgIT09IHRoaXMuX3RyaWdnZXIoInNlbGVjdCIsIHQsIHsgaXRlbTogcyB9KSAmJiB0aGlzLl92YWx1ZShzLnZhbHVlKSwgdGhpcy50ZXJtID0gdGhpcy5fdmFsdWUoKSwgdGhpcy5jbG9zZSh0KSwgdGhpcy5zZWxlY3RlZEl0ZW0gPSBzIH0gfSksIHRoaXMubGl2ZVJlZ2lvbiA9IGUoIjxkaXY+IiwgeyByb2xlOiAic3RhdHVzIiwgImFyaWEtbGl2ZSI6ICJhc3NlcnRpdmUiLCAiYXJpYS1yZWxldmFudCI6ICJhZGRpdGlvbnMiIH0pLmFwcGVuZFRvKHRoaXMuZG9jdW1lbnRbMF0uYm9keSksIHRoaXMuX2FkZENsYXNzKHRoaXMubGl2ZVJlZ2lvbiwgbnVsbCwgInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZSIpLCB0aGlzLl9vbih0aGlzLndpbmRvdywgeyBiZWZvcmV1bmxvYWQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoImF1dG9jb21wbGV0ZSIpIH0gfSkgfSwgX2Rlc3Ryb3k6IGZ1bmN0aW9uICgpIHsgY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoaW5nKSwgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoImF1dG9jb21wbGV0ZSIpLCB0aGlzLm1lbnUuZWxlbWVudC5yZW1vdmUoKSwgdGhpcy5saXZlUmVnaW9uLnJlbW92ZSgpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IHRoaXMuX3N1cGVyKGUsIHQpLCAic291cmNlIiA9PT0gZSAmJiB0aGlzLl9pbml0U291cmNlKCksICJhcHBlbmRUbyIgPT09IGUgJiYgdGhpcy5tZW51LmVsZW1lbnQuYXBwZW5kVG8odGhpcy5fYXBwZW5kVG8oKSksICJkaXNhYmxlZCIgPT09IGUgJiYgdCAmJiB0aGlzLnhociAmJiB0aGlzLnhoci5hYm9ydCgpIH0sIF9pc0V2ZW50VGFyZ2V0SW5XaWRnZXQ6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5tZW51LmVsZW1lbnRbMF07IHJldHVybiB0LnRhcmdldCA9PT0gdGhpcy5lbGVtZW50WzBdIHx8IHQudGFyZ2V0ID09PSBpIHx8IGUuY29udGFpbnMoaSwgdC50YXJnZXQpIH0sIF9jbG9zZU9uQ2xpY2tPdXRzaWRlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl9pc0V2ZW50VGFyZ2V0SW5XaWRnZXQoZSkgfHwgdGhpcy5jbG9zZSgpIH0sIF9hcHBlbmRUbzogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMub3B0aW9ucy5hcHBlbmRUbzsgcmV0dXJuIHQgJiYgKHQgPSB0LmpxdWVyeSB8fCB0Lm5vZGVUeXBlID8gZSh0KSA6IHRoaXMuZG9jdW1lbnQuZmluZCh0KS5lcSgwKSksIHQgJiYgdFswXSB8fCAodCA9IHRoaXMuZWxlbWVudC5jbG9zZXN0KCIudWktZnJvbnQsIGRpYWxvZyIpKSwgdC5sZW5ndGggfHwgKHQgPSB0aGlzLmRvY3VtZW50WzBdLmJvZHkpLCB0IH0sIF9pbml0U291cmNlOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpLCBzID0gdGhpczsgZS5pc0FycmF5KHRoaXMub3B0aW9ucy5zb3VyY2UpID8gKHQgPSB0aGlzLm9wdGlvbnMuc291cmNlLCB0aGlzLnNvdXJjZSA9IGZ1bmN0aW9uIChpLCBzKSB7IHMoZS51aS5hdXRvY29tcGxldGUuZmlsdGVyKHQsIGkudGVybSkpIH0pIDogInN0cmluZyIgPT0gdHlwZW9mIHRoaXMub3B0aW9ucy5zb3VyY2UgPyAoaSA9IHRoaXMub3B0aW9ucy5zb3VyY2UsIHRoaXMuc291cmNlID0gZnVuY3Rpb24gKHQsIGEpIHsgcy54aHIgJiYgcy54aHIuYWJvcnQoKSwgcy54aHIgPSBlLmFqYXgoeyB1cmw6IGksIGRhdGE6IHQsIGRhdGFUeXBlOiAianNvbiIsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IGEoZSkgfSwgZXJyb3I6IGZ1bmN0aW9uICgpIHsgYShbXSkgfSB9KSB9KSA6IHRoaXMuc291cmNlID0gdGhpcy5vcHRpb25zLnNvdXJjZSB9LCBfc2VhcmNoVGltZW91dDogZnVuY3Rpb24gKGUpIHsgY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoaW5nKSwgdGhpcy5zZWFyY2hpbmcgPSB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy50ZXJtID09PSB0aGlzLl92YWx1ZSgpLCBpID0gdGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIiksIHMgPSBlLmFsdEtleSB8fCBlLmN0cmxLZXkgfHwgZS5tZXRhS2V5IHx8IGUuc2hpZnRLZXk7ICghdCB8fCB0ICYmICFpICYmICFzKSAmJiAodGhpcy5zZWxlY3RlZEl0ZW0gPSBudWxsLCB0aGlzLnNlYXJjaChudWxsLCBlKSkgfSwgdGhpcy5vcHRpb25zLmRlbGF5KSB9LCBzZWFyY2g6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBlID0gbnVsbCAhPSBlID8gZSA6IHRoaXMuX3ZhbHVlKCksIHRoaXMudGVybSA9IHRoaXMuX3ZhbHVlKCksIGUubGVuZ3RoIDwgdGhpcy5vcHRpb25zLm1pbkxlbmd0aCA/IHRoaXMuY2xvc2UodCkgOiB0aGlzLl90cmlnZ2VyKCJzZWFyY2giLCB0KSAhPT0gITEgPyB0aGlzLl9zZWFyY2goZSkgOiB2b2lkIDAgfSwgX3NlYXJjaDogZnVuY3Rpb24gKGUpIHsgdGhpcy5wZW5kaW5nKysgLCB0aGlzLl9hZGRDbGFzcygidWktYXV0b2NvbXBsZXRlLWxvYWRpbmciKSwgdGhpcy5jYW5jZWxTZWFyY2ggPSAhMSwgdGhpcy5zb3VyY2UoeyB0ZXJtOiBlIH0sIHRoaXMuX3Jlc3BvbnNlKCkpIH0sIF9yZXNwb25zZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9ICsrdGhpcy5yZXF1ZXN0SW5kZXg7IHJldHVybiBlLnByb3h5KGZ1bmN0aW9uIChlKSB7IHQgPT09IHRoaXMucmVxdWVzdEluZGV4ICYmIHRoaXMuX19yZXNwb25zZShlKSwgdGhpcy5wZW5kaW5nLS0gLCB0aGlzLnBlbmRpbmcgfHwgdGhpcy5fcmVtb3ZlQ2xhc3MoInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nIikgfSwgdGhpcykgfSwgX19yZXNwb25zZTogZnVuY3Rpb24gKGUpIHsgZSAmJiAoZSA9IHRoaXMuX25vcm1hbGl6ZShlKSksIHRoaXMuX3RyaWdnZXIoInJlc3BvbnNlIiwgbnVsbCwgeyBjb250ZW50OiBlIH0pLCAhdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIGUgJiYgZS5sZW5ndGggJiYgIXRoaXMuY2FuY2VsU2VhcmNoID8gKHRoaXMuX3N1Z2dlc3QoZSksIHRoaXMuX3RyaWdnZXIoIm9wZW4iKSkgOiB0aGlzLl9jbG9zZSgpIH0sIGNsb3NlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLmNhbmNlbFNlYXJjaCA9ICEwLCB0aGlzLl9jbG9zZShlKSB9LCBfY2xvc2U6IGZ1bmN0aW9uIChlKSB7IHRoaXMuX29mZih0aGlzLmRvY3VtZW50LCAibW91c2Vkb3duIiksIHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpICYmICh0aGlzLm1lbnUuZWxlbWVudC5oaWRlKCksIHRoaXMubWVudS5ibHVyKCksIHRoaXMuaXNOZXdNZW51ID0gITAsIHRoaXMuX3RyaWdnZXIoImNsb3NlIiwgZSkpIH0sIF9jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7IHRoaXMucHJldmlvdXMgIT09IHRoaXMuX3ZhbHVlKCkgJiYgdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgZSwgeyBpdGVtOiB0aGlzLnNlbGVjdGVkSXRlbSB9KSB9LCBfbm9ybWFsaXplOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sZW5ndGggJiYgdFswXS5sYWJlbCAmJiB0WzBdLnZhbHVlID8gdCA6IGUubWFwKHQsIGZ1bmN0aW9uICh0KSB7IHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IHsgbGFiZWw6IHQsIHZhbHVlOiB0IH0gOiBlLmV4dGVuZCh7fSwgdCwgeyBsYWJlbDogdC5sYWJlbCB8fCB0LnZhbHVlLCB2YWx1ZTogdC52YWx1ZSB8fCB0LmxhYmVsIH0pIH0pIH0sIF9zdWdnZXN0OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMubWVudS5lbGVtZW50LmVtcHR5KCk7IHRoaXMuX3JlbmRlck1lbnUoaSwgdCksIHRoaXMuaXNOZXdNZW51ID0gITAsIHRoaXMubWVudS5yZWZyZXNoKCksIGkuc2hvdygpLCB0aGlzLl9yZXNpemVNZW51KCksIGkucG9zaXRpb24oZS5leHRlbmQoeyBvZjogdGhpcy5lbGVtZW50IH0sIHRoaXMub3B0aW9ucy5wb3NpdGlvbikpLCB0aGlzLm9wdGlvbnMuYXV0b0ZvY3VzICYmIHRoaXMubWVudS5uZXh0KCksIHRoaXMuX29uKHRoaXMuZG9jdW1lbnQsIHsgbW91c2Vkb3duOiAiX2Nsb3NlT25DbGlja091dHNpZGUiIH0pIH0sIF9yZXNpemVNZW51OiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5tZW51LmVsZW1lbnQ7IGUub3V0ZXJXaWR0aChNYXRoLm1heChlLndpZHRoKCIiKS5vdXRlcldpZHRoKCkgKyAxLCB0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpKSkgfSwgX3JlbmRlck1lbnU6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gdGhpczsgZS5lYWNoKGksIGZ1bmN0aW9uIChlLCBpKSB7IHMuX3JlbmRlckl0ZW1EYXRhKHQsIGkpIH0pIH0sIF9yZW5kZXJJdGVtRGF0YTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHRoaXMuX3JlbmRlckl0ZW0oZSwgdCkuZGF0YSgidWktYXV0b2NvbXBsZXRlLWl0ZW0iLCB0KSB9LCBfcmVuZGVySXRlbTogZnVuY3Rpb24gKHQsIGkpIHsgcmV0dXJuIGUoIjxsaT4iKS5hcHBlbmQoZSgiPGRpdj4iKS50ZXh0KGkubGFiZWwpKS5hcHBlbmRUbyh0KSB9LCBfbW92ZTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpID8gdGhpcy5tZW51LmlzRmlyc3RJdGVtKCkgJiYgL15wcmV2aW91cy8udGVzdChlKSB8fCB0aGlzLm1lbnUuaXNMYXN0SXRlbSgpICYmIC9ebmV4dC8udGVzdChlKSA/ICh0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMuX3ZhbHVlKHRoaXMudGVybSksIHRoaXMubWVudS5ibHVyKCksIHZvaWQgMCkgOiAodGhpcy5tZW51W2VdKHQpLCB2b2lkIDApIDogKHRoaXMuc2VhcmNoKG51bGwsIHQpLCB2b2lkIDApIH0sIHdpZGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tZW51LmVsZW1lbnQgfSwgX3ZhbHVlOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnZhbHVlTWV0aG9kLmFwcGx5KHRoaXMuZWxlbWVudCwgYXJndW1lbnRzKSB9LCBfa2V5RXZlbnQ6IGZ1bmN0aW9uIChlLCB0KSB7ICghdGhpcy5pc011bHRpTGluZSB8fCB0aGlzLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSkgJiYgKHRoaXMuX21vdmUoZSwgdCksIHQucHJldmVudERlZmF1bHQoKSkgfSwgX2lzQ29udGVudEVkaXRhYmxlOiBmdW5jdGlvbiAoZSkgeyBpZiAoIWUubGVuZ3RoKSByZXR1cm4gITE7IHZhciB0ID0gZS5wcm9wKCJjb250ZW50RWRpdGFibGUiKTsgcmV0dXJuICJpbmhlcml0IiA9PT0gdCA/IHRoaXMuX2lzQ29udGVudEVkaXRhYmxlKGUucGFyZW50KCkpIDogInRydWUiID09PSB0IH0gfSksIGUuZXh0ZW5kKGUudWkuYXV0b2NvbXBsZXRlLCB7IGVzY2FwZVJlZ2V4OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5yZXBsYWNlKC9bXC1cW1xde30oKSorPy4sXFxcXiR8I1xzXS9nLCAiXFwkJiIpIH0sIGZpbHRlcjogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSBSZWdFeHAoZS51aS5hdXRvY29tcGxldGUuZXNjYXBlUmVnZXgoaSksICJpIik7IHJldHVybiBlLmdyZXAodCwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHMudGVzdChlLmxhYmVsIHx8IGUudmFsdWUgfHwgZSkgfSkgfSB9KSwgZS53aWRnZXQoInVpLmF1dG9jb21wbGV0ZSIsIGUudWkuYXV0b2NvbXBsZXRlLCB7IG9wdGlvbnM6IHsgbWVzc2FnZXM6IHsgbm9SZXN1bHRzOiAiTm8gc2VhcmNoIHJlc3VsdHMuIiwgcmVzdWx0czogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgKyAoZSA+IDEgPyAiIHJlc3VsdHMgYXJlIiA6ICIgcmVzdWx0IGlzIikgKyAiIGF2YWlsYWJsZSwgdXNlIHVwIGFuZCBkb3duIGFycm93IGtleXMgdG8gbmF2aWdhdGUuIiB9IH0gfSwgX19yZXNwb25zZTogZnVuY3Rpb24gKHQpIHsgdmFyIGk7IHRoaXMuX3N1cGVyQXBwbHkoYXJndW1lbnRzKSwgdGhpcy5vcHRpb25zLmRpc2FibGVkIHx8IHRoaXMuY2FuY2VsU2VhcmNoIHx8IChpID0gdCAmJiB0Lmxlbmd0aCA/IHRoaXMub3B0aW9ucy5tZXNzYWdlcy5yZXN1bHRzKHQubGVuZ3RoKSA6IHRoaXMub3B0aW9ucy5tZXNzYWdlcy5ub1Jlc3VsdHMsIHRoaXMubGl2ZVJlZ2lvbi5jaGlsZHJlbigpLmhpZGUoKSwgZSgiPGRpdj4iKS50ZXh0KGkpLmFwcGVuZFRvKHRoaXMubGl2ZVJlZ2lvbikpIH0gfSksIGUudWkuYXV0b2NvbXBsZXRlOyB2YXIgYyA9IC91aS1jb3JuZXItKFthLXpdKXsyLDZ9L2c7IGUud2lkZ2V0KCJ1aS5jb250cm9sZ3JvdXAiLCB7IHZlcnNpb246ICIxLjEyLjEiLCBkZWZhdWx0RWxlbWVudDogIjxkaXY+Iiwgb3B0aW9uczogeyBkaXJlY3Rpb246ICJob3Jpem9udGFsIiwgZGlzYWJsZWQ6IG51bGwsIG9ubHlWaXNpYmxlOiAhMCwgaXRlbXM6IHsgYnV0dG9uOiAiaW5wdXRbdHlwZT1idXR0b25dLCBpbnB1dFt0eXBlPXN1Ym1pdF0sIGlucHV0W3R5cGU9cmVzZXRdLCBidXR0b24sIGEiLCBjb250cm9sZ3JvdXBMYWJlbDogIi51aS1jb250cm9sZ3JvdXAtbGFiZWwiLCBjaGVja2JveHJhZGlvOiAiaW5wdXRbdHlwZT0nY2hlY2tib3gnXSwgaW5wdXRbdHlwZT0ncmFkaW8nXSIsIHNlbGVjdG1lbnU6ICJzZWxlY3QiLCBzcGlubmVyOiAiLnVpLXNwaW5uZXItaW5wdXQiIH0gfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB0aGlzLl9lbmhhbmNlKCkgfSwgX2VuaGFuY2U6IGZ1bmN0aW9uICgpIHsgdGhpcy5lbGVtZW50LmF0dHIoInJvbGUiLCAidG9vbGJhciIpLCB0aGlzLnJlZnJlc2goKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLl9jYWxsQ2hpbGRNZXRob2QoImRlc3Ryb3kiKSwgdGhpcy5jaGlsZFdpZGdldHMucmVtb3ZlRGF0YSgidWktY29udHJvbGdyb3VwLWRhdGEiKSwgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoInJvbGUiKSwgdGhpcy5vcHRpb25zLml0ZW1zLmNvbnRyb2xncm91cExhYmVsICYmIHRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5pdGVtcy5jb250cm9sZ3JvdXBMYWJlbCkuZmluZCgiLnVpLWNvbnRyb2xncm91cC1sYWJlbC1jb250ZW50cyIpLmNvbnRlbnRzKCkudW53cmFwKCkgfSwgX2luaXRXaWRnZXRzOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgaSA9IFtdOyBlLmVhY2godGhpcy5vcHRpb25zLml0ZW1zLCBmdW5jdGlvbiAocywgYSkgeyB2YXIgbiwgciA9IHt9OyByZXR1cm4gYSA/ICJjb250cm9sZ3JvdXBMYWJlbCIgPT09IHMgPyAobiA9IHQuZWxlbWVudC5maW5kKGEpLCBuLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHQuY2hpbGRyZW4oIi51aS1jb250cm9sZ3JvdXAtbGFiZWwtY29udGVudHMiKS5sZW5ndGggfHwgdC5jb250ZW50cygpLndyYXBBbGwoIjxzcGFuIGNsYXNzPSd1aS1jb250cm9sZ3JvdXAtbGFiZWwtY29udGVudHMnPjwvc3Bhbj4iKSB9KSwgdC5fYWRkQ2xhc3MobiwgbnVsbCwgInVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1zdGF0ZS1kZWZhdWx0IiksIGkgPSBpLmNvbmNhdChuLmdldCgpKSwgdm9pZCAwKSA6IChlLmZuW3NdICYmIChyID0gdFsiXyIgKyBzICsgIk9wdGlvbnMiXSA/IHRbIl8iICsgcyArICJPcHRpb25zIl0oIm1pZGRsZSIpIDogeyBjbGFzc2VzOiB7fSB9LCB0LmVsZW1lbnQuZmluZChhKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGEgPSBlKHRoaXMpLCBuID0gYVtzXSgiaW5zdGFuY2UiKSwgbyA9IGUud2lkZ2V0LmV4dGVuZCh7fSwgcik7IGlmICgiYnV0dG9uIiAhPT0gcyB8fCAhYS5wYXJlbnQoIi51aS1zcGlubmVyIikubGVuZ3RoKSB7IG4gfHwgKG4gPSBhW3NdKClbc10oImluc3RhbmNlIikpLCBuICYmIChvLmNsYXNzZXMgPSB0Ll9yZXNvbHZlQ2xhc3Nlc1ZhbHVlcyhvLmNsYXNzZXMsIG4pKSwgYVtzXShvKTsgdmFyIGwgPSBhW3NdKCJ3aWRnZXQiKTsgZS5kYXRhKGxbMF0sICJ1aS1jb250cm9sZ3JvdXAtZGF0YSIsIG4gPyBuIDogYVtzXSgiaW5zdGFuY2UiKSksIGkucHVzaChsWzBdKSB9IH0pKSwgdm9pZCAwKSA6IHZvaWQgMCB9KSwgdGhpcy5jaGlsZFdpZGdldHMgPSBlKGUudW5pcXVlKGkpKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5jaGlsZFdpZGdldHMsICJ1aS1jb250cm9sZ3JvdXAtaXRlbSIpIH0sIF9jYWxsQ2hpbGRNZXRob2Q6IGZ1bmN0aW9uICh0KSB7IHRoaXMuY2hpbGRXaWRnZXRzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgaSA9IGUodGhpcyksIHMgPSBpLmRhdGEoInVpLWNvbnRyb2xncm91cC1kYXRhIik7IHMgJiYgc1t0XSAmJiBzW3RdKCkgfSkgfSwgX3VwZGF0ZUNvcm5lckNsYXNzOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSA9ICJ1aS1jb3JuZXItdG9wIHVpLWNvcm5lci1ib3R0b20gdWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0IHVpLWNvcm5lci1hbGwiLCBzID0gdGhpcy5fYnVpbGRTaW1wbGVPcHRpb25zKHQsICJsYWJlbCIpLmNsYXNzZXMubGFiZWw7IHRoaXMuX3JlbW92ZUNsYXNzKGUsIG51bGwsIGkpLCB0aGlzLl9hZGRDbGFzcyhlLCBudWxsLCBzKSB9LCBfYnVpbGRTaW1wbGVPcHRpb25zOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSA9ICJ2ZXJ0aWNhbCIgPT09IHRoaXMub3B0aW9ucy5kaXJlY3Rpb24sIHMgPSB7IGNsYXNzZXM6IHt9IH07IHJldHVybiBzLmNsYXNzZXNbdF0gPSB7IG1pZGRsZTogIiIsIGZpcnN0OiAidWktY29ybmVyLSIgKyAoaSA/ICJ0b3AiIDogImxlZnQiKSwgbGFzdDogInVpLWNvcm5lci0iICsgKGkgPyAiYm90dG9tIiA6ICJyaWdodCIpLCBvbmx5OiAidWktY29ybmVyLWFsbCIgfVtlXSwgcyB9LCBfc3Bpbm5lck9wdGlvbnM6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpcy5fYnVpbGRTaW1wbGVPcHRpb25zKGUsICJ1aS1zcGlubmVyIik7IHJldHVybiB0LmNsYXNzZXNbInVpLXNwaW5uZXItdXAiXSA9ICIiLCB0LmNsYXNzZXNbInVpLXNwaW5uZXItZG93biJdID0gIiIsIHQgfSwgX2J1dHRvbk9wdGlvbnM6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLl9idWlsZFNpbXBsZU9wdGlvbnMoZSwgInVpLWJ1dHRvbiIpIH0sIF9jaGVja2JveHJhZGlvT3B0aW9uczogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuX2J1aWxkU2ltcGxlT3B0aW9ucyhlLCAidWktY2hlY2tib3hyYWRpby1sYWJlbCIpIH0sIF9zZWxlY3RtZW51T3B0aW9uczogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSAidmVydGljYWwiID09PSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uOyByZXR1cm4geyB3aWR0aDogdCA/ICJhdXRvIiA6ICExLCBjbGFzc2VzOiB7IG1pZGRsZTogeyAidWktc2VsZWN0bWVudS1idXR0b24tb3BlbiI6ICIiLCAidWktc2VsZWN0bWVudS1idXR0b24tY2xvc2VkIjogIiIgfSwgZmlyc3Q6IHsgInVpLXNlbGVjdG1lbnUtYnV0dG9uLW9wZW4iOiAidWktY29ybmVyLSIgKyAodCA/ICJ0b3AiIDogInRsIiksICJ1aS1zZWxlY3RtZW51LWJ1dHRvbi1jbG9zZWQiOiAidWktY29ybmVyLSIgKyAodCA/ICJ0b3AiIDogImxlZnQiKSB9LCBsYXN0OiB7ICJ1aS1zZWxlY3RtZW51LWJ1dHRvbi1vcGVuIjogdCA/ICIiIDogInVpLWNvcm5lci10ciIsICJ1aS1zZWxlY3RtZW51LWJ1dHRvbi1jbG9zZWQiOiAidWktY29ybmVyLSIgKyAodCA/ICJib3R0b20iIDogInJpZ2h0IikgfSwgb25seTogeyAidWktc2VsZWN0bWVudS1idXR0b24tb3BlbiI6ICJ1aS1jb3JuZXItdG9wIiwgInVpLXNlbGVjdG1lbnUtYnV0dG9uLWNsb3NlZCI6ICJ1aS1jb3JuZXItYWxsIiB9IH1bZV0gfSB9LCBfcmVzb2x2ZUNsYXNzZXNWYWx1ZXM6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0ge307IHJldHVybiBlLmVhY2godCwgZnVuY3Rpb24gKGEpIHsgdmFyIG4gPSBpLm9wdGlvbnMuY2xhc3Nlc1thXSB8fCAiIjsgbiA9IGUudHJpbShuLnJlcGxhY2UoYywgIiIpKSwgc1thXSA9IChuICsgIiAiICsgdFthXSkucmVwbGFjZSgvXHMrL2csICIgIikgfSksIHMgfSwgX3NldE9wdGlvbjogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICJkaXJlY3Rpb24iID09PSBlICYmIHRoaXMuX3JlbW92ZUNsYXNzKCJ1aS1jb250cm9sZ3JvdXAtIiArIHRoaXMub3B0aW9ucy5kaXJlY3Rpb24pLCB0aGlzLl9zdXBlcihlLCB0KSwgImRpc2FibGVkIiA9PT0gZSA/ICh0aGlzLl9jYWxsQ2hpbGRNZXRob2QodCA/ICJkaXNhYmxlIiA6ICJlbmFibGUiKSwgdm9pZCAwKSA6ICh0aGlzLnJlZnJlc2goKSwgdm9pZCAwKSB9LCByZWZyZXNoOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpID0gdGhpczsgdGhpcy5fYWRkQ2xhc3MoInVpLWNvbnRyb2xncm91cCB1aS1jb250cm9sZ3JvdXAtIiArIHRoaXMub3B0aW9ucy5kaXJlY3Rpb24pLCAiaG9yaXpvbnRhbCIgPT09IHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gJiYgdGhpcy5fYWRkQ2xhc3MobnVsbCwgInVpLWhlbHBlci1jbGVhcmZpeCIpLCB0aGlzLl9pbml0V2lkZ2V0cygpLCB0ID0gdGhpcy5jaGlsZFdpZGdldHMsIHRoaXMub3B0aW9ucy5vbmx5VmlzaWJsZSAmJiAodCA9IHQuZmlsdGVyKCI6dmlzaWJsZSIpKSwgdC5sZW5ndGggJiYgKGUuZWFjaChbImZpcnN0IiwgImxhc3QiXSwgZnVuY3Rpb24gKGUsIHMpIHsgdmFyIGEgPSB0W3NdKCkuZGF0YSgidWktY29udHJvbGdyb3VwLWRhdGEiKTsgaWYgKGEgJiYgaVsiXyIgKyBhLndpZGdldE5hbWUgKyAiT3B0aW9ucyJdKSB7IHZhciBuID0gaVsiXyIgKyBhLndpZGdldE5hbWUgKyAiT3B0aW9ucyJdKDEgPT09IHQubGVuZ3RoID8gIm9ubHkiIDogcyk7IG4uY2xhc3NlcyA9IGkuX3Jlc29sdmVDbGFzc2VzVmFsdWVzKG4uY2xhc3NlcywgYSksIGEuZWxlbWVudFthLndpZGdldE5hbWVdKG4pIH0gZWxzZSBpLl91cGRhdGVDb3JuZXJDbGFzcyh0W3NdKCksIHMpIH0pLCB0aGlzLl9jYWxsQ2hpbGRNZXRob2QoInJlZnJlc2giKSkgfSB9KSwgZS53aWRnZXQoInVpLmNoZWNrYm94cmFkaW8iLCBbZS51aS5mb3JtUmVzZXRNaXhpbiwgew0KICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjEyLjEiLCBvcHRpb25zOiB7IGRpc2FibGVkOiBudWxsLCBsYWJlbDogbnVsbCwgaWNvbjogITAsIGNsYXNzZXM6IHsgInVpLWNoZWNrYm94cmFkaW8tbGFiZWwiOiAidWktY29ybmVyLWFsbCIsICJ1aS1jaGVja2JveHJhZGlvLWljb24iOiAidWktY29ybmVyLWFsbCIgfSB9LCBfZ2V0Q3JlYXRlT3B0aW9uczogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSwgcyA9IHRoaXMsIGEgPSB0aGlzLl9zdXBlcigpIHx8IHt9OyByZXR1cm4gdGhpcy5fcmVhZFR5cGUoKSwgaSA9IHRoaXMuZWxlbWVudC5sYWJlbHMoKSwgdGhpcy5sYWJlbCA9IGUoaVtpLmxlbmd0aCAtIDFdKSwgdGhpcy5sYWJlbC5sZW5ndGggfHwgZS5lcnJvcigiTm8gbGFiZWwgZm91bmQgZm9yIGNoZWNrYm94cmFkaW8gd2lkZ2V0IiksIHRoaXMub3JpZ2luYWxMYWJlbCA9ICIiLCB0aGlzLmxhYmVsLmNvbnRlbnRzKCkubm90KHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbiAoKSB7IHMub3JpZ2luYWxMYWJlbCArPSAzID09PSB0aGlzLm5vZGVUeXBlID8gZSh0aGlzKS50ZXh0KCkgOiB0aGlzLm91dGVySFRNTCB9KSwgdGhpcy5vcmlnaW5hbExhYmVsICYmIChhLmxhYmVsID0gdGhpcy5vcmlnaW5hbExhYmVsKSwgdCA9IHRoaXMuZWxlbWVudFswXS5kaXNhYmxlZCwgbnVsbCAhPSB0ICYmIChhLmRpc2FibGVkID0gdCksIGEgfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuZWxlbWVudFswXS5jaGVja2VkOyB0aGlzLl9iaW5kRm9ybVJlc2V0SGFuZGxlcigpLCBudWxsID09IHRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiAodGhpcy5vcHRpb25zLmRpc2FibGVkID0gdGhpcy5lbGVtZW50WzBdLmRpc2FibGVkKSwgdGhpcy5fc2V0T3B0aW9uKCJkaXNhYmxlZCIsIHRoaXMub3B0aW9ucy5kaXNhYmxlZCksIHRoaXMuX2FkZENsYXNzKCJ1aS1jaGVja2JveHJhZGlvIiwgInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZSIpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLmxhYmVsLCAidWktY2hlY2tib3hyYWRpby1sYWJlbCIsICJ1aS1idXR0b24gdWktd2lkZ2V0IiksICJyYWRpbyIgPT09IHRoaXMudHlwZSAmJiB0aGlzLl9hZGRDbGFzcyh0aGlzLmxhYmVsLCAidWktY2hlY2tib3hyYWRpby1yYWRpby1sYWJlbCIpLCB0aGlzLm9wdGlvbnMubGFiZWwgJiYgdGhpcy5vcHRpb25zLmxhYmVsICE9PSB0aGlzLm9yaWdpbmFsTGFiZWwgPyB0aGlzLl91cGRhdGVMYWJlbCgpIDogdGhpcy5vcmlnaW5hbExhYmVsICYmICh0aGlzLm9wdGlvbnMubGFiZWwgPSB0aGlzLm9yaWdpbmFsTGFiZWwpLCB0aGlzLl9lbmhhbmNlKCksIGUgJiYgKHRoaXMuX2FkZENsYXNzKHRoaXMubGFiZWwsICJ1aS1jaGVja2JveHJhZGlvLWNoZWNrZWQiLCAidWktc3RhdGUtYWN0aXZlIiksIHRoaXMuaWNvbiAmJiB0aGlzLl9hZGRDbGFzcyh0aGlzLmljb24sIG51bGwsICJ1aS1zdGF0ZS1ob3ZlciIpKSwgdGhpcy5fb24oeyBjaGFuZ2U6ICJfdG9nZ2xlQ2xhc3NlcyIsIGZvY3VzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX2FkZENsYXNzKHRoaXMubGFiZWwsIG51bGwsICJ1aS1zdGF0ZS1mb2N1cyB1aS12aXN1YWwtZm9jdXMiKSB9LCBibHVyOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMubGFiZWwsIG51bGwsICJ1aS1zdGF0ZS1mb2N1cyB1aS12aXN1YWwtZm9jdXMiKSB9IH0pIH0sIF9yZWFkVHlwZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOyB0aGlzLnR5cGUgPSB0aGlzLmVsZW1lbnRbMF0udHlwZSwgImlucHV0IiA9PT0gdCAmJiAvcmFkaW98Y2hlY2tib3gvLnRlc3QodGhpcy50eXBlKSB8fCBlLmVycm9yKCJDYW4ndCBjcmVhdGUgY2hlY2tib3hyYWRpbyBvbiBlbGVtZW50Lm5vZGVOYW1lPSIgKyB0ICsgIiBhbmQgZWxlbWVudC50eXBlPSIgKyB0aGlzLnR5cGUpIH0sIF9lbmhhbmNlOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3VwZGF0ZUljb24odGhpcy5lbGVtZW50WzBdLmNoZWNrZWQpIH0sIHdpZGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5sYWJlbCB9LCBfZ2V0UmFkaW9Hcm91cDogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSA9IHRoaXMuZWxlbWVudFswXS5uYW1lLCBzID0gImlucHV0W25hbWU9JyIgKyBlLnVpLmVzY2FwZVNlbGVjdG9yKGkpICsgIiddIjsgcmV0dXJuIGkgPyAodCA9IHRoaXMuZm9ybS5sZW5ndGggPyBlKHRoaXMuZm9ybVswXS5lbGVtZW50cykuZmlsdGVyKHMpIDogZShzKS5maWx0ZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gMCA9PT0gZSh0aGlzKS5mb3JtKCkubGVuZ3RoIH0pLCB0Lm5vdCh0aGlzLmVsZW1lbnQpKSA6IGUoW10pIH0sIF90b2dnbGVDbGFzc2VzOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5lbGVtZW50WzBdLmNoZWNrZWQ7IHRoaXMuX3RvZ2dsZUNsYXNzKHRoaXMubGFiZWwsICJ1aS1jaGVja2JveHJhZGlvLWNoZWNrZWQiLCAidWktc3RhdGUtYWN0aXZlIiwgdCksIHRoaXMub3B0aW9ucy5pY29uICYmICJjaGVja2JveCIgPT09IHRoaXMudHlwZSAmJiB0aGlzLl90b2dnbGVDbGFzcyh0aGlzLmljb24sIG51bGwsICJ1aS1pY29uLWNoZWNrIHVpLXN0YXRlLWNoZWNrZWQiLCB0KS5fdG9nZ2xlQ2xhc3ModGhpcy5pY29uLCBudWxsLCAidWktaWNvbi1ibGFuayIsICF0KSwgInJhZGlvIiA9PT0gdGhpcy50eXBlICYmIHRoaXMuX2dldFJhZGlvR3JvdXAoKS5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpLmNoZWNrYm94cmFkaW8oImluc3RhbmNlIik7IHQgJiYgdC5fcmVtb3ZlQ2xhc3ModC5sYWJlbCwgInVpLWNoZWNrYm94cmFkaW8tY2hlY2tlZCIsICJ1aS1zdGF0ZS1hY3RpdmUiKSB9KSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLl91bmJpbmRGb3JtUmVzZXRIYW5kbGVyKCksIHRoaXMuaWNvbiAmJiAodGhpcy5pY29uLnJlbW92ZSgpLCB0aGlzLmljb25TcGFjZS5yZW1vdmUoKSkgfSwgX3NldE9wdGlvbjogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICJsYWJlbCIgIT09IGUgfHwgdCA/ICh0aGlzLl9zdXBlcihlLCB0KSwgImRpc2FibGVkIiA9PT0gZSA/ICh0aGlzLl90b2dnbGVDbGFzcyh0aGlzLmxhYmVsLCBudWxsLCAidWktc3RhdGUtZGlzYWJsZWQiLCB0KSwgdGhpcy5lbGVtZW50WzBdLmRpc2FibGVkID0gdCwgdm9pZCAwKSA6ICh0aGlzLnJlZnJlc2goKSwgdm9pZCAwKSkgOiB2b2lkIDAgfSwgX3VwZGF0ZUljb246IGZ1bmN0aW9uICh0KSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpID0gInVpLWljb24gdWktaWNvbi1iYWNrZ3JvdW5kICI7IHRoaXMub3B0aW9ucy5pY29uID8gKHRoaXMuaWNvbiB8fCAodGhpcy5pY29uID0gZSgiPHNwYW4+IiksIHRoaXMuaWNvblNwYWNlID0gZSgiPHNwYW4+IDwvc3Bhbj4iKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5pY29uU3BhY2UsICJ1aS1jaGVja2JveHJhZGlvLWljb24tc3BhY2UiKSksICJjaGVja2JveCIgPT09IHRoaXMudHlwZSA/IChpICs9IHQgPyAidWktaWNvbi1jaGVjayB1aS1zdGF0ZS1jaGVja2VkIiA6ICJ1aS1pY29uLWJsYW5rIiwgdGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5pY29uLCBudWxsLCB0ID8gInVpLWljb24tYmxhbmsiIDogInVpLWljb24tY2hlY2siKSkgOiBpICs9ICJ1aS1pY29uLWJsYW5rIiwgdGhpcy5fYWRkQ2xhc3ModGhpcy5pY29uLCAidWktY2hlY2tib3hyYWRpby1pY29uIiwgaSksIHQgfHwgdGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5pY29uLCBudWxsLCAidWktaWNvbi1jaGVjayB1aS1zdGF0ZS1jaGVja2VkIiksIHRoaXMuaWNvbi5wcmVwZW5kVG8odGhpcy5sYWJlbCkuYWZ0ZXIodGhpcy5pY29uU3BhY2UpKSA6IHZvaWQgMCAhPT0gdGhpcy5pY29uICYmICh0aGlzLmljb24ucmVtb3ZlKCksIHRoaXMuaWNvblNwYWNlLnJlbW92ZSgpLCBkZWxldGUgdGhpcy5pY29uKQ0KICAgICAgICAgICAgICAgIH0sIF91cGRhdGVMYWJlbDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMubGFiZWwuY29udGVudHMoKS5ub3QodGhpcy5lbGVtZW50WzBdKTsgdGhpcy5pY29uICYmIChlID0gZS5ub3QodGhpcy5pY29uWzBdKSksIHRoaXMuaWNvblNwYWNlICYmIChlID0gZS5ub3QodGhpcy5pY29uU3BhY2VbMF0pKSwgZS5yZW1vdmUoKSwgdGhpcy5sYWJlbC5hcHBlbmQodGhpcy5vcHRpb25zLmxhYmVsKSB9LCByZWZyZXNoOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5lbGVtZW50WzBdLmNoZWNrZWQsIHQgPSB0aGlzLmVsZW1lbnRbMF0uZGlzYWJsZWQ7IHRoaXMuX3VwZGF0ZUljb24oZSksIHRoaXMuX3RvZ2dsZUNsYXNzKHRoaXMubGFiZWwsICJ1aS1jaGVja2JveHJhZGlvLWNoZWNrZWQiLCAidWktc3RhdGUtYWN0aXZlIiwgZSksIG51bGwgIT09IHRoaXMub3B0aW9ucy5sYWJlbCAmJiB0aGlzLl91cGRhdGVMYWJlbCgpLCB0ICE9PSB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy5fc2V0T3B0aW9ucyh7IGRpc2FibGVkOiB0IH0pIH0NCiAgICAgICAgICAgIH1dKSwgZS51aS5jaGVja2JveHJhZGlvLCBlLndpZGdldCgidWkuYnV0dG9uIiwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgZGVmYXVsdEVsZW1lbnQ6ICI8YnV0dG9uPiIsIG9wdGlvbnM6IHsgY2xhc3NlczogeyAidWktYnV0dG9uIjogInVpLWNvcm5lci1hbGwiIH0sIGRpc2FibGVkOiBudWxsLCBpY29uOiBudWxsLCBpY29uUG9zaXRpb246ICJiZWdpbm5pbmciLCBsYWJlbDogbnVsbCwgc2hvd0xhYmVsOiAhMCB9LCBfZ2V0Q3JlYXRlT3B0aW9uczogZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCA9IHRoaXMuX3N1cGVyKCkgfHwge307IHJldHVybiB0aGlzLmlzSW5wdXQgPSB0aGlzLmVsZW1lbnQuaXMoImlucHV0IiksIGUgPSB0aGlzLmVsZW1lbnRbMF0uZGlzYWJsZWQsIG51bGwgIT0gZSAmJiAodC5kaXNhYmxlZCA9IGUpLCB0aGlzLm9yaWdpbmFsTGFiZWwgPSB0aGlzLmlzSW5wdXQgPyB0aGlzLmVsZW1lbnQudmFsKCkgOiB0aGlzLmVsZW1lbnQuaHRtbCgpLCB0aGlzLm9yaWdpbmFsTGFiZWwgJiYgKHQubGFiZWwgPSB0aGlzLm9yaWdpbmFsTGFiZWwpLCB0IH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgIXRoaXMub3B0aW9uLnNob3dMYWJlbCAmICF0aGlzLm9wdGlvbnMuaWNvbiAmJiAodGhpcy5vcHRpb25zLnNob3dMYWJlbCA9ICEwKSwgbnVsbCA9PSB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9IHRoaXMuZWxlbWVudFswXS5kaXNhYmxlZCB8fCAhMSksIHRoaXMuaGFzVGl0bGUgPSAhIXRoaXMuZWxlbWVudC5hdHRyKCJ0aXRsZSIpLCB0aGlzLm9wdGlvbnMubGFiZWwgJiYgdGhpcy5vcHRpb25zLmxhYmVsICE9PSB0aGlzLm9yaWdpbmFsTGFiZWwgJiYgKHRoaXMuaXNJbnB1dCA/IHRoaXMuZWxlbWVudC52YWwodGhpcy5vcHRpb25zLmxhYmVsKSA6IHRoaXMuZWxlbWVudC5odG1sKHRoaXMub3B0aW9ucy5sYWJlbCkpLCB0aGlzLl9hZGRDbGFzcygidWktYnV0dG9uIiwgInVpLXdpZGdldCIpLCB0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIiwgdGhpcy5vcHRpb25zLmRpc2FibGVkKSwgdGhpcy5fZW5oYW5jZSgpLCB0aGlzLmVsZW1lbnQuaXMoImEiKSAmJiB0aGlzLl9vbih7IGtleXVwOiBmdW5jdGlvbiAodCkgeyB0LmtleUNvZGUgPT09IGUudWkua2V5Q29kZS5TUEFDRSAmJiAodC5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLmVsZW1lbnRbMF0uY2xpY2sgPyB0aGlzLmVsZW1lbnRbMF0uY2xpY2soKSA6IHRoaXMuZWxlbWVudC50cmlnZ2VyKCJjbGljayIpKSB9IH0pIH0sIF9lbmhhbmNlOiBmdW5jdGlvbiAoKSB7IHRoaXMuZWxlbWVudC5pcygiYnV0dG9uIikgfHwgdGhpcy5lbGVtZW50LmF0dHIoInJvbGUiLCAiYnV0dG9uIiksIHRoaXMub3B0aW9ucy5pY29uICYmICh0aGlzLl91cGRhdGVJY29uKCJpY29uIiwgdGhpcy5vcHRpb25zLmljb24pLCB0aGlzLl91cGRhdGVUb29sdGlwKCkpIH0sIF91cGRhdGVUb29sdGlwOiBmdW5jdGlvbiAoKSB7IHRoaXMudGl0bGUgPSB0aGlzLmVsZW1lbnQuYXR0cigidGl0bGUiKSwgdGhpcy5vcHRpb25zLnNob3dMYWJlbCB8fCB0aGlzLnRpdGxlIHx8IHRoaXMuZWxlbWVudC5hdHRyKCJ0aXRsZSIsIHRoaXMub3B0aW9ucy5sYWJlbCkgfSwgX3VwZGF0ZUljb246IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gImljb25Qb3NpdGlvbiIgIT09IHQsIGEgPSBzID8gdGhpcy5vcHRpb25zLmljb25Qb3NpdGlvbiA6IGksIG4gPSAidG9wIiA9PT0gYSB8fCAiYm90dG9tIiA9PT0gYTsgdGhpcy5pY29uID8gcyAmJiB0aGlzLl9yZW1vdmVDbGFzcyh0aGlzLmljb24sIG51bGwsIHRoaXMub3B0aW9ucy5pY29uKSA6ICh0aGlzLmljb24gPSBlKCI8c3Bhbj4iKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5pY29uLCAidWktYnV0dG9uLWljb24iLCAidWktaWNvbiIpLCB0aGlzLm9wdGlvbnMuc2hvd0xhYmVsIHx8IHRoaXMuX2FkZENsYXNzKCJ1aS1idXR0b24taWNvbi1vbmx5IikpLCBzICYmIHRoaXMuX2FkZENsYXNzKHRoaXMuaWNvbiwgbnVsbCwgaSksIHRoaXMuX2F0dGFjaEljb24oYSksIG4gPyAodGhpcy5fYWRkQ2xhc3ModGhpcy5pY29uLCBudWxsLCAidWktd2lkZ2V0LWljb24tYmxvY2siKSwgdGhpcy5pY29uU3BhY2UgJiYgdGhpcy5pY29uU3BhY2UucmVtb3ZlKCkpIDogKHRoaXMuaWNvblNwYWNlIHx8ICh0aGlzLmljb25TcGFjZSA9IGUoIjxzcGFuPiA8L3NwYW4+IiksIHRoaXMuX2FkZENsYXNzKHRoaXMuaWNvblNwYWNlLCAidWktYnV0dG9uLWljb24tc3BhY2UiKSksIHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuaWNvbiwgbnVsbCwgInVpLXdpZ2V0LWljb24tYmxvY2siKSwgdGhpcy5fYXR0YWNoSWNvblNwYWNlKGEpKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigicm9sZSIpLCB0aGlzLmljb24gJiYgdGhpcy5pY29uLnJlbW92ZSgpLCB0aGlzLmljb25TcGFjZSAmJiB0aGlzLmljb25TcGFjZS5yZW1vdmUoKSwgdGhpcy5oYXNUaXRsZSB8fCB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigidGl0bGUiKSB9LCBfYXR0YWNoSWNvblNwYWNlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLmljb25bL14oPzplbmR8Ym90dG9tKS8udGVzdChlKSA/ICJiZWZvcmUiIDogImFmdGVyIl0odGhpcy5pY29uU3BhY2UpIH0sIF9hdHRhY2hJY29uOiBmdW5jdGlvbiAoZSkgeyB0aGlzLmVsZW1lbnRbL14oPzplbmR8Ym90dG9tKS8udGVzdChlKSA/ICJhcHBlbmQiIDogInByZXBlbmQiXSh0aGlzLmljb24pIH0sIF9zZXRPcHRpb25zOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHZvaWQgMCA9PT0gZS5zaG93TGFiZWwgPyB0aGlzLm9wdGlvbnMuc2hvd0xhYmVsIDogZS5zaG93TGFiZWwsIGkgPSB2b2lkIDAgPT09IGUuaWNvbiA/IHRoaXMub3B0aW9ucy5pY29uIDogZS5pY29uOyB0IHx8IGkgfHwgKGUuc2hvd0xhYmVsID0gITApLCB0aGlzLl9zdXBlcihlKSB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyAiaWNvbiIgPT09IGUgJiYgKHQgPyB0aGlzLl91cGRhdGVJY29uKGUsIHQpIDogdGhpcy5pY29uICYmICh0aGlzLmljb24ucmVtb3ZlKCksIHRoaXMuaWNvblNwYWNlICYmIHRoaXMuaWNvblNwYWNlLnJlbW92ZSgpKSksICJpY29uUG9zaXRpb24iID09PSBlICYmIHRoaXMuX3VwZGF0ZUljb24oZSwgdCksICJzaG93TGFiZWwiID09PSBlICYmICh0aGlzLl90b2dnbGVDbGFzcygidWktYnV0dG9uLWljb24tb25seSIsIG51bGwsICF0KSwgdGhpcy5fdXBkYXRlVG9vbHRpcCgpKSwgImxhYmVsIiA9PT0gZSAmJiAodGhpcy5pc0lucHV0ID8gdGhpcy5lbGVtZW50LnZhbCh0KSA6ICh0aGlzLmVsZW1lbnQuaHRtbCh0KSwgdGhpcy5pY29uICYmICh0aGlzLl9hdHRhY2hJY29uKHRoaXMub3B0aW9ucy5pY29uUG9zaXRpb24pLCB0aGlzLl9hdHRhY2hJY29uU3BhY2UodGhpcy5vcHRpb25zLmljb25Qb3NpdGlvbikpKSksIHRoaXMuX3N1cGVyKGUsIHQpLCAiZGlzYWJsZWQiID09PSBlICYmICh0aGlzLl90b2dnbGVDbGFzcyhudWxsLCAidWktc3RhdGUtZGlzYWJsZWQiLCB0KSwgdGhpcy5lbGVtZW50WzBdLmRpc2FibGVkID0gdCwgdCAmJiB0aGlzLmVsZW1lbnQuYmx1cigpKSB9LCByZWZyZXNoOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5lbGVtZW50LmlzKCJpbnB1dCwgYnV0dG9uIikgPyB0aGlzLmVsZW1lbnRbMF0uZGlzYWJsZWQgOiB0aGlzLmVsZW1lbnQuaGFzQ2xhc3MoInVpLWJ1dHRvbi1kaXNhYmxlZCIpOyBlICE9PSB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy5fc2V0T3B0aW9ucyh7IGRpc2FibGVkOiBlIH0pLCB0aGlzLl91cGRhdGVUb29sdGlwKCkgfSB9KSwgZS51aUJhY2tDb21wYXQgIT09ICExICYmIChlLndpZGdldCgidWkuYnV0dG9uIiwgZS51aS5idXR0b24sIHsgb3B0aW9uczogeyB0ZXh0OiAhMCwgaWNvbnM6IHsgcHJpbWFyeTogbnVsbCwgc2Vjb25kYXJ5OiBudWxsIH0gfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbnMuc2hvd0xhYmVsICYmICF0aGlzLm9wdGlvbnMudGV4dCAmJiAodGhpcy5vcHRpb25zLnNob3dMYWJlbCA9IHRoaXMub3B0aW9ucy50ZXh0KSwgIXRoaXMub3B0aW9ucy5zaG93TGFiZWwgJiYgdGhpcy5vcHRpb25zLnRleHQgJiYgKHRoaXMub3B0aW9ucy50ZXh0ID0gdGhpcy5vcHRpb25zLnNob3dMYWJlbCksIHRoaXMub3B0aW9ucy5pY29uIHx8ICF0aGlzLm9wdGlvbnMuaWNvbnMucHJpbWFyeSAmJiAhdGhpcy5vcHRpb25zLmljb25zLnNlY29uZGFyeSA/IHRoaXMub3B0aW9ucy5pY29uICYmICh0aGlzLm9wdGlvbnMuaWNvbnMucHJpbWFyeSA9IHRoaXMub3B0aW9ucy5pY29uKSA6IHRoaXMub3B0aW9ucy5pY29ucy5wcmltYXJ5ID8gdGhpcy5vcHRpb25zLmljb24gPSB0aGlzLm9wdGlvbnMuaWNvbnMucHJpbWFyeSA6ICh0aGlzLm9wdGlvbnMuaWNvbiA9IHRoaXMub3B0aW9ucy5pY29ucy5zZWNvbmRhcnksIHRoaXMub3B0aW9ucy5pY29uUG9zaXRpb24gPSAiZW5kIiksIHRoaXMuX3N1cGVyKCkgfSwgX3NldE9wdGlvbjogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICJ0ZXh0IiA9PT0gZSA/ICh0aGlzLl9zdXBlcigic2hvd0xhYmVsIiwgdCksIHZvaWQgMCkgOiAoInNob3dMYWJlbCIgPT09IGUgJiYgKHRoaXMub3B0aW9ucy50ZXh0ID0gdCksICJpY29uIiA9PT0gZSAmJiAodGhpcy5vcHRpb25zLmljb25zLnByaW1hcnkgPSB0KSwgImljb25zIiA9PT0gZSAmJiAodC5wcmltYXJ5ID8gKHRoaXMuX3N1cGVyKCJpY29uIiwgdC5wcmltYXJ5KSwgdGhpcy5fc3VwZXIoImljb25Qb3NpdGlvbiIsICJiZWdpbm5pbmciKSkgOiB0LnNlY29uZGFyeSAmJiAodGhpcy5fc3VwZXIoImljb24iLCB0LnNlY29uZGFyeSksIHRoaXMuX3N1cGVyKCJpY29uUG9zaXRpb24iLCAiZW5kIikpKSwgdGhpcy5fc3VwZXJBcHBseShhcmd1bWVudHMpLCB2b2lkIDApIH0gfSksIGUuZm4uYnV0dG9uID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuICF0aGlzLmxlbmd0aCB8fCB0aGlzLmxlbmd0aCAmJiAiSU5QVVQiICE9PSB0aGlzWzBdLnRhZ05hbWUgfHwgdGhpcy5sZW5ndGggJiYgIklOUFVUIiA9PT0gdGhpc1swXS50YWdOYW1lICYmICJjaGVja2JveCIgIT09IHRoaXMuYXR0cigidHlwZSIpICYmICJyYWRpbyIgIT09IHRoaXMuYXR0cigidHlwZSIpID8gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogKGUudWkuY2hlY2tib3hyYWRpbyB8fCBlLmVycm9yKCJDaGVja2JveHJhZGlvIHdpZGdldCBtaXNzaW5nIiksIDAgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLmNoZWNrYm94cmFkaW8oeyBpY29uOiAhMSB9KSA6IHRoaXMuY2hlY2tib3hyYWRpby5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB9IH0oZS5mbi5idXR0b24pLCBlLmZuLmJ1dHRvbnNldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUudWkuY29udHJvbGdyb3VwIHx8IGUuZXJyb3IoIkNvbnRyb2xncm91cCB3aWRnZXQgbWlzc2luZyIpLCAib3B0aW9uIiA9PT0gYXJndW1lbnRzWzBdICYmICJpdGVtcyIgPT09IGFyZ3VtZW50c1sxXSAmJiBhcmd1bWVudHNbMl0gPyB0aGlzLmNvbnRyb2xncm91cC5hcHBseSh0aGlzLCBbYXJndW1lbnRzWzBdLCAiaXRlbXMuYnV0dG9uIiwgYXJndW1lbnRzWzJdXSkgOiAib3B0aW9uIiA9PT0gYXJndW1lbnRzWzBdICYmICJpdGVtcyIgPT09IGFyZ3VtZW50c1sxXSA/IHRoaXMuY29udHJvbGdyb3VwLmFwcGx5KHRoaXMsIFthcmd1bWVudHNbMF0sICJpdGVtcy5idXR0b24iXSkgOiAoIm9iamVjdCIgPT0gdHlwZW9mIGFyZ3VtZW50c1swXSAmJiBhcmd1bWVudHNbMF0uaXRlbXMgJiYgKGFyZ3VtZW50c1swXS5pdGVtcyA9IHsgYnV0dG9uOiBhcmd1bWVudHNbMF0uaXRlbXMgfSksIHRoaXMuY29udHJvbGdyb3VwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIH0pLCBlLnVpLmJ1dHRvbiwgZS5leHRlbmQoZS51aSwgeyBkYXRlcGlja2VyOiB7IHZlcnNpb246ICIxLjEyLjEiIH0gfSk7IHZhciBwOyBlLmV4dGVuZChzLnByb3RvdHlwZSwgew0KICAgICAgICAgICAgICAgIG1hcmtlckNsYXNzTmFtZTogImhhc0RhdGVwaWNrZXIiLCBtYXhSb3dzOiA0LCBfd2lkZ2V0RGF0ZXBpY2tlcjogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5kcERpdiB9LCBzZXREZWZhdWx0czogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHIodGhpcy5fZGVmYXVsdHMsIGUgfHwge30pLCB0aGlzIH0sIF9hdHRhY2hEYXRlcGlja2VyOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSwgbjsgcyA9IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwgYSA9ICJkaXYiID09PSBzIHx8ICJzcGFuIiA9PT0gcywgdC5pZCB8fCAodGhpcy51dWlkICs9IDEsIHQuaWQgPSAiZHAiICsgdGhpcy51dWlkKSwgbiA9IHRoaXMuX25ld0luc3QoZSh0KSwgYSksIG4uc2V0dGluZ3MgPSBlLmV4dGVuZCh7fSwgaSB8fCB7fSksICJpbnB1dCIgPT09IHMgPyB0aGlzLl9jb25uZWN0RGF0ZXBpY2tlcih0LCBuKSA6IGEgJiYgdGhpcy5faW5saW5lRGF0ZXBpY2tlcih0LCBuKSB9LCBfbmV3SW5zdDogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSB0WzBdLmlkLnJlcGxhY2UoLyhbXkEtWmEtejAtOV9cLV0pL2csICJcXFxcJDEiKTsgcmV0dXJuIHsgaWQ6IHMsIGlucHV0OiB0LCBzZWxlY3RlZERheTogMCwgc2VsZWN0ZWRNb250aDogMCwgc2VsZWN0ZWRZZWFyOiAwLCBkcmF3TW9udGg6IDAsIGRyYXdZZWFyOiAwLCBpbmxpbmU6IGksIGRwRGl2OiBpID8gYShlKCI8ZGl2IGNsYXNzPSciICsgdGhpcy5faW5saW5lQ2xhc3MgKyAiIHVpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSkgOiB0aGlzLmRwRGl2IH0gfSwgX2Nvbm5lY3REYXRlcGlja2VyOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IGUodCk7IGkuYXBwZW5kID0gZShbXSksIGkudHJpZ2dlciA9IGUoW10pLCBzLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSB8fCAodGhpcy5fYXR0YWNobWVudHMocywgaSksIHMuYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLm9uKCJrZXlkb3duIiwgdGhpcy5fZG9LZXlEb3duKS5vbigia2V5cHJlc3MiLCB0aGlzLl9kb0tleVByZXNzKS5vbigia2V5dXAiLCB0aGlzLl9kb0tleVVwKSwgdGhpcy5fYXV0b1NpemUoaSksIGUuZGF0YSh0LCAiZGF0ZXBpY2tlciIsIGkpLCBpLnNldHRpbmdzLmRpc2FibGVkICYmIHRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKHQpKSB9LCBfYXR0YWNobWVudHM6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzLCBhLCBuLCByID0gdGhpcy5fZ2V0KGksICJhcHBlbmRUZXh0IiksIG8gPSB0aGlzLl9nZXQoaSwgImlzUlRMIik7IGkuYXBwZW5kICYmIGkuYXBwZW5kLnJlbW92ZSgpLCByICYmIChpLmFwcGVuZCA9IGUoIjxzcGFuIGNsYXNzPSciICsgdGhpcy5fYXBwZW5kQ2xhc3MgKyAiJz4iICsgciArICI8L3NwYW4+IiksIHRbbyA/ICJiZWZvcmUiIDogImFmdGVyIl0oaS5hcHBlbmQpKSwgdC5vZmYoImZvY3VzIiwgdGhpcy5fc2hvd0RhdGVwaWNrZXIpLCBpLnRyaWdnZXIgJiYgaS50cmlnZ2VyLnJlbW92ZSgpLCBzID0gdGhpcy5fZ2V0KGksICJzaG93T24iKSwgKCJmb2N1cyIgPT09IHMgfHwgImJvdGgiID09PSBzKSAmJiB0Lm9uKCJmb2N1cyIsIHRoaXMuX3Nob3dEYXRlcGlja2VyKSwgKCJidXR0b24iID09PSBzIHx8ICJib3RoIiA9PT0gcykgJiYgKGEgPSB0aGlzLl9nZXQoaSwgImJ1dHRvblRleHQiKSwgbiA9IHRoaXMuX2dldChpLCAiYnV0dG9uSW1hZ2UiKSwgaS50cmlnZ2VyID0gZSh0aGlzLl9nZXQoaSwgImJ1dHRvbkltYWdlT25seSIpID8gZSgiPGltZy8+IikuYWRkQ2xhc3ModGhpcy5fdHJpZ2dlckNsYXNzKS5hdHRyKHsgc3JjOiBuLCBhbHQ6IGEsIHRpdGxlOiBhIH0pIDogZSgiPGJ1dHRvbiB0eXBlPSdidXR0b24nPjwvYnV0dG9uPiIpLmFkZENsYXNzKHRoaXMuX3RyaWdnZXJDbGFzcykuaHRtbChuID8gZSgiPGltZy8+IikuYXR0cih7IHNyYzogbiwgYWx0OiBhLCB0aXRsZTogYSB9KSA6IGEpKSwgdFtvID8gImJlZm9yZSIgOiAiYWZ0ZXIiXShpLnRyaWdnZXIpLCBpLnRyaWdnZXIub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gZS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiBlLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9PT0gdFswXSA/IGUuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKSA6IGUuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgZS5kYXRlcGlja2VyLl9sYXN0SW5wdXQgIT09IHRbMF0gPyAoZS5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpLCBlLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRbMF0pKSA6IGUuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIodFswXSksICExIH0pKSB9LCBfYXV0b1NpemU6IGZ1bmN0aW9uIChlKSB7IGlmICh0aGlzLl9nZXQoZSwgImF1dG9TaXplIikgJiYgIWUuaW5saW5lKSB7IHZhciB0LCBpLCBzLCBhLCBuID0gbmV3IERhdGUoMjAwOSwgMTEsIDIwKSwgciA9IHRoaXMuX2dldChlLCAiZGF0ZUZvcm1hdCIpOyByLm1hdGNoKC9bRE1dLykgJiYgKHQgPSBmdW5jdGlvbiAoZSkgeyBmb3IgKGkgPSAwLCBzID0gMCwgYSA9IDA7IGUubGVuZ3RoID4gYTsgYSsrKWVbYV0ubGVuZ3RoID4gaSAmJiAoaSA9IGVbYV0ubGVuZ3RoLCBzID0gYSk7IHJldHVybiBzIH0sIG4uc2V0TW9udGgodCh0aGlzLl9nZXQoZSwgci5tYXRjaCgvTU0vKSA/ICJtb250aE5hbWVzIiA6ICJtb250aE5hbWVzU2hvcnQiKSkpLCBuLnNldERhdGUodCh0aGlzLl9nZXQoZSwgci5tYXRjaCgvREQvKSA/ICJkYXlOYW1lcyIgOiAiZGF5TmFtZXNTaG9ydCIpKSArIDIwIC0gbi5nZXREYXkoKSkpLCBlLmlucHV0LmF0dHIoInNpemUiLCB0aGlzLl9mb3JtYXREYXRlKGUsIG4pLmxlbmd0aCkgfSB9LCBfaW5saW5lRGF0ZXBpY2tlcjogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSBlKHQpOyBzLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSB8fCAocy5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuYXBwZW5kKGkuZHBEaXYpLCBlLmRhdGEodCwgImRhdGVwaWNrZXIiLCBpKSwgdGhpcy5fc2V0RGF0ZShpLCB0aGlzLl9nZXREZWZhdWx0RGF0ZShpKSwgITApLCB0aGlzLl91cGRhdGVEYXRlcGlja2VyKGkpLCB0aGlzLl91cGRhdGVBbHRlcm5hdGUoaSksIGkuc2V0dGluZ3MuZGlzYWJsZWQgJiYgdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIodCksIGkuZHBEaXYuY3NzKCJkaXNwbGF5IiwgImJsb2NrIikpIH0sIF9kaWFsb2dEYXRlcGlja2VyOiBmdW5jdGlvbiAodCwgaSwgcywgYSwgbikgeyB2YXIgbywgbCwgaCwgdSwgZCwgYyA9IHRoaXMuX2RpYWxvZ0luc3Q7IHJldHVybiBjIHx8ICh0aGlzLnV1aWQgKz0gMSwgbyA9ICJkcCIgKyB0aGlzLnV1aWQsIHRoaXMuX2RpYWxvZ0lucHV0ID0gZSgiPGlucHV0IHR5cGU9J3RleHQnIGlkPSciICsgbyArICInIHN0eWxlPSdwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogLTEwMHB4OyB3aWR0aDogMHB4OycvPiIpLCB0aGlzLl9kaWFsb2dJbnB1dC5vbigia2V5ZG93biIsIHRoaXMuX2RvS2V5RG93biksIGUoImJvZHkiKS5hcHBlbmQodGhpcy5fZGlhbG9nSW5wdXQpLCBjID0gdGhpcy5fZGlhbG9nSW5zdCA9IHRoaXMuX25ld0luc3QodGhpcy5fZGlhbG9nSW5wdXQsICExKSwgYy5zZXR0aW5ncyA9IHt9LCBlLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sICJkYXRlcGlja2VyIiwgYykpLCByKGMuc2V0dGluZ3MsIGEgfHwge30pLCBpID0gaSAmJiBpLmNvbnN0cnVjdG9yID09PSBEYXRlID8gdGhpcy5fZm9ybWF0RGF0ZShjLCBpKSA6IGksIHRoaXMuX2RpYWxvZ0lucHV0LnZhbChpKSwgdGhpcy5fcG9zID0gbiA/IG4ubGVuZ3RoID8gbiA6IFtuLnBhZ2VYLCBuLnBhZ2VZXSA6IG51bGwsIHRoaXMuX3BvcyB8fCAobCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgaCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHUgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQsIGQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wLCB0aGlzLl9wb3MgPSBbbCAvIDIgLSAxMDAgKyB1LCBoIC8gMiAtIDE1MCArIGRdKSwgdGhpcy5fZGlhbG9nSW5wdXQuY3NzKCJsZWZ0IiwgdGhpcy5fcG9zWzBdICsgMjAgKyAicHgiKS5jc3MoInRvcCIsIHRoaXMuX3Bvc1sxXSArICJweCIpLCBjLnNldHRpbmdzLm9uU2VsZWN0ID0gcywgdGhpcy5faW5EaWFsb2cgPSAhMCwgdGhpcy5kcERpdi5hZGRDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcyksIHRoaXMuX3Nob3dEYXRlcGlja2VyKHRoaXMuX2RpYWxvZ0lucHV0WzBdKSwgZS5ibG9ja1VJICYmIGUuYmxvY2tVSSh0aGlzLmRwRGl2KSwgZS5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCAiZGF0ZXBpY2tlciIsIGMpLCB0aGlzIH0sIF9kZXN0cm95RGF0ZXBpY2tlcjogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMgPSBlKHQpLCBhID0gZS5kYXRhKHQsICJkYXRlcGlja2VyIik7IHMuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpICYmIChpID0gdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBlLnJlbW92ZURhdGEodCwgImRhdGVwaWNrZXIiKSwgImlucHV0IiA9PT0gaSA/IChhLmFwcGVuZC5yZW1vdmUoKSwgYS50cmlnZ2VyLnJlbW92ZSgpLCBzLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5vZmYoImZvY3VzIiwgdGhpcy5fc2hvd0RhdGVwaWNrZXIpLm9mZigia2V5ZG93biIsIHRoaXMuX2RvS2V5RG93bikub2ZmKCJrZXlwcmVzcyIsIHRoaXMuX2RvS2V5UHJlc3MpLm9mZigia2V5dXAiLCB0aGlzLl9kb0tleVVwKSkgOiAoImRpdiIgPT09IGkgfHwgInNwYW4iID09PSBpKSAmJiBzLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5lbXB0eSgpLCBwID09PSBhICYmIChwID0gbnVsbCkpIH0sIF9lbmFibGVEYXRlcGlja2VyOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcywgYSA9IGUodCksIG4gPSBlLmRhdGEodCwgImRhdGVwaWNrZXIiKTsgYS5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkgJiYgKGkgPSB0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksICJpbnB1dCIgPT09IGkgPyAodC5kaXNhYmxlZCA9ICExLCBuLnRyaWdnZXIuZmlsdGVyKCJidXR0b24iKS5lYWNoKGZ1bmN0aW9uICgpIHsgdGhpcy5kaXNhYmxlZCA9ICExIH0pLmVuZCgpLmZpbHRlcigiaW1nIikuY3NzKHsgb3BhY2l0eTogIjEuMCIsIGN1cnNvcjogIiIgfSkpIDogKCJkaXYiID09PSBpIHx8ICJzcGFuIiA9PT0gaSkgJiYgKHMgPSBhLmNoaWxkcmVuKCIuIiArIHRoaXMuX2lubGluZUNsYXNzKSwgcy5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpLCBzLmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIikucHJvcCgiZGlzYWJsZWQiLCAhMSkpLCB0aGlzLl9kaXNhYmxlZElucHV0cyA9IGUubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSA9PT0gdCA/IG51bGwgOiBlIH0pKSB9LCBfZGlzYWJsZURhdGVwaWNrZXI6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhID0gZSh0KSwgbiA9IGUuZGF0YSh0LCAiZGF0ZXBpY2tlciIpOyBhLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSAmJiAoaSA9IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwgImlucHV0IiA9PT0gaSA/ICh0LmRpc2FibGVkID0gITAsIG4udHJpZ2dlci5maWx0ZXIoImJ1dHRvbiIpLmVhY2goZnVuY3Rpb24gKCkgeyB0aGlzLmRpc2FibGVkID0gITAgfSkuZW5kKCkuZmlsdGVyKCJpbWciKS5jc3MoeyBvcGFjaXR5OiAiMC41IiwgY3Vyc29yOiAiZGVmYXVsdCIgfSkpIDogKCJkaXYiID09PSBpIHx8ICJzcGFuIiA9PT0gaSkgJiYgKHMgPSBhLmNoaWxkcmVuKCIuIiArIHRoaXMuX2lubGluZUNsYXNzKSwgcy5jaGlsZHJlbigpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpLCBzLmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIikucHJvcCgiZGlzYWJsZWQiLCAhMCkpLCB0aGlzLl9kaXNhYmxlZElucHV0cyA9IGUubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSA9PT0gdCA/IG51bGwgOiBlIH0pLCB0aGlzLl9kaXNhYmxlZElucHV0c1t0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGhdID0gdCkgfSwgX2lzRGlzYWJsZWREYXRlcGlja2VyOiBmdW5jdGlvbiAoZSkgeyBpZiAoIWUpIHJldHVybiAhMTsgZm9yICh2YXIgdCA9IDA7IHRoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aCA+IHQ7IHQrKylpZiAodGhpcy5fZGlzYWJsZWRJbnB1dHNbdF0gPT09IGUpIHJldHVybiAhMDsgcmV0dXJuICExIH0sIF9nZXRJbnN0OiBmdW5jdGlvbiAodCkgeyB0cnkgeyByZXR1cm4gZS5kYXRhKHQsICJkYXRlcGlja2VyIikgfSBjYXRjaCAoaSkgeyB0aHJvdyAiTWlzc2luZyBpbnN0YW5jZSBkYXRhIGZvciB0aGlzIGRhdGVwaWNrZXIiIH0gfSwgX29wdGlvbkRhdGVwaWNrZXI6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhLCBuLCBvLCBsLCBoID0gdGhpcy5fZ2V0SW5zdCh0KTsgcmV0dXJuIDIgPT09IGFyZ3VtZW50cy5sZW5ndGggJiYgInN0cmluZyIgPT0gdHlwZW9mIGkgPyAiZGVmYXVsdHMiID09PSBpID8gZS5leHRlbmQoe30sIGUuZGF0ZXBpY2tlci5fZGVmYXVsdHMpIDogaCA/ICJhbGwiID09PSBpID8gZS5leHRlbmQoe30sIGguc2V0dGluZ3MpIDogdGhpcy5fZ2V0KGgsIGkpIDogbnVsbCA6IChhID0gaSB8fCB7fSwgInN0cmluZyIgPT0gdHlwZW9mIGkgJiYgKGEgPSB7fSwgYVtpXSA9IHMpLCBoICYmICh0aGlzLl9jdXJJbnN0ID09PSBoICYmIHRoaXMuX2hpZGVEYXRlcGlja2VyKCksIG4gPSB0aGlzLl9nZXREYXRlRGF0ZXBpY2tlcih0LCAhMCksIG8gPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGgsICJtaW4iKSwgbCA9IHRoaXMuX2dldE1pbk1heERhdGUoaCwgIm1heCIpLCByKGguc2V0dGluZ3MsIGEpLCBudWxsICE9PSBvICYmIHZvaWQgMCAhPT0gYS5kYXRlRm9ybWF0ICYmIHZvaWQgMCA9PT0gYS5taW5EYXRlICYmIChoLnNldHRpbmdzLm1pbkRhdGUgPSB0aGlzLl9mb3JtYXREYXRlKGgsIG8pKSwgbnVsbCAhPT0gbCAmJiB2b2lkIDAgIT09IGEuZGF0ZUZvcm1hdCAmJiB2b2lkIDAgPT09IGEubWF4RGF0ZSAmJiAoaC5zZXR0aW5ncy5tYXhEYXRlID0gdGhpcy5fZm9ybWF0RGF0ZShoLCBsKSksICJkaXNhYmxlZCIgaW4gYSAmJiAoYS5kaXNhYmxlZCA/IHRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKHQpIDogdGhpcy5fZW5hYmxlRGF0ZXBpY2tlcih0KSksIHRoaXMuX2F0dGFjaG1lbnRzKGUodCksIGgpLCB0aGlzLl9hdXRvU2l6ZShoKSwgdGhpcy5fc2V0RGF0ZShoLCBuKSwgdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGgpLCB0aGlzLl91cGRhdGVEYXRlcGlja2VyKGgpKSwgdm9pZCAwKSB9LCBfY2hhbmdlRGF0ZXBpY2tlcjogZnVuY3Rpb24gKGUsIHQsIGkpIHsgdGhpcy5fb3B0aW9uRGF0ZXBpY2tlcihlLCB0LCBpKSB9LCBfcmVmcmVzaERhdGVwaWNrZXI6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpcy5fZ2V0SW5zdChlKTsgdCAmJiB0aGlzLl91cGRhdGVEYXRlcGlja2VyKHQpIH0sIF9zZXREYXRlRGF0ZXBpY2tlcjogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGkgPSB0aGlzLl9nZXRJbnN0KGUpOyBpICYmICh0aGlzLl9zZXREYXRlKGksIHQpLCB0aGlzLl91cGRhdGVEYXRlcGlja2VyKGkpLCB0aGlzLl91cGRhdGVBbHRlcm5hdGUoaSkpIH0sIF9nZXREYXRlRGF0ZXBpY2tlcjogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGkgPSB0aGlzLl9nZXRJbnN0KGUpOyByZXR1cm4gaSAmJiAhaS5pbmxpbmUgJiYgdGhpcy5fc2V0RGF0ZUZyb21GaWVsZChpLCB0KSwgaSA/IHRoaXMuX2dldERhdGUoaSkgOiBudWxsIH0sIF9kb0tleURvd246IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzLCBhLCBuID0gZS5kYXRlcGlja2VyLl9nZXRJbnN0KHQudGFyZ2V0KSwgciA9ICEwLCBvID0gbi5kcERpdi5pcygiLnVpLWRhdGVwaWNrZXItcnRsIik7IGlmIChuLl9rZXlFdmVudCA9ICEwLCBlLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nKSBzd2l0Y2ggKHQua2V5Q29kZSkgeyBjYXNlIDk6IGUuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKSwgciA9ICExOyBicmVhazsgY2FzZSAxMzogcmV0dXJuIGEgPSBlKCJ0ZC4iICsgZS5kYXRlcGlja2VyLl9kYXlPdmVyQ2xhc3MgKyAiOm5vdCguIiArIGUuZGF0ZXBpY2tlci5fY3VycmVudENsYXNzICsgIikiLCBuLmRwRGl2KSwgYVswXSAmJiBlLmRhdGVwaWNrZXIuX3NlbGVjdERheSh0LnRhcmdldCwgbi5zZWxlY3RlZE1vbnRoLCBuLnNlbGVjdGVkWWVhciwgYVswXSksIGkgPSBlLmRhdGVwaWNrZXIuX2dldChuLCAib25TZWxlY3QiKSwgaSA/IChzID0gZS5kYXRlcGlja2VyLl9mb3JtYXREYXRlKG4pLCBpLmFwcGx5KG4uaW5wdXQgPyBuLmlucHV0WzBdIDogbnVsbCwgW3MsIG5dKSkgOiBlLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCksICExOyBjYXNlIDI3OiBlLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7IGJyZWFrOyBjYXNlIDMzOiBlLmRhdGVwaWNrZXIuX2FkanVzdERhdGUodC50YXJnZXQsIHQuY3RybEtleSA/IC1lLmRhdGVwaWNrZXIuX2dldChuLCAic3RlcEJpZ01vbnRocyIpIDogLWUuZGF0ZXBpY2tlci5fZ2V0KG4sICJzdGVwTW9udGhzIiksICJNIik7IGJyZWFrOyBjYXNlIDM0OiBlLmRhdGVwaWNrZXIuX2FkanVzdERhdGUodC50YXJnZXQsIHQuY3RybEtleSA/ICtlLmRhdGVwaWNrZXIuX2dldChuLCAic3RlcEJpZ01vbnRocyIpIDogK2UuZGF0ZXBpY2tlci5fZ2V0KG4sICJzdGVwTW9udGhzIiksICJNIik7IGJyZWFrOyBjYXNlIDM1OiAodC5jdHJsS2V5IHx8IHQubWV0YUtleSkgJiYgZS5kYXRlcGlja2VyLl9jbGVhckRhdGUodC50YXJnZXQpLCByID0gdC5jdHJsS2V5IHx8IHQubWV0YUtleTsgYnJlYWs7IGNhc2UgMzY6ICh0LmN0cmxLZXkgfHwgdC5tZXRhS2V5KSAmJiBlLmRhdGVwaWNrZXIuX2dvdG9Ub2RheSh0LnRhcmdldCksIHIgPSB0LmN0cmxLZXkgfHwgdC5tZXRhS2V5OyBicmVhazsgY2FzZSAzNzogKHQuY3RybEtleSB8fCB0Lm1ldGFLZXkpICYmIGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSh0LnRhcmdldCwgbyA/IDEgOiAtMSwgIkQiKSwgciA9IHQuY3RybEtleSB8fCB0Lm1ldGFLZXksIHQub3JpZ2luYWxFdmVudC5hbHRLZXkgJiYgZS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKHQudGFyZ2V0LCB0LmN0cmxLZXkgPyAtZS5kYXRlcGlja2VyLl9nZXQobiwgInN0ZXBCaWdNb250aHMiKSA6IC1lLmRhdGVwaWNrZXIuX2dldChuLCAic3RlcE1vbnRocyIpLCAiTSIpOyBicmVhazsgY2FzZSAzODogKHQuY3RybEtleSB8fCB0Lm1ldGFLZXkpICYmIGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSh0LnRhcmdldCwgLTcsICJEIiksIHIgPSB0LmN0cmxLZXkgfHwgdC5tZXRhS2V5OyBicmVhazsgY2FzZSAzOTogKHQuY3RybEtleSB8fCB0Lm1ldGFLZXkpICYmIGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSh0LnRhcmdldCwgbyA/IC0xIDogMSwgIkQiKSwgciA9IHQuY3RybEtleSB8fCB0Lm1ldGFLZXksIHQub3JpZ2luYWxFdmVudC5hbHRLZXkgJiYgZS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKHQudGFyZ2V0LCB0LmN0cmxLZXkgPyArZS5kYXRlcGlja2VyLl9nZXQobiwgInN0ZXBCaWdNb250aHMiKSA6ICtlLmRhdGVwaWNrZXIuX2dldChuLCAic3RlcE1vbnRocyIpLCAiTSIpOyBicmVhazsgY2FzZSA0MDogKHQuY3RybEtleSB8fCB0Lm1ldGFLZXkpICYmIGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSh0LnRhcmdldCwgNywgIkQiKSwgciA9IHQuY3RybEtleSB8fCB0Lm1ldGFLZXk7IGJyZWFrOyBkZWZhdWx0OiByID0gITEgfSBlbHNlIDM2ID09PSB0LmtleUNvZGUgJiYgdC5jdHJsS2V5ID8gZS5kYXRlcGlja2VyLl9zaG93RGF0ZXBpY2tlcih0aGlzKSA6IHIgPSAhMTsgciAmJiAodC5wcmV2ZW50RGVmYXVsdCgpLCB0LnN0b3BQcm9wYWdhdGlvbigpKSB9LCBfZG9LZXlQcmVzczogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEgPSBlLmRhdGVwaWNrZXIuX2dldEluc3QodC50YXJnZXQpOyByZXR1cm4gZS5kYXRlcGlja2VyLl9nZXQoYSwgImNvbnN0cmFpbklucHV0IikgPyAoaSA9IGUuZGF0ZXBpY2tlci5fcG9zc2libGVDaGFycyhlLmRhdGVwaWNrZXIuX2dldChhLCAiZGF0ZUZvcm1hdCIpKSwgcyA9IFN0cmluZy5mcm9tQ2hhckNvZGUobnVsbCA9PSB0LmNoYXJDb2RlID8gdC5rZXlDb2RlIDogdC5jaGFyQ29kZSksIHQuY3RybEtleSB8fCB0Lm1ldGFLZXkgfHwgIiAiID4gcyB8fCAhaSB8fCBpLmluZGV4T2YocykgPiAtMSkgOiB2b2lkIDAgfSwgX2RvS2V5VXA6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzID0gZS5kYXRlcGlja2VyLl9nZXRJbnN0KHQudGFyZ2V0KTsgaWYgKHMuaW5wdXQudmFsKCkgIT09IHMubGFzdFZhbCkgdHJ5IHsgaSA9IGUuZGF0ZXBpY2tlci5wYXJzZURhdGUoZS5kYXRlcGlja2VyLl9nZXQocywgImRhdGVGb3JtYXQiKSwgcy5pbnB1dCA/IHMuaW5wdXQudmFsKCkgOiBudWxsLCBlLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhzKSksIGkgJiYgKGUuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChzKSwgZS5kYXRlcGlja2VyLl91cGRhdGVBbHRlcm5hdGUocyksIGUuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihzKSkgfSBjYXRjaCAoYSkgeyB9IHJldHVybiAhMCB9LCBfc2hvd0RhdGVwaWNrZXI6IGZ1bmN0aW9uICh0KSB7IGlmICh0ID0gdC50YXJnZXQgfHwgdCwgImlucHV0IiAhPT0gdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmICh0ID0gZSgiaW5wdXQiLCB0LnBhcmVudE5vZGUpWzBdKSwgIWUuZGF0ZXBpY2tlci5faXNEaXNhYmxlZERhdGVwaWNrZXIodCkgJiYgZS5kYXRlcGlja2VyLl9sYXN0SW5wdXQgIT09IHQpIHsgdmFyIHMsIGEsIG4sIG8sIGwsIGgsIHU7IHMgPSBlLmRhdGVwaWNrZXIuX2dldEluc3QodCksIGUuZGF0ZXBpY2tlci5fY3VySW5zdCAmJiBlLmRhdGVwaWNrZXIuX2N1ckluc3QgIT09IHMgJiYgKGUuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKCEwLCAhMCksIHMgJiYgZS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiBlLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKGUuZGF0ZXBpY2tlci5fY3VySW5zdC5pbnB1dFswXSkpLCBhID0gZS5kYXRlcGlja2VyLl9nZXQocywgImJlZm9yZVNob3ciKSwgbiA9IGEgPyBhLmFwcGx5KHQsIFt0LCBzXSkgOiB7fSwgbiAhPT0gITEgJiYgKHIocy5zZXR0aW5ncywgbiksIHMubGFzdFZhbCA9IG51bGwsIGUuZGF0ZXBpY2tlci5fbGFzdElucHV0ID0gdCwgZS5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKHMpLCBlLmRhdGVwaWNrZXIuX2luRGlhbG9nICYmICh0LnZhbHVlID0gIiIpLCBlLmRhdGVwaWNrZXIuX3BvcyB8fCAoZS5kYXRlcGlja2VyLl9wb3MgPSBlLmRhdGVwaWNrZXIuX2ZpbmRQb3ModCksIGUuZGF0ZXBpY2tlci5fcG9zWzFdICs9IHQub2Zmc2V0SGVpZ2h0KSwgbyA9ICExLCBlKHQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG8gfD0gImZpeGVkIiA9PT0gZSh0aGlzKS5jc3MoInBvc2l0aW9uIiksICFvIH0pLCBsID0geyBsZWZ0OiBlLmRhdGVwaWNrZXIuX3Bvc1swXSwgdG9wOiBlLmRhdGVwaWNrZXIuX3Bvc1sxXSB9LCBlLmRhdGVwaWNrZXIuX3BvcyA9IG51bGwsIHMuZHBEaXYuZW1wdHkoKSwgcy5kcERpdi5jc3MoeyBwb3NpdGlvbjogImFic29sdXRlIiwgZGlzcGxheTogImJsb2NrIiwgdG9wOiAiLTEwMDBweCIgfSksIGUuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihzKSwgbCA9IGUuZGF0ZXBpY2tlci5fY2hlY2tPZmZzZXQocywgbCwgbyksIHMuZHBEaXYuY3NzKHsgcG9zaXRpb246IGUuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgZS5ibG9ja1VJID8gInN0YXRpYyIgOiBvID8gImZpeGVkIiA6ICJhYnNvbHV0ZSIsIGRpc3BsYXk6ICJub25lIiwgbGVmdDogbC5sZWZ0ICsgInB4IiwgdG9wOiBsLnRvcCArICJweCIgfSksIHMuaW5saW5lIHx8IChoID0gZS5kYXRlcGlja2VyLl9nZXQocywgInNob3dBbmltIiksIHUgPSBlLmRhdGVwaWNrZXIuX2dldChzLCAiZHVyYXRpb24iKSwgcy5kcERpdi5jc3MoInotaW5kZXgiLCBpKGUodCkpICsgMSksIGUuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgPSAhMCwgZS5lZmZlY3RzICYmIGUuZWZmZWN0cy5lZmZlY3RbaF0gPyBzLmRwRGl2LnNob3coaCwgZS5kYXRlcGlja2VyLl9nZXQocywgInNob3dPcHRpb25zIiksIHUpIDogcy5kcERpdltoIHx8ICJzaG93Il0oaCA/IHUgOiBudWxsKSwgZS5kYXRlcGlja2VyLl9zaG91bGRGb2N1c0lucHV0KHMpICYmIHMuaW5wdXQudHJpZ2dlcigiZm9jdXMiKSwgZS5kYXRlcGlja2VyLl9jdXJJbnN0ID0gcykpIH0gfSwgX3VwZGF0ZURhdGVwaWNrZXI6IGZ1bmN0aW9uICh0KSB7IHRoaXMubWF4Um93cyA9IDQsIHAgPSB0LCB0LmRwRGl2LmVtcHR5KCkuYXBwZW5kKHRoaXMuX2dlbmVyYXRlSFRNTCh0KSksIHRoaXMuX2F0dGFjaEhhbmRsZXJzKHQpOyB2YXIgaSwgcyA9IHRoaXMuX2dldE51bWJlck9mTW9udGhzKHQpLCBhID0gc1sxXSwgciA9IDE3LCBvID0gdC5kcERpdi5maW5kKCIuIiArIHRoaXMuX2RheU92ZXJDbGFzcyArICIgYSIpOyBvLmxlbmd0aCA+IDAgJiYgbi5hcHBseShvLmdldCgwKSksIHQuZHBEaXYucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItbXVsdGktMiB1aS1kYXRlcGlja2VyLW11bHRpLTMgdWktZGF0ZXBpY2tlci1tdWx0aS00Iikud2lkdGgoIiIpLCBhID4gMSAmJiB0LmRwRGl2LmFkZENsYXNzKCJ1aS1kYXRlcGlja2VyLW11bHRpLSIgKyBhKS5jc3MoIndpZHRoIiwgciAqIGEgKyAiZW0iKSwgdC5kcERpdlsoMSAhPT0gc1swXSB8fCAxICE9PSBzWzFdID8gImFkZCIgOiAicmVtb3ZlIikgKyAiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1tdWx0aSIpLCB0LmRwRGl2Wyh0aGlzLl9nZXQodCwgImlzUlRMIikgPyAiYWRkIiA6ICJyZW1vdmUiKSArICJDbGFzcyJdKCJ1aS1kYXRlcGlja2VyLXJ0bCIpLCB0ID09PSBlLmRhdGVwaWNrZXIuX2N1ckluc3QgJiYgZS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiBlLmRhdGVwaWNrZXIuX3Nob3VsZEZvY3VzSW5wdXQodCkgJiYgdC5pbnB1dC50cmlnZ2VyKCJmb2N1cyIpLCB0LnllYXJzaHRtbCAmJiAoaSA9IHQueWVhcnNodG1sLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgaSA9PT0gdC55ZWFyc2h0bWwgJiYgdC55ZWFyc2h0bWwgJiYgdC5kcERpdi5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyOmZpcnN0IikucmVwbGFjZVdpdGgodC55ZWFyc2h0bWwpLCBpID0gdC55ZWFyc2h0bWwgPSBudWxsIH0sIDApKSB9LCBfc2hvdWxkRm9jdXNJbnB1dDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuaW5wdXQgJiYgZS5pbnB1dC5pcygiOnZpc2libGUiKSAmJiAhZS5pbnB1dC5pcygiOmRpc2FibGVkIikgJiYgIWUuaW5wdXQuaXMoIjpmb2N1cyIpIH0sIF9jaGVja09mZnNldDogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEgPSB0LmRwRGl2Lm91dGVyV2lkdGgoKSwgbiA9IHQuZHBEaXYub3V0ZXJIZWlnaHQoKSwgciA9IHQuaW5wdXQgPyB0LmlucHV0Lm91dGVyV2lkdGgoKSA6IDAsIG8gPSB0LmlucHV0ID8gdC5pbnB1dC5vdXRlckhlaWdodCgpIDogMCwgbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCArIChzID8gMCA6IGUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSksIGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ICsgKHMgPyAwIDogZShkb2N1bWVudCkuc2Nyb2xsVG9wKCkpOyByZXR1cm4gaS5sZWZ0IC09IHRoaXMuX2dldCh0LCAiaXNSVEwiKSA/IGEgLSByIDogMCwgaS5sZWZ0IC09IHMgJiYgaS5sZWZ0ID09PSB0LmlucHV0Lm9mZnNldCgpLmxlZnQgPyBlKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgOiAwLCBpLnRvcCAtPSBzICYmIGkudG9wID09PSB0LmlucHV0Lm9mZnNldCgpLnRvcCArIG8gPyBlKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA6IDAsIGkubGVmdCAtPSBNYXRoLm1pbihpLmxlZnQsIGkubGVmdCArIGEgPiBsICYmIGwgPiBhID8gTWF0aC5hYnMoaS5sZWZ0ICsgYSAtIGwpIDogMCksIGkudG9wIC09IE1hdGgubWluKGkudG9wLCBpLnRvcCArIG4gPiBoICYmIGggPiBuID8gTWF0aC5hYnMobiArIG8pIDogMCksIGkgfSwgX2ZpbmRQb3M6IGZ1bmN0aW9uICh0KSB7IGZvciAodmFyIGksIHMgPSB0aGlzLl9nZXRJbnN0KHQpLCBhID0gdGhpcy5fZ2V0KHMsICJpc1JUTCIpOyB0ICYmICgiaGlkZGVuIiA9PT0gdC50eXBlIHx8IDEgIT09IHQubm9kZVR5cGUgfHwgZS5leHByLmZpbHRlcnMuaGlkZGVuKHQpKTspdCA9IHRbYSA/ICJwcmV2aW91c1NpYmxpbmciIDogIm5leHRTaWJsaW5nIl07IHJldHVybiBpID0gZSh0KS5vZmZzZXQoKSwgW2kubGVmdCwgaS50b3BdIH0sIF9oaWRlRGF0ZXBpY2tlcjogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG4sIHIgPSB0aGlzLl9jdXJJbnN0OyAhciB8fCB0ICYmIHIgIT09IGUuZGF0YSh0LCAiZGF0ZXBpY2tlciIpIHx8IHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nICYmIChpID0gdGhpcy5fZ2V0KHIsICJzaG93QW5pbSIpLCBzID0gdGhpcy5fZ2V0KHIsICJkdXJhdGlvbiIpLCBhID0gZnVuY3Rpb24gKCkgeyBlLmRhdGVwaWNrZXIuX3RpZHlEaWFsb2cocikgfSwgZS5lZmZlY3RzICYmIChlLmVmZmVjdHMuZWZmZWN0W2ldIHx8IGUuZWZmZWN0c1tpXSkgPyByLmRwRGl2LmhpZGUoaSwgZS5kYXRlcGlja2VyLl9nZXQociwgInNob3dPcHRpb25zIiksIHMsIGEpIDogci5kcERpdlsic2xpZGVEb3duIiA9PT0gaSA/ICJzbGlkZVVwIiA6ICJmYWRlSW4iID09PSBpID8gImZhZGVPdXQiIDogImhpZGUiXShpID8gcyA6IG51bGwsIGEpLCBpIHx8IGEoKSwgdGhpcy5fZGF0ZXBpY2tlclNob3dpbmcgPSAhMSwgbiA9IHRoaXMuX2dldChyLCAib25DbG9zZSIpLCBuICYmIG4uYXBwbHkoci5pbnB1dCA/IHIuaW5wdXRbMF0gOiBudWxsLCBbci5pbnB1dCA/IHIuaW5wdXQudmFsKCkgOiAiIiwgcl0pLCB0aGlzLl9sYXN0SW5wdXQgPSBudWxsLCB0aGlzLl9pbkRpYWxvZyAmJiAodGhpcy5fZGlhbG9nSW5wdXQuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIGxlZnQ6ICIwIiwgdG9wOiAiLTEwMHB4IiB9KSwgZS5ibG9ja1VJICYmIChlLnVuYmxvY2tVSSgpLCBlKCJib2R5IikuYXBwZW5kKHRoaXMuZHBEaXYpKSksIHRoaXMuX2luRGlhbG9nID0gITEpIH0sIF90aWR5RGlhbG9nOiBmdW5jdGlvbiAoZSkgeyBlLmRwRGl2LnJlbW92ZUNsYXNzKHRoaXMuX2RpYWxvZ0NsYXNzKS5vZmYoIi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIikgfSwgX2NoZWNrRXh0ZXJuYWxDbGljazogZnVuY3Rpb24gKHQpIHsgaWYgKGUuZGF0ZXBpY2tlci5fY3VySW5zdCkgeyB2YXIgaSA9IGUodC50YXJnZXQpLCBzID0gZS5kYXRlcGlja2VyLl9nZXRJbnN0KGlbMF0pOyAoaVswXS5pZCAhPT0gZS5kYXRlcGlja2VyLl9tYWluRGl2SWQgJiYgMCA9PT0gaS5wYXJlbnRzKCIjIiArIGUuZGF0ZXBpY2tlci5fbWFpbkRpdklkKS5sZW5ndGggJiYgIWkuaGFzQ2xhc3MoZS5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkgJiYgIWkuY2xvc2VzdCgiLiIgKyBlLmRhdGVwaWNrZXIuX3RyaWdnZXJDbGFzcykubGVuZ3RoICYmIGUuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgKCFlLmRhdGVwaWNrZXIuX2luRGlhbG9nIHx8ICFlLmJsb2NrVUkpIHx8IGkuaGFzQ2xhc3MoZS5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkgJiYgZS5kYXRlcGlja2VyLl9jdXJJbnN0ICE9PSBzKSAmJiBlLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCkgfSB9LCBfYWRqdXN0RGF0ZTogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEgPSBlKHQpLCBuID0gdGhpcy5fZ2V0SW5zdChhWzBdKTsgdGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIoYVswXSkgfHwgKHRoaXMuX2FkanVzdEluc3REYXRlKG4sIGkgKyAoIk0iID09PSBzID8gdGhpcy5fZ2V0KG4sICJzaG93Q3VycmVudEF0UG9zIikgOiAwKSwgcyksIHRoaXMuX3VwZGF0ZURhdGVwaWNrZXIobikpIH0sIF9nb3RvVG9kYXk6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzID0gZSh0KSwgYSA9IHRoaXMuX2dldEluc3Qoc1swXSk7IHRoaXMuX2dldChhLCAiZ290b0N1cnJlbnQiKSAmJiBhLmN1cnJlbnREYXkgPyAoYS5zZWxlY3RlZERheSA9IGEuY3VycmVudERheSwgYS5kcmF3TW9udGggPSBhLnNlbGVjdGVkTW9udGggPSBhLmN1cnJlbnRNb250aCwgYS5kcmF3WWVhciA9IGEuc2VsZWN0ZWRZZWFyID0gYS5jdXJyZW50WWVhcikgOiAoaSA9IG5ldyBEYXRlLCBhLnNlbGVjdGVkRGF5ID0gaS5nZXREYXRlKCksIGEuZHJhd01vbnRoID0gYS5zZWxlY3RlZE1vbnRoID0gaS5nZXRNb250aCgpLCBhLmRyYXdZZWFyID0gYS5zZWxlY3RlZFllYXIgPSBpLmdldEZ1bGxZZWFyKCkpLCB0aGlzLl9ub3RpZnlDaGFuZ2UoYSksIHRoaXMuX2FkanVzdERhdGUocykgfSwgX3NlbGVjdE1vbnRoWWVhcjogZnVuY3Rpb24gKHQsIGksIHMpIHsgdmFyIGEgPSBlKHQpLCBuID0gdGhpcy5fZ2V0SW5zdChhWzBdKTsgblsic2VsZWN0ZWQiICsgKCJNIiA9PT0gcyA/ICJNb250aCIgOiAiWWVhciIpXSA9IG5bImRyYXciICsgKCJNIiA9PT0gcyA/ICJNb250aCIgOiAiWWVhciIpXSA9IHBhcnNlSW50KGkub3B0aW9uc1tpLnNlbGVjdGVkSW5kZXhdLnZhbHVlLCAxMCksIHRoaXMuX25vdGlmeUNoYW5nZShuKSwgdGhpcy5fYWRqdXN0RGF0ZShhKSB9LCBfc2VsZWN0RGF5OiBmdW5jdGlvbiAodCwgaSwgcywgYSkgeyB2YXIgbiwgciA9IGUodCk7IGUoYSkuaGFzQ2xhc3ModGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MpIHx8IHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKHJbMF0pIHx8IChuID0gdGhpcy5fZ2V0SW5zdChyWzBdKSwgbi5zZWxlY3RlZERheSA9IG4uY3VycmVudERheSA9IGUoImEiLCBhKS5odG1sKCksIG4uc2VsZWN0ZWRNb250aCA9IG4uY3VycmVudE1vbnRoID0gaSwgbi5zZWxlY3RlZFllYXIgPSBuLmN1cnJlbnRZZWFyID0gcywgdGhpcy5fc2VsZWN0RGF0ZSh0LCB0aGlzLl9mb3JtYXREYXRlKG4sIG4uY3VycmVudERheSwgbi5jdXJyZW50TW9udGgsIG4uY3VycmVudFllYXIpKSkgfSwgX2NsZWFyRGF0ZTogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKHQpOyB0aGlzLl9zZWxlY3REYXRlKGksICIiKSB9LCBfc2VsZWN0RGF0ZTogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMsIGEgPSBlKHQpLCBuID0gdGhpcy5fZ2V0SW5zdChhWzBdKTsgaSA9IG51bGwgIT0gaSA/IGkgOiB0aGlzLl9mb3JtYXREYXRlKG4pLCBuLmlucHV0ICYmIG4uaW5wdXQudmFsKGkpLCB0aGlzLl91cGRhdGVBbHRlcm5hdGUobiksIHMgPSB0aGlzLl9nZXQobiwgIm9uU2VsZWN0IiksIHMgPyBzLmFwcGx5KG4uaW5wdXQgPyBuLmlucHV0WzBdIDogbnVsbCwgW2ksIG5dKSA6IG4uaW5wdXQgJiYgbi5pbnB1dC50cmlnZ2VyKCJjaGFuZ2UiKSwgbi5pbmxpbmUgPyB0aGlzLl91cGRhdGVEYXRlcGlja2VyKG4pIDogKHRoaXMuX2hpZGVEYXRlcGlja2VyKCksIHRoaXMuX2xhc3RJbnB1dCA9IG4uaW5wdXRbMF0sICJvYmplY3QiICE9IHR5cGVvZiBuLmlucHV0WzBdICYmIG4uaW5wdXQudHJpZ2dlcigiZm9jdXMiKSwgdGhpcy5fbGFzdElucHV0ID0gbnVsbCkgfSwgX3VwZGF0ZUFsdGVybmF0ZTogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG4gPSB0aGlzLl9nZXQodCwgImFsdEZpZWxkIik7IG4gJiYgKGkgPSB0aGlzLl9nZXQodCwgImFsdEZvcm1hdCIpIHx8IHRoaXMuX2dldCh0LCAiZGF0ZUZvcm1hdCIpLCBzID0gdGhpcy5fZ2V0RGF0ZSh0KSwgYSA9IHRoaXMuZm9ybWF0RGF0ZShpLCBzLCB0aGlzLl9nZXRGb3JtYXRDb25maWcodCkpLCBlKG4pLnZhbChhKSkgfSwgbm9XZWVrZW5kczogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLmdldERheSgpOyByZXR1cm4gW3QgPiAwICYmIDYgPiB0LCAiIl0gfSwgaXNvODYwMVdlZWs6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBpID0gbmV3IERhdGUoZS5nZXRUaW1lKCkpOyByZXR1cm4gaS5zZXREYXRlKGkuZ2V0RGF0ZSgpICsgNCAtIChpLmdldERheSgpIHx8IDcpKSwgdCA9IGkuZ2V0VGltZSgpLCBpLnNldE1vbnRoKDApLCBpLnNldERhdGUoMSksIE1hdGguZmxvb3IoTWF0aC5yb3VuZCgodCAtIGkpIC8gODY0ZTUpIC8gNykgKyAxIH0sIHBhcnNlRGF0ZTogZnVuY3Rpb24gKHQsIGksIHMpIHsgaWYgKG51bGwgPT0gdCB8fCBudWxsID09IGkpIHRocm93ICJJbnZhbGlkIGFyZ3VtZW50cyI7IGlmIChpID0gIm9iamVjdCIgPT0gdHlwZW9mIGkgPyAiIiArIGkgOiBpICsgIiIsICIiID09PSBpKSByZXR1cm4gbnVsbDsgdmFyIGEsIG4sIHIsIG8sIGwgPSAwLCBoID0gKHMgPyBzLnNob3J0WWVhckN1dG9mZiA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZiwgdSA9ICJzdHJpbmciICE9IHR5cGVvZiBoID8gaCA6IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAlIDEwMCArIHBhcnNlSW50KGgsIDEwKSwgZCA9IChzID8gcy5kYXlOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCwgYyA9IChzID8gcy5kYXlOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLCBwID0gKHMgPyBzLm1vbnRoTmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCwgbSA9IChzID8gcy5tb250aE5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcywgZiA9IC0xLCBnID0gLTEsIHYgPSAtMSwgeSA9IC0xLCBfID0gITEsIGIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgaSA9IHQubGVuZ3RoID4gYSArIDEgJiYgdC5jaGFyQXQoYSArIDEpID09PSBlOyByZXR1cm4gaSAmJiBhKysgLCBpIH0sIGsgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGIoZSksIHMgPSAiQCIgPT09IGUgPyAxNCA6ICIhIiA9PT0gZSA/IDIwIDogInkiID09PSBlICYmIHQgPyA0IDogIm8iID09PSBlID8gMyA6IDIsIGEgPSAieSIgPT09IGUgPyBzIDogMSwgbiA9IFJlZ0V4cCgiXlxcZHsiICsgYSArICIsIiArIHMgKyAifSIpLCByID0gaS5zdWJzdHJpbmcobCkubWF0Y2gobik7IGlmICghcikgdGhyb3cgIk1pc3NpbmcgbnVtYmVyIGF0IHBvc2l0aW9uICIgKyBsOyByZXR1cm4gbCArPSByWzBdLmxlbmd0aCwgcGFyc2VJbnQoclswXSwgMTApIH0sIHggPSBmdW5jdGlvbiAodCwgcywgYSkgeyB2YXIgbiA9IC0xLCByID0gZS5tYXAoYih0KSA/IGEgOiBzLCBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gW1t0LCBlXV0gfSkuc29ydChmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gLShlWzFdLmxlbmd0aCAtIHRbMV0ubGVuZ3RoKSB9KTsgaWYgKGUuZWFjaChyLCBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgcyA9IHRbMV07IHJldHVybiBpLnN1YnN0cihsLCBzLmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PT0gcy50b0xvd2VyQ2FzZSgpID8gKG4gPSB0WzBdLCBsICs9IHMubGVuZ3RoLCAhMSkgOiB2b2lkIDAgfSksIC0xICE9PSBuKSByZXR1cm4gbiArIDE7IHRocm93ICJVbmtub3duIG5hbWUgYXQgcG9zaXRpb24gIiArIGwgfSwgRCA9IGZ1bmN0aW9uICgpIHsgaWYgKGkuY2hhckF0KGwpICE9PSB0LmNoYXJBdChhKSkgdGhyb3cgIlVuZXhwZWN0ZWQgbGl0ZXJhbCBhdCBwb3NpdGlvbiAiICsgbDsgbCsrIH07IGZvciAoYSA9IDA7IHQubGVuZ3RoID4gYTsgYSsrKWlmIChfKSAiJyIgIT09IHQuY2hhckF0KGEpIHx8IGIoIiciKSA/IEQoKSA6IF8gPSAhMTsgZWxzZSBzd2l0Y2ggKHQuY2hhckF0KGEpKSB7IGNhc2UgImQiOiB2ID0gaygiZCIpOyBicmVhazsgY2FzZSAiRCI6IHgoIkQiLCBkLCBjKTsgYnJlYWs7IGNhc2UgIm8iOiB5ID0gaygibyIpOyBicmVhazsgY2FzZSAibSI6IGcgPSBrKCJtIik7IGJyZWFrOyBjYXNlICJNIjogZyA9IHgoIk0iLCBwLCBtKTsgYnJlYWs7IGNhc2UgInkiOiBmID0gaygieSIpOyBicmVhazsgY2FzZSAiQCI6IG8gPSBuZXcgRGF0ZShrKCJAIikpLCBmID0gby5nZXRGdWxsWWVhcigpLCBnID0gby5nZXRNb250aCgpICsgMSwgdiA9IG8uZ2V0RGF0ZSgpOyBicmVhazsgY2FzZSAiISI6IG8gPSBuZXcgRGF0ZSgoaygiISIpIC0gdGhpcy5fdGlja3NUbzE5NzApIC8gMWU0KSwgZiA9IG8uZ2V0RnVsbFllYXIoKSwgZyA9IG8uZ2V0TW9udGgoKSArIDEsIHYgPSBvLmdldERhdGUoKTsgYnJlYWs7IGNhc2UgIiciOiBiKCInIikgPyBEKCkgOiBfID0gITA7IGJyZWFrOyBkZWZhdWx0OiBEKCkgfWlmIChpLmxlbmd0aCA+IGwgJiYgKHIgPSBpLnN1YnN0cihsKSwgIS9eXHMrLy50ZXN0KHIpKSkgdGhyb3cgIkV4dHJhL3VucGFyc2VkIGNoYXJhY3RlcnMgZm91bmQgaW4gZGF0ZTogIiArIHI7IGlmICgtMSA9PT0gZiA/IGYgPSAobmV3IERhdGUpLmdldEZ1bGxZZWFyKCkgOiAxMDAgPiBmICYmIChmICs9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAtIChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAlIDEwMCArICh1ID49IGYgPyAwIDogLTEwMCkpLCB5ID4gLTEpIGZvciAoZyA9IDEsIHYgPSB5OyA7KSB7IGlmIChuID0gdGhpcy5fZ2V0RGF5c0luTW9udGgoZiwgZyAtIDEpLCBuID49IHYpIGJyZWFrOyBnKysgLCB2IC09IG4gfSBpZiAobyA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGYsIGcgLSAxLCB2KSksIG8uZ2V0RnVsbFllYXIoKSAhPT0gZiB8fCBvLmdldE1vbnRoKCkgKyAxICE9PSBnIHx8IG8uZ2V0RGF0ZSgpICE9PSB2KSB0aHJvdyAiSW52YWxpZCBkYXRlIjsgcmV0dXJuIG8gfSwgQVRPTTogInl5LW1tLWRkIiwgQ09PS0lFOiAiRCwgZGQgTSB5eSIsIElTT184NjAxOiAieXktbW0tZGQiLCBSRkNfODIyOiAiRCwgZCBNIHkiLCBSRkNfODUwOiAiREQsIGRkLU0teSIsIFJGQ18xMDM2OiAiRCwgZCBNIHkiLCBSRkNfMTEyMzogIkQsIGQgTSB5eSIsIFJGQ18yODIyOiAiRCwgZCBNIHl5IiwgUlNTOiAiRCwgZCBNIHkiLCBUSUNLUzogIiEiLCBUSU1FU1RBTVA6ICJAIiwgVzNDOiAieXktbW0tZGQiLCBfdGlja3NUbzE5NzA6IDFlNyAqIDYwICogNjAgKiAyNCAqICg3MTg2ODUgKyBNYXRoLmZsb29yKDQ5Mi41KSAtIE1hdGguZmxvb3IoMTkuNykgKyBNYXRoLmZsb29yKDQuOTI1KSksIGZvcm1hdERhdGU6IGZ1bmN0aW9uIChlLCB0LCBpKSB7IGlmICghdCkgcmV0dXJuICIiOyB2YXIgcywgYSA9IChpID8gaS5kYXlOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCwgbiA9IChpID8gaS5kYXlOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLCByID0gKGkgPyBpLm1vbnRoTmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCwgbyA9IChpID8gaS5tb250aE5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcywgbCA9IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gZS5sZW5ndGggPiBzICsgMSAmJiBlLmNoYXJBdChzICsgMSkgPT09IHQ7IHJldHVybiBpICYmIHMrKyAsIGkgfSwgaCA9IGZ1bmN0aW9uIChlLCB0LCBpKSB7IHZhciBzID0gIiIgKyB0OyBpZiAobChlKSkgZm9yICg7IGkgPiBzLmxlbmd0aDspcyA9ICIwIiArIHM7IHJldHVybiBzIH0sIHUgPSBmdW5jdGlvbiAoZSwgdCwgaSwgcykgeyByZXR1cm4gbChlKSA/IHNbdF0gOiBpW3RdIH0sIGQgPSAiIiwgYyA9ICExOyBpZiAodCkgZm9yIChzID0gMDsgZS5sZW5ndGggPiBzOyBzKyspaWYgKGMpICInIiAhPT0gZS5jaGFyQXQocykgfHwgbCgiJyIpID8gZCArPSBlLmNoYXJBdChzKSA6IGMgPSAhMTsgZWxzZSBzd2l0Y2ggKGUuY2hhckF0KHMpKSB7IGNhc2UgImQiOiBkICs9IGgoImQiLCB0LmdldERhdGUoKSwgMik7IGJyZWFrOyBjYXNlICJEIjogZCArPSB1KCJEIiwgdC5nZXREYXkoKSwgYSwgbik7IGJyZWFrOyBjYXNlICJvIjogZCArPSBoKCJvIiwgTWF0aC5yb3VuZCgobmV3IERhdGUodC5nZXRGdWxsWWVhcigpLCB0LmdldE1vbnRoKCksIHQuZ2V0RGF0ZSgpKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSh0LmdldEZ1bGxZZWFyKCksIDAsIDApLmdldFRpbWUoKSkgLyA4NjRlNSksIDMpOyBicmVhazsgY2FzZSAibSI6IGQgKz0gaCgibSIsIHQuZ2V0TW9udGgoKSArIDEsIDIpOyBicmVhazsgY2FzZSAiTSI6IGQgKz0gdSgiTSIsIHQuZ2V0TW9udGgoKSwgciwgbyk7IGJyZWFrOyBjYXNlICJ5IjogZCArPSBsKCJ5IikgPyB0LmdldEZ1bGxZZWFyKCkgOiAoMTAgPiB0LmdldEZ1bGxZZWFyKCkgJSAxMDAgPyAiMCIgOiAiIikgKyB0LmdldEZ1bGxZZWFyKCkgJSAxMDA7IGJyZWFrOyBjYXNlICJAIjogZCArPSB0LmdldFRpbWUoKTsgYnJlYWs7IGNhc2UgIiEiOiBkICs9IDFlNCAqIHQuZ2V0VGltZSgpICsgdGhpcy5fdGlja3NUbzE5NzA7IGJyZWFrOyBjYXNlICInIjogbCgiJyIpID8gZCArPSAiJyIgOiBjID0gITA7IGJyZWFrOyBkZWZhdWx0OiBkICs9IGUuY2hhckF0KHMpIH1yZXR1cm4gZCB9LCBfcG9zc2libGVDaGFyczogZnVuY3Rpb24gKGUpIHsgdmFyIHQsIGkgPSAiIiwgcyA9ICExLCBhID0gZnVuY3Rpb24gKGkpIHsgdmFyIHMgPSBlLmxlbmd0aCA+IHQgKyAxICYmIGUuY2hhckF0KHQgKyAxKSA9PT0gaTsgcmV0dXJuIHMgJiYgdCsrICwgcyB9OyBmb3IgKHQgPSAwOyBlLmxlbmd0aCA+IHQ7IHQrKylpZiAocykgIiciICE9PSBlLmNoYXJBdCh0KSB8fCBhKCInIikgPyBpICs9IGUuY2hhckF0KHQpIDogcyA9ICExOyBlbHNlIHN3aXRjaCAoZS5jaGFyQXQodCkpIHsgY2FzZSAiZCI6IGNhc2UgIm0iOiBjYXNlICJ5IjogY2FzZSAiQCI6IGkgKz0gIjAxMjM0NTY3ODkiOyBicmVhazsgY2FzZSAiRCI6IGNhc2UgIk0iOiByZXR1cm4gbnVsbDsgY2FzZSAiJyI6IGEoIiciKSA/IGkgKz0gIiciIDogcyA9ICEwOyBicmVhazsgZGVmYXVsdDogaSArPSBlLmNoYXJBdCh0KSB9cmV0dXJuIGkgfSwgX2dldDogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHZvaWQgMCAhPT0gZS5zZXR0aW5nc1t0XSA/IGUuc2V0dGluZ3NbdF0gOiB0aGlzLl9kZWZhdWx0c1t0XSB9LCBfc2V0RGF0ZUZyb21GaWVsZDogZnVuY3Rpb24gKGUsIHQpIHsgaWYgKGUuaW5wdXQudmFsKCkgIT09IGUubGFzdFZhbCkgeyB2YXIgaSA9IHRoaXMuX2dldChlLCAiZGF0ZUZvcm1hdCIpLCBzID0gZS5sYXN0VmFsID0gZS5pbnB1dCA/IGUuaW5wdXQudmFsKCkgOiBudWxsLCBhID0gdGhpcy5fZ2V0RGVmYXVsdERhdGUoZSksIG4gPSBhLCByID0gdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGUpOyB0cnkgeyBuID0gdGhpcy5wYXJzZURhdGUoaSwgcywgcikgfHwgYSB9IGNhdGNoIChvKSB7IHMgPSB0ID8gIiIgOiBzIH0gZS5zZWxlY3RlZERheSA9IG4uZ2V0RGF0ZSgpLCBlLmRyYXdNb250aCA9IGUuc2VsZWN0ZWRNb250aCA9IG4uZ2V0TW9udGgoKSwgZS5kcmF3WWVhciA9IGUuc2VsZWN0ZWRZZWFyID0gbi5nZXRGdWxsWWVhcigpLCBlLmN1cnJlbnREYXkgPSBzID8gbi5nZXREYXRlKCkgOiAwLCBlLmN1cnJlbnRNb250aCA9IHMgPyBuLmdldE1vbnRoKCkgOiAwLCBlLmN1cnJlbnRZZWFyID0gcyA/IG4uZ2V0RnVsbFllYXIoKSA6IDAsIHRoaXMuX2FkanVzdEluc3REYXRlKGUpIH0gfSwgX2dldERlZmF1bHREYXRlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5fcmVzdHJpY3RNaW5NYXgoZSwgdGhpcy5fZGV0ZXJtaW5lRGF0ZShlLCB0aGlzLl9nZXQoZSwgImRlZmF1bHREYXRlIiksIG5ldyBEYXRlKSkgfSwgX2RldGVybWluZURhdGU6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBuZXcgRGF0ZTsgcmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKSArIGUpLCB0IH0sIG4gPSBmdW5jdGlvbiAoaSkgeyB0cnkgeyByZXR1cm4gZS5kYXRlcGlja2VyLnBhcnNlRGF0ZShlLmRhdGVwaWNrZXIuX2dldCh0LCAiZGF0ZUZvcm1hdCIpLCBpLCBlLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyh0KSkgfSBjYXRjaCAocykgeyB9IGZvciAodmFyIGEgPSAoaS50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eYy8pID8gZS5kYXRlcGlja2VyLl9nZXREYXRlKHQpIDogbnVsbCkgfHwgbmV3IERhdGUsIG4gPSBhLmdldEZ1bGxZZWFyKCksIHIgPSBhLmdldE1vbnRoKCksIG8gPSBhLmdldERhdGUoKSwgbCA9IC8oWytcLV0/WzAtOV0rKVxzKihkfER8d3xXfG18TXx5fFkpPy9nLCBoID0gbC5leGVjKGkpOyBoOykgeyBzd2l0Y2ggKGhbMl0gfHwgImQiKSB7IGNhc2UgImQiOiBjYXNlICJEIjogbyArPSBwYXJzZUludChoWzFdLCAxMCk7IGJyZWFrOyBjYXNlICJ3IjogY2FzZSAiVyI6IG8gKz0gNyAqIHBhcnNlSW50KGhbMV0sIDEwKTsgYnJlYWs7IGNhc2UgIm0iOiBjYXNlICJNIjogciArPSBwYXJzZUludChoWzFdLCAxMCksIG8gPSBNYXRoLm1pbihvLCBlLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKG4sIHIpKTsgYnJlYWs7IGNhc2UgInkiOiBjYXNlICJZIjogbiArPSBwYXJzZUludChoWzFdLCAxMCksIG8gPSBNYXRoLm1pbihvLCBlLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKG4sIHIpKSB9aCA9IGwuZXhlYyhpKSB9IHJldHVybiBuZXcgRGF0ZShuLCByLCBvKSB9LCByID0gbnVsbCA9PSBpIHx8ICIiID09PSBpID8gcyA6ICJzdHJpbmciID09IHR5cGVvZiBpID8gbihpKSA6ICJudW1iZXIiID09IHR5cGVvZiBpID8gaXNOYU4oaSkgPyBzIDogYShpKSA6IG5ldyBEYXRlKGkuZ2V0VGltZSgpKTsgcmV0dXJuIHIgPSByICYmICJJbnZhbGlkIERhdGUiID09ICIiICsgciA/IHMgOiByLCByICYmIChyLnNldEhvdXJzKDApLCByLnNldE1pbnV0ZXMoMCksIHIuc2V0U2Vjb25kcygwKSwgci5zZXRNaWxsaXNlY29uZHMoMCkpLCB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChyKSB9LCBfZGF5bGlnaHRTYXZpbmdBZGp1c3Q6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlID8gKGUuc2V0SG91cnMoZS5nZXRIb3VycygpID4gMTIgPyBlLmdldEhvdXJzKCkgKyAyIDogMCksIGUpIDogbnVsbCB9LCBfc2V0RGF0ZTogZnVuY3Rpb24gKGUsIHQsIGkpIHsgdmFyIHMgPSAhdCwgYSA9IGUuc2VsZWN0ZWRNb250aCwgbiA9IGUuc2VsZWN0ZWRZZWFyLCByID0gdGhpcy5fcmVzdHJpY3RNaW5NYXgoZSwgdGhpcy5fZGV0ZXJtaW5lRGF0ZShlLCB0LCBuZXcgRGF0ZSkpOyBlLnNlbGVjdGVkRGF5ID0gZS5jdXJyZW50RGF5ID0gci5nZXREYXRlKCksIGUuZHJhd01vbnRoID0gZS5zZWxlY3RlZE1vbnRoID0gZS5jdXJyZW50TW9udGggPSByLmdldE1vbnRoKCksIGUuZHJhd1llYXIgPSBlLnNlbGVjdGVkWWVhciA9IGUuY3VycmVudFllYXIgPSByLmdldEZ1bGxZZWFyKCksIGEgPT09IGUuc2VsZWN0ZWRNb250aCAmJiBuID09PSBlLnNlbGVjdGVkWWVhciB8fCBpIHx8IHRoaXMuX25vdGlmeUNoYW5nZShlKSwgdGhpcy5fYWRqdXN0SW5zdERhdGUoZSksIGUuaW5wdXQgJiYgZS5pbnB1dC52YWwocyA/ICIiIDogdGhpcy5fZm9ybWF0RGF0ZShlKSkgfSwgX2dldERhdGU6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gIWUuY3VycmVudFllYXIgfHwgZS5pbnB1dCAmJiAiIiA9PT0gZS5pbnB1dC52YWwoKSA/IG51bGwgOiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShlLmN1cnJlbnRZZWFyLCBlLmN1cnJlbnRNb250aCwgZS5jdXJyZW50RGF5KSk7IHJldHVybiB0IH0sIF9hdHRhY2hIYW5kbGVyczogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLl9nZXQodCwgInN0ZXBNb250aHMiKSwgcyA9ICIjIiArIHQuaWQucmVwbGFjZSgvXFxcXC9nLCAiXFwiKTsgdC5kcERpdi5maW5kKCJbZGF0YS1oYW5kbGVyXSIpLm1hcChmdW5jdGlvbiAoKSB7IHZhciB0ID0geyBwcmV2OiBmdW5jdGlvbiAoKSB7IGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShzLCAtaSwgIk0iKSB9LCBuZXh0OiBmdW5jdGlvbiAoKSB7IGUuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShzLCAraSwgIk0iKSB9LCBoaWRlOiBmdW5jdGlvbiAoKSB7IGUuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKSB9LCB0b2RheTogZnVuY3Rpb24gKCkgeyBlLmRhdGVwaWNrZXIuX2dvdG9Ub2RheShzKSB9LCBzZWxlY3REYXk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuZGF0ZXBpY2tlci5fc2VsZWN0RGF5KHMsICt0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1tb250aCIpLCArdGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEteWVhciIpLCB0aGlzKSwgITEgfSwgc2VsZWN0TW9udGg6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKHMsIHRoaXMsICJNIiksICExIH0sIHNlbGVjdFllYXI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKHMsIHRoaXMsICJZIiksICExIH0gfTsgZSh0aGlzKS5vbih0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1ldmVudCIpLCB0W3RoaXMuZ2V0QXR0cmlidXRlKCJkYXRhLWhhbmRsZXIiKV0pIH0pIH0sIF9nZW5lcmF0ZUhUTUw6IGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0LCBpLCBzLCBhLCBuLCByLCBvLCBsLCBoLCB1LCBkLCBjLCBwLCBtLCBmLCBnLCB2LCB5LCBfLCBiLCBrLCB4LCBELCB3LCBULCBTLCBNLCBOLCBDLCBBLCBJLCBQLCBGLCBqLCBILCB6LCBMLCBPLCBFLCBSID0gbmV3IERhdGUsIFcgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShSLmdldEZ1bGxZZWFyKCksIFIuZ2V0TW9udGgoKSwgUi5nZXREYXRlKCkpKSwgWSA9IHRoaXMuX2dldChlLCAiaXNSVEwiKSwgSiA9IHRoaXMuX2dldChlLCAic2hvd0J1dHRvblBhbmVsIiksIEIgPSB0aGlzLl9nZXQoZSwgImhpZGVJZk5vUHJldk5leHQiKSwgUSA9IHRoaXMuX2dldChlLCAibmF2aWdhdGlvbkFzRGF0ZUZvcm1hdCIpLCBLID0gdGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoZSksIFYgPSB0aGlzLl9nZXQoZSwgInNob3dDdXJyZW50QXRQb3MiKSwgVSA9IHRoaXMuX2dldChlLCAic3RlcE1vbnRocyIpLCBxID0gMSAhPT0gS1swXSB8fCAxICE9PSBLWzFdLCBHID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoZS5jdXJyZW50RGF5ID8gbmV3IERhdGUoZS5jdXJyZW50WWVhciwgZS5jdXJyZW50TW9udGgsIGUuY3VycmVudERheSkgOiBuZXcgRGF0ZSg5OTk5LCA5LCA5KSksIFggPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGUsICJtaW4iKSwgJCA9IHRoaXMuX2dldE1pbk1heERhdGUoZSwgIm1heCIpLCBaID0gZS5kcmF3TW9udGggLSBWLCBldCA9IGUuZHJhd1llYXI7IGlmICgwID4gWiAmJiAoWiArPSAxMiwgZXQtLSksICQpIGZvciAodCA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKCQuZ2V0RnVsbFllYXIoKSwgJC5nZXRNb250aCgpIC0gS1swXSAqIEtbMV0gKyAxLCAkLmdldERhdGUoKSkpLCB0ID0gWCAmJiBYID4gdCA/IFggOiB0OyB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShldCwgWiwgMSkpID4gdDspWi0tICwgMCA+IFogJiYgKFogPSAxMSwgZXQtLSk7IGZvciAoZS5kcmF3TW9udGggPSBaLCBlLmRyYXdZZWFyID0gZXQsIGkgPSB0aGlzLl9nZXQoZSwgInByZXZUZXh0IiksIGkgPSBRID8gdGhpcy5mb3JtYXREYXRlKGksIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGV0LCBaIC0gVSwgMSkpLCB0aGlzLl9nZXRGb3JtYXRDb25maWcoZSkpIDogaSwgcyA9IHRoaXMuX2NhbkFkanVzdE1vbnRoKGUsIC0xLCBldCwgWikgPyAiPGEgY2xhc3M9J3VpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsJyBkYXRhLWhhbmRsZXI9J3ByZXYnIGRhdGEtZXZlbnQ9J2NsaWNrJyB0aXRsZT0nIiArIGkgKyAiJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0iICsgKFkgPyAiZSIgOiAidyIpICsgIic+IiArIGkgKyAiPC9zcGFuPjwvYT4iIDogQiA/ICIiIDogIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZCcgdGl0bGU9JyIgKyBpICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArIChZID8gImUiIDogInciKSArICInPiIgKyBpICsgIjwvc3Bhbj48L2E+IiwgYSA9IHRoaXMuX2dldChlLCAibmV4dFRleHQiKSwgYSA9IFEgPyB0aGlzLmZvcm1hdERhdGUoYSwgdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZXQsIFogKyBVLCAxKSksIHRoaXMuX2dldEZvcm1hdENvbmZpZyhlKSkgOiBhLCBuID0gdGhpcy5fY2FuQWRqdXN0TW9udGgoZSwgMSwgZXQsIFopID8gIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbCcgZGF0YS1oYW5kbGVyPSduZXh0JyBkYXRhLWV2ZW50PSdjbGljaycgdGl0bGU9JyIgKyBhICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArIChZID8gInciIDogImUiKSArICInPiIgKyBhICsgIjwvc3Bhbj48L2E+IiA6IEIgPyAiIiA6ICI8YSBjbGFzcz0ndWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtZGlzYWJsZWQnIHRpdGxlPSciICsgYSArICInPjxzcGFuIGNsYXNzPSd1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLSIgKyAoWSA/ICJ3IiA6ICJlIikgKyAiJz4iICsgYSArICI8L3NwYW4+PC9hPiIsIHIgPSB0aGlzLl9nZXQoZSwgImN1cnJlbnRUZXh0IiksIG8gPSB0aGlzLl9nZXQoZSwgImdvdG9DdXJyZW50IikgJiYgZS5jdXJyZW50RGF5ID8gRyA6IFcsIHIgPSBRID8gdGhpcy5mb3JtYXREYXRlKHIsIG8sIHRoaXMuX2dldEZvcm1hdENvbmZpZyhlKSkgOiByLCBsID0gZS5pbmxpbmUgPyAiIiA6ICI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J3VpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0naGlkZScgZGF0YS1ldmVudD0nY2xpY2snPiIgKyB0aGlzLl9nZXQoZSwgImNsb3NlVGV4dCIpICsgIjwvYnV0dG9uPiIsIGggPSBKID8gIjxkaXYgY2xhc3M9J3VpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCc+IiArIChZID8gbCA6ICIiKSArICh0aGlzLl9pc0luUmFuZ2UoZSwgbykgPyAiPGJ1dHRvbiB0eXBlPSdidXR0b24nIGNsYXNzPSd1aS1kYXRlcGlja2VyLWN1cnJlbnQgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1zZWNvbmRhcnkgdWktY29ybmVyLWFsbCcgZGF0YS1oYW5kbGVyPSd0b2RheScgZGF0YS1ldmVudD0nY2xpY2snPiIgKyByICsgIjwvYnV0dG9uPiIgOiAiIikgKyAoWSA/ICIiIDogbCkgKyAiPC9kaXY+IiA6ICIiLCB1ID0gcGFyc2VJbnQodGhpcy5fZ2V0KGUsICJmaXJzdERheSIpLCAxMCksIHUgPSBpc05hTih1KSA/IDAgOiB1LCBkID0gdGhpcy5fZ2V0KGUsICJzaG93V2VlayIpLCBjID0gdGhpcy5fZ2V0KGUsICJkYXlOYW1lcyIpLCBwID0gdGhpcy5fZ2V0KGUsICJkYXlOYW1lc01pbiIpLCBtID0gdGhpcy5fZ2V0KGUsICJtb250aE5hbWVzIiksIGYgPSB0aGlzLl9nZXQoZSwgIm1vbnRoTmFtZXNTaG9ydCIpLCBnID0gdGhpcy5fZ2V0KGUsICJiZWZvcmVTaG93RGF5IiksIHYgPSB0aGlzLl9nZXQoZSwgInNob3dPdGhlck1vbnRocyIpLCB5ID0gdGhpcy5fZ2V0KGUsICJzZWxlY3RPdGhlck1vbnRocyIpLCBfID0gdGhpcy5fZ2V0RGVmYXVsdERhdGUoZSksIGIgPSAiIiwgeCA9IDA7IEtbMF0gPiB4OyB4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoRCA9ICIiLCB0aGlzLm1heFJvd3MgPSA0LCB3ID0gMDsgS1sxXSA+IHc7IHcrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZXQsIFosIGUuc2VsZWN0ZWREYXkpKSwgUyA9ICIgdWktY29ybmVyLWFsbCIsIE0gPSAiIiwgcSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTSArPSAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1ncm91cCIsIEtbMV0gPiAxKSBzd2l0Y2ggKHcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDogTSArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtZmlyc3QiLCBTID0gIiB1aS1jb3JuZXItIiArIChZID8gInJpZ2h0IiA6ICJsZWZ0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IGNhc2UgS1sxXSAtIDE6IE0gKz0gIiB1aS1kYXRlcGlja2VyLWdyb3VwLWxhc3QiLCBTID0gIiB1aS1jb3JuZXItIiArIChZID8gImxlZnQiIDogInJpZ2h0Iik7IGJyZWFrOyBkZWZhdWx0OiBNICs9ICIgdWktZGF0ZXBpY2tlci1ncm91cC1taWRkbGUiLCBTID0gIiINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfU0gKz0gIic+Ig0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZm9yIChNICs9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLWhlYWRlciB1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCIgKyBTICsgIic+IiArICgvYWxsfGxlZnQvLnRlc3QoUykgJiYgMCA9PT0geCA/IFkgPyBuIDogcyA6ICIiKSArICgvYWxsfHJpZ2h0Ly50ZXN0KFMpICYmIDAgPT09IHggPyBZID8gcyA6IG4gOiAiIikgKyB0aGlzLl9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcihlLCBaLCBldCwgWCwgJCwgeCA+IDAgfHwgdyA+IDAsIG0sIGYpICsgIjwvZGl2Pjx0YWJsZSBjbGFzcz0ndWktZGF0ZXBpY2tlci1jYWxlbmRhcic+PHRoZWFkPiIgKyAiPHRyPiIsIE4gPSBkID8gIjx0aCBjbGFzcz0ndWktZGF0ZXBpY2tlci13ZWVrLWNvbCc+IiArIHRoaXMuX2dldChlLCAid2Vla0hlYWRlciIpICsgIjwvdGg+IiA6ICIiLCBrID0gMDsgNyA+IGs7IGsrKylDID0gKGsgKyB1KSAlIDcsIE4gKz0gIjx0aCBzY29wZT0nY29sJyIgKyAoKGsgKyB1ICsgNikgJSA3ID49IDUgPyAiIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstZW5kJyIgOiAiIikgKyAiPiIgKyAiPHNwYW4gdGl0bGU9JyIgKyBjW0NdICsgIic+IiArIHBbQ10gKyAiPC9zcGFuPjwvdGg+IjsgZm9yIChNICs9IE4gKyAiPC90cj48L3RoZWFkPjx0Ym9keT4iLCBBID0gdGhpcy5fZ2V0RGF5c0luTW9udGgoZXQsIFopLCBldCA9PT0gZS5zZWxlY3RlZFllYXIgJiYgWiA9PT0gZS5zZWxlY3RlZE1vbnRoICYmIChlLnNlbGVjdGVkRGF5ID0gTWF0aC5taW4oZS5zZWxlY3RlZERheSwgQSkpLCBJID0gKHRoaXMuX2dldEZpcnN0RGF5T2ZNb250aChldCwgWikgLSB1ICsgNykgJSA3LCBQID0gTWF0aC5jZWlsKChJICsgQSkgLyA3KSwgRiA9IHEgPyB0aGlzLm1heFJvd3MgPiBQID8gdGhpcy5tYXhSb3dzIDogUCA6IFAsIHRoaXMubWF4Um93cyA9IEYsIGogPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShldCwgWiwgMSAtIEkpKSwgSCA9IDA7IEYgPiBIOyBIKyspIHsgZm9yIChNICs9ICI8dHI+IiwgeiA9IGQgPyAiPHRkIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstY29sJz4iICsgdGhpcy5fZ2V0KGUsICJjYWxjdWxhdGVXZWVrIikoaikgKyAiPC90ZD4iIDogIiIsIGsgPSAwOyA3ID4gazsgaysrKUwgPSBnID8gZy5hcHBseShlLmlucHV0ID8gZS5pbnB1dFswXSA6IG51bGwsIFtqXSkgOiBbITAsICIiXSwgTyA9IGouZ2V0TW9udGgoKSAhPT0gWiwgRSA9IE8gJiYgIXkgfHwgIUxbMF0gfHwgWCAmJiBYID4gaiB8fCAkICYmIGogPiAkLCB6ICs9ICI8dGQgY2xhc3M9JyIgKyAoKGsgKyB1ICsgNikgJSA3ID49IDUgPyAiIHVpLWRhdGVwaWNrZXItd2Vlay1lbmQiIDogIiIpICsgKE8gPyAiIHVpLWRhdGVwaWNrZXItb3RoZXItbW9udGgiIDogIiIpICsgKGouZ2V0VGltZSgpID09PSBULmdldFRpbWUoKSAmJiBaID09PSBlLnNlbGVjdGVkTW9udGggJiYgZS5fa2V5RXZlbnQgfHwgXy5nZXRUaW1lKCkgPT09IGouZ2V0VGltZSgpICYmIF8uZ2V0VGltZSgpID09PSBULmdldFRpbWUoKSA/ICIgIiArIHRoaXMuX2RheU92ZXJDbGFzcyA6ICIiKSArIChFID8gIiAiICsgdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MgKyAiIHVpLXN0YXRlLWRpc2FibGVkIiA6ICIiKSArIChPICYmICF2ID8gIiIgOiAiICIgKyBMWzFdICsgKGouZ2V0VGltZSgpID09PSBHLmdldFRpbWUoKSA/ICIgIiArIHRoaXMuX2N1cnJlbnRDbGFzcyA6ICIiKSArIChqLmdldFRpbWUoKSA9PT0gVy5nZXRUaW1lKCkgPyAiIHVpLWRhdGVwaWNrZXItdG9kYXkiIDogIiIpKSArICInIiArIChPICYmICF2IHx8ICFMWzJdID8gIiIgOiAiIHRpdGxlPSciICsgTFsyXS5yZXBsYWNlKC8nL2csICImIzM5OyIpICsgIiciKSArIChFID8gIiIgOiAiIGRhdGEtaGFuZGxlcj0nc2VsZWN0RGF5JyBkYXRhLWV2ZW50PSdjbGljaycgZGF0YS1tb250aD0nIiArIGouZ2V0TW9udGgoKSArICInIGRhdGEteWVhcj0nIiArIGouZ2V0RnVsbFllYXIoKSArICInIikgKyAiPiIgKyAoTyAmJiAhdiA/ICImI3hhMDsiIDogRSA/ICI8c3BhbiBjbGFzcz0ndWktc3RhdGUtZGVmYXVsdCc+IiArIGouZ2V0RGF0ZSgpICsgIjwvc3Bhbj4iIDogIjxhIGNsYXNzPSd1aS1zdGF0ZS1kZWZhdWx0IiArIChqLmdldFRpbWUoKSA9PT0gVy5nZXRUaW1lKCkgPyAiIHVpLXN0YXRlLWhpZ2hsaWdodCIgOiAiIikgKyAoai5nZXRUaW1lKCkgPT09IEcuZ2V0VGltZSgpID8gIiB1aS1zdGF0ZS1hY3RpdmUiIDogIiIpICsgKE8gPyAiIHVpLXByaW9yaXR5LXNlY29uZGFyeSIgOiAiIikgKyAiJyBocmVmPScjJz4iICsgai5nZXREYXRlKCkgKyAiPC9hPiIpICsgIjwvdGQ+Iiwgai5zZXREYXRlKGouZ2V0RGF0ZSgpICsgMSksIGogPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChqKTsgTSArPSB6ICsgIjwvdHI+IiB9IForKyAsIFogPiAxMSAmJiAoWiA9IDAsIGV0KyspLCBNICs9ICI8L3Rib2R5PjwvdGFibGU+IiArIChxID8gIjwvZGl2PiIgKyAoS1swXSA+IDAgJiYgdyA9PT0gS1sxXSAtIDEgPyAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1yb3ctYnJlYWsnPjwvZGl2PiIgOiAiIikgOiAiIiksIEQgKz0gTQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBiICs9IEQNCiAgICAgICAgICAgICAgICAgICAgfSByZXR1cm4gYiArPSBoLCBlLl9rZXlFdmVudCA9ICExLCBiDQogICAgICAgICAgICAgICAgfSwgX2dlbmVyYXRlTW9udGhZZWFySGVhZGVyOiBmdW5jdGlvbiAoZSwgdCwgaSwgcywgYSwgbiwgciwgbykgeyB2YXIgbCwgaCwgdSwgZCwgYywgcCwgbSwgZiwgZyA9IHRoaXMuX2dldChlLCAiY2hhbmdlTW9udGgiKSwgdiA9IHRoaXMuX2dldChlLCAiY2hhbmdlWWVhciIpLCB5ID0gdGhpcy5fZ2V0KGUsICJzaG93TW9udGhBZnRlclllYXIiKSwgXyA9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLXRpdGxlJz4iLCBiID0gIiI7IGlmIChuIHx8ICFnKSBiICs9ICI8c3BhbiBjbGFzcz0ndWktZGF0ZXBpY2tlci1tb250aCc+IiArIHJbdF0gKyAiPC9zcGFuPiI7IGVsc2UgeyBmb3IgKGwgPSBzICYmIHMuZ2V0RnVsbFllYXIoKSA9PT0gaSwgaCA9IGEgJiYgYS5nZXRGdWxsWWVhcigpID09PSBpLCBiICs9ICI8c2VsZWN0IGNsYXNzPSd1aS1kYXRlcGlja2VyLW1vbnRoJyBkYXRhLWhhbmRsZXI9J3NlbGVjdE1vbnRoJyBkYXRhLWV2ZW50PSdjaGFuZ2UnPiIsIHUgPSAwOyAxMiA+IHU7IHUrKykoIWwgfHwgdSA+PSBzLmdldE1vbnRoKCkpICYmICghaCB8fCBhLmdldE1vbnRoKCkgPj0gdSkgJiYgKGIgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyB1ICsgIiciICsgKHUgPT09IHQgPyAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIpICsgIj4iICsgb1t1XSArICI8L29wdGlvbj4iKTsgYiArPSAiPC9zZWxlY3Q+IiB9IGlmICh5IHx8IChfICs9IGIgKyAoIW4gJiYgZyAmJiB2ID8gIiIgOiAiJiN4YTA7IikpLCAhZS55ZWFyc2h0bWwpIGlmIChlLnllYXJzaHRtbCA9ICIiLCBuIHx8ICF2KSBfICs9ICI8c3BhbiBjbGFzcz0ndWktZGF0ZXBpY2tlci15ZWFyJz4iICsgaSArICI8L3NwYW4+IjsgZWxzZSB7IGZvciAoZCA9IHRoaXMuX2dldChlLCAieWVhclJhbmdlIikuc3BsaXQoIjoiKSwgYyA9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSwgcCA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5tYXRjaCgvY1srXC1dLiovKSA/IGkgKyBwYXJzZUludChlLnN1YnN0cmluZygxKSwgMTApIDogZS5tYXRjaCgvWytcLV0uKi8pID8gYyArIHBhcnNlSW50KGUsIDEwKSA6IHBhcnNlSW50KGUsIDEwKTsgcmV0dXJuIGlzTmFOKHQpID8gYyA6IHQgfSwgbSA9IHAoZFswXSksIGYgPSBNYXRoLm1heChtLCBwKGRbMV0gfHwgIiIpKSwgbSA9IHMgPyBNYXRoLm1heChtLCBzLmdldEZ1bGxZZWFyKCkpIDogbSwgZiA9IGEgPyBNYXRoLm1pbihmLCBhLmdldEZ1bGxZZWFyKCkpIDogZiwgZS55ZWFyc2h0bWwgKz0gIjxzZWxlY3QgY2xhc3M9J3VpLWRhdGVwaWNrZXIteWVhcicgZGF0YS1oYW5kbGVyPSdzZWxlY3RZZWFyJyBkYXRhLWV2ZW50PSdjaGFuZ2UnPiI7IGYgPj0gbTsgbSsrKWUueWVhcnNodG1sICs9ICI8b3B0aW9uIHZhbHVlPSciICsgbSArICInIiArIChtID09PSBpID8gIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIiA6ICIiKSArICI+IiArIG0gKyAiPC9vcHRpb24+IjsgZS55ZWFyc2h0bWwgKz0gIjwvc2VsZWN0PiIsIF8gKz0gZS55ZWFyc2h0bWwsIGUueWVhcnNodG1sID0gbnVsbCB9IHJldHVybiBfICs9IHRoaXMuX2dldChlLCAieWVhclN1ZmZpeCIpLCB5ICYmIChfICs9ICghbiAmJiBnICYmIHYgPyAiIiA6ICImI3hhMDsiKSArIGIpLCBfICs9ICI8L2Rpdj4iIH0sIF9hZGp1c3RJbnN0RGF0ZTogZnVuY3Rpb24gKGUsIHQsIGkpIHsgdmFyIHMgPSBlLnNlbGVjdGVkWWVhciArICgiWSIgPT09IGkgPyB0IDogMCksIGEgPSBlLnNlbGVjdGVkTW9udGggKyAoIk0iID09PSBpID8gdCA6IDApLCBuID0gTWF0aC5taW4oZS5zZWxlY3RlZERheSwgdGhpcy5fZ2V0RGF5c0luTW9udGgocywgYSkpICsgKCJEIiA9PT0gaSA/IHQgOiAwKSwgciA9IHRoaXMuX3Jlc3RyaWN0TWluTWF4KGUsIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHMsIGEsIG4pKSk7IGUuc2VsZWN0ZWREYXkgPSByLmdldERhdGUoKSwgZS5kcmF3TW9udGggPSBlLnNlbGVjdGVkTW9udGggPSByLmdldE1vbnRoKCksIGUuZHJhd1llYXIgPSBlLnNlbGVjdGVkWWVhciA9IHIuZ2V0RnVsbFllYXIoKSwgKCJNIiA9PT0gaSB8fCAiWSIgPT09IGkpICYmIHRoaXMuX25vdGlmeUNoYW5nZShlKSB9LCBfcmVzdHJpY3RNaW5NYXg6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShlLCAibWluIiksIHMgPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGUsICJtYXgiKSwgYSA9IGkgJiYgaSA+IHQgPyBpIDogdDsgcmV0dXJuIHMgJiYgYSA+IHMgPyBzIDogYSB9LCBfbm90aWZ5Q2hhbmdlOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMuX2dldChlLCAib25DaGFuZ2VNb250aFllYXIiKTsgdCAmJiB0LmFwcGx5KGUuaW5wdXQgPyBlLmlucHV0WzBdIDogbnVsbCwgW2Uuc2VsZWN0ZWRZZWFyLCBlLnNlbGVjdGVkTW9udGggKyAxLCBlXSkgfSwgX2dldE51bWJlck9mTW9udGhzOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IHRoaXMuX2dldChlLCAibnVtYmVyT2ZNb250aHMiKTsgcmV0dXJuIG51bGwgPT0gdCA/IFsxLCAxXSA6ICJudW1iZXIiID09IHR5cGVvZiB0ID8gWzEsIHRdIDogdCB9LCBfZ2V0TWluTWF4RGF0ZTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHRoaXMuX2RldGVybWluZURhdGUoZSwgdGhpcy5fZ2V0KGUsIHQgKyAiRGF0ZSIpLCBudWxsKSB9LCBfZ2V0RGF5c0luTW9udGg6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiAzMiAtIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGUsIHQsIDMyKSkuZ2V0RGF0ZSgpIH0sIF9nZXRGaXJzdERheU9mTW9udGg6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBuZXcgRGF0ZShlLCB0LCAxKS5nZXREYXkoKSB9LCBfY2FuQWRqdXN0TW9udGg6IGZ1bmN0aW9uIChlLCB0LCBpLCBzKSB7IHZhciBhID0gdGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoZSksIG4gPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShpLCBzICsgKDAgPiB0ID8gdCA6IGFbMF0gKiBhWzFdKSwgMSkpOyByZXR1cm4gMCA+IHQgJiYgbi5zZXREYXRlKHRoaXMuX2dldERheXNJbk1vbnRoKG4uZ2V0RnVsbFllYXIoKSwgbi5nZXRNb250aCgpKSksIHRoaXMuX2lzSW5SYW5nZShlLCBuKSB9LCBfaXNJblJhbmdlOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSwgcywgYSA9IHRoaXMuX2dldE1pbk1heERhdGUoZSwgIm1pbiIpLCBuID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShlLCAibWF4IiksIHIgPSBudWxsLCBvID0gbnVsbCwgbCA9IHRoaXMuX2dldChlLCAieWVhclJhbmdlIik7IHJldHVybiBsICYmIChpID0gbC5zcGxpdCgiOiIpLCBzID0gKG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpLCByID0gcGFyc2VJbnQoaVswXSwgMTApLCBvID0gcGFyc2VJbnQoaVsxXSwgMTApLCBpWzBdLm1hdGNoKC9bK1wtXS4qLykgJiYgKHIgKz0gcyksIGlbMV0ubWF0Y2goL1srXC1dLiovKSAmJiAobyArPSBzKSksICghYSB8fCB0LmdldFRpbWUoKSA+PSBhLmdldFRpbWUoKSkgJiYgKCFuIHx8IHQuZ2V0VGltZSgpIDw9IG4uZ2V0VGltZSgpKSAmJiAoIXIgfHwgdC5nZXRGdWxsWWVhcigpID49IHIpICYmICghbyB8fCBvID49IHQuZ2V0RnVsbFllYXIoKSkgfSwgX2dldEZvcm1hdENvbmZpZzogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB0aGlzLl9nZXQoZSwgInNob3J0WWVhckN1dG9mZiIpOyByZXR1cm4gdCA9ICJzdHJpbmciICE9IHR5cGVvZiB0ID8gdCA6IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAlIDEwMCArIHBhcnNlSW50KHQsIDEwKSwgeyBzaG9ydFllYXJDdXRvZmY6IHQsIGRheU5hbWVzU2hvcnQ6IHRoaXMuX2dldChlLCAiZGF5TmFtZXNTaG9ydCIpLCBkYXlOYW1lczogdGhpcy5fZ2V0KGUsICJkYXlOYW1lcyIpLCBtb250aE5hbWVzU2hvcnQ6IHRoaXMuX2dldChlLCAibW9udGhOYW1lc1Nob3J0IiksIG1vbnRoTmFtZXM6IHRoaXMuX2dldChlLCAibW9udGhOYW1lcyIpIH0gfSwgX2Zvcm1hdERhdGU6IGZ1bmN0aW9uIChlLCB0LCBpLCBzKSB7IHQgfHwgKGUuY3VycmVudERheSA9IGUuc2VsZWN0ZWREYXksIGUuY3VycmVudE1vbnRoID0gZS5zZWxlY3RlZE1vbnRoLCBlLmN1cnJlbnRZZWFyID0gZS5zZWxlY3RlZFllYXIpOyB2YXIgYSA9IHQgPyAib2JqZWN0IiA9PSB0eXBlb2YgdCA/IHQgOiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShzLCBpLCB0KSkgOiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShlLmN1cnJlbnRZZWFyLCBlLmN1cnJlbnRNb250aCwgZS5jdXJyZW50RGF5KSk7IHJldHVybiB0aGlzLmZvcm1hdERhdGUodGhpcy5fZ2V0KGUsICJkYXRlRm9ybWF0IiksIGEsIHRoaXMuX2dldEZvcm1hdENvbmZpZyhlKSkgfQ0KICAgICAgICAgICAgfSksIGUuZm4uZGF0ZXBpY2tlciA9IGZ1bmN0aW9uICh0KSB7IGlmICghdGhpcy5sZW5ndGgpIHJldHVybiB0aGlzOyBlLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQgfHwgKGUoZG9jdW1lbnQpLm9uKCJtb3VzZWRvd24iLCBlLmRhdGVwaWNrZXIuX2NoZWNrRXh0ZXJuYWxDbGljayksIGUuZGF0ZXBpY2tlci5pbml0aWFsaXplZCA9ICEwKSwgMCA9PT0gZSgiIyIgKyBlLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoICYmIGUoImJvZHkiKS5hcHBlbmQoZS5kYXRlcGlja2VyLmRwRGl2KTsgdmFyIGkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOyByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIHQgfHwgImlzRGlzYWJsZWQiICE9PSB0ICYmICJnZXREYXRlIiAhPT0gdCAmJiAid2lkZ2V0IiAhPT0gdCA/ICJvcHRpb24iID09PSB0ICYmIDIgPT09IGFyZ3VtZW50cy5sZW5ndGggJiYgInN0cmluZyIgPT0gdHlwZW9mIGFyZ3VtZW50c1sxXSA/IGUuZGF0ZXBpY2tlclsiXyIgKyB0ICsgIkRhdGVwaWNrZXIiXS5hcHBseShlLmRhdGVwaWNrZXIsIFt0aGlzWzBdXS5jb25jYXQoaSkpIDogdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgInN0cmluZyIgPT0gdHlwZW9mIHQgPyBlLmRhdGVwaWNrZXJbIl8iICsgdCArICJEYXRlcGlja2VyIl0uYXBwbHkoZS5kYXRlcGlja2VyLCBbdGhpc10uY29uY2F0KGkpKSA6IGUuZGF0ZXBpY2tlci5fYXR0YWNoRGF0ZXBpY2tlcih0aGlzLCB0KSB9KSA6IGUuZGF0ZXBpY2tlclsiXyIgKyB0ICsgIkRhdGVwaWNrZXIiXS5hcHBseShlLmRhdGVwaWNrZXIsIFt0aGlzWzBdXS5jb25jYXQoaSkpIH0sIGUuZGF0ZXBpY2tlciA9IG5ldyBzLCBlLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQgPSAhMSwgZS5kYXRlcGlja2VyLnV1aWQgPSAobmV3IERhdGUpLmdldFRpbWUoKSwgZS5kYXRlcGlja2VyLnZlcnNpb24gPSAiMS4xMi4xIiwgZS5kYXRlcGlja2VyLCBlLndpZGdldCgidWkuZGlhbG9nIiwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgb3B0aW9uczogeyBhcHBlbmRUbzogImJvZHkiLCBhdXRvT3BlbjogITAsIGJ1dHRvbnM6IFtdLCBjbGFzc2VzOiB7ICJ1aS1kaWFsb2ciOiAidWktY29ybmVyLWFsbCIsICJ1aS1kaWFsb2ctdGl0bGViYXIiOiAidWktY29ybmVyLWFsbCIgfSwgY2xvc2VPbkVzY2FwZTogITAsIGNsb3NlVGV4dDogIkNsb3NlIiwgZHJhZ2dhYmxlOiAhMCwgaGlkZTogbnVsbCwgaGVpZ2h0OiAiYXV0byIsIG1heEhlaWdodDogbnVsbCwgbWF4V2lkdGg6IG51bGwsIG1pbkhlaWdodDogMTUwLCBtaW5XaWR0aDogMTUwLCBtb2RhbDogITEsIHBvc2l0aW9uOiB7IG15OiAiY2VudGVyIiwgYXQ6ICJjZW50ZXIiLCBvZjogd2luZG93LCBjb2xsaXNpb246ICJmaXQiLCB1c2luZzogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKHRoaXMpLmNzcyh0KS5vZmZzZXQoKS50b3A7IDAgPiBpICYmIGUodGhpcykuY3NzKCJ0b3AiLCB0LnRvcCAtIGkpIH0gfSwgcmVzaXphYmxlOiAhMCwgc2hvdzogbnVsbCwgdGl0bGU6IG51bGwsIHdpZHRoOiAzMDAsIGJlZm9yZUNsb3NlOiBudWxsLCBjbG9zZTogbnVsbCwgZHJhZzogbnVsbCwgZHJhZ1N0YXJ0OiBudWxsLCBkcmFnU3RvcDogbnVsbCwgZm9jdXM6IG51bGwsIG9wZW46IG51bGwsIHJlc2l6ZTogbnVsbCwgcmVzaXplU3RhcnQ6IG51bGwsIHJlc2l6ZVN0b3A6IG51bGwgfSwgc2l6ZVJlbGF0ZWRPcHRpb25zOiB7IGJ1dHRvbnM6ICEwLCBoZWlnaHQ6ICEwLCBtYXhIZWlnaHQ6ICEwLCBtYXhXaWR0aDogITAsIG1pbkhlaWdodDogITAsIG1pbldpZHRoOiAhMCwgd2lkdGg6ICEwIH0sIHJlc2l6YWJsZVJlbGF0ZWRPcHRpb25zOiB7IG1heEhlaWdodDogITAsIG1heFdpZHRoOiAhMCwgbWluSGVpZ2h0OiAhMCwgbWluV2lkdGg6ICEwIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdGhpcy5vcmlnaW5hbENzcyA9IHsgZGlzcGxheTogdGhpcy5lbGVtZW50WzBdLnN0eWxlLmRpc3BsYXksIHdpZHRoOiB0aGlzLmVsZW1lbnRbMF0uc3R5bGUud2lkdGgsIG1pbkhlaWdodDogdGhpcy5lbGVtZW50WzBdLnN0eWxlLm1pbkhlaWdodCwgbWF4SGVpZ2h0OiB0aGlzLmVsZW1lbnRbMF0uc3R5bGUubWF4SGVpZ2h0LCBoZWlnaHQ6IHRoaXMuZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgfSwgdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0geyBwYXJlbnQ6IHRoaXMuZWxlbWVudC5wYXJlbnQoKSwgaW5kZXg6IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5jaGlsZHJlbigpLmluZGV4KHRoaXMuZWxlbWVudCkgfSwgdGhpcy5vcmlnaW5hbFRpdGxlID0gdGhpcy5lbGVtZW50LmF0dHIoInRpdGxlIiksIG51bGwgPT0gdGhpcy5vcHRpb25zLnRpdGxlICYmIG51bGwgIT0gdGhpcy5vcmlnaW5hbFRpdGxlICYmICh0aGlzLm9wdGlvbnMudGl0bGUgPSB0aGlzLm9yaWdpbmFsVGl0bGUpLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9ICExKSwgdGhpcy5fY3JlYXRlV3JhcHBlcigpLCB0aGlzLmVsZW1lbnQuc2hvdygpLnJlbW92ZUF0dHIoInRpdGxlIikuYXBwZW5kVG8odGhpcy51aURpYWxvZyksIHRoaXMuX2FkZENsYXNzKCJ1aS1kaWFsb2ctY29udGVudCIsICJ1aS13aWRnZXQtY29udGVudCIpLCB0aGlzLl9jcmVhdGVUaXRsZWJhcigpLCB0aGlzLl9jcmVhdGVCdXR0b25QYW5lKCksIHRoaXMub3B0aW9ucy5kcmFnZ2FibGUgJiYgZS5mbi5kcmFnZ2FibGUgJiYgdGhpcy5fbWFrZURyYWdnYWJsZSgpLCB0aGlzLm9wdGlvbnMucmVzaXphYmxlICYmIGUuZm4ucmVzaXphYmxlICYmIHRoaXMuX21ha2VSZXNpemFibGUoKSwgdGhpcy5faXNPcGVuID0gITEsIHRoaXMuX3RyYWNrRm9jdXMoKSB9LCBfaW5pdDogZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbnMuYXV0b09wZW4gJiYgdGhpcy5vcGVuKCkgfSwgX2FwcGVuZFRvOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5vcHRpb25zLmFwcGVuZFRvOyByZXR1cm4gdCAmJiAodC5qcXVlcnkgfHwgdC5ub2RlVHlwZSkgPyBlKHQpIDogdGhpcy5kb2N1bWVudC5maW5kKHQgfHwgImJvZHkiKS5lcSgwKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsgdGhpcy5fdW50cmFja0luc3RhbmNlKCksIHRoaXMuX2Rlc3Ryb3lPdmVybGF5KCksIHRoaXMuZWxlbWVudC5yZW1vdmVVbmlxdWVJZCgpLmNzcyh0aGlzLm9yaWdpbmFsQ3NzKS5kZXRhY2goKSwgdGhpcy51aURpYWxvZy5yZW1vdmUoKSwgdGhpcy5vcmlnaW5hbFRpdGxlICYmIHRoaXMuZWxlbWVudC5hdHRyKCJ0aXRsZSIsIHRoaXMub3JpZ2luYWxUaXRsZSksIGUgPSB0LnBhcmVudC5jaGlsZHJlbigpLmVxKHQuaW5kZXgpLCBlLmxlbmd0aCAmJiBlWzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gPyBlLmJlZm9yZSh0aGlzLmVsZW1lbnQpIDogdC5wYXJlbnQuYXBwZW5kKHRoaXMuZWxlbWVudCkgfSwgd2lkZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnVpRGlhbG9nIH0sIGRpc2FibGU6IGUubm9vcCwgZW5hYmxlOiBlLm5vb3AsIGNsb3NlOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXM7IHRoaXMuX2lzT3BlbiAmJiB0aGlzLl90cmlnZ2VyKCJiZWZvcmVDbG9zZSIsIHQpICE9PSAhMSAmJiAodGhpcy5faXNPcGVuID0gITEsIHRoaXMuX2ZvY3VzZWRFbGVtZW50ID0gbnVsbCwgdGhpcy5fZGVzdHJveU92ZXJsYXkoKSwgdGhpcy5fdW50cmFja0luc3RhbmNlKCksIHRoaXMub3BlbmVyLmZpbHRlcigiOmZvY3VzYWJsZSIpLnRyaWdnZXIoImZvY3VzIikubGVuZ3RoIHx8IGUudWkuc2FmZUJsdXIoZS51aS5zYWZlQWN0aXZlRWxlbWVudCh0aGlzLmRvY3VtZW50WzBdKSksIHRoaXMuX2hpZGUodGhpcy51aURpYWxvZywgdGhpcy5vcHRpb25zLmhpZGUsIGZ1bmN0aW9uICgpIHsgaS5fdHJpZ2dlcigiY2xvc2UiLCB0KSB9KSkgfSwgaXNPcGVuOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9pc09wZW4gfSwgbW92ZVRvVG9wOiBmdW5jdGlvbiAoKSB7IHRoaXMuX21vdmVUb1RvcCgpIH0sIF9tb3ZlVG9Ub3A6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gITEsIGEgPSB0aGlzLnVpRGlhbG9nLnNpYmxpbmdzKCIudWktZnJvbnQ6dmlzaWJsZSIpLm1hcChmdW5jdGlvbiAoKSB7IHJldHVybiArZSh0aGlzKS5jc3MoInotaW5kZXgiKSB9KS5nZXQoKSwgbiA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGEpOyByZXR1cm4gbiA+PSArdGhpcy51aURpYWxvZy5jc3MoInotaW5kZXgiKSAmJiAodGhpcy51aURpYWxvZy5jc3MoInotaW5kZXgiLCBuICsgMSksIHMgPSAhMCksIHMgJiYgIWkgJiYgdGhpcy5fdHJpZ2dlcigiZm9jdXMiLCB0KSwgcyB9LCBvcGVuOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpczsgcmV0dXJuIHRoaXMuX2lzT3BlbiA/ICh0aGlzLl9tb3ZlVG9Ub3AoKSAmJiB0aGlzLl9mb2N1c1RhYmJhYmxlKCksIHZvaWQgMCkgOiAodGhpcy5faXNPcGVuID0gITAsIHRoaXMub3BlbmVyID0gZShlLnVpLnNhZmVBY3RpdmVFbGVtZW50KHRoaXMuZG9jdW1lbnRbMF0pKSwgdGhpcy5fc2l6ZSgpLCB0aGlzLl9wb3NpdGlvbigpLCB0aGlzLl9jcmVhdGVPdmVybGF5KCksIHRoaXMuX21vdmVUb1RvcChudWxsLCAhMCksIHRoaXMub3ZlcmxheSAmJiB0aGlzLm92ZXJsYXkuY3NzKCJ6LWluZGV4IiwgdGhpcy51aURpYWxvZy5jc3MoInotaW5kZXgiKSAtIDEpLCB0aGlzLl9zaG93KHRoaXMudWlEaWFsb2csIHRoaXMub3B0aW9ucy5zaG93LCBmdW5jdGlvbiAoKSB7IHQuX2ZvY3VzVGFiYmFibGUoKSwgdC5fdHJpZ2dlcigiZm9jdXMiKSB9KSwgdGhpcy5fbWFrZUZvY3VzVGFyZ2V0KCksIHRoaXMuX3RyaWdnZXIoIm9wZW4iKSwgdm9pZCAwKSB9LCBfZm9jdXNUYWJiYWJsZTogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuX2ZvY3VzZWRFbGVtZW50OyBlIHx8IChlID0gdGhpcy5lbGVtZW50LmZpbmQoIlthdXRvZm9jdXNdIikpLCBlLmxlbmd0aCB8fCAoZSA9IHRoaXMuZWxlbWVudC5maW5kKCI6dGFiYmFibGUiKSksIGUubGVuZ3RoIHx8IChlID0gdGhpcy51aURpYWxvZ0J1dHRvblBhbmUuZmluZCgiOnRhYmJhYmxlIikpLCBlLmxlbmd0aCB8fCAoZSA9IHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLmZpbHRlcigiOnRhYmJhYmxlIikpLCBlLmxlbmd0aCB8fCAoZSA9IHRoaXMudWlEaWFsb2cpLCBlLmVxKDApLnRyaWdnZXIoImZvY3VzIikgfSwgX2tlZXBGb2N1czogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gaSgpIHsgdmFyIHQgPSBlLnVpLnNhZmVBY3RpdmVFbGVtZW50KHRoaXMuZG9jdW1lbnRbMF0pLCBpID0gdGhpcy51aURpYWxvZ1swXSA9PT0gdCB8fCBlLmNvbnRhaW5zKHRoaXMudWlEaWFsb2dbMF0sIHQpOyBpIHx8IHRoaXMuX2ZvY3VzVGFiYmFibGUoKSB9IHQucHJldmVudERlZmF1bHQoKSwgaS5jYWxsKHRoaXMpLCB0aGlzLl9kZWxheShpKSB9LCBfY3JlYXRlV3JhcHBlcjogZnVuY3Rpb24gKCkgeyB0aGlzLnVpRGlhbG9nID0gZSgiPGRpdj4iKS5oaWRlKCkuYXR0cih7IHRhYkluZGV4OiAtMSwgcm9sZTogImRpYWxvZyIgfSkuYXBwZW5kVG8odGhpcy5fYXBwZW5kVG8oKSksIHRoaXMuX2FkZENsYXNzKHRoaXMudWlEaWFsb2csICJ1aS1kaWFsb2ciLCAidWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWZyb250IiksIHRoaXMuX29uKHRoaXMudWlEaWFsb2csIHsga2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgaWYgKHRoaXMub3B0aW9ucy5jbG9zZU9uRXNjYXBlICYmICF0LmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIHQua2V5Q29kZSAmJiB0LmtleUNvZGUgPT09IGUudWkua2V5Q29kZS5FU0NBUEUpIHJldHVybiB0LnByZXZlbnREZWZhdWx0KCksIHRoaXMuY2xvc2UodCksIHZvaWQgMDsgaWYgKHQua2V5Q29kZSA9PT0gZS51aS5rZXlDb2RlLlRBQiAmJiAhdC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgeyB2YXIgaSA9IHRoaXMudWlEaWFsb2cuZmluZCgiOnRhYmJhYmxlIiksIHMgPSBpLmZpbHRlcigiOmZpcnN0IiksIGEgPSBpLmZpbHRlcigiOmxhc3QiKTsgdC50YXJnZXQgIT09IGFbMF0gJiYgdC50YXJnZXQgIT09IHRoaXMudWlEaWFsb2dbMF0gfHwgdC5zaGlmdEtleSA/IHQudGFyZ2V0ICE9PSBzWzBdICYmIHQudGFyZ2V0ICE9PSB0aGlzLnVpRGlhbG9nWzBdIHx8ICF0LnNoaWZ0S2V5IHx8ICh0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IGEudHJpZ2dlcigiZm9jdXMiKSB9KSwgdC5wcmV2ZW50RGVmYXVsdCgpKSA6ICh0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHMudHJpZ2dlcigiZm9jdXMiKSB9KSwgdC5wcmV2ZW50RGVmYXVsdCgpKSB9IH0sIG1vdXNlZG93bjogZnVuY3Rpb24gKGUpIHsgdGhpcy5fbW92ZVRvVG9wKGUpICYmIHRoaXMuX2ZvY3VzVGFiYmFibGUoKSB9IH0pLCB0aGlzLmVsZW1lbnQuZmluZCgiW2FyaWEtZGVzY3JpYmVkYnldIikubGVuZ3RoIHx8IHRoaXMudWlEaWFsb2cuYXR0cih7ICJhcmlhLWRlc2NyaWJlZGJ5IjogdGhpcy5lbGVtZW50LnVuaXF1ZUlkKCkuYXR0cigiaWQiKSB9KSB9LCBfY3JlYXRlVGl0bGViYXI6IGZ1bmN0aW9uICgpIHsgdmFyIHQ7IHRoaXMudWlEaWFsb2dUaXRsZWJhciA9IGUoIjxkaXY+IiksIHRoaXMuX2FkZENsYXNzKHRoaXMudWlEaWFsb2dUaXRsZWJhciwgInVpLWRpYWxvZy10aXRsZWJhciIsICJ1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCIpLCB0aGlzLl9vbih0aGlzLnVpRGlhbG9nVGl0bGViYXIsIHsgbW91c2Vkb3duOiBmdW5jdGlvbiAodCkgeyBlKHQudGFyZ2V0KS5jbG9zZXN0KCIudWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIikgfHwgdGhpcy51aURpYWxvZy50cmlnZ2VyKCJmb2N1cyIpIH0gfSksIHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlID0gZSgiPGJ1dHRvbiB0eXBlPSdidXR0b24nPjwvYnV0dG9uPiIpLmJ1dHRvbih7IGxhYmVsOiBlKCI8YT4iKS50ZXh0KHRoaXMub3B0aW9ucy5jbG9zZVRleHQpLmh0bWwoKSwgaWNvbjogInVpLWljb24tY2xvc2V0aGljayIsIHNob3dMYWJlbDogITEgfSkuYXBwZW5kVG8odGhpcy51aURpYWxvZ1RpdGxlYmFyKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UsICJ1aS1kaWFsb2ctdGl0bGViYXItY2xvc2UiKSwgdGhpcy5fb24odGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UsIHsgY2xpY2s6IGZ1bmN0aW9uIChlKSB7IGUucHJldmVudERlZmF1bHQoKSwgdGhpcy5jbG9zZShlKSB9IH0pLCB0ID0gZSgiPHNwYW4+IikudW5pcXVlSWQoKS5wcmVwZW5kVG8odGhpcy51aURpYWxvZ1RpdGxlYmFyKSwgdGhpcy5fYWRkQ2xhc3ModCwgInVpLWRpYWxvZy10aXRsZSIpLCB0aGlzLl90aXRsZSh0KSwgdGhpcy51aURpYWxvZ1RpdGxlYmFyLnByZXBlbmRUbyh0aGlzLnVpRGlhbG9nKSwgdGhpcy51aURpYWxvZy5hdHRyKHsgImFyaWEtbGFiZWxsZWRieSI6IHQuYXR0cigiaWQiKSB9KSB9LCBfdGl0bGU6IGZ1bmN0aW9uIChlKSB7IHRoaXMub3B0aW9ucy50aXRsZSA/IGUudGV4dCh0aGlzLm9wdGlvbnMudGl0bGUpIDogZS5odG1sKCImIzE2MDsiKSB9LCBfY3JlYXRlQnV0dG9uUGFuZTogZnVuY3Rpb24gKCkgeyB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZSA9IGUoIjxkaXY+IiksIHRoaXMuX2FkZENsYXNzKHRoaXMudWlEaWFsb2dCdXR0b25QYW5lLCAidWktZGlhbG9nLWJ1dHRvbnBhbmUiLCAidWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IiksIHRoaXMudWlCdXR0b25TZXQgPSBlKCI8ZGl2PiIpLmFwcGVuZFRvKHRoaXMudWlEaWFsb2dCdXR0b25QYW5lKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy51aUJ1dHRvblNldCwgInVpLWRpYWxvZy1idXR0b25zZXQiKSwgdGhpcy5fY3JlYXRlQnV0dG9ucygpIH0sIF9jcmVhdGVCdXR0b25zOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgaSA9IHRoaXMub3B0aW9ucy5idXR0b25zOyByZXR1cm4gdGhpcy51aURpYWxvZ0J1dHRvblBhbmUucmVtb3ZlKCksIHRoaXMudWlCdXR0b25TZXQuZW1wdHkoKSwgZS5pc0VtcHR5T2JqZWN0KGkpIHx8IGUuaXNBcnJheShpKSAmJiAhaS5sZW5ndGggPyAodGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy51aURpYWxvZywgInVpLWRpYWxvZy1idXR0b25zIiksIHZvaWQgMCkgOiAoZS5lYWNoKGksIGZ1bmN0aW9uIChpLCBzKSB7IHZhciBhLCBuOyBzID0gZS5pc0Z1bmN0aW9uKHMpID8geyBjbGljazogcywgdGV4dDogaSB9IDogcywgcyA9IGUuZXh0ZW5kKHsgdHlwZTogImJ1dHRvbiIgfSwgcyksIGEgPSBzLmNsaWNrLCBuID0geyBpY29uOiBzLmljb24sIGljb25Qb3NpdGlvbjogcy5pY29uUG9zaXRpb24sIHNob3dMYWJlbDogcy5zaG93TGFiZWwsIGljb25zOiBzLmljb25zLCB0ZXh0OiBzLnRleHQgfSwgZGVsZXRlIHMuY2xpY2ssIGRlbGV0ZSBzLmljb24sIGRlbGV0ZSBzLmljb25Qb3NpdGlvbiwgZGVsZXRlIHMuc2hvd0xhYmVsLCBkZWxldGUgcy5pY29ucywgImJvb2xlYW4iID09IHR5cGVvZiBzLnRleHQgJiYgZGVsZXRlIHMudGV4dCwgZSgiPGJ1dHRvbj48L2J1dHRvbj4iLCBzKS5idXR0b24obikuYXBwZW5kVG8odC51aUJ1dHRvblNldCkub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgeyBhLmFwcGx5KHQuZWxlbWVudFswXSwgYXJndW1lbnRzKSB9KSB9KSwgdGhpcy5fYWRkQ2xhc3ModGhpcy51aURpYWxvZywgInVpLWRpYWxvZy1idXR0b25zIiksIHRoaXMudWlEaWFsb2dCdXR0b25QYW5lLmFwcGVuZFRvKHRoaXMudWlEaWFsb2cpLCB2b2lkIDApIH0sIF9tYWtlRHJhZ2dhYmxlOiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQoZSkgeyByZXR1cm4geyBwb3NpdGlvbjogZS5wb3NpdGlvbiwgb2Zmc2V0OiBlLm9mZnNldCB9IH0gdmFyIGkgPSB0aGlzLCBzID0gdGhpcy5vcHRpb25zOyB0aGlzLnVpRGlhbG9nLmRyYWdnYWJsZSh7IGNhbmNlbDogIi51aS1kaWFsb2ctY29udGVudCwgLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIsIGhhbmRsZTogIi51aS1kaWFsb2ctdGl0bGViYXIiLCBjb250YWlubWVudDogImRvY3VtZW50Iiwgc3RhcnQ6IGZ1bmN0aW9uIChzLCBhKSB7IGkuX2FkZENsYXNzKGUodGhpcyksICJ1aS1kaWFsb2ctZHJhZ2dpbmciKSwgaS5fYmxvY2tGcmFtZXMoKSwgaS5fdHJpZ2dlcigiZHJhZ1N0YXJ0IiwgcywgdChhKSkgfSwgZHJhZzogZnVuY3Rpb24gKGUsIHMpIHsgaS5fdHJpZ2dlcigiZHJhZyIsIGUsIHQocykpIH0sIHN0b3A6IGZ1bmN0aW9uIChhLCBuKSB7IHZhciByID0gbi5vZmZzZXQubGVmdCAtIGkuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLCBvID0gbi5vZmZzZXQudG9wIC0gaS5kb2N1bWVudC5zY3JvbGxUb3AoKTsgcy5wb3NpdGlvbiA9IHsgbXk6ICJsZWZ0IHRvcCIsIGF0OiAibGVmdCIgKyAociA+PSAwID8gIisiIDogIiIpICsgciArICIgIiArICJ0b3AiICsgKG8gPj0gMCA/ICIrIiA6ICIiKSArIG8sIG9mOiBpLndpbmRvdyB9LCBpLl9yZW1vdmVDbGFzcyhlKHRoaXMpLCAidWktZGlhbG9nLWRyYWdnaW5nIiksIGkuX3VuYmxvY2tGcmFtZXMoKSwgaS5fdHJpZ2dlcigiZHJhZ1N0b3AiLCBhLCB0KG4pKSB9IH0pIH0sIF9tYWtlUmVzaXphYmxlOiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQoZSkgeyByZXR1cm4geyBvcmlnaW5hbFBvc2l0aW9uOiBlLm9yaWdpbmFsUG9zaXRpb24sIG9yaWdpbmFsU2l6ZTogZS5vcmlnaW5hbFNpemUsIHBvc2l0aW9uOiBlLnBvc2l0aW9uLCBzaXplOiBlLnNpemUgfSB9IHZhciBpID0gdGhpcywgcyA9IHRoaXMub3B0aW9ucywgYSA9IHMucmVzaXphYmxlLCBuID0gdGhpcy51aURpYWxvZy5jc3MoInBvc2l0aW9uIiksIHIgPSAic3RyaW5nIiA9PSB0eXBlb2YgYSA/IGEgOiAibixlLHMsdyxzZSxzdyxuZSxudyI7IHRoaXMudWlEaWFsb2cucmVzaXphYmxlKHsgY2FuY2VsOiAiLnVpLWRpYWxvZy1jb250ZW50IiwgY29udGFpbm1lbnQ6ICJkb2N1bWVudCIsIGFsc29SZXNpemU6IHRoaXMuZWxlbWVudCwgbWF4V2lkdGg6IHMubWF4V2lkdGgsIG1heEhlaWdodDogcy5tYXhIZWlnaHQsIG1pbldpZHRoOiBzLm1pbldpZHRoLCBtaW5IZWlnaHQ6IHRoaXMuX21pbkhlaWdodCgpLCBoYW5kbGVzOiByLCBzdGFydDogZnVuY3Rpb24gKHMsIGEpIHsgaS5fYWRkQ2xhc3MoZSh0aGlzKSwgInVpLWRpYWxvZy1yZXNpemluZyIpLCBpLl9ibG9ja0ZyYW1lcygpLCBpLl90cmlnZ2VyKCJyZXNpemVTdGFydCIsIHMsIHQoYSkpIH0sIHJlc2l6ZTogZnVuY3Rpb24gKGUsIHMpIHsgaS5fdHJpZ2dlcigicmVzaXplIiwgZSwgdChzKSkgfSwgc3RvcDogZnVuY3Rpb24gKGEsIG4pIHsgdmFyIHIgPSBpLnVpRGlhbG9nLm9mZnNldCgpLCBvID0gci5sZWZ0IC0gaS5kb2N1bWVudC5zY3JvbGxMZWZ0KCksIGwgPSByLnRvcCAtIGkuZG9jdW1lbnQuc2Nyb2xsVG9wKCk7IHMuaGVpZ2h0ID0gaS51aURpYWxvZy5oZWlnaHQoKSwgcy53aWR0aCA9IGkudWlEaWFsb2cud2lkdGgoKSwgcy5wb3NpdGlvbiA9IHsgbXk6ICJsZWZ0IHRvcCIsIGF0OiAibGVmdCIgKyAobyA+PSAwID8gIisiIDogIiIpICsgbyArICIgIiArICJ0b3AiICsgKGwgPj0gMCA/ICIrIiA6ICIiKSArIGwsIG9mOiBpLndpbmRvdyB9LCBpLl9yZW1vdmVDbGFzcyhlKHRoaXMpLCAidWktZGlhbG9nLXJlc2l6aW5nIiksIGkuX3VuYmxvY2tGcmFtZXMoKSwgaS5fdHJpZ2dlcigicmVzaXplU3RvcCIsIGEsIHQobikpIH0gfSkuY3NzKCJwb3NpdGlvbiIsIG4pIH0sIF90cmFja0ZvY3VzOiBmdW5jdGlvbiAoKSB7IHRoaXMuX29uKHRoaXMud2lkZ2V0KCksIHsgZm9jdXNpbjogZnVuY3Rpb24gKHQpIHsgdGhpcy5fbWFrZUZvY3VzVGFyZ2V0KCksIHRoaXMuX2ZvY3VzZWRFbGVtZW50ID0gZSh0LnRhcmdldCkgfSB9KSB9LCBfbWFrZUZvY3VzVGFyZ2V0OiBmdW5jdGlvbiAoKSB7IHRoaXMuX3VudHJhY2tJbnN0YW5jZSgpLCB0aGlzLl90cmFja2luZ0luc3RhbmNlcygpLnVuc2hpZnQodGhpcykgfSwgX3VudHJhY2tJbnN0YW5jZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuX3RyYWNraW5nSW5zdGFuY2VzKCksIGkgPSBlLmluQXJyYXkodGhpcywgdCk7IC0xICE9PSBpICYmIHQuc3BsaWNlKGksIDEpIH0sIF90cmFja2luZ0luc3RhbmNlczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuZG9jdW1lbnQuZGF0YSgidWktZGlhbG9nLWluc3RhbmNlcyIpOyByZXR1cm4gZSB8fCAoZSA9IFtdLCB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1pbnN0YW5jZXMiLCBlKSksIGUgfSwgX21pbkhlaWdodDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMub3B0aW9uczsgcmV0dXJuICJhdXRvIiA9PT0gZS5oZWlnaHQgPyBlLm1pbkhlaWdodCA6IE1hdGgubWluKGUubWluSGVpZ2h0LCBlLmhlaWdodCkgfSwgX3Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKTsgZSB8fCB0aGlzLnVpRGlhbG9nLnNob3coKSwgdGhpcy51aURpYWxvZy5wb3NpdGlvbih0aGlzLm9wdGlvbnMucG9zaXRpb24pLCBlIHx8IHRoaXMudWlEaWFsb2cuaGlkZSgpIH0sIF9zZXRPcHRpb25zOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMsIHMgPSAhMSwgYSA9IHt9OyBlLmVhY2godCwgZnVuY3Rpb24gKGUsIHQpIHsgaS5fc2V0T3B0aW9uKGUsIHQpLCBlIGluIGkuc2l6ZVJlbGF0ZWRPcHRpb25zICYmIChzID0gITApLCBlIGluIGkucmVzaXphYmxlUmVsYXRlZE9wdGlvbnMgJiYgKGFbZV0gPSB0KSB9KSwgcyAmJiAodGhpcy5fc2l6ZSgpLCB0aGlzLl9wb3NpdGlvbigpKSwgdGhpcy51aURpYWxvZy5pcygiOmRhdGEodWktcmVzaXphYmxlKSIpICYmIHRoaXMudWlEaWFsb2cucmVzaXphYmxlKCJvcHRpb24iLCBhKSB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSwgbiA9IHRoaXMudWlEaWFsb2c7ICJkaXNhYmxlZCIgIT09IHQgJiYgKHRoaXMuX3N1cGVyKHQsIGkpLCAiYXBwZW5kVG8iID09PSB0ICYmIHRoaXMudWlEaWFsb2cuYXBwZW5kVG8odGhpcy5fYXBwZW5kVG8oKSksICJidXR0b25zIiA9PT0gdCAmJiB0aGlzLl9jcmVhdGVCdXR0b25zKCksICJjbG9zZVRleHQiID09PSB0ICYmIHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLmJ1dHRvbih7IGxhYmVsOiBlKCI8YT4iKS50ZXh0KCIiICsgdGhpcy5vcHRpb25zLmNsb3NlVGV4dCkuaHRtbCgpIH0pLCAiZHJhZ2dhYmxlIiA9PT0gdCAmJiAocyA9IG4uaXMoIjpkYXRhKHVpLWRyYWdnYWJsZSkiKSwgcyAmJiAhaSAmJiBuLmRyYWdnYWJsZSgiZGVzdHJveSIpLCAhcyAmJiBpICYmIHRoaXMuX21ha2VEcmFnZ2FibGUoKSksICJwb3NpdGlvbiIgPT09IHQgJiYgdGhpcy5fcG9zaXRpb24oKSwgInJlc2l6YWJsZSIgPT09IHQgJiYgKGEgPSBuLmlzKCI6ZGF0YSh1aS1yZXNpemFibGUpIiksIGEgJiYgIWkgJiYgbi5yZXNpemFibGUoImRlc3Ryb3kiKSwgYSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgaSAmJiBuLnJlc2l6YWJsZSgib3B0aW9uIiwgImhhbmRsZXMiLCBpKSwgYSB8fCBpID09PSAhMSB8fCB0aGlzLl9tYWtlUmVzaXphYmxlKCkpLCAidGl0bGUiID09PSB0ICYmIHRoaXMuX3RpdGxlKHRoaXMudWlEaWFsb2dUaXRsZWJhci5maW5kKCIudWktZGlhbG9nLXRpdGxlIikpKSB9LCBfc2l6ZTogZnVuY3Rpb24gKCkgeyB2YXIgZSwgdCwgaSwgcyA9IHRoaXMub3B0aW9uczsgdGhpcy5lbGVtZW50LnNob3coKS5jc3MoeyB3aWR0aDogImF1dG8iLCBtaW5IZWlnaHQ6IDAsIG1heEhlaWdodDogIm5vbmUiLCBoZWlnaHQ6IDAgfSksIHMubWluV2lkdGggPiBzLndpZHRoICYmIChzLndpZHRoID0gcy5taW5XaWR0aCksIGUgPSB0aGlzLnVpRGlhbG9nLmNzcyh7IGhlaWdodDogImF1dG8iLCB3aWR0aDogcy53aWR0aCB9KS5vdXRlckhlaWdodCgpLCB0ID0gTWF0aC5tYXgoMCwgcy5taW5IZWlnaHQgLSBlKSwgaSA9ICJudW1iZXIiID09IHR5cGVvZiBzLm1heEhlaWdodCA/IE1hdGgubWF4KDAsIHMubWF4SGVpZ2h0IC0gZSkgOiAibm9uZSIsICJhdXRvIiA9PT0gcy5oZWlnaHQgPyB0aGlzLmVsZW1lbnQuY3NzKHsgbWluSGVpZ2h0OiB0LCBtYXhIZWlnaHQ6IGksIGhlaWdodDogImF1dG8iIH0pIDogdGhpcy5lbGVtZW50LmhlaWdodChNYXRoLm1heCgwLCBzLmhlaWdodCAtIGUpKSwgdGhpcy51aURpYWxvZy5pcygiOmRhdGEodWktcmVzaXphYmxlKSIpICYmIHRoaXMudWlEaWFsb2cucmVzaXphYmxlKCJvcHRpb24iLCAibWluSGVpZ2h0IiwgdGhpcy5fbWluSGVpZ2h0KCkpIH0sIF9ibG9ja0ZyYW1lczogZnVuY3Rpb24gKCkgeyB0aGlzLmlmcmFtZUJsb2NrcyA9IHRoaXMuZG9jdW1lbnQuZmluZCgiaWZyYW1lIikubWFwKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpOyByZXR1cm4gZSgiPGRpdj4iKS5jc3MoeyBwb3NpdGlvbjogImFic29sdXRlIiwgd2lkdGg6IHQub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6IHQub3V0ZXJIZWlnaHQoKSB9KS5hcHBlbmRUbyh0LnBhcmVudCgpKS5vZmZzZXQodC5vZmZzZXQoKSlbMF0gfSkgfSwgX3VuYmxvY2tGcmFtZXM6IGZ1bmN0aW9uICgpIHsgdGhpcy5pZnJhbWVCbG9ja3MgJiYgKHRoaXMuaWZyYW1lQmxvY2tzLnJlbW92ZSgpLCBkZWxldGUgdGhpcy5pZnJhbWVCbG9ja3MpIH0sIF9hbGxvd0ludGVyYWN0aW9uOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gZSh0LnRhcmdldCkuY2xvc2VzdCgiLnVpLWRpYWxvZyIpLmxlbmd0aCA/ICEwIDogISFlKHQudGFyZ2V0KS5jbG9zZXN0KCIudWktZGF0ZXBpY2tlciIpLmxlbmd0aCB9LCBfY3JlYXRlT3ZlcmxheTogZnVuY3Rpb24gKCkgeyBpZiAodGhpcy5vcHRpb25zLm1vZGFsKSB7IHZhciB0ID0gITA7IHRoaXMuX2RlbGF5KGZ1bmN0aW9uICgpIHsgdCA9ICExIH0pLCB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIpIHx8IHRoaXMuX29uKHRoaXMuZG9jdW1lbnQsIHsgZm9jdXNpbjogZnVuY3Rpb24gKGUpIHsgdCB8fCB0aGlzLl9hbGxvd0ludGVyYWN0aW9uKGUpIHx8IChlLnByZXZlbnREZWZhdWx0KCksIHRoaXMuX3RyYWNraW5nSW5zdGFuY2VzKClbMF0uX2ZvY3VzVGFiYmFibGUoKSkgfSB9KSwgdGhpcy5vdmVybGF5ID0gZSgiPGRpdj4iKS5hcHBlbmRUbyh0aGlzLl9hcHBlbmRUbygpKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5vdmVybGF5LCBudWxsLCAidWktd2lkZ2V0LW92ZXJsYXkgdWktZnJvbnQiKSwgdGhpcy5fb24odGhpcy5vdmVybGF5LCB7IG1vdXNlZG93bjogIl9rZWVwRm9jdXMiIH0pLCB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIsICh0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIpIHx8IDApICsgMSkgfSB9LCBfZGVzdHJveU92ZXJsYXk6IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMub3B0aW9ucy5tb2RhbCAmJiB0aGlzLm92ZXJsYXkpIHsgdmFyIGUgPSB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIpIC0gMTsgZSA/IHRoaXMuZG9jdW1lbnQuZGF0YSgidWktZGlhbG9nLW92ZXJsYXlzIiwgZSkgOiAodGhpcy5fb2ZmKHRoaXMuZG9jdW1lbnQsICJmb2N1c2luIiksIHRoaXMuZG9jdW1lbnQucmVtb3ZlRGF0YSgidWktZGlhbG9nLW92ZXJsYXlzIikpLCB0aGlzLm92ZXJsYXkucmVtb3ZlKCksIHRoaXMub3ZlcmxheSA9IG51bGwgfSB9IH0pLCBlLnVpQmFja0NvbXBhdCAhPT0gITEgJiYgZS53aWRnZXQoInVpLmRpYWxvZyIsIGUudWkuZGlhbG9nLCB7IG9wdGlvbnM6IHsgZGlhbG9nQ2xhc3M6ICIiIH0sIF9jcmVhdGVXcmFwcGVyOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3N1cGVyKCksIHRoaXMudWlEaWFsb2cuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmRpYWxvZ0NsYXNzKSB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyAiZGlhbG9nQ2xhc3MiID09PSBlICYmIHRoaXMudWlEaWFsb2cucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmRpYWxvZ0NsYXNzKS5hZGRDbGFzcyh0KSwgdGhpcy5fc3VwZXJBcHBseShhcmd1bWVudHMpIH0gfSksIGUudWkuZGlhbG9nLCBlLndpZGdldCgidWkucHJvZ3Jlc3NiYXIiLCB7IHZlcnNpb246ICIxLjEyLjEiLCBvcHRpb25zOiB7IGNsYXNzZXM6IHsgInVpLXByb2dyZXNzYmFyIjogInVpLWNvcm5lci1hbGwiLCAidWktcHJvZ3Jlc3NiYXItdmFsdWUiOiAidWktY29ybmVyLWxlZnQiLCAidWktcHJvZ3Jlc3NiYXItY29tcGxldGUiOiAidWktY29ybmVyLXJpZ2h0IiB9LCBtYXg6IDEwMCwgdmFsdWU6IDAsIGNoYW5nZTogbnVsbCwgY29tcGxldGU6IG51bGwgfSwgbWluOiAwLCBfY3JlYXRlOiBmdW5jdGlvbiAoKSB7IHRoaXMub2xkVmFsdWUgPSB0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl9jb25zdHJhaW5lZFZhbHVlKCksIHRoaXMuZWxlbWVudC5hdHRyKHsgcm9sZTogInByb2dyZXNzYmFyIiwgImFyaWEtdmFsdWVtaW4iOiB0aGlzLm1pbiB9KSwgdGhpcy5fYWRkQ2xhc3MoInVpLXByb2dyZXNzYmFyIiwgInVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCIpLCB0aGlzLnZhbHVlRGl2ID0gZSgiPGRpdj4iKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLnZhbHVlRGl2LCAidWktcHJvZ3Jlc3NiYXItdmFsdWUiLCAidWktd2lkZ2V0LWhlYWRlciIpLCB0aGlzLl9yZWZyZXNoVmFsdWUoKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigicm9sZSBhcmlhLXZhbHVlbWluIGFyaWEtdmFsdWVtYXggYXJpYS12YWx1ZW5vdyIpLCB0aGlzLnZhbHVlRGl2LnJlbW92ZSgpIH0sIHZhbHVlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwID09PSBlID8gdGhpcy5vcHRpb25zLnZhbHVlIDogKHRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX2NvbnN0cmFpbmVkVmFsdWUoZSksIHRoaXMuX3JlZnJlc2hWYWx1ZSgpLCB2b2lkIDApIH0sIF9jb25zdHJhaW5lZFZhbHVlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gdGhpcy5vcHRpb25zLnZhbHVlKSwgdGhpcy5pbmRldGVybWluYXRlID0gZSA9PT0gITEsICJudW1iZXIiICE9IHR5cGVvZiBlICYmIChlID0gMCksIHRoaXMuaW5kZXRlcm1pbmF0ZSA/ICExIDogTWF0aC5taW4odGhpcy5vcHRpb25zLm1heCwgTWF0aC5tYXgodGhpcy5taW4sIGUpKSB9LCBfc2V0T3B0aW9uczogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnZhbHVlOyBkZWxldGUgZS52YWx1ZSwgdGhpcy5fc3VwZXIoZSksIHRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX2NvbnN0cmFpbmVkVmFsdWUodCksIHRoaXMuX3JlZnJlc2hWYWx1ZSgpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7ICJtYXgiID09PSBlICYmICh0ID0gTWF0aC5tYXgodGhpcy5taW4sIHQpKSwgdGhpcy5fc3VwZXIoZSwgdCkgfSwgX3NldE9wdGlvbkRpc2FibGVkOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zdXBlcihlKSwgdGhpcy5lbGVtZW50LmF0dHIoImFyaWEtZGlzYWJsZWQiLCBlKSwgdGhpcy5fdG9nZ2xlQ2xhc3MobnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiwgISFlKSB9LCBfcGVyY2VudGFnZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5pbmRldGVybWluYXRlID8gMTAwIDogMTAwICogKHRoaXMub3B0aW9ucy52YWx1ZSAtIHRoaXMubWluKSAvICh0aGlzLm9wdGlvbnMubWF4IC0gdGhpcy5taW4pIH0sIF9yZWZyZXNoVmFsdWU6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLm9wdGlvbnMudmFsdWUsIGkgPSB0aGlzLl9wZXJjZW50YWdlKCk7IHRoaXMudmFsdWVEaXYudG9nZ2xlKHRoaXMuaW5kZXRlcm1pbmF0ZSB8fCB0ID4gdGhpcy5taW4pLndpZHRoKGkudG9GaXhlZCgwKSArICIlIiksIHRoaXMuX3RvZ2dsZUNsYXNzKHRoaXMudmFsdWVEaXYsICJ1aS1wcm9ncmVzc2Jhci1jb21wbGV0ZSIsIG51bGwsIHQgPT09IHRoaXMub3B0aW9ucy5tYXgpLl90b2dnbGVDbGFzcygidWktcHJvZ3Jlc3NiYXItaW5kZXRlcm1pbmF0ZSIsIG51bGwsIHRoaXMuaW5kZXRlcm1pbmF0ZSksIHRoaXMuaW5kZXRlcm1pbmF0ZSA/ICh0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW5vdyIpLCB0aGlzLm92ZXJsYXlEaXYgfHwgKHRoaXMub3ZlcmxheURpdiA9IGUoIjxkaXY+IikuYXBwZW5kVG8odGhpcy52YWx1ZURpdiksIHRoaXMuX2FkZENsYXNzKHRoaXMub3ZlcmxheURpdiwgInVpLXByb2dyZXNzYmFyLW92ZXJsYXkiKSkpIDogKHRoaXMuZWxlbWVudC5hdHRyKHsgImFyaWEtdmFsdWVtYXgiOiB0aGlzLm9wdGlvbnMubWF4LCAiYXJpYS12YWx1ZW5vdyI6IHQgfSksIHRoaXMub3ZlcmxheURpdiAmJiAodGhpcy5vdmVybGF5RGl2LnJlbW92ZSgpLCB0aGlzLm92ZXJsYXlEaXYgPSBudWxsKSksIHRoaXMub2xkVmFsdWUgIT09IHQgJiYgKHRoaXMub2xkVmFsdWUgPSB0LCB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiKSksIHQgPT09IHRoaXMub3B0aW9ucy5tYXggJiYgdGhpcy5fdHJpZ2dlcigiY29tcGxldGUiKSB9IH0pLCBlLndpZGdldCgidWkuc2VsZWN0bWVudSIsIFtlLnVpLmZvcm1SZXNldE1peGluLCB7IHZlcnNpb246ICIxLjEyLjEiLCBkZWZhdWx0RWxlbWVudDogIjxzZWxlY3Q+Iiwgb3B0aW9uczogeyBhcHBlbmRUbzogbnVsbCwgY2xhc3NlczogeyAidWktc2VsZWN0bWVudS1idXR0b24tb3BlbiI6ICJ1aS1jb3JuZXItdG9wIiwgInVpLXNlbGVjdG1lbnUtYnV0dG9uLWNsb3NlZCI6ICJ1aS1jb3JuZXItYWxsIiB9LCBkaXNhYmxlZDogbnVsbCwgaWNvbnM6IHsgYnV0dG9uOiAidWktaWNvbi10cmlhbmdsZS0xLXMiIH0sIHBvc2l0aW9uOiB7IG15OiAibGVmdCB0b3AiLCBhdDogImxlZnQgYm90dG9tIiwgY29sbGlzaW9uOiAibm9uZSIgfSwgd2lkdGg6ICExLCBjaGFuZ2U6IG51bGwsIGNsb3NlOiBudWxsLCBmb2N1czogbnVsbCwgb3BlbjogbnVsbCwgc2VsZWN0OiBudWxsIH0sIF9jcmVhdGU6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmVsZW1lbnQudW5pcXVlSWQoKS5hdHRyKCJpZCIpOyB0aGlzLmlkcyA9IHsgZWxlbWVudDogdCwgYnV0dG9uOiB0ICsgIi1idXR0b24iLCBtZW51OiB0ICsgIi1tZW51IiB9LCB0aGlzLl9kcmF3QnV0dG9uKCksIHRoaXMuX2RyYXdNZW51KCksIHRoaXMuX2JpbmRGb3JtUmVzZXRIYW5kbGVyKCksIHRoaXMuX3JlbmRlcmVkID0gITEsIHRoaXMubWVudUl0ZW1zID0gZSgpIH0sIF9kcmF3QnV0dG9uOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpID0gdGhpcywgcyA9IHRoaXMuX3BhcnNlT3B0aW9uKHRoaXMuZWxlbWVudC5maW5kKCJvcHRpb246c2VsZWN0ZWQiKSwgdGhpcy5lbGVtZW50WzBdLnNlbGVjdGVkSW5kZXgpOyB0aGlzLmxhYmVscyA9IHRoaXMuZWxlbWVudC5sYWJlbHMoKS5hdHRyKCJmb3IiLCB0aGlzLmlkcy5idXR0b24pLCB0aGlzLl9vbih0aGlzLmxhYmVscywgeyBjbGljazogZnVuY3Rpb24gKGUpIHsgdGhpcy5idXR0b24uZm9jdXMoKSwgZS5wcmV2ZW50RGVmYXVsdCgpIH0gfSksIHRoaXMuZWxlbWVudC5oaWRlKCksIHRoaXMuYnV0dG9uID0gZSgiPHNwYW4+IiwgeyB0YWJpbmRleDogdGhpcy5vcHRpb25zLmRpc2FibGVkID8gLTEgOiAwLCBpZDogdGhpcy5pZHMuYnV0dG9uLCByb2xlOiAiY29tYm9ib3giLCAiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIsICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwgImFyaWEtb3ducyI6IHRoaXMuaWRzLm1lbnUsICJhcmlhLWhhc3BvcHVwIjogInRydWUiLCB0aXRsZTogdGhpcy5lbGVtZW50LmF0dHIoInRpdGxlIikgfSkuaW5zZXJ0QWZ0ZXIodGhpcy5lbGVtZW50KSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5idXR0b24sICJ1aS1zZWxlY3RtZW51LWJ1dHRvbiB1aS1zZWxlY3RtZW51LWJ1dHRvbi1jbG9zZWQiLCAidWktYnV0dG9uIHVpLXdpZGdldCIpLCB0ID0gZSgiPHNwYW4+IikuYXBwZW5kVG8odGhpcy5idXR0b24pLCB0aGlzLl9hZGRDbGFzcyh0LCAidWktc2VsZWN0bWVudS1pY29uIiwgInVpLWljb24gIiArIHRoaXMub3B0aW9ucy5pY29ucy5idXR0b24pLCB0aGlzLmJ1dHRvbkl0ZW0gPSB0aGlzLl9yZW5kZXJCdXR0b25JdGVtKHMpLmFwcGVuZFRvKHRoaXMuYnV0dG9uKSwgdGhpcy5vcHRpb25zLndpZHRoICE9PSAhMSAmJiB0aGlzLl9yZXNpemVCdXR0b24oKSwgdGhpcy5fb24odGhpcy5idXR0b24sIHRoaXMuX2J1dHRvbkV2ZW50cyksIHRoaXMuYnV0dG9uLm9uZSgiZm9jdXNpbiIsIGZ1bmN0aW9uICgpIHsgaS5fcmVuZGVyZWQgfHwgaS5fcmVmcmVzaE1lbnUoKSB9KSB9LCBfZHJhd01lbnU6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzOyB0aGlzLm1lbnUgPSBlKCI8dWw+IiwgeyAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIsICJhcmlhLWxhYmVsbGVkYnkiOiB0aGlzLmlkcy5idXR0b24sIGlkOiB0aGlzLmlkcy5tZW51IH0pLCB0aGlzLm1lbnVXcmFwID0gZSgiPGRpdj4iKS5hcHBlbmQodGhpcy5tZW51KSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5tZW51V3JhcCwgInVpLXNlbGVjdG1lbnUtbWVudSIsICJ1aS1mcm9udCIpLCB0aGlzLm1lbnVXcmFwLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpLCB0aGlzLm1lbnVJbnN0YW5jZSA9IHRoaXMubWVudS5tZW51KHsgY2xhc3NlczogeyAidWktbWVudSI6ICJ1aS1jb3JuZXItYm90dG9tIiB9LCByb2xlOiAibGlzdGJveCIsIHNlbGVjdDogZnVuY3Rpb24gKGUsIGkpIHsgZS5wcmV2ZW50RGVmYXVsdCgpLCB0Ll9zZXRTZWxlY3Rpb24oKSwgdC5fc2VsZWN0KGkuaXRlbS5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSwgZSkgfSwgZm9jdXM6IGZ1bmN0aW9uIChlLCBpKSB7IHZhciBzID0gaS5pdGVtLmRhdGEoInVpLXNlbGVjdG1lbnUtaXRlbSIpOyBudWxsICE9IHQuZm9jdXNJbmRleCAmJiBzLmluZGV4ICE9PSB0LmZvY3VzSW5kZXggJiYgKHQuX3RyaWdnZXIoImZvY3VzIiwgZSwgeyBpdGVtOiBzIH0pLCB0LmlzT3BlbiB8fCB0Ll9zZWxlY3QocywgZSkpLCB0LmZvY3VzSW5kZXggPSBzLmluZGV4LCB0LmJ1dHRvbi5hdHRyKCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnQiLCB0Lm1lbnVJdGVtcy5lcShzLmluZGV4KS5hdHRyKCJpZCIpKSB9IH0pLm1lbnUoImluc3RhbmNlIiksIHRoaXMubWVudUluc3RhbmNlLl9vZmYodGhpcy5tZW51LCAibW91c2VsZWF2ZSIpLCB0aGlzLm1lbnVJbnN0YW5jZS5fY2xvc2VPbkRvY3VtZW50Q2xpY2sgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhMSB9LCB0aGlzLm1lbnVJbnN0YW5jZS5faXNEaXZpZGVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gITEgfSB9LCByZWZyZXNoOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlZnJlc2hNZW51KCksIHRoaXMuYnV0dG9uSXRlbS5yZXBsYWNlV2l0aCh0aGlzLmJ1dHRvbkl0ZW0gPSB0aGlzLl9yZW5kZXJCdXR0b25JdGVtKHRoaXMuX2dldFNlbGVjdGVkSXRlbSgpLmRhdGEoInVpLXNlbGVjdG1lbnUtaXRlbSIpIHx8IHt9KSksIG51bGwgPT09IHRoaXMub3B0aW9ucy53aWR0aCAmJiB0aGlzLl9yZXNpemVCdXR0b24oKSB9LCBfcmVmcmVzaE1lbnU6IGZ1bmN0aW9uICgpIHsgdmFyIGUsIHQgPSB0aGlzLmVsZW1lbnQuZmluZCgib3B0aW9uIik7IHRoaXMubWVudS5lbXB0eSgpLCB0aGlzLl9wYXJzZU9wdGlvbnModCksIHRoaXMuX3JlbmRlck1lbnUodGhpcy5tZW51LCB0aGlzLml0ZW1zKSwgdGhpcy5tZW51SW5zdGFuY2UucmVmcmVzaCgpLCB0aGlzLm1lbnVJdGVtcyA9IHRoaXMubWVudS5maW5kKCJsaSIpLm5vdCgiLnVpLXNlbGVjdG1lbnUtb3B0Z3JvdXAiKS5maW5kKCIudWktbWVudS1pdGVtLXdyYXBwZXIiKSwgdGhpcy5fcmVuZGVyZWQgPSAhMCwgdC5sZW5ndGggJiYgKGUgPSB0aGlzLl9nZXRTZWxlY3RlZEl0ZW0oKSwgdGhpcy5tZW51SW5zdGFuY2UuZm9jdXMobnVsbCwgZSksIHRoaXMuX3NldEFyaWEoZS5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSksIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLCB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiKSkpIH0sIG9wZW46IGZ1bmN0aW9uIChlKSB7IHRoaXMub3B0aW9ucy5kaXNhYmxlZCB8fCAodGhpcy5fcmVuZGVyZWQgPyAodGhpcy5fcmVtb3ZlQ2xhc3ModGhpcy5tZW51LmZpbmQoIi51aS1zdGF0ZS1hY3RpdmUiKSwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLm1lbnVJbnN0YW5jZS5mb2N1cyhudWxsLCB0aGlzLl9nZXRTZWxlY3RlZEl0ZW0oKSkpIDogdGhpcy5fcmVmcmVzaE1lbnUoKSwgdGhpcy5tZW51SXRlbXMubGVuZ3RoICYmICh0aGlzLmlzT3BlbiA9ICEwLCB0aGlzLl90b2dnbGVBdHRyKCksIHRoaXMuX3Jlc2l6ZU1lbnUoKSwgdGhpcy5fcG9zaXRpb24oKSwgdGhpcy5fb24odGhpcy5kb2N1bWVudCwgdGhpcy5fZG9jdW1lbnRDbGljayksIHRoaXMuX3RyaWdnZXIoIm9wZW4iLCBlKSkpIH0sIF9wb3NpdGlvbjogZnVuY3Rpb24gKCkgeyB0aGlzLm1lbnVXcmFwLnBvc2l0aW9uKGUuZXh0ZW5kKHsgb2Y6IHRoaXMuYnV0dG9uIH0sIHRoaXMub3B0aW9ucy5wb3NpdGlvbikpIH0sIGNsb3NlOiBmdW5jdGlvbiAoZSkgeyB0aGlzLmlzT3BlbiAmJiAodGhpcy5pc09wZW4gPSAhMSwgdGhpcy5fdG9nZ2xlQXR0cigpLCB0aGlzLnJhbmdlID0gbnVsbCwgdGhpcy5fb2ZmKHRoaXMuZG9jdW1lbnQpLCB0aGlzLl90cmlnZ2VyKCJjbG9zZSIsIGUpKSB9LCB3aWRnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYnV0dG9uIH0sIG1lbnVXaWRnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMubWVudSB9LCBfcmVuZGVyQnV0dG9uSXRlbTogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKCI8c3Bhbj4iKTsgcmV0dXJuIHRoaXMuX3NldFRleHQoaSwgdC5sYWJlbCksIHRoaXMuX2FkZENsYXNzKGksICJ1aS1zZWxlY3RtZW51LXRleHQiKSwgaSB9LCBfcmVuZGVyTWVudTogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSB0aGlzLCBhID0gIiI7IGUuZWFjaChpLCBmdW5jdGlvbiAoaSwgbikgeyB2YXIgcjsgbi5vcHRncm91cCAhPT0gYSAmJiAociA9IGUoIjxsaT4iLCB7IHRleHQ6IG4ub3B0Z3JvdXAgfSksIHMuX2FkZENsYXNzKHIsICJ1aS1zZWxlY3RtZW51LW9wdGdyb3VwIiwgInVpLW1lbnUtZGl2aWRlciIgKyAobi5lbGVtZW50LnBhcmVudCgib3B0Z3JvdXAiKS5wcm9wKCJkaXNhYmxlZCIpID8gIiB1aS1zdGF0ZS1kaXNhYmxlZCIgOiAiIikpLCByLmFwcGVuZFRvKHQpLCBhID0gbi5vcHRncm91cCksIHMuX3JlbmRlckl0ZW1EYXRhKHQsIG4pIH0pIH0sIF9yZW5kZXJJdGVtRGF0YTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHRoaXMuX3JlbmRlckl0ZW0oZSwgdCkuZGF0YSgidWktc2VsZWN0bWVudS1pdGVtIiwgdCkgfSwgX3JlbmRlckl0ZW06IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gZSgiPGxpPiIpLCBhID0gZSgiPGRpdj4iLCB7IHRpdGxlOiBpLmVsZW1lbnQuYXR0cigidGl0bGUiKSB9KTsgcmV0dXJuIGkuZGlzYWJsZWQgJiYgdGhpcy5fYWRkQ2xhc3MocywgbnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiksIHRoaXMuX3NldFRleHQoYSwgaS5sYWJlbCksIHMuYXBwZW5kKGEpLmFwcGVuZFRvKHQpIH0sIF9zZXRUZXh0OiBmdW5jdGlvbiAoZSwgdCkgeyB0ID8gZS50ZXh0KHQpIDogZS5odG1sKCImIzE2MDsiKSB9LCBfbW92ZTogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGksIHMsIGEgPSAiLnVpLW1lbnUtaXRlbSI7IHRoaXMuaXNPcGVuID8gaSA9IHRoaXMubWVudUl0ZW1zLmVxKHRoaXMuZm9jdXNJbmRleCkucGFyZW50KCJsaSIpIDogKGkgPSB0aGlzLm1lbnVJdGVtcy5lcSh0aGlzLmVsZW1lbnRbMF0uc2VsZWN0ZWRJbmRleCkucGFyZW50KCJsaSIpLCBhICs9ICI6bm90KC51aS1zdGF0ZS1kaXNhYmxlZCkiKSwgcyA9ICJmaXJzdCIgPT09IGUgfHwgImxhc3QiID09PSBlID8gaVsiZmlyc3QiID09PSBlID8gInByZXZBbGwiIDogIm5leHRBbGwiXShhKS5lcSgtMSkgOiBpW2UgKyAiQWxsIl0oYSkuZXEoMCksIHMubGVuZ3RoICYmIHRoaXMubWVudUluc3RhbmNlLmZvY3VzKHQsIHMpIH0sIF9nZXRTZWxlY3RlZEl0ZW06IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMubWVudUl0ZW1zLmVxKHRoaXMuZWxlbWVudFswXS5zZWxlY3RlZEluZGV4KS5wYXJlbnQoImxpIikgfSwgX3RvZ2dsZTogZnVuY3Rpb24gKGUpIHsgdGhpc1t0aGlzLmlzT3BlbiA/ICJjbG9zZSIgOiAib3BlbiJdKGUpIH0sIF9zZXRTZWxlY3Rpb246IGZ1bmN0aW9uICgpIHsgdmFyIGU7IHRoaXMucmFuZ2UgJiYgKHdpbmRvdy5nZXRTZWxlY3Rpb24gPyAoZSA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgZS5yZW1vdmVBbGxSYW5nZXMoKSwgZS5hZGRSYW5nZSh0aGlzLnJhbmdlKSkgOiB0aGlzLnJhbmdlLnNlbGVjdCgpLCB0aGlzLmJ1dHRvbi5mb2N1cygpKSB9LCBfZG9jdW1lbnRDbGljazogeyBtb3VzZWRvd246IGZ1bmN0aW9uICh0KSB7IHRoaXMuaXNPcGVuICYmIChlKHQudGFyZ2V0KS5jbG9zZXN0KCIudWktc2VsZWN0bWVudS1tZW51LCAjIiArIGUudWkuZXNjYXBlU2VsZWN0b3IodGhpcy5pZHMuYnV0dG9uKSkubGVuZ3RoIHx8IHRoaXMuY2xvc2UodCkpIH0gfSwgX2J1dHRvbkV2ZW50czogeyBtb3VzZWRvd246IGZ1bmN0aW9uICgpIHsgdmFyIGU7IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyAoZSA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgZS5yYW5nZUNvdW50ICYmICh0aGlzLnJhbmdlID0gZS5nZXRSYW5nZUF0KDApKSkgOiB0aGlzLnJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkgfSwgY2xpY2s6IGZ1bmN0aW9uIChlKSB7IHRoaXMuX3NldFNlbGVjdGlvbigpLCB0aGlzLl90b2dnbGUoZSkgfSwga2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSAhMDsgc3dpdGNoICh0LmtleUNvZGUpIHsgY2FzZSBlLnVpLmtleUNvZGUuVEFCOiBjYXNlIGUudWkua2V5Q29kZS5FU0NBUEU6IHRoaXMuY2xvc2UodCksIGkgPSAhMTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkVOVEVSOiB0aGlzLmlzT3BlbiAmJiB0aGlzLl9zZWxlY3RGb2N1c2VkSXRlbSh0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLlVQOiB0LmFsdEtleSA/IHRoaXMuX3RvZ2dsZSh0KSA6IHRoaXMuX21vdmUoInByZXYiLCB0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkRPV046IHQuYWx0S2V5ID8gdGhpcy5fdG9nZ2xlKHQpIDogdGhpcy5fbW92ZSgibmV4dCIsIHQpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuU1BBQ0U6IHRoaXMuaXNPcGVuID8gdGhpcy5fc2VsZWN0Rm9jdXNlZEl0ZW0odCkgOiB0aGlzLl90b2dnbGUodCk7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5MRUZUOiB0aGlzLl9tb3ZlKCJwcmV2IiwgdCk7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5SSUdIVDogdGhpcy5fbW92ZSgibmV4dCIsIHQpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuSE9NRTogY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9VUDogdGhpcy5fbW92ZSgiZmlyc3QiLCB0KTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkVORDogY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9ET1dOOiB0aGlzLl9tb3ZlKCJsYXN0IiwgdCk7IGJyZWFrOyBkZWZhdWx0OiB0aGlzLm1lbnUudHJpZ2dlcih0KSwgaSA9ICExIH1pICYmIHQucHJldmVudERlZmF1bHQoKSB9IH0sIF9zZWxlY3RGb2N1c2VkSXRlbTogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB0aGlzLm1lbnVJdGVtcy5lcSh0aGlzLmZvY3VzSW5kZXgpLnBhcmVudCgibGkiKTsgdC5oYXNDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSB8fCB0aGlzLl9zZWxlY3QodC5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSwgZSkgfSwgX3NlbGVjdDogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGkgPSB0aGlzLmVsZW1lbnRbMF0uc2VsZWN0ZWRJbmRleDsgdGhpcy5lbGVtZW50WzBdLnNlbGVjdGVkSW5kZXggPSBlLmluZGV4LCB0aGlzLmJ1dHRvbkl0ZW0ucmVwbGFjZVdpdGgodGhpcy5idXR0b25JdGVtID0gdGhpcy5fcmVuZGVyQnV0dG9uSXRlbShlKSksIHRoaXMuX3NldEFyaWEoZSksIHRoaXMuX3RyaWdnZXIoInNlbGVjdCIsIHQsIHsgaXRlbTogZSB9KSwgZS5pbmRleCAhPT0gaSAmJiB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCB0LCB7IGl0ZW06IGUgfSksIHRoaXMuY2xvc2UodCkgfSwgX3NldEFyaWE6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gdGhpcy5tZW51SXRlbXMuZXEoZS5pbmRleCkuYXR0cigiaWQiKTsgdGhpcy5idXR0b24uYXR0cih7ICJhcmlhLWxhYmVsbGVkYnkiOiB0LCAiYXJpYS1hY3RpdmVkZXNjZW5kYW50IjogdCB9KSwgdGhpcy5tZW51LmF0dHIoImFyaWEtYWN0aXZlZGVzY2VuZGFudCIsIHQpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IGlmICgiaWNvbnMiID09PSBlKSB7IHZhciBpID0gdGhpcy5idXR0b24uZmluZCgic3Bhbi51aS1pY29uIik7IHRoaXMuX3JlbW92ZUNsYXNzKGksIG51bGwsIHRoaXMub3B0aW9ucy5pY29ucy5idXR0b24pLl9hZGRDbGFzcyhpLCBudWxsLCB0LmJ1dHRvbikgfSB0aGlzLl9zdXBlcihlLCB0KSwgImFwcGVuZFRvIiA9PT0gZSAmJiB0aGlzLm1lbnVXcmFwLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpLCAid2lkdGgiID09PSBlICYmIHRoaXMuX3Jlc2l6ZUJ1dHRvbigpIH0sIF9zZXRPcHRpb25EaXNhYmxlZDogZnVuY3Rpb24gKGUpIHsgdGhpcy5fc3VwZXIoZSksIHRoaXMubWVudUluc3RhbmNlLm9wdGlvbigiZGlzYWJsZWQiLCBlKSwgdGhpcy5idXR0b24uYXR0cigiYXJpYS1kaXNhYmxlZCIsIGUpLCB0aGlzLl90b2dnbGVDbGFzcyh0aGlzLmJ1dHRvbiwgbnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiwgZSksIHRoaXMuZWxlbWVudC5wcm9wKCJkaXNhYmxlZCIsIGUpLCBlID8gKHRoaXMuYnV0dG9uLmF0dHIoInRhYmluZGV4IiwgLTEpLCB0aGlzLmNsb3NlKCkpIDogdGhpcy5idXR0b24uYXR0cigidGFiaW5kZXgiLCAwKSB9LCBfYXBwZW5kVG86IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLm9wdGlvbnMuYXBwZW5kVG87IHJldHVybiB0ICYmICh0ID0gdC5qcXVlcnkgfHwgdC5ub2RlVHlwZSA/IGUodCkgOiB0aGlzLmRvY3VtZW50LmZpbmQodCkuZXEoMCkpLCB0ICYmIHRbMF0gfHwgKHQgPSB0aGlzLmVsZW1lbnQuY2xvc2VzdCgiLnVpLWZyb250LCBkaWFsb2ciKSksIHQubGVuZ3RoIHx8ICh0ID0gdGhpcy5kb2N1bWVudFswXS5ib2R5KSwgdCB9LCBfdG9nZ2xlQXR0cjogZnVuY3Rpb24gKCkgeyB0aGlzLmJ1dHRvbi5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgdGhpcy5pc09wZW4pLCB0aGlzLl9yZW1vdmVDbGFzcyh0aGlzLmJ1dHRvbiwgInVpLXNlbGVjdG1lbnUtYnV0dG9uLSIgKyAodGhpcy5pc09wZW4gPyAiY2xvc2VkIiA6ICJvcGVuIikpLl9hZGRDbGFzcyh0aGlzLmJ1dHRvbiwgInVpLXNlbGVjdG1lbnUtYnV0dG9uLSIgKyAodGhpcy5pc09wZW4gPyAib3BlbiIgOiAiY2xvc2VkIikpLl90b2dnbGVDbGFzcyh0aGlzLm1lbnVXcmFwLCAidWktc2VsZWN0bWVudS1vcGVuIiwgbnVsbCwgdGhpcy5pc09wZW4pLCB0aGlzLm1lbnUuYXR0cigiYXJpYS1oaWRkZW4iLCAhdGhpcy5pc09wZW4pIH0sIF9yZXNpemVCdXR0b246IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLm9wdGlvbnMud2lkdGg7IHJldHVybiBlID09PSAhMSA/ICh0aGlzLmJ1dHRvbi5jc3MoIndpZHRoIiwgIiIpLCB2b2lkIDApIDogKG51bGwgPT09IGUgJiYgKGUgPSB0aGlzLmVsZW1lbnQuc2hvdygpLm91dGVyV2lkdGgoKSwgdGhpcy5lbGVtZW50LmhpZGUoKSksIHRoaXMuYnV0dG9uLm91dGVyV2lkdGgoZSksIHZvaWQgMCkgfSwgX3Jlc2l6ZU1lbnU6IGZ1bmN0aW9uICgpIHsgdGhpcy5tZW51Lm91dGVyV2lkdGgoTWF0aC5tYXgodGhpcy5idXR0b24ub3V0ZXJXaWR0aCgpLCB0aGlzLm1lbnUud2lkdGgoIiIpLm91dGVyV2lkdGgoKSArIDEpKSB9LCBfZ2V0Q3JlYXRlT3B0aW9uczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuX3N1cGVyKCk7IHJldHVybiBlLmRpc2FibGVkID0gdGhpcy5lbGVtZW50LnByb3AoImRpc2FibGVkIiksIGUgfSwgX3BhcnNlT3B0aW9uczogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLCBzID0gW107IHQuZWFjaChmdW5jdGlvbiAodCwgYSkgeyBzLnB1c2goaS5fcGFyc2VPcHRpb24oZShhKSwgdCkpIH0pLCB0aGlzLml0ZW1zID0gcyB9LCBfcGFyc2VPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpID0gZS5wYXJlbnQoIm9wdGdyb3VwIik7IHJldHVybiB7IGVsZW1lbnQ6IGUsIGluZGV4OiB0LCB2YWx1ZTogZS52YWwoKSwgbGFiZWw6IGUudGV4dCgpLCBvcHRncm91cDogaS5hdHRyKCJsYWJlbCIpIHx8ICIiLCBkaXNhYmxlZDogaS5wcm9wKCJkaXNhYmxlZCIpIHx8IGUucHJvcCgiZGlzYWJsZWQiKSB9IH0sIF9kZXN0cm95OiBmdW5jdGlvbiAoKSB7IHRoaXMuX3VuYmluZEZvcm1SZXNldEhhbmRsZXIoKSwgdGhpcy5tZW51V3JhcC5yZW1vdmUoKSwgdGhpcy5idXR0b24ucmVtb3ZlKCksIHRoaXMuZWxlbWVudC5zaG93KCksIHRoaXMuZWxlbWVudC5yZW1vdmVVbmlxdWVJZCgpLCB0aGlzLmxhYmVscy5hdHRyKCJmb3IiLCB0aGlzLmlkcy5lbGVtZW50KSB9IH1dKSwgZS53aWRnZXQoInVpLnNsaWRlciIsIGUudWkubW91c2UsIHsNCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMi4xIiwgd2lkZ2V0RXZlbnRQcmVmaXg6ICJzbGlkZSIsIG9wdGlvbnM6IHsgYW5pbWF0ZTogITEsIGNsYXNzZXM6IHsgInVpLXNsaWRlciI6ICJ1aS1jb3JuZXItYWxsIiwgInVpLXNsaWRlci1oYW5kbGUiOiAidWktY29ybmVyLWFsbCIsICJ1aS1zbGlkZXItcmFuZ2UiOiAidWktY29ybmVyLWFsbCB1aS13aWRnZXQtaGVhZGVyIiB9LCBkaXN0YW5jZTogMCwgbWF4OiAxMDAsIG1pbjogMCwgb3JpZW50YXRpb246ICJob3Jpem9udGFsIiwgcmFuZ2U6ICExLCBzdGVwOiAxLCB2YWx1ZTogMCwgdmFsdWVzOiBudWxsLCBjaGFuZ2U6IG51bGwsIHNsaWRlOiBudWxsLCBzdGFydDogbnVsbCwgc3RvcDogbnVsbCB9LCBudW1QYWdlczogNSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB0aGlzLl9rZXlTbGlkaW5nID0gITEsIHRoaXMuX21vdXNlU2xpZGluZyA9ICExLCB0aGlzLl9hbmltYXRlT2ZmID0gITAsIHRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbCwgdGhpcy5fZGV0ZWN0T3JpZW50YXRpb24oKSwgdGhpcy5fbW91c2VJbml0KCksIHRoaXMuX2NhbGN1bGF0ZU5ld01heCgpLCB0aGlzLl9hZGRDbGFzcygidWktc2xpZGVyIHVpLXNsaWRlci0iICsgdGhpcy5vcmllbnRhdGlvbiwgInVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCIpLCB0aGlzLl9yZWZyZXNoKCksIHRoaXMuX2FuaW1hdGVPZmYgPSAhMSB9LCBfcmVmcmVzaDogZnVuY3Rpb24gKCkgeyB0aGlzLl9jcmVhdGVSYW5nZSgpLCB0aGlzLl9jcmVhdGVIYW5kbGVzKCksIHRoaXMuX3NldHVwRXZlbnRzKCksIHRoaXMuX3JlZnJlc2hWYWx1ZSgpIH0sIF9jcmVhdGVIYW5kbGVzOiBmdW5jdGlvbiAoKSB7IHZhciB0LCBpLCBzID0gdGhpcy5vcHRpb25zLCBhID0gdGhpcy5lbGVtZW50LmZpbmQoIi51aS1zbGlkZXItaGFuZGxlIiksIG4gPSAiPHNwYW4gdGFiaW5kZXg9JzAnPjwvc3Bhbj4iLCByID0gW107IGZvciAoaSA9IHMudmFsdWVzICYmIHMudmFsdWVzLmxlbmd0aCB8fCAxLCBhLmxlbmd0aCA+IGkgJiYgKGEuc2xpY2UoaSkucmVtb3ZlKCksIGEgPSBhLnNsaWNlKDAsIGkpKSwgdCA9IGEubGVuZ3RoOyBpID4gdDsgdCsrKXIucHVzaChuKTsgdGhpcy5oYW5kbGVzID0gYS5hZGQoZShyLmpvaW4oIiIpKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5oYW5kbGVzLCAidWktc2xpZGVyLWhhbmRsZSIsICJ1aS1zdGF0ZS1kZWZhdWx0IiksIHRoaXMuaGFuZGxlID0gdGhpcy5oYW5kbGVzLmVxKDApLCB0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbiAodCkgeyBlKHRoaXMpLmRhdGEoInVpLXNsaWRlci1oYW5kbGUtaW5kZXgiLCB0KS5hdHRyKCJ0YWJJbmRleCIsIDApIH0pIH0sIF9jcmVhdGVSYW5nZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMub3B0aW9uczsgdC5yYW5nZSA/ICh0LnJhbmdlID09PSAhMCAmJiAodC52YWx1ZXMgPyB0LnZhbHVlcy5sZW5ndGggJiYgMiAhPT0gdC52YWx1ZXMubGVuZ3RoID8gdC52YWx1ZXMgPSBbdC52YWx1ZXNbMF0sIHQudmFsdWVzWzBdXSA6IGUuaXNBcnJheSh0LnZhbHVlcykgJiYgKHQudmFsdWVzID0gdC52YWx1ZXMuc2xpY2UoMCkpIDogdC52YWx1ZXMgPSBbdGhpcy5fdmFsdWVNaW4oKSwgdGhpcy5fdmFsdWVNaW4oKV0pLCB0aGlzLnJhbmdlICYmIHRoaXMucmFuZ2UubGVuZ3RoID8gKHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMucmFuZ2UsICJ1aS1zbGlkZXItcmFuZ2UtbWluIHVpLXNsaWRlci1yYW5nZS1tYXgiKSwgdGhpcy5yYW5nZS5jc3MoeyBsZWZ0OiAiIiwgYm90dG9tOiAiIiB9KSkgOiAodGhpcy5yYW5nZSA9IGUoIjxkaXY+IikuYXBwZW5kVG8odGhpcy5lbGVtZW50KSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5yYW5nZSwgInVpLXNsaWRlci1yYW5nZSIpKSwgKCJtaW4iID09PSB0LnJhbmdlIHx8ICJtYXgiID09PSB0LnJhbmdlKSAmJiB0aGlzLl9hZGRDbGFzcyh0aGlzLnJhbmdlLCAidWktc2xpZGVyLXJhbmdlLSIgKyB0LnJhbmdlKSkgOiAodGhpcy5yYW5nZSAmJiB0aGlzLnJhbmdlLnJlbW92ZSgpLCB0aGlzLnJhbmdlID0gbnVsbCkNCiAgICAgICAgICAgICAgICB9LCBfc2V0dXBFdmVudHM6IGZ1bmN0aW9uICgpIHsgdGhpcy5fb2ZmKHRoaXMuaGFuZGxlcyksIHRoaXMuX29uKHRoaXMuaGFuZGxlcywgdGhpcy5faGFuZGxlRXZlbnRzKSwgdGhpcy5faG92ZXJhYmxlKHRoaXMuaGFuZGxlcyksIHRoaXMuX2ZvY3VzYWJsZSh0aGlzLmhhbmRsZXMpIH0sIF9kZXN0cm95OiBmdW5jdGlvbiAoKSB7IHRoaXMuaGFuZGxlcy5yZW1vdmUoKSwgdGhpcy5yYW5nZSAmJiB0aGlzLnJhbmdlLnJlbW92ZSgpLCB0aGlzLl9tb3VzZURlc3Ryb3koKSB9LCBfbW91c2VDYXB0dXJlOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcywgYSwgbiwgciwgbywgbCwgaCwgdSA9IHRoaXMsIGQgPSB0aGlzLm9wdGlvbnM7IHJldHVybiBkLmRpc2FibGVkID8gITEgOiAodGhpcy5lbGVtZW50U2l6ZSA9IHsgd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksIGhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkgfSwgdGhpcy5lbGVtZW50T2Zmc2V0ID0gdGhpcy5lbGVtZW50Lm9mZnNldCgpLCBpID0geyB4OiB0LnBhZ2VYLCB5OiB0LnBhZ2VZIH0sIHMgPSB0aGlzLl9ub3JtVmFsdWVGcm9tTW91c2UoaSksIGEgPSB0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSArIDEsIHRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uICh0KSB7IHZhciBpID0gTWF0aC5hYnMocyAtIHUudmFsdWVzKHQpKTsgKGEgPiBpIHx8IGEgPT09IGkgJiYgKHQgPT09IHUuX2xhc3RDaGFuZ2VkVmFsdWUgfHwgdS52YWx1ZXModCkgPT09IGQubWluKSkgJiYgKGEgPSBpLCBuID0gZSh0aGlzKSwgciA9IHQpIH0pLCBvID0gdGhpcy5fc3RhcnQodCwgciksIG8gPT09ICExID8gITEgOiAodGhpcy5fbW91c2VTbGlkaW5nID0gITAsIHRoaXMuX2hhbmRsZUluZGV4ID0gciwgdGhpcy5fYWRkQ2xhc3MobiwgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCBuLnRyaWdnZXIoImZvY3VzIiksIGwgPSBuLm9mZnNldCgpLCBoID0gIWUodC50YXJnZXQpLnBhcmVudHMoKS5hZGRCYWNrKCkuaXMoIi51aS1zbGlkZXItaGFuZGxlIiksIHRoaXMuX2NsaWNrT2Zmc2V0ID0gaCA/IHsgbGVmdDogMCwgdG9wOiAwIH0gOiB7IGxlZnQ6IHQucGFnZVggLSBsLmxlZnQgLSBuLndpZHRoKCkgLyAyLCB0b3A6IHQucGFnZVkgLSBsLnRvcCAtIG4uaGVpZ2h0KCkgLyAyIC0gKHBhcnNlSW50KG4uY3NzKCJib3JkZXJUb3BXaWR0aCIpLCAxMCkgfHwgMCkgLSAocGFyc2VJbnQobi5jc3MoImJvcmRlckJvdHRvbVdpZHRoIiksIDEwKSB8fCAwKSArIChwYXJzZUludChuLmNzcygibWFyZ2luVG9wIiksIDEwKSB8fCAwKSB9LCB0aGlzLmhhbmRsZXMuaGFzQ2xhc3MoInVpLXN0YXRlLWhvdmVyIikgfHwgdGhpcy5fc2xpZGUodCwgciwgcyksIHRoaXMuX2FuaW1hdGVPZmYgPSAhMCwgITApKSB9LCBfbW91c2VTdGFydDogZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgfSwgX21vdXNlRHJhZzogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB7IHg6IGUucGFnZVgsIHk6IGUucGFnZVkgfSwgaSA9IHRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSh0KTsgcmV0dXJuIHRoaXMuX3NsaWRlKGUsIHRoaXMuX2hhbmRsZUluZGV4LCBpKSwgITEgfSwgX21vdXNlU3RvcDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuaGFuZGxlcywgbnVsbCwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLl9tb3VzZVNsaWRpbmcgPSAhMSwgdGhpcy5fc3RvcChlLCB0aGlzLl9oYW5kbGVJbmRleCksIHRoaXMuX2NoYW5nZShlLCB0aGlzLl9oYW5kbGVJbmRleCksIHRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbCwgdGhpcy5fY2xpY2tPZmZzZXQgPSBudWxsLCB0aGlzLl9hbmltYXRlT2ZmID0gITEsICExIH0sIF9kZXRlY3RPcmllbnRhdGlvbjogZnVuY3Rpb24gKCkgeyB0aGlzLm9yaWVudGF0aW9uID0gInZlcnRpY2FsIiA9PT0gdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uID8gInZlcnRpY2FsIiA6ICJob3Jpem9udGFsIiB9LCBfbm9ybVZhbHVlRnJvbU1vdXNlOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCwgaSwgcywgYSwgbjsgcmV0dXJuICJob3Jpem9udGFsIiA9PT0gdGhpcy5vcmllbnRhdGlvbiA/ICh0ID0gdGhpcy5lbGVtZW50U2l6ZS53aWR0aCwgaSA9IGUueCAtIHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0IC0gKHRoaXMuX2NsaWNrT2Zmc2V0ID8gdGhpcy5fY2xpY2tPZmZzZXQubGVmdCA6IDApKSA6ICh0ID0gdGhpcy5lbGVtZW50U2l6ZS5oZWlnaHQsIGkgPSBlLnkgLSB0aGlzLmVsZW1lbnRPZmZzZXQudG9wIC0gKHRoaXMuX2NsaWNrT2Zmc2V0ID8gdGhpcy5fY2xpY2tPZmZzZXQudG9wIDogMCkpLCBzID0gaSAvIHQsIHMgPiAxICYmIChzID0gMSksIDAgPiBzICYmIChzID0gMCksICJ2ZXJ0aWNhbCIgPT09IHRoaXMub3JpZW50YXRpb24gJiYgKHMgPSAxIC0gcyksIGEgPSB0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSwgbiA9IHRoaXMuX3ZhbHVlTWluKCkgKyBzICogYSwgdGhpcy5fdHJpbUFsaWduVmFsdWUobikgfSwgX3VpSGFzaDogZnVuY3Rpb24gKGUsIHQsIGkpIHsgdmFyIHMgPSB7IGhhbmRsZTogdGhpcy5oYW5kbGVzW2VdLCBoYW5kbGVJbmRleDogZSwgdmFsdWU6IHZvaWQgMCAhPT0gdCA/IHQgOiB0aGlzLnZhbHVlKCkgfTsgcmV0dXJuIHRoaXMuX2hhc011bHRpcGxlVmFsdWVzKCkgJiYgKHMudmFsdWUgPSB2b2lkIDAgIT09IHQgPyB0IDogdGhpcy52YWx1ZXMoZSksIHMudmFsdWVzID0gaSB8fCB0aGlzLnZhbHVlcygpKSwgcyB9LCBfaGFzTXVsdGlwbGVWYWx1ZXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggfSwgX3N0YXJ0OiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBlLCB0aGlzLl91aUhhc2godCkpIH0sIF9zbGlkZTogZnVuY3Rpb24gKGUsIHQsIGkpIHsgdmFyIHMsIGEsIG4gPSB0aGlzLnZhbHVlKCksIHIgPSB0aGlzLnZhbHVlcygpOyB0aGlzLl9oYXNNdWx0aXBsZVZhbHVlcygpICYmIChhID0gdGhpcy52YWx1ZXModCA/IDAgOiAxKSwgbiA9IHRoaXMudmFsdWVzKHQpLCAyID09PSB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCAmJiB0aGlzLm9wdGlvbnMucmFuZ2UgPT09ICEwICYmIChpID0gMCA9PT0gdCA/IE1hdGgubWluKGEsIGkpIDogTWF0aC5tYXgoYSwgaSkpLCByW3RdID0gaSksIGkgIT09IG4gJiYgKHMgPSB0aGlzLl90cmlnZ2VyKCJzbGlkZSIsIGUsIHRoaXMuX3VpSGFzaCh0LCBpLCByKSksIHMgIT09ICExICYmICh0aGlzLl9oYXNNdWx0aXBsZVZhbHVlcygpID8gdGhpcy52YWx1ZXModCwgaSkgOiB0aGlzLnZhbHVlKGkpKSkgfSwgX3N0b3A6IGZ1bmN0aW9uIChlLCB0KSB7IHRoaXMuX3RyaWdnZXIoInN0b3AiLCBlLCB0aGlzLl91aUhhc2godCkpIH0sIF9jaGFuZ2U6IGZ1bmN0aW9uIChlLCB0KSB7IHRoaXMuX2tleVNsaWRpbmcgfHwgdGhpcy5fbW91c2VTbGlkaW5nIHx8ICh0aGlzLl9sYXN0Q2hhbmdlZFZhbHVlID0gdCwgdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgZSwgdGhpcy5fdWlIYXNoKHQpKSkgfSwgdmFsdWU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKGUpLCB0aGlzLl9yZWZyZXNoVmFsdWUoKSwgdGhpcy5fY2hhbmdlKG51bGwsIDApLCB2b2lkIDApIDogdGhpcy5fdmFsdWUoKSB9LCB2YWx1ZXM6IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzLCBhLCBuOyBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHJldHVybiB0aGlzLm9wdGlvbnMudmFsdWVzW3RdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoaSksIHRoaXMuX3JlZnJlc2hWYWx1ZSgpLCB0aGlzLl9jaGFuZ2UobnVsbCwgdCksIHZvaWQgMDsgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5fdmFsdWVzKCk7IGlmICghZS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHJldHVybiB0aGlzLl9oYXNNdWx0aXBsZVZhbHVlcygpID8gdGhpcy5fdmFsdWVzKHQpIDogdGhpcy52YWx1ZSgpOyBmb3IgKHMgPSB0aGlzLm9wdGlvbnMudmFsdWVzLCBhID0gYXJndW1lbnRzWzBdLCBuID0gMDsgcy5sZW5ndGggPiBuOyBuICs9IDEpc1tuXSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKGFbbl0pLCB0aGlzLl9jaGFuZ2UobnVsbCwgbik7IHRoaXMuX3JlZnJlc2hWYWx1ZSgpIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzLCBhID0gMDsgc3dpdGNoICgicmFuZ2UiID09PSB0ICYmIHRoaXMub3B0aW9ucy5yYW5nZSA9PT0gITAgJiYgKCJtaW4iID09PSBpID8gKHRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcygwKSwgdGhpcy5vcHRpb25zLnZhbHVlcyA9IG51bGwpIDogIm1heCIgPT09IGkgJiYgKHRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcyh0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCAtIDEpLCB0aGlzLm9wdGlvbnMudmFsdWVzID0gbnVsbCkpLCBlLmlzQXJyYXkodGhpcy5vcHRpb25zLnZhbHVlcykgJiYgKGEgPSB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCksIHRoaXMuX3N1cGVyKHQsIGkpLCB0KSB7IGNhc2UgIm9yaWVudGF0aW9uIjogdGhpcy5fZGV0ZWN0T3JpZW50YXRpb24oKSwgdGhpcy5fcmVtb3ZlQ2xhc3MoInVpLXNsaWRlci1ob3Jpem9udGFsIHVpLXNsaWRlci12ZXJ0aWNhbCIpLl9hZGRDbGFzcygidWktc2xpZGVyLSIgKyB0aGlzLm9yaWVudGF0aW9uKSwgdGhpcy5fcmVmcmVzaFZhbHVlKCksIHRoaXMub3B0aW9ucy5yYW5nZSAmJiB0aGlzLl9yZWZyZXNoUmFuZ2UoaSksIHRoaXMuaGFuZGxlcy5jc3MoImhvcml6b250YWwiID09PSBpID8gImJvdHRvbSIgOiAibGVmdCIsICIiKTsgYnJlYWs7IGNhc2UgInZhbHVlIjogdGhpcy5fYW5pbWF0ZU9mZiA9ICEwLCB0aGlzLl9yZWZyZXNoVmFsdWUoKSwgdGhpcy5fY2hhbmdlKG51bGwsIDApLCB0aGlzLl9hbmltYXRlT2ZmID0gITE7IGJyZWFrOyBjYXNlICJ2YWx1ZXMiOiBmb3IgKHRoaXMuX2FuaW1hdGVPZmYgPSAhMCwgdGhpcy5fcmVmcmVzaFZhbHVlKCksIHMgPSBhIC0gMTsgcyA+PSAwOyBzLS0pdGhpcy5fY2hhbmdlKG51bGwsIHMpOyB0aGlzLl9hbmltYXRlT2ZmID0gITE7IGJyZWFrOyBjYXNlICJzdGVwIjogY2FzZSAibWluIjogY2FzZSAibWF4IjogdGhpcy5fYW5pbWF0ZU9mZiA9ICEwLCB0aGlzLl9jYWxjdWxhdGVOZXdNYXgoKSwgdGhpcy5fcmVmcmVzaFZhbHVlKCksIHRoaXMuX2FuaW1hdGVPZmYgPSAhMTsgYnJlYWs7IGNhc2UgInJhbmdlIjogdGhpcy5fYW5pbWF0ZU9mZiA9ICEwLCB0aGlzLl9yZWZyZXNoKCksIHRoaXMuX2FuaW1hdGVPZmYgPSAhMSB9IH0sIF9zZXRPcHRpb25EaXNhYmxlZDogZnVuY3Rpb24gKGUpIHsgdGhpcy5fc3VwZXIoZSksIHRoaXMuX3RvZ2dsZUNsYXNzKG51bGwsICJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhZSkgfSwgX3ZhbHVlOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5vcHRpb25zLnZhbHVlOyByZXR1cm4gZSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKGUpIH0sIF92YWx1ZXM6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBpLCBzOyBpZiAoYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHQgPSB0aGlzLm9wdGlvbnMudmFsdWVzW2VdLCB0ID0gdGhpcy5fdHJpbUFsaWduVmFsdWUodCk7IGlmICh0aGlzLl9oYXNNdWx0aXBsZVZhbHVlcygpKSB7IGZvciAoaSA9IHRoaXMub3B0aW9ucy52YWx1ZXMuc2xpY2UoKSwgcyA9IDA7IGkubGVuZ3RoID4gczsgcyArPSAxKWlbc10gPSB0aGlzLl90cmltQWxpZ25WYWx1ZShpW3NdKTsgcmV0dXJuIGkgfSByZXR1cm4gW10gfSwgX3RyaW1BbGlnblZhbHVlOiBmdW5jdGlvbiAoZSkgeyBpZiAodGhpcy5fdmFsdWVNaW4oKSA+PSBlKSByZXR1cm4gdGhpcy5fdmFsdWVNaW4oKTsgaWYgKGUgPj0gdGhpcy5fdmFsdWVNYXgoKSkgcmV0dXJuIHRoaXMuX3ZhbHVlTWF4KCk7IHZhciB0ID0gdGhpcy5vcHRpb25zLnN0ZXAgPiAwID8gdGhpcy5vcHRpb25zLnN0ZXAgOiAxLCBpID0gKGUgLSB0aGlzLl92YWx1ZU1pbigpKSAlIHQsIHMgPSBlIC0gaTsgcmV0dXJuIDIgKiBNYXRoLmFicyhpKSA+PSB0ICYmIChzICs9IGkgPiAwID8gdCA6IC10KSwgcGFyc2VGbG9hdChzLnRvRml4ZWQoNSkpIH0sIF9jYWxjdWxhdGVOZXdNYXg6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLm9wdGlvbnMubWF4LCB0ID0gdGhpcy5fdmFsdWVNaW4oKSwgaSA9IHRoaXMub3B0aW9ucy5zdGVwLCBzID0gTWF0aC5yb3VuZCgoZSAtIHQpIC8gaSkgKiBpOyBlID0gcyArIHQsIGUgPiB0aGlzLm9wdGlvbnMubWF4ICYmIChlIC09IGkpLCB0aGlzLm1heCA9IHBhcnNlRmxvYXQoZS50b0ZpeGVkKHRoaXMuX3ByZWNpc2lvbigpKSkgfSwgX3ByZWNpc2lvbjogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuX3ByZWNpc2lvbk9mKHRoaXMub3B0aW9ucy5zdGVwKTsgcmV0dXJuIG51bGwgIT09IHRoaXMub3B0aW9ucy5taW4gJiYgKGUgPSBNYXRoLm1heChlLCB0aGlzLl9wcmVjaXNpb25PZih0aGlzLm9wdGlvbnMubWluKSkpLCBlIH0sIF9wcmVjaXNpb25PZjogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSAiIiArIGUsIGkgPSB0LmluZGV4T2YoIi4iKTsgcmV0dXJuIC0xID09PSBpID8gMCA6IHQubGVuZ3RoIC0gaSAtIDEgfSwgX3ZhbHVlTWluOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm9wdGlvbnMubWluIH0sIF92YWx1ZU1heDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXggfSwgX3JlZnJlc2hSYW5nZTogZnVuY3Rpb24gKGUpIHsgInZlcnRpY2FsIiA9PT0gZSAmJiB0aGlzLnJhbmdlLmNzcyh7IHdpZHRoOiAiIiwgbGVmdDogIiIgfSksICJob3Jpem9udGFsIiA9PT0gZSAmJiB0aGlzLnJhbmdlLmNzcyh7IGhlaWdodDogIiIsIGJvdHRvbTogIiIgfSkgfSwgX3JlZnJlc2hWYWx1ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCwgaSwgcywgYSwgbiwgciA9IHRoaXMub3B0aW9ucy5yYW5nZSwgbyA9IHRoaXMub3B0aW9ucywgbCA9IHRoaXMsIGggPSB0aGlzLl9hbmltYXRlT2ZmID8gITEgOiBvLmFuaW1hdGUsIHUgPSB7fTsgdGhpcy5faGFzTXVsdGlwbGVWYWx1ZXMoKSA/IHRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uIChzKSB7IGkgPSAxMDAgKiAoKGwudmFsdWVzKHMpIC0gbC5fdmFsdWVNaW4oKSkgLyAobC5fdmFsdWVNYXgoKSAtIGwuX3ZhbHVlTWluKCkpKSwgdVsiaG9yaXpvbnRhbCIgPT09IGwub3JpZW50YXRpb24gPyAibGVmdCIgOiAiYm90dG9tIl0gPSBpICsgIiUiLCBlKHRoaXMpLnN0b3AoMSwgMSlbaCA/ICJhbmltYXRlIiA6ICJjc3MiXSh1LCBvLmFuaW1hdGUpLCBsLm9wdGlvbnMucmFuZ2UgPT09ICEwICYmICgiaG9yaXpvbnRhbCIgPT09IGwub3JpZW50YXRpb24gPyAoMCA9PT0gcyAmJiBsLnJhbmdlLnN0b3AoMSwgMSlbaCA/ICJhbmltYXRlIiA6ICJjc3MiXSh7IGxlZnQ6IGkgKyAiJSIgfSwgby5hbmltYXRlKSwgMSA9PT0gcyAmJiBsLnJhbmdlW2ggPyAiYW5pbWF0ZSIgOiAiY3NzIl0oeyB3aWR0aDogaSAtIHQgKyAiJSIgfSwgeyBxdWV1ZTogITEsIGR1cmF0aW9uOiBvLmFuaW1hdGUgfSkpIDogKDAgPT09IHMgJiYgbC5yYW5nZS5zdG9wKDEsIDEpW2ggPyAiYW5pbWF0ZSIgOiAiY3NzIl0oeyBib3R0b206IGkgKyAiJSIgfSwgby5hbmltYXRlKSwgMSA9PT0gcyAmJiBsLnJhbmdlW2ggPyAiYW5pbWF0ZSIgOiAiY3NzIl0oeyBoZWlnaHQ6IGkgLSB0ICsgIiUiIH0sIHsgcXVldWU6ICExLCBkdXJhdGlvbjogby5hbmltYXRlIH0pKSksIHQgPSBpIH0pIDogKHMgPSB0aGlzLnZhbHVlKCksIGEgPSB0aGlzLl92YWx1ZU1pbigpLCBuID0gdGhpcy5fdmFsdWVNYXgoKSwgaSA9IG4gIT09IGEgPyAxMDAgKiAoKHMgLSBhKSAvIChuIC0gYSkpIDogMCwgdVsiaG9yaXpvbnRhbCIgPT09IHRoaXMub3JpZW50YXRpb24gPyAibGVmdCIgOiAiYm90dG9tIl0gPSBpICsgIiUiLCB0aGlzLmhhbmRsZS5zdG9wKDEsIDEpW2ggPyAiYW5pbWF0ZSIgOiAiY3NzIl0odSwgby5hbmltYXRlKSwgIm1pbiIgPT09IHIgJiYgImhvcml6b250YWwiID09PSB0aGlzLm9yaWVudGF0aW9uICYmIHRoaXMucmFuZ2Uuc3RvcCgxLCAxKVtoID8gImFuaW1hdGUiIDogImNzcyJdKHsgd2lkdGg6IGkgKyAiJSIgfSwgby5hbmltYXRlKSwgIm1heCIgPT09IHIgJiYgImhvcml6b250YWwiID09PSB0aGlzLm9yaWVudGF0aW9uICYmIHRoaXMucmFuZ2Uuc3RvcCgxLCAxKVtoID8gImFuaW1hdGUiIDogImNzcyJdKHsgd2lkdGg6IDEwMCAtIGkgKyAiJSIgfSwgby5hbmltYXRlKSwgIm1pbiIgPT09IHIgJiYgInZlcnRpY2FsIiA9PT0gdGhpcy5vcmllbnRhdGlvbiAmJiB0aGlzLnJhbmdlLnN0b3AoMSwgMSlbaCA/ICJhbmltYXRlIiA6ICJjc3MiXSh7IGhlaWdodDogaSArICIlIiB9LCBvLmFuaW1hdGUpLCAibWF4IiA9PT0gciAmJiAidmVydGljYWwiID09PSB0aGlzLm9yaWVudGF0aW9uICYmIHRoaXMucmFuZ2Uuc3RvcCgxLCAxKVtoID8gImFuaW1hdGUiIDogImNzcyJdKHsgaGVpZ2h0OiAxMDAgLSBpICsgIiUiIH0sIG8uYW5pbWF0ZSkpIH0sIF9oYW5kbGVFdmVudHM6IHsga2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMsIGEsIG4sIHIgPSBlKHQudGFyZ2V0KS5kYXRhKCJ1aS1zbGlkZXItaGFuZGxlLWluZGV4Iik7IHN3aXRjaCAodC5rZXlDb2RlKSB7IGNhc2UgZS51aS5rZXlDb2RlLkhPTUU6IGNhc2UgZS51aS5rZXlDb2RlLkVORDogY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9VUDogY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9ET1dOOiBjYXNlIGUudWkua2V5Q29kZS5VUDogY2FzZSBlLnVpLmtleUNvZGUuUklHSFQ6IGNhc2UgZS51aS5rZXlDb2RlLkRPV046IGNhc2UgZS51aS5rZXlDb2RlLkxFRlQ6IGlmICh0LnByZXZlbnREZWZhdWx0KCksICF0aGlzLl9rZXlTbGlkaW5nICYmICh0aGlzLl9rZXlTbGlkaW5nID0gITAsIHRoaXMuX2FkZENsYXNzKGUodC50YXJnZXQpLCBudWxsLCAidWktc3RhdGUtYWN0aXZlIiksIGkgPSB0aGlzLl9zdGFydCh0LCByKSwgaSA9PT0gITEpKSByZXR1cm4gfXN3aXRjaCAobiA9IHRoaXMub3B0aW9ucy5zdGVwLCBzID0gYSA9IHRoaXMuX2hhc011bHRpcGxlVmFsdWVzKCkgPyB0aGlzLnZhbHVlcyhyKSA6IHRoaXMudmFsdWUoKSwgdC5rZXlDb2RlKSB7IGNhc2UgZS51aS5rZXlDb2RlLkhPTUU6IGEgPSB0aGlzLl92YWx1ZU1pbigpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuRU5EOiBhID0gdGhpcy5fdmFsdWVNYXgoKTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLlBBR0VfVVA6IGEgPSB0aGlzLl90cmltQWxpZ25WYWx1ZShzICsgKHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpKSAvIHRoaXMubnVtUGFnZXMpOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuUEFHRV9ET1dOOiBhID0gdGhpcy5fdHJpbUFsaWduVmFsdWUocyAtICh0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSkgLyB0aGlzLm51bVBhZ2VzKTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLlVQOiBjYXNlIGUudWkua2V5Q29kZS5SSUdIVDogaWYgKHMgPT09IHRoaXMuX3ZhbHVlTWF4KCkpIHJldHVybjsgYSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKHMgKyBuKTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkRPV046IGNhc2UgZS51aS5rZXlDb2RlLkxFRlQ6IGlmIChzID09PSB0aGlzLl92YWx1ZU1pbigpKSByZXR1cm47IGEgPSB0aGlzLl90cmltQWxpZ25WYWx1ZShzIC0gbikgfXRoaXMuX3NsaWRlKHQsIHIsIGEpIH0sIGtleXVwOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IGUodC50YXJnZXQpLmRhdGEoInVpLXNsaWRlci1oYW5kbGUtaW5kZXgiKTsgdGhpcy5fa2V5U2xpZGluZyAmJiAodGhpcy5fa2V5U2xpZGluZyA9ICExLCB0aGlzLl9zdG9wKHQsIGkpLCB0aGlzLl9jaGFuZ2UodCwgaSksIHRoaXMuX3JlbW92ZUNsYXNzKGUodC50YXJnZXQpLCBudWxsLCAidWktc3RhdGUtYWN0aXZlIikpIH0gfQ0KICAgICAgICAgICAgfSksIGUud2lkZ2V0KCJ1aS5zcGlubmVyIiwgeyB2ZXJzaW9uOiAiMS4xMi4xIiwgZGVmYXVsdEVsZW1lbnQ6ICI8aW5wdXQ+Iiwgd2lkZ2V0RXZlbnRQcmVmaXg6ICJzcGluIiwgb3B0aW9uczogeyBjbGFzc2VzOiB7ICJ1aS1zcGlubmVyIjogInVpLWNvcm5lci1hbGwiLCAidWktc3Bpbm5lci1kb3duIjogInVpLWNvcm5lci1iciIsICJ1aS1zcGlubmVyLXVwIjogInVpLWNvcm5lci10ciIgfSwgY3VsdHVyZTogbnVsbCwgaWNvbnM6IHsgZG93bjogInVpLWljb24tdHJpYW5nbGUtMS1zIiwgdXA6ICJ1aS1pY29uLXRyaWFuZ2xlLTEtbiIgfSwgaW5jcmVtZW50YWw6ICEwLCBtYXg6IG51bGwsIG1pbjogbnVsbCwgbnVtYmVyRm9ybWF0OiBudWxsLCBwYWdlOiAxMCwgc3RlcDogMSwgY2hhbmdlOiBudWxsLCBzcGluOiBudWxsLCBzdGFydDogbnVsbCwgc3RvcDogbnVsbCB9LCBfY3JlYXRlOiBmdW5jdGlvbiAoKSB7IHRoaXMuX3NldE9wdGlvbigibWF4IiwgdGhpcy5vcHRpb25zLm1heCksIHRoaXMuX3NldE9wdGlvbigibWluIiwgdGhpcy5vcHRpb25zLm1pbiksIHRoaXMuX3NldE9wdGlvbigic3RlcCIsIHRoaXMub3B0aW9ucy5zdGVwKSwgIiIgIT09IHRoaXMudmFsdWUoKSAmJiB0aGlzLl92YWx1ZSh0aGlzLmVsZW1lbnQudmFsKCksICEwKSwgdGhpcy5fZHJhdygpLCB0aGlzLl9vbih0aGlzLl9ldmVudHMpLCB0aGlzLl9yZWZyZXNoKCksIHRoaXMuX29uKHRoaXMud2luZG93LCB7IGJlZm9yZXVubG9hZDogZnVuY3Rpb24gKCkgeyB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIikgfSB9KSB9LCBfZ2V0Q3JlYXRlT3B0aW9uczogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuX3N1cGVyKCksIGkgPSB0aGlzLmVsZW1lbnQ7IHJldHVybiBlLmVhY2goWyJtaW4iLCAibWF4IiwgInN0ZXAiXSwgZnVuY3Rpb24gKGUsIHMpIHsgdmFyIGEgPSBpLmF0dHIocyk7IG51bGwgIT0gYSAmJiBhLmxlbmd0aCAmJiAodFtzXSA9IGEpIH0pLCB0IH0sIF9ldmVudHM6IHsga2V5ZG93bjogZnVuY3Rpb24gKGUpIHsgdGhpcy5fc3RhcnQoZSkgJiYgdGhpcy5fa2V5ZG93bihlKSAmJiBlLnByZXZlbnREZWZhdWx0KCkgfSwga2V5dXA6ICJfc3RvcCIsIGZvY3VzOiBmdW5jdGlvbiAoKSB7IHRoaXMucHJldmlvdXMgPSB0aGlzLmVsZW1lbnQudmFsKCkgfSwgYmx1cjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuY2FuY2VsQmx1ciA/IChkZWxldGUgdGhpcy5jYW5jZWxCbHVyLCB2b2lkIDApIDogKHRoaXMuX3N0b3AoKSwgdGhpcy5fcmVmcmVzaCgpLCB0aGlzLnByZXZpb3VzICE9PSB0aGlzLmVsZW1lbnQudmFsKCkgJiYgdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgZSksIHZvaWQgMCkgfSwgbW91c2V3aGVlbDogZnVuY3Rpb24gKGUsIHQpIHsgaWYgKHQpIHsgaWYgKCF0aGlzLnNwaW5uaW5nICYmICF0aGlzLl9zdGFydChlKSkgcmV0dXJuICExOyB0aGlzLl9zcGluKCh0ID4gMCA/IDEgOiAtMSkgKiB0aGlzLm9wdGlvbnMuc3RlcCwgZSksIGNsZWFyVGltZW91dCh0aGlzLm1vdXNld2hlZWxUaW1lciksIHRoaXMubW91c2V3aGVlbFRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24gKCkgeyB0aGlzLnNwaW5uaW5nICYmIHRoaXMuX3N0b3AoZSkgfSwgMTAwKSwgZS5wcmV2ZW50RGVmYXVsdCgpIH0gfSwgIm1vdXNlZG93biAudWktc3Bpbm5lci1idXR0b24iOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBpKCkgeyB2YXIgdCA9IHRoaXMuZWxlbWVudFswXSA9PT0gZS51aS5zYWZlQWN0aXZlRWxlbWVudCh0aGlzLmRvY3VtZW50WzBdKTsgdCB8fCAodGhpcy5lbGVtZW50LnRyaWdnZXIoImZvY3VzIiksIHRoaXMucHJldmlvdXMgPSBzLCB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHRoaXMucHJldmlvdXMgPSBzIH0pKSB9IHZhciBzOyBzID0gdGhpcy5lbGVtZW50WzBdID09PSBlLnVpLnNhZmVBY3RpdmVFbGVtZW50KHRoaXMuZG9jdW1lbnRbMF0pID8gdGhpcy5wcmV2aW91cyA6IHRoaXMuZWxlbWVudC52YWwoKSwgdC5wcmV2ZW50RGVmYXVsdCgpLCBpLmNhbGwodGhpcyksIHRoaXMuY2FuY2VsQmx1ciA9ICEwLCB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IGRlbGV0ZSB0aGlzLmNhbmNlbEJsdXIsIGkuY2FsbCh0aGlzKSB9KSwgdGhpcy5fc3RhcnQodCkgIT09ICExICYmIHRoaXMuX3JlcGVhdChudWxsLCBlKHQuY3VycmVudFRhcmdldCkuaGFzQ2xhc3MoInVpLXNwaW5uZXItdXAiKSA/IDEgOiAtMSwgdCkgfSwgIm1vdXNldXAgLnVpLXNwaW5uZXItYnV0dG9uIjogIl9zdG9wIiwgIm1vdXNlZW50ZXIgLnVpLXNwaW5uZXItYnV0dG9uIjogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGUodC5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcygidWktc3RhdGUtYWN0aXZlIikgPyB0aGlzLl9zdGFydCh0KSA9PT0gITEgPyAhMSA6ICh0aGlzLl9yZXBlYXQobnVsbCwgZSh0LmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKCJ1aS1zcGlubmVyLXVwIikgPyAxIDogLTEsIHQpLCB2b2lkIDApIDogdm9pZCAwIH0sICJtb3VzZWxlYXZlIC51aS1zcGlubmVyLWJ1dHRvbiI6ICJfc3RvcCIgfSwgX2VuaGFuY2U6IGZ1bmN0aW9uICgpIHsgdGhpcy51aVNwaW5uZXIgPSB0aGlzLmVsZW1lbnQuYXR0cigiYXV0b2NvbXBsZXRlIiwgIm9mZiIpLndyYXAoIjxzcGFuPiIpLnBhcmVudCgpLmFwcGVuZCgiPGE+PC9hPjxhPjwvYT4iKSB9LCBfZHJhdzogZnVuY3Rpb24gKCkgeyB0aGlzLl9lbmhhbmNlKCksIHRoaXMuX2FkZENsYXNzKHRoaXMudWlTcGlubmVyLCAidWktc3Bpbm5lciIsICJ1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQiKSwgdGhpcy5fYWRkQ2xhc3MoInVpLXNwaW5uZXItaW5wdXQiKSwgdGhpcy5lbGVtZW50LmF0dHIoInJvbGUiLCAic3BpbmJ1dHRvbiIpLCB0aGlzLmJ1dHRvbnMgPSB0aGlzLnVpU3Bpbm5lci5jaGlsZHJlbigiYSIpLmF0dHIoInRhYkluZGV4IiwgLTEpLmF0dHIoImFyaWEtaGlkZGVuIiwgITApLmJ1dHRvbih7IGNsYXNzZXM6IHsgInVpLWJ1dHRvbiI6ICIiIH0gfSksIHRoaXMuX3JlbW92ZUNsYXNzKHRoaXMuYnV0dG9ucywgInVpLWNvcm5lci1hbGwiKSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5idXR0b25zLmZpcnN0KCksICJ1aS1zcGlubmVyLWJ1dHRvbiB1aS1zcGlubmVyLXVwIiksIHRoaXMuX2FkZENsYXNzKHRoaXMuYnV0dG9ucy5sYXN0KCksICJ1aS1zcGlubmVyLWJ1dHRvbiB1aS1zcGlubmVyLWRvd24iKSwgdGhpcy5idXR0b25zLmZpcnN0KCkuYnV0dG9uKHsgaWNvbjogdGhpcy5vcHRpb25zLmljb25zLnVwLCBzaG93TGFiZWw6ICExIH0pLCB0aGlzLmJ1dHRvbnMubGFzdCgpLmJ1dHRvbih7IGljb246IHRoaXMub3B0aW9ucy5pY29ucy5kb3duLCBzaG93TGFiZWw6ICExIH0pLCB0aGlzLmJ1dHRvbnMuaGVpZ2h0KCkgPiBNYXRoLmNlaWwoLjUgKiB0aGlzLnVpU3Bpbm5lci5oZWlnaHQoKSkgJiYgdGhpcy51aVNwaW5uZXIuaGVpZ2h0KCkgPiAwICYmIHRoaXMudWlTcGlubmVyLmhlaWdodCh0aGlzLnVpU3Bpbm5lci5oZWlnaHQoKSkgfSwgX2tleWRvd246IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5vcHRpb25zLCBzID0gZS51aS5rZXlDb2RlOyBzd2l0Y2ggKHQua2V5Q29kZSkgeyBjYXNlIHMuVVA6IHJldHVybiB0aGlzLl9yZXBlYXQobnVsbCwgMSwgdCksICEwOyBjYXNlIHMuRE9XTjogcmV0dXJuIHRoaXMuX3JlcGVhdChudWxsLCAtMSwgdCksICEwOyBjYXNlIHMuUEFHRV9VUDogcmV0dXJuIHRoaXMuX3JlcGVhdChudWxsLCBpLnBhZ2UsIHQpLCAhMDsgY2FzZSBzLlBBR0VfRE9XTjogcmV0dXJuIHRoaXMuX3JlcGVhdChudWxsLCAtaS5wYWdlLCB0KSwgITAgfXJldHVybiAhMSB9LCBfc3RhcnQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLnNwaW5uaW5nIHx8IHRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgZSkgIT09ICExID8gKHRoaXMuY291bnRlciB8fCAodGhpcy5jb3VudGVyID0gMSksIHRoaXMuc3Bpbm5pbmcgPSAhMCwgITApIDogITEgfSwgX3JlcGVhdDogZnVuY3Rpb24gKGUsIHQsIGkpIHsgZSA9IGUgfHwgNTAwLCBjbGVhclRpbWVvdXQodGhpcy50aW1lciksIHRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbiAoKSB7IHRoaXMuX3JlcGVhdCg0MCwgdCwgaSkgfSwgZSksIHRoaXMuX3NwaW4odCAqIHRoaXMub3B0aW9ucy5zdGVwLCBpKSB9LCBfc3BpbjogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGkgPSB0aGlzLnZhbHVlKCkgfHwgMDsgdGhpcy5jb3VudGVyIHx8ICh0aGlzLmNvdW50ZXIgPSAxKSwgaSA9IHRoaXMuX2FkanVzdFZhbHVlKGkgKyBlICogdGhpcy5faW5jcmVtZW50KHRoaXMuY291bnRlcikpLCB0aGlzLnNwaW5uaW5nICYmIHRoaXMuX3RyaWdnZXIoInNwaW4iLCB0LCB7IHZhbHVlOiBpIH0pID09PSAhMSB8fCAodGhpcy5fdmFsdWUoaSksIHRoaXMuY291bnRlcisrKSB9LCBfaW5jcmVtZW50OiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMub3B0aW9ucy5pbmNyZW1lbnRhbDsgcmV0dXJuIGkgPyBlLmlzRnVuY3Rpb24oaSkgPyBpKHQpIDogTWF0aC5mbG9vcih0ICogdCAqIHQgLyA1ZTQgLSB0ICogdCAvIDUwMCArIDE3ICogdCAvIDIwMCArIDEpIDogMSB9LCBfcHJlY2lzaW9uOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5fcHJlY2lzaW9uT2YodGhpcy5vcHRpb25zLnN0ZXApOyByZXR1cm4gbnVsbCAhPT0gdGhpcy5vcHRpb25zLm1pbiAmJiAoZSA9IE1hdGgubWF4KGUsIHRoaXMuX3ByZWNpc2lvbk9mKHRoaXMub3B0aW9ucy5taW4pKSksIGUgfSwgX3ByZWNpc2lvbk9mOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9ICIiICsgZSwgaSA9IHQuaW5kZXhPZigiLiIpOyByZXR1cm4gLTEgPT09IGkgPyAwIDogdC5sZW5ndGggLSBpIC0gMSB9LCBfYWRqdXN0VmFsdWU6IGZ1bmN0aW9uIChlKSB7IHZhciB0LCBpLCBzID0gdGhpcy5vcHRpb25zOyByZXR1cm4gdCA9IG51bGwgIT09IHMubWluID8gcy5taW4gOiAwLCBpID0gZSAtIHQsIGkgPSBNYXRoLnJvdW5kKGkgLyBzLnN0ZXApICogcy5zdGVwLCBlID0gdCArIGksIGUgPSBwYXJzZUZsb2F0KGUudG9GaXhlZCh0aGlzLl9wcmVjaXNpb24oKSkpLCBudWxsICE9PSBzLm1heCAmJiBlID4gcy5tYXggPyBzLm1heCA6IG51bGwgIT09IHMubWluICYmIHMubWluID4gZSA/IHMubWluIDogZSB9LCBfc3RvcDogZnVuY3Rpb24gKGUpIHsgdGhpcy5zcGlubmluZyAmJiAoY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpLCBjbGVhclRpbWVvdXQodGhpcy5tb3VzZXdoZWVsVGltZXIpLCB0aGlzLmNvdW50ZXIgPSAwLCB0aGlzLnNwaW5uaW5nID0gITEsIHRoaXMuX3RyaWdnZXIoInN0b3AiLCBlKSkgfSwgX3NldE9wdGlvbjogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIGksIHMsIGE7IHJldHVybiAiY3VsdHVyZSIgPT09IGUgfHwgIm51bWJlckZvcm1hdCIgPT09IGUgPyAoaSA9IHRoaXMuX3BhcnNlKHRoaXMuZWxlbWVudC52YWwoKSksIHRoaXMub3B0aW9uc1tlXSA9IHQsIHRoaXMuZWxlbWVudC52YWwodGhpcy5fZm9ybWF0KGkpKSwgdm9pZCAwKSA6ICgoIm1heCIgPT09IGUgfHwgIm1pbiIgPT09IGUgfHwgInN0ZXAiID09PSBlKSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiAodCA9IHRoaXMuX3BhcnNlKHQpKSwgImljb25zIiA9PT0gZSAmJiAocyA9IHRoaXMuYnV0dG9ucy5maXJzdCgpLmZpbmQoIi51aS1pY29uIiksIHRoaXMuX3JlbW92ZUNsYXNzKHMsIG51bGwsIHRoaXMub3B0aW9ucy5pY29ucy51cCksIHRoaXMuX2FkZENsYXNzKHMsIG51bGwsIHQudXApLCBhID0gdGhpcy5idXR0b25zLmxhc3QoKS5maW5kKCIudWktaWNvbiIpLCB0aGlzLl9yZW1vdmVDbGFzcyhhLCBudWxsLCB0aGlzLm9wdGlvbnMuaWNvbnMuZG93biksIHRoaXMuX2FkZENsYXNzKGEsIG51bGwsIHQuZG93bikpLCB0aGlzLl9zdXBlcihlLCB0KSwgdm9pZCAwKSB9LCBfc2V0T3B0aW9uRGlzYWJsZWQ6IGZ1bmN0aW9uIChlKSB7IHRoaXMuX3N1cGVyKGUpLCB0aGlzLl90b2dnbGVDbGFzcyh0aGlzLnVpU3Bpbm5lciwgbnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIiwgISFlKSwgdGhpcy5lbGVtZW50LnByb3AoImRpc2FibGVkIiwgISFlKSwgdGhpcy5idXR0b25zLmJ1dHRvbihlID8gImRpc2FibGUiIDogImVuYWJsZSIpIH0sIF9zZXRPcHRpb25zOiBvKGZ1bmN0aW9uIChlKSB7IHRoaXMuX3N1cGVyKGUpIH0pLCBfcGFyc2U6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiAiIiAhPT0gZSAmJiAoZSA9IHdpbmRvdy5HbG9iYWxpemUgJiYgdGhpcy5vcHRpb25zLm51bWJlckZvcm1hdCA/IEdsb2JhbGl6ZS5wYXJzZUZsb2F0KGUsIDEwLCB0aGlzLm9wdGlvbnMuY3VsdHVyZSkgOiArZSksICIiID09PSBlIHx8IGlzTmFOKGUpID8gbnVsbCA6IGUgfSwgX2Zvcm1hdDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuICIiID09PSBlID8gIiIgOiB3aW5kb3cuR2xvYmFsaXplICYmIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQgPyBHbG9iYWxpemUuZm9ybWF0KGUsIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQsIHRoaXMub3B0aW9ucy5jdWx0dXJlKSA6IGUgfSwgX3JlZnJlc2g6IGZ1bmN0aW9uICgpIHsgdGhpcy5lbGVtZW50LmF0dHIoeyAiYXJpYS12YWx1ZW1pbiI6IHRoaXMub3B0aW9ucy5taW4sICJhcmlhLXZhbHVlbWF4IjogdGhpcy5vcHRpb25zLm1heCwgImFyaWEtdmFsdWVub3ciOiB0aGlzLl9wYXJzZSh0aGlzLmVsZW1lbnQudmFsKCkpIH0pIH0sIGlzVmFsaWQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLnZhbHVlKCk7IHJldHVybiBudWxsID09PSBlID8gITEgOiBlID09PSB0aGlzLl9hZGp1c3RWYWx1ZShlKSB9LCBfdmFsdWU6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpOyAiIiAhPT0gZSAmJiAoaSA9IHRoaXMuX3BhcnNlKGUpLCBudWxsICE9PSBpICYmICh0IHx8IChpID0gdGhpcy5fYWRqdXN0VmFsdWUoaSkpLCBlID0gdGhpcy5fZm9ybWF0KGkpKSksIHRoaXMuZWxlbWVudC52YWwoZSksIHRoaXMuX3JlZnJlc2goKSB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiLCAhMSkucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIHJvbGUgYXJpYS12YWx1ZW1pbiBhcmlhLXZhbHVlbWF4IGFyaWEtdmFsdWVub3ciKSwgdGhpcy51aVNwaW5uZXIucmVwbGFjZVdpdGgodGhpcy5lbGVtZW50KSB9LCBzdGVwVXA6IG8oZnVuY3Rpb24gKGUpIHsgdGhpcy5fc3RlcFVwKGUpIH0pLCBfc3RlcFVwOiBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zdGFydCgpICYmICh0aGlzLl9zcGluKChlIHx8IDEpICogdGhpcy5vcHRpb25zLnN0ZXApLCB0aGlzLl9zdG9wKCkpIH0sIHN0ZXBEb3duOiBvKGZ1bmN0aW9uIChlKSB7IHRoaXMuX3N0ZXBEb3duKGUpIH0pLCBfc3RlcERvd246IGZ1bmN0aW9uIChlKSB7IHRoaXMuX3N0YXJ0KCkgJiYgKHRoaXMuX3NwaW4oKGUgfHwgMSkgKiAtdGhpcy5vcHRpb25zLnN0ZXApLCB0aGlzLl9zdG9wKCkpIH0sIHBhZ2VVcDogbyhmdW5jdGlvbiAoZSkgeyB0aGlzLl9zdGVwVXAoKGUgfHwgMSkgKiB0aGlzLm9wdGlvbnMucGFnZSkgfSksIHBhZ2VEb3duOiBvKGZ1bmN0aW9uIChlKSB7IHRoaXMuX3N0ZXBEb3duKChlIHx8IDEpICogdGhpcy5vcHRpb25zLnBhZ2UpIH0pLCB2YWx1ZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobyh0aGlzLl92YWx1ZSkuY2FsbCh0aGlzLCBlKSwgdm9pZCAwKSA6IHRoaXMuX3BhcnNlKHRoaXMuZWxlbWVudC52YWwoKSkgfSwgd2lkZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnVpU3Bpbm5lciB9IH0pLCBlLnVpQmFja0NvbXBhdCAhPT0gITEgJiYgZS53aWRnZXQoInVpLnNwaW5uZXIiLCBlLnVpLnNwaW5uZXIsIHsgX2VuaGFuY2U6IGZ1bmN0aW9uICgpIHsgdGhpcy51aVNwaW5uZXIgPSB0aGlzLmVsZW1lbnQuYXR0cigiYXV0b2NvbXBsZXRlIiwgIm9mZiIpLndyYXAodGhpcy5fdWlTcGlubmVySHRtbCgpKS5wYXJlbnQoKS5hcHBlbmQodGhpcy5fYnV0dG9uSHRtbCgpKSB9LCBfdWlTcGlubmVySHRtbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gIjxzcGFuPiIgfSwgX2J1dHRvbkh0bWw6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICI8YT48L2E+PGE+PC9hPiIgfSB9KSwgZS51aS5zcGlubmVyLCBlLndpZGdldCgidWkudGFicyIsIHsgdmVyc2lvbjogIjEuMTIuMSIsIGRlbGF5OiAzMDAsIG9wdGlvbnM6IHsgYWN0aXZlOiBudWxsLCBjbGFzc2VzOiB7ICJ1aS10YWJzIjogInVpLWNvcm5lci1hbGwiLCAidWktdGFicy1uYXYiOiAidWktY29ybmVyLWFsbCIsICJ1aS10YWJzLXBhbmVsIjogInVpLWNvcm5lci1ib3R0b20iLCAidWktdGFicy10YWIiOiAidWktY29ybmVyLXRvcCIgfSwgY29sbGFwc2libGU6ICExLCBldmVudDogImNsaWNrIiwgaGVpZ2h0U3R5bGU6ICJjb250ZW50IiwgaGlkZTogbnVsbCwgc2hvdzogbnVsbCwgYWN0aXZhdGU6IG51bGwsIGJlZm9yZUFjdGl2YXRlOiBudWxsLCBiZWZvcmVMb2FkOiBudWxsLCBsb2FkOiBudWxsIH0sIF9pc0xvY2FsOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gLyMuKiQvOyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgdmFyIGksIHM7IGkgPSB0LmhyZWYucmVwbGFjZShlLCAiIiksIHMgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoZSwgIiIpOyB0cnkgeyBpID0gZGVjb2RlVVJJQ29tcG9uZW50KGkpIH0gY2F0Y2ggKGEpIHsgfSB0cnkgeyBzID0gZGVjb2RlVVJJQ29tcG9uZW50KHMpIH0gY2F0Y2ggKGEpIHsgfSByZXR1cm4gdC5oYXNoLmxlbmd0aCA+IDEgJiYgaSA9PT0gcyB9IH0oKSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMsIGkgPSB0aGlzLm9wdGlvbnM7IHRoaXMucnVubmluZyA9ICExLCB0aGlzLl9hZGRDbGFzcygidWktdGFicyIsICJ1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQiKSwgdGhpcy5fdG9nZ2xlQ2xhc3MoInVpLXRhYnMtY29sbGFwc2libGUiLCBudWxsLCBpLmNvbGxhcHNpYmxlKSwgdGhpcy5fcHJvY2Vzc1RhYnMoKSwgaS5hY3RpdmUgPSB0aGlzLl9pbml0aWFsQWN0aXZlKCksIGUuaXNBcnJheShpLmRpc2FibGVkKSAmJiAoaS5kaXNhYmxlZCA9IGUudW5pcXVlKGkuZGlzYWJsZWQuY29uY2F0KGUubWFwKHRoaXMudGFicy5maWx0ZXIoIi51aS1zdGF0ZS1kaXNhYmxlZCIpLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC50YWJzLmluZGV4KGUpIH0pKSkuc29ydCgpKSwgdGhpcy5hY3RpdmUgPSB0aGlzLm9wdGlvbnMuYWN0aXZlICE9PSAhMSAmJiB0aGlzLmFuY2hvcnMubGVuZ3RoID8gdGhpcy5fZmluZEFjdGl2ZShpLmFjdGl2ZSkgOiBlKCksIHRoaXMuX3JlZnJlc2goKSwgdGhpcy5hY3RpdmUubGVuZ3RoICYmIHRoaXMubG9hZChpLmFjdGl2ZSkgfSwgX2luaXRpYWxBY3RpdmU6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLm9wdGlvbnMuYWN0aXZlLCBpID0gdGhpcy5vcHRpb25zLmNvbGxhcHNpYmxlLCBzID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSk7IHJldHVybiBudWxsID09PSB0ICYmIChzICYmIHRoaXMudGFicy5lYWNoKGZ1bmN0aW9uIChpLCBhKSB7IHJldHVybiBlKGEpLmF0dHIoImFyaWEtY29udHJvbHMiKSA9PT0gcyA/ICh0ID0gaSwgITEpIDogdm9pZCAwIH0pLCBudWxsID09PSB0ICYmICh0ID0gdGhpcy50YWJzLmluZGV4KHRoaXMudGFicy5maWx0ZXIoIi51aS10YWJzLWFjdGl2ZSIpKSksIChudWxsID09PSB0IHx8IC0xID09PSB0KSAmJiAodCA9IHRoaXMudGFicy5sZW5ndGggPyAwIDogITEpKSwgdCAhPT0gITEgJiYgKHQgPSB0aGlzLnRhYnMuaW5kZXgodGhpcy50YWJzLmVxKHQpKSwgLTEgPT09IHQgJiYgKHQgPSBpID8gITEgOiAwKSksICFpICYmIHQgPT09ICExICYmIHRoaXMuYW5jaG9ycy5sZW5ndGggJiYgKHQgPSAwKSwgdCB9LCBfZ2V0Q3JlYXRlRXZlbnREYXRhOiBmdW5jdGlvbiAoKSB7IHJldHVybiB7IHRhYjogdGhpcy5hY3RpdmUsIHBhbmVsOiB0aGlzLmFjdGl2ZS5sZW5ndGggPyB0aGlzLl9nZXRQYW5lbEZvclRhYih0aGlzLmFjdGl2ZSkgOiBlKCkgfSB9LCBfdGFiS2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKGUudWkuc2FmZUFjdGl2ZUVsZW1lbnQodGhpcy5kb2N1bWVudFswXSkpLmNsb3Nlc3QoImxpIiksIHMgPSB0aGlzLnRhYnMuaW5kZXgoaSksIGEgPSAhMDsgaWYgKCF0aGlzLl9oYW5kbGVQYWdlTmF2KHQpKSB7IHN3aXRjaCAodC5rZXlDb2RlKSB7IGNhc2UgZS51aS5rZXlDb2RlLlJJR0hUOiBjYXNlIGUudWkua2V5Q29kZS5ET1dOOiBzKys7IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5VUDogY2FzZSBlLnVpLmtleUNvZGUuTEVGVDogYSA9ICExLCBzLS07IGJyZWFrOyBjYXNlIGUudWkua2V5Q29kZS5FTkQ6IHMgPSB0aGlzLmFuY2hvcnMubGVuZ3RoIC0gMTsgYnJlYWs7IGNhc2UgZS51aS5rZXlDb2RlLkhPTUU6IHMgPSAwOyBicmVhazsgY2FzZSBlLnVpLmtleUNvZGUuU1BBQ0U6IHJldHVybiB0LnByZXZlbnREZWZhdWx0KCksIGNsZWFyVGltZW91dCh0aGlzLmFjdGl2YXRpbmcpLCB0aGlzLl9hY3RpdmF0ZShzKSwgdm9pZCAwOyBjYXNlIGUudWkua2V5Q29kZS5FTlRFUjogcmV0dXJuIHQucHJldmVudERlZmF1bHQoKSwgY2xlYXJUaW1lb3V0KHRoaXMuYWN0aXZhdGluZyksIHRoaXMuX2FjdGl2YXRlKHMgPT09IHRoaXMub3B0aW9ucy5hY3RpdmUgPyAhMSA6IHMpLCB2b2lkIDA7IGRlZmF1bHQ6IHJldHVybiB9dC5wcmV2ZW50RGVmYXVsdCgpLCBjbGVhclRpbWVvdXQodGhpcy5hY3RpdmF0aW5nKSwgcyA9IHRoaXMuX2ZvY3VzTmV4dFRhYihzLCBhKSwgdC5jdHJsS2V5IHx8IHQubWV0YUtleSB8fCAoaS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIiksIHRoaXMudGFicy5lcShzKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgInRydWUiKSwgdGhpcy5hY3RpdmF0aW5nID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbigiYWN0aXZlIiwgcykgfSwgdGhpcy5kZWxheSkpIH0gfSwgX3BhbmVsS2V5ZG93bjogZnVuY3Rpb24gKHQpIHsgdGhpcy5faGFuZGxlUGFnZU5hdih0KSB8fCB0LmN0cmxLZXkgJiYgdC5rZXlDb2RlID09PSBlLnVpLmtleUNvZGUuVVAgJiYgKHQucHJldmVudERlZmF1bHQoKSwgdGhpcy5hY3RpdmUudHJpZ2dlcigiZm9jdXMiKSkgfSwgX2hhbmRsZVBhZ2VOYXY6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmFsdEtleSAmJiB0LmtleUNvZGUgPT09IGUudWkua2V5Q29kZS5QQUdFX1VQID8gKHRoaXMuX2FjdGl2YXRlKHRoaXMuX2ZvY3VzTmV4dFRhYih0aGlzLm9wdGlvbnMuYWN0aXZlIC0gMSwgITEpKSwgITApIDogdC5hbHRLZXkgJiYgdC5rZXlDb2RlID09PSBlLnVpLmtleUNvZGUuUEFHRV9ET1dOID8gKHRoaXMuX2FjdGl2YXRlKHRoaXMuX2ZvY3VzTmV4dFRhYih0aGlzLm9wdGlvbnMuYWN0aXZlICsgMSwgITApKSwgITApIDogdm9pZCAwIH0sIF9maW5kTmV4dFRhYjogZnVuY3Rpb24gKHQsIGkpIHsgZnVuY3Rpb24gcygpIHsgcmV0dXJuIHQgPiBhICYmICh0ID0gMCksIDAgPiB0ICYmICh0ID0gYSksIHQgfSBmb3IgKHZhciBhID0gdGhpcy50YWJzLmxlbmd0aCAtIDE7IC0xICE9PSBlLmluQXJyYXkocygpLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQpOyl0ID0gaSA/IHQgKyAxIDogdCAtIDE7IHJldHVybiB0IH0sIF9mb2N1c05leHRUYWI6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBlID0gdGhpcy5fZmluZE5leHRUYWIoZSwgdCksIHRoaXMudGFicy5lcShlKS50cmlnZ2VyKCJmb2N1cyIpLCBlIH0sIF9zZXRPcHRpb246IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiAiYWN0aXZlIiA9PT0gZSA/ICh0aGlzLl9hY3RpdmF0ZSh0KSwgdm9pZCAwKSA6ICh0aGlzLl9zdXBlcihlLCB0KSwgImNvbGxhcHNpYmxlIiA9PT0gZSAmJiAodGhpcy5fdG9nZ2xlQ2xhc3MoInVpLXRhYnMtY29sbGFwc2libGUiLCBudWxsLCB0KSwgdCB8fCB0aGlzLm9wdGlvbnMuYWN0aXZlICE9PSAhMSB8fCB0aGlzLl9hY3RpdmF0ZSgwKSksICJldmVudCIgPT09IGUgJiYgdGhpcy5fc2V0dXBFdmVudHModCksICJoZWlnaHRTdHlsZSIgPT09IGUgJiYgdGhpcy5fc2V0dXBIZWlnaHRTdHlsZSh0KSwgdm9pZCAwKSB9LCBfc2FuaXRpemVTZWxlY3RvcjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgPyBlLnJlcGxhY2UoL1shIiQlJicoKSorLC5cLzo7PD0+P0BcW1xdXF5ge3x9fl0vZywgIlxcJCYiKSA6ICIiIH0sIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLm9wdGlvbnMsIGkgPSB0aGlzLnRhYmxpc3QuY2hpbGRyZW4oIjpoYXMoYVtocmVmXSkiKTsgdC5kaXNhYmxlZCA9IGUubWFwKGkuZmlsdGVyKCIudWktc3RhdGUtZGlzYWJsZWQiKSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGkuaW5kZXgoZSkgfSksIHRoaXMuX3Byb2Nlc3NUYWJzKCksIHQuYWN0aXZlICE9PSAhMSAmJiB0aGlzLmFuY2hvcnMubGVuZ3RoID8gdGhpcy5hY3RpdmUubGVuZ3RoICYmICFlLmNvbnRhaW5zKHRoaXMudGFibGlzdFswXSwgdGhpcy5hY3RpdmVbMF0pID8gdGhpcy50YWJzLmxlbmd0aCA9PT0gdC5kaXNhYmxlZC5sZW5ndGggPyAodC5hY3RpdmUgPSAhMSwgdGhpcy5hY3RpdmUgPSBlKCkpIDogdGhpcy5fYWN0aXZhdGUodGhpcy5fZmluZE5leHRUYWIoTWF0aC5tYXgoMCwgdC5hY3RpdmUgLSAxKSwgITEpKSA6IHQuYWN0aXZlID0gdGhpcy50YWJzLmluZGV4KHRoaXMuYWN0aXZlKSA6ICh0LmFjdGl2ZSA9ICExLCB0aGlzLmFjdGl2ZSA9IGUoKSksIHRoaXMuX3JlZnJlc2goKSB9LCBfcmVmcmVzaDogZnVuY3Rpb24gKCkgeyB0aGlzLl9zZXRPcHRpb25EaXNhYmxlZCh0aGlzLm9wdGlvbnMuZGlzYWJsZWQpLCB0aGlzLl9zZXR1cEV2ZW50cyh0aGlzLm9wdGlvbnMuZXZlbnQpLCB0aGlzLl9zZXR1cEhlaWdodFN0eWxlKHRoaXMub3B0aW9ucy5oZWlnaHRTdHlsZSksIHRoaXMudGFicy5ub3QodGhpcy5hY3RpdmUpLmF0dHIoeyAiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIsICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiwgdGFiSW5kZXg6IC0xIH0pLCB0aGlzLnBhbmVscy5ub3QodGhpcy5fZ2V0UGFuZWxGb3JUYWIodGhpcy5hY3RpdmUpKS5oaWRlKCkuYXR0cih7ICJhcmlhLWhpZGRlbiI6ICJ0cnVlIiB9KSwgdGhpcy5hY3RpdmUubGVuZ3RoID8gKHRoaXMuYWN0aXZlLmF0dHIoeyAiYXJpYS1zZWxlY3RlZCI6ICJ0cnVlIiwgImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIsIHRhYkluZGV4OiAwIH0pLCB0aGlzLl9hZGRDbGFzcyh0aGlzLmFjdGl2ZSwgInVpLXRhYnMtYWN0aXZlIiwgInVpLXN0YXRlLWFjdGl2ZSIpLCB0aGlzLl9nZXRQYW5lbEZvclRhYih0aGlzLmFjdGl2ZSkuc2hvdygpLmF0dHIoeyAiYXJpYS1oaWRkZW4iOiAiZmFsc2UiIH0pKSA6IHRoaXMudGFicy5lcSgwKS5hdHRyKCJ0YWJJbmRleCIsIDApIH0sIF9wcm9jZXNzVGFiczogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMsIGkgPSB0aGlzLnRhYnMsIHMgPSB0aGlzLmFuY2hvcnMsIGEgPSB0aGlzLnBhbmVsczsgdGhpcy50YWJsaXN0ID0gdGhpcy5fZ2V0TGlzdCgpLmF0dHIoInJvbGUiLCAidGFibGlzdCIpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLnRhYmxpc3QsICJ1aS10YWJzLW5hdiIsICJ1aS1oZWxwZXItcmVzZXQgdWktaGVscGVyLWNsZWFyZml4IHVpLXdpZGdldC1oZWFkZXIiKSwgdGhpcy50YWJsaXN0Lm9uKCJtb3VzZWRvd24iICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgIj4gbGkiLCBmdW5jdGlvbiAodCkgeyBlKHRoaXMpLmlzKCIudWktc3RhdGUtZGlzYWJsZWQiKSAmJiB0LnByZXZlbnREZWZhdWx0KCkgfSkub24oImZvY3VzIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsICIudWktdGFicy1hbmNob3IiLCBmdW5jdGlvbiAoKSB7IGUodGhpcykuY2xvc2VzdCgibGkiKS5pcygiLnVpLXN0YXRlLWRpc2FibGVkIikgJiYgdGhpcy5ibHVyKCkgfSksIHRoaXMudGFicyA9IHRoaXMudGFibGlzdC5maW5kKCI+IGxpOmhhcyhhW2hyZWZdKSIpLmF0dHIoeyByb2xlOiAidGFiIiwgdGFiSW5kZXg6IC0xIH0pLCB0aGlzLl9hZGRDbGFzcyh0aGlzLnRhYnMsICJ1aS10YWJzLXRhYiIsICJ1aS1zdGF0ZS1kZWZhdWx0IiksIHRoaXMuYW5jaG9ycyA9IHRoaXMudGFicy5tYXAoZnVuY3Rpb24gKCkgeyByZXR1cm4gZSgiYSIsIHRoaXMpWzBdIH0pLmF0dHIoeyByb2xlOiAicHJlc2VudGF0aW9uIiwgdGFiSW5kZXg6IC0xIH0pLCB0aGlzLl9hZGRDbGFzcyh0aGlzLmFuY2hvcnMsICJ1aS10YWJzLWFuY2hvciIpLCB0aGlzLnBhbmVscyA9IGUoKSwgdGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24gKGksIHMpIHsgdmFyIGEsIG4sIHIsIG8gPSBlKHMpLnVuaXF1ZUlkKCkuYXR0cigiaWQiKSwgbCA9IGUocykuY2xvc2VzdCgibGkiKSwgaCA9IGwuYXR0cigiYXJpYS1jb250cm9scyIpOyB0Ll9pc0xvY2FsKHMpID8gKGEgPSBzLmhhc2gsIHIgPSBhLnN1YnN0cmluZygxKSwgbiA9IHQuZWxlbWVudC5maW5kKHQuX3Nhbml0aXplU2VsZWN0b3IoYSkpKSA6IChyID0gbC5hdHRyKCJhcmlhLWNvbnRyb2xzIikgfHwgZSh7fSkudW5pcXVlSWQoKVswXS5pZCwgYSA9ICIjIiArIHIsIG4gPSB0LmVsZW1lbnQuZmluZChhKSwgbi5sZW5ndGggfHwgKG4gPSB0Ll9jcmVhdGVQYW5lbChyKSwgbi5pbnNlcnRBZnRlcih0LnBhbmVsc1tpIC0gMV0gfHwgdC50YWJsaXN0KSksIG4uYXR0cigiYXJpYS1saXZlIiwgInBvbGl0ZSIpKSwgbi5sZW5ndGggJiYgKHQucGFuZWxzID0gdC5wYW5lbHMuYWRkKG4pKSwgaCAmJiBsLmRhdGEoInVpLXRhYnMtYXJpYS1jb250cm9scyIsIGgpLCBsLmF0dHIoeyAiYXJpYS1jb250cm9scyI6IHIsICJhcmlhLWxhYmVsbGVkYnkiOiBvIH0pLCBuLmF0dHIoImFyaWEtbGFiZWxsZWRieSIsIG8pIH0pLCB0aGlzLnBhbmVscy5hdHRyKCJyb2xlIiwgInRhYnBhbmVsIiksIHRoaXMuX2FkZENsYXNzKHRoaXMucGFuZWxzLCAidWktdGFicy1wYW5lbCIsICJ1aS13aWRnZXQtY29udGVudCIpLCBpICYmICh0aGlzLl9vZmYoaS5ub3QodGhpcy50YWJzKSksIHRoaXMuX29mZihzLm5vdCh0aGlzLmFuY2hvcnMpKSwgdGhpcy5fb2ZmKGEubm90KHRoaXMucGFuZWxzKSkpIH0sIF9nZXRMaXN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRhYmxpc3QgfHwgdGhpcy5lbGVtZW50LmZpbmQoIm9sLCB1bCIpLmVxKDApIH0sIF9jcmVhdGVQYW5lbDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGUoIjxkaXY+IikuYXR0cigiaWQiLCB0KS5kYXRhKCJ1aS10YWJzLWRlc3Ryb3kiLCAhMCkgfSwgX3NldE9wdGlvbkRpc2FibGVkOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcywgYTsgZm9yIChlLmlzQXJyYXkodCkgJiYgKHQubGVuZ3RoID8gdC5sZW5ndGggPT09IHRoaXMuYW5jaG9ycy5sZW5ndGggJiYgKHQgPSAhMCkgOiB0ID0gITEpLCBhID0gMDsgcyA9IHRoaXMudGFic1thXTsgYSsrKWkgPSBlKHMpLCB0ID09PSAhMCB8fCAtMSAhPT0gZS5pbkFycmF5KGEsIHQpID8gKGkuYXR0cigiYXJpYS1kaXNhYmxlZCIsICJ0cnVlIiksIHRoaXMuX2FkZENsYXNzKGksIG51bGwsICJ1aS1zdGF0ZS1kaXNhYmxlZCIpKSA6IChpLnJlbW92ZUF0dHIoImFyaWEtZGlzYWJsZWQiKSwgdGhpcy5fcmVtb3ZlQ2xhc3MoaSwgbnVsbCwgInVpLXN0YXRlLWRpc2FibGVkIikpOyB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSB0LCB0aGlzLl90b2dnbGVDbGFzcyh0aGlzLndpZGdldCgpLCB0aGlzLndpZGdldEZ1bGxOYW1lICsgIi1kaXNhYmxlZCIsIG51bGwsIHQgPT09ICEwKSB9LCBfc2V0dXBFdmVudHM6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0ge307IHQgJiYgZS5lYWNoKHQuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKGUsIHQpIHsgaVt0XSA9ICJfZXZlbnRIYW5kbGVyIiB9KSwgdGhpcy5fb2ZmKHRoaXMuYW5jaG9ycy5hZGQodGhpcy50YWJzKS5hZGQodGhpcy5wYW5lbHMpKSwgdGhpcy5fb24oITAsIHRoaXMuYW5jaG9ycywgeyBjbGljazogZnVuY3Rpb24gKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpIH0gfSksIHRoaXMuX29uKHRoaXMuYW5jaG9ycywgaSksIHRoaXMuX29uKHRoaXMudGFicywgeyBrZXlkb3duOiAiX3RhYktleWRvd24iIH0pLCB0aGlzLl9vbih0aGlzLnBhbmVscywgeyBrZXlkb3duOiAiX3BhbmVsS2V5ZG93biIgfSksIHRoaXMuX2ZvY3VzYWJsZSh0aGlzLnRhYnMpLCB0aGlzLl9ob3ZlcmFibGUodGhpcy50YWJzKSB9LCBfc2V0dXBIZWlnaHRTdHlsZTogZnVuY3Rpb24gKHQpIHsgdmFyIGksIHMgPSB0aGlzLmVsZW1lbnQucGFyZW50KCk7ICJmaWxsIiA9PT0gdCA/IChpID0gcy5oZWlnaHQoKSwgaSAtPSB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSAtIHRoaXMuZWxlbWVudC5oZWlnaHQoKSwgdGhpcy5lbGVtZW50LnNpYmxpbmdzKCI6dmlzaWJsZSIpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyksIHMgPSB0LmNzcygicG9zaXRpb24iKTsgImFic29sdXRlIiAhPT0gcyAmJiAiZml4ZWQiICE9PSBzICYmIChpIC09IHQub3V0ZXJIZWlnaHQoITApKSB9KSwgdGhpcy5lbGVtZW50LmNoaWxkcmVuKCkubm90KHRoaXMucGFuZWxzKS5lYWNoKGZ1bmN0aW9uICgpIHsgaSAtPSBlKHRoaXMpLm91dGVySGVpZ2h0KCEwKSB9KSwgdGhpcy5wYW5lbHMuZWFjaChmdW5jdGlvbiAoKSB7IGUodGhpcykuaGVpZ2h0KE1hdGgubWF4KDAsIGkgLSBlKHRoaXMpLmlubmVySGVpZ2h0KCkgKyBlKHRoaXMpLmhlaWdodCgpKSkgfSkuY3NzKCJvdmVyZmxvdyIsICJhdXRvIikpIDogImF1dG8iID09PSB0ICYmIChpID0gMCwgdGhpcy5wYW5lbHMuZWFjaChmdW5jdGlvbiAoKSB7IGkgPSBNYXRoLm1heChpLCBlKHRoaXMpLmhlaWdodCgiIikuaGVpZ2h0KCkpIH0pLmhlaWdodChpKSkgfSwgX2V2ZW50SGFuZGxlcjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLm9wdGlvbnMsIHMgPSB0aGlzLmFjdGl2ZSwgYSA9IGUodC5jdXJyZW50VGFyZ2V0KSwgbiA9IGEuY2xvc2VzdCgibGkiKSwgciA9IG5bMF0gPT09IHNbMF0sIG8gPSByICYmIGkuY29sbGFwc2libGUsIGwgPSBvID8gZSgpIDogdGhpcy5fZ2V0UGFuZWxGb3JUYWIobiksIGggPSBzLmxlbmd0aCA/IHRoaXMuX2dldFBhbmVsRm9yVGFiKHMpIDogZSgpLCB1ID0geyBvbGRUYWI6IHMsIG9sZFBhbmVsOiBoLCBuZXdUYWI6IG8gPyBlKCkgOiBuLCBuZXdQYW5lbDogbCB9OyB0LnByZXZlbnREZWZhdWx0KCksIG4uaGFzQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIikgfHwgbi5oYXNDbGFzcygidWktdGFicy1sb2FkaW5nIikgfHwgdGhpcy5ydW5uaW5nIHx8IHIgJiYgIWkuY29sbGFwc2libGUgfHwgdGhpcy5fdHJpZ2dlcigiYmVmb3JlQWN0aXZhdGUiLCB0LCB1KSA9PT0gITEgfHwgKGkuYWN0aXZlID0gbyA/ICExIDogdGhpcy50YWJzLmluZGV4KG4pLCB0aGlzLmFjdGl2ZSA9IHIgPyBlKCkgOiBuLCB0aGlzLnhociAmJiB0aGlzLnhoci5hYm9ydCgpLCBoLmxlbmd0aCB8fCBsLmxlbmd0aCB8fCBlLmVycm9yKCJqUXVlcnkgVUkgVGFiczogTWlzbWF0Y2hpbmcgZnJhZ21lbnQgaWRlbnRpZmllci4iKSwgbC5sZW5ndGggJiYgdGhpcy5sb2FkKHRoaXMudGFicy5pbmRleChuKSwgdCksIHRoaXMuX3RvZ2dsZSh0LCB1KSkgfSwgX3RvZ2dsZTogZnVuY3Rpb24gKHQsIGkpIHsgZnVuY3Rpb24gcygpIHsgbi5ydW5uaW5nID0gITEsIG4uX3RyaWdnZXIoImFjdGl2YXRlIiwgdCwgaSkgfSBmdW5jdGlvbiBhKCkgeyBuLl9hZGRDbGFzcyhpLm5ld1RhYi5jbG9zZXN0KCJsaSIpLCAidWktdGFicy1hY3RpdmUiLCAidWktc3RhdGUtYWN0aXZlIiksIHIubGVuZ3RoICYmIG4ub3B0aW9ucy5zaG93ID8gbi5fc2hvdyhyLCBuLm9wdGlvbnMuc2hvdywgcykgOiAoci5zaG93KCksIHMoKSkgfSB2YXIgbiA9IHRoaXMsIHIgPSBpLm5ld1BhbmVsLCBvID0gaS5vbGRQYW5lbDsgdGhpcy5ydW5uaW5nID0gITAsIG8ubGVuZ3RoICYmIHRoaXMub3B0aW9ucy5oaWRlID8gdGhpcy5faGlkZShvLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24gKCkgeyBuLl9yZW1vdmVDbGFzcyhpLm9sZFRhYi5jbG9zZXN0KCJsaSIpLCAidWktdGFicy1hY3RpdmUiLCAidWktc3RhdGUtYWN0aXZlIiksIGEoKSB9KSA6ICh0aGlzLl9yZW1vdmVDbGFzcyhpLm9sZFRhYi5jbG9zZXN0KCJsaSIpLCAidWktdGFicy1hY3RpdmUiLCAidWktc3RhdGUtYWN0aXZlIiksIG8uaGlkZSgpLCBhKCkpLCBvLmF0dHIoImFyaWEtaGlkZGVuIiwgInRydWUiKSwgaS5vbGRUYWIuYXR0cih7ICJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwgImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiIH0pLCByLmxlbmd0aCAmJiBvLmxlbmd0aCA/IGkub2xkVGFiLmF0dHIoInRhYkluZGV4IiwgLTEpIDogci5sZW5ndGggJiYgdGhpcy50YWJzLmZpbHRlcihmdW5jdGlvbiAoKSB7IHJldHVybiAwID09PSBlKHRoaXMpLmF0dHIoInRhYkluZGV4IikgfSkuYXR0cigidGFiSW5kZXgiLCAtMSksIHIuYXR0cigiYXJpYS1oaWRkZW4iLCAiZmFsc2UiKSwgaS5uZXdUYWIuYXR0cih7ICJhcmlhLXNlbGVjdGVkIjogInRydWUiLCAiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwgdGFiSW5kZXg6IDAgfSkgfSwgX2FjdGl2YXRlOiBmdW5jdGlvbiAodCkgeyB2YXIgaSwgcyA9IHRoaXMuX2ZpbmRBY3RpdmUodCk7IHNbMF0gIT09IHRoaXMuYWN0aXZlWzBdICYmIChzLmxlbmd0aCB8fCAocyA9IHRoaXMuYWN0aXZlKSwgaSA9IHMuZmluZCgiLnVpLXRhYnMtYW5jaG9yIilbMF0sIHRoaXMuX2V2ZW50SGFuZGxlcih7IHRhcmdldDogaSwgY3VycmVudFRhcmdldDogaSwgcHJldmVudERlZmF1bHQ6IGUubm9vcCB9KSkgfSwgX2ZpbmRBY3RpdmU6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ID09PSAhMSA/IGUoKSA6IHRoaXMudGFicy5lcSh0KSB9LCBfZ2V0SW5kZXg6IGZ1bmN0aW9uICh0KSB7IHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiAodCA9IHRoaXMuYW5jaG9ycy5pbmRleCh0aGlzLmFuY2hvcnMuZmlsdGVyKCJbaHJlZiQ9JyIgKyBlLnVpLmVzY2FwZVNlbGVjdG9yKHQpICsgIiddIikpKSwgdCB9LCBfZGVzdHJveTogZnVuY3Rpb24gKCkgeyB0aGlzLnhociAmJiB0aGlzLnhoci5hYm9ydCgpLCB0aGlzLnRhYmxpc3QucmVtb3ZlQXR0cigicm9sZSIpLm9mZih0aGlzLmV2ZW50TmFtZXNwYWNlKSwgdGhpcy5hbmNob3JzLnJlbW92ZUF0dHIoInJvbGUgdGFiSW5kZXgiKS5yZW1vdmVVbmlxdWVJZCgpLCB0aGlzLnRhYnMuYWRkKHRoaXMucGFuZWxzKS5lYWNoKGZ1bmN0aW9uICgpIHsgZS5kYXRhKHRoaXMsICJ1aS10YWJzLWRlc3Ryb3kiKSA/IGUodGhpcykucmVtb3ZlKCkgOiBlKHRoaXMpLnJlbW92ZUF0dHIoInJvbGUgdGFiSW5kZXggYXJpYS1saXZlIGFyaWEtYnVzeSBhcmlhLXNlbGVjdGVkIGFyaWEtbGFiZWxsZWRieSBhcmlhLWhpZGRlbiBhcmlhLWV4cGFuZGVkIikgfSksIHRoaXMudGFicy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlKHRoaXMpLCBpID0gdC5kYXRhKCJ1aS10YWJzLWFyaWEtY29udHJvbHMiKTsgaSA/IHQuYXR0cigiYXJpYS1jb250cm9scyIsIGkpLnJlbW92ZURhdGEoInVpLXRhYnMtYXJpYS1jb250cm9scyIpIDogdC5yZW1vdmVBdHRyKCJhcmlhLWNvbnRyb2xzIikgfSksIHRoaXMucGFuZWxzLnNob3coKSwgImNvbnRlbnQiICE9PSB0aGlzLm9wdGlvbnMuaGVpZ2h0U3R5bGUgJiYgdGhpcy5wYW5lbHMuY3NzKCJoZWlnaHQiLCAiIikgfSwgZW5hYmxlOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMub3B0aW9ucy5kaXNhYmxlZDsgaSAhPT0gITEgJiYgKHZvaWQgMCA9PT0gdCA/IGkgPSAhMSA6ICh0ID0gdGhpcy5fZ2V0SW5kZXgodCksIGkgPSBlLmlzQXJyYXkoaSkgPyBlLm1hcChpLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSAhPT0gdCA/IGUgOiBudWxsIH0pIDogZS5tYXAodGhpcy50YWJzLCBmdW5jdGlvbiAoZSwgaSkgeyByZXR1cm4gaSAhPT0gdCA/IGkgOiBudWxsIH0pKSwgdGhpcy5fc2V0T3B0aW9uRGlzYWJsZWQoaSkpIH0sIGRpc2FibGU6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5vcHRpb25zLmRpc2FibGVkOyBpZiAoaSAhPT0gITApIHsgaWYgKHZvaWQgMCA9PT0gdCkgaSA9ICEwOyBlbHNlIHsgaWYgKHQgPSB0aGlzLl9nZXRJbmRleCh0KSwgLTEgIT09IGUuaW5BcnJheSh0LCBpKSkgcmV0dXJuOyBpID0gZS5pc0FycmF5KGkpID8gZS5tZXJnZShbdF0sIGkpLnNvcnQoKSA6IFt0XSB9IHRoaXMuX3NldE9wdGlvbkRpc2FibGVkKGkpIH0gfSwgbG9hZDogZnVuY3Rpb24gKHQsIGkpIHsgdCA9IHRoaXMuX2dldEluZGV4KHQpOyB2YXIgcyA9IHRoaXMsIGEgPSB0aGlzLnRhYnMuZXEodCksIG4gPSBhLmZpbmQoIi51aS10YWJzLWFuY2hvciIpLCByID0gdGhpcy5fZ2V0UGFuZWxGb3JUYWIoYSksIG8gPSB7IHRhYjogYSwgcGFuZWw6IHIgfSwgbCA9IGZ1bmN0aW9uIChlLCB0KSB7ICJhYm9ydCIgPT09IHQgJiYgcy5wYW5lbHMuc3RvcCghMSwgITApLCBzLl9yZW1vdmVDbGFzcyhhLCAidWktdGFicy1sb2FkaW5nIiksIHIucmVtb3ZlQXR0cigiYXJpYS1idXN5IiksIGUgPT09IHMueGhyICYmIGRlbGV0ZSBzLnhociB9OyB0aGlzLl9pc0xvY2FsKG5bMF0pIHx8ICh0aGlzLnhociA9IGUuYWpheCh0aGlzLl9hamF4U2V0dGluZ3MobiwgaSwgbykpLCB0aGlzLnhociAmJiAiY2FuY2VsZWQiICE9PSB0aGlzLnhoci5zdGF0dXNUZXh0ICYmICh0aGlzLl9hZGRDbGFzcyhhLCAidWktdGFicy1sb2FkaW5nIiksIHIuYXR0cigiYXJpYS1idXN5IiwgInRydWUiKSwgdGhpcy54aHIuZG9uZShmdW5jdGlvbiAoZSwgdCwgYSkgeyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgci5odG1sKGUpLCBzLl90cmlnZ2VyKCJsb2FkIiwgaSwgbyksIGwoYSwgdCkgfSwgMSkgfSkuZmFpbChmdW5jdGlvbiAoZSwgdCkgeyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgbChlLCB0KSB9LCAxKSB9KSkpIH0sIF9hamF4U2V0dGluZ3M6IGZ1bmN0aW9uICh0LCBpLCBzKSB7IHZhciBhID0gdGhpczsgcmV0dXJuIHsgdXJsOiB0LmF0dHIoImhyZWYiKS5yZXBsYWNlKC8jLiokLywgIiIpLCBiZWZvcmVTZW5kOiBmdW5jdGlvbiAodCwgbikgeyByZXR1cm4gYS5fdHJpZ2dlcigiYmVmb3JlTG9hZCIsIGksIGUuZXh0ZW5kKHsganFYSFI6IHQsIGFqYXhTZXR0aW5nczogbiB9LCBzKSkgfSB9IH0sIF9nZXRQYW5lbEZvclRhYjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKHQpLmF0dHIoImFyaWEtY29udHJvbHMiKTsgcmV0dXJuIHRoaXMuZWxlbWVudC5maW5kKHRoaXMuX3Nhbml0aXplU2VsZWN0b3IoIiMiICsgaSkpIH0gfSksIGUudWlCYWNrQ29tcGF0ICE9PSAhMSAmJiBlLndpZGdldCgidWkudGFicyIsIGUudWkudGFicywgeyBfcHJvY2Vzc1RhYnM6IGZ1bmN0aW9uICgpIHsgdGhpcy5fc3VwZXJBcHBseShhcmd1bWVudHMpLCB0aGlzLl9hZGRDbGFzcyh0aGlzLnRhYnMsICJ1aS10YWIiKSB9IH0pLCBlLnVpLnRhYnMsIGUud2lkZ2V0KCJ1aS50b29sdGlwIiwgew0KICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjEyLjEiLCBvcHRpb25zOiB7IGNsYXNzZXM6IHsgInVpLXRvb2x0aXAiOiAidWktY29ybmVyLWFsbCB1aS13aWRnZXQtc2hhZG93IiB9LCBjb250ZW50OiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gZSh0aGlzKS5hdHRyKCJ0aXRsZSIpIHx8ICIiOyByZXR1cm4gZSgiPGE+IikudGV4dCh0KS5odG1sKCkgfSwgaGlkZTogITAsIGl0ZW1zOiAiW3RpdGxlXTpub3QoW2Rpc2FibGVkXSkiLCBwb3NpdGlvbjogeyBteTogImxlZnQgdG9wKzE1IiwgYXQ6ICJsZWZ0IGJvdHRvbSIsIGNvbGxpc2lvbjogImZsaXBmaXQgZmxpcCIgfSwgc2hvdzogITAsIHRyYWNrOiAhMSwgY2xvc2U6IG51bGwsIG9wZW46IG51bGwgfSwgX2FkZERlc2NyaWJlZEJ5OiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9ICh0LmF0dHIoImFyaWEtZGVzY3JpYmVkYnkiKSB8fCAiIikuc3BsaXQoL1xzKy8pOyBzLnB1c2goaSksIHQuZGF0YSgidWktdG9vbHRpcC1pZCIsIGkpLmF0dHIoImFyaWEtZGVzY3JpYmVkYnkiLCBlLnRyaW0ocy5qb2luKCIgIikpKSB9LCBfcmVtb3ZlRGVzY3JpYmVkQnk6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdC5kYXRhKCJ1aS10b29sdGlwLWlkIiksIHMgPSAodC5hdHRyKCJhcmlhLWRlc2NyaWJlZGJ5IikgfHwgIiIpLnNwbGl0KC9ccysvKSwgYSA9IGUuaW5BcnJheShpLCBzKTsgLTEgIT09IGEgJiYgcy5zcGxpY2UoYSwgMSksIHQucmVtb3ZlRGF0YSgidWktdG9vbHRpcC1pZCIpLCBzID0gZS50cmltKHMuam9pbigiICIpKSwgcyA/IHQuYXR0cigiYXJpYS1kZXNjcmliZWRieSIsIHMpIDogdC5yZW1vdmVBdHRyKCJhcmlhLWRlc2NyaWJlZGJ5IikgfSwgX2NyZWF0ZTogZnVuY3Rpb24gKCkgeyB0aGlzLl9vbih7IG1vdXNlb3ZlcjogIm9wZW4iLCBmb2N1c2luOiAib3BlbiIgfSksIHRoaXMudG9vbHRpcHMgPSB7fSwgdGhpcy5wYXJlbnRzID0ge30sIHRoaXMubGl2ZVJlZ2lvbiA9IGUoIjxkaXY+IikuYXR0cih7IHJvbGU6ICJsb2ciLCAiYXJpYS1saXZlIjogImFzc2VydGl2ZSIsICJhcmlhLXJlbGV2YW50IjogImFkZGl0aW9ucyIgfSkuYXBwZW5kVG8odGhpcy5kb2N1bWVudFswXS5ib2R5KSwgdGhpcy5fYWRkQ2xhc3ModGhpcy5saXZlUmVnaW9uLCBudWxsLCAidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIiksIHRoaXMuZGlzYWJsZWRUaXRsZXMgPSBlKFtdKSB9LCBfc2V0T3B0aW9uOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IHRoaXM7IHRoaXMuX3N1cGVyKHQsIGkpLCAiY29udGVudCIgPT09IHQgJiYgZS5lYWNoKHRoaXMudG9vbHRpcHMsIGZ1bmN0aW9uIChlLCB0KSB7IHMuX3VwZGF0ZUNvbnRlbnQodC5lbGVtZW50KSB9KSB9LCBfc2V0T3B0aW9uRGlzYWJsZWQ6IGZ1bmN0aW9uIChlKSB7IHRoaXNbZSA/ICJfZGlzYWJsZSIgOiAiX2VuYWJsZSJdKCkgfSwgX2Rpc2FibGU6IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzOyBlLmVhY2godGhpcy50b29sdGlwcywgZnVuY3Rpb24gKGksIHMpIHsgdmFyIGEgPSBlLkV2ZW50KCJibHVyIik7IGEudGFyZ2V0ID0gYS5jdXJyZW50VGFyZ2V0ID0gcy5lbGVtZW50WzBdLCB0LmNsb3NlKGEsICEwKSB9KSwgdGhpcy5kaXNhYmxlZFRpdGxlcyA9IHRoaXMuZGlzYWJsZWRUaXRsZXMuYWRkKHRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5pdGVtcykuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbiAoKSB7IHZhciB0ID0gZSh0aGlzKTsgcmV0dXJuIHQuaXMoIlt0aXRsZV0iKSA/IHQuZGF0YSgidWktdG9vbHRpcC10aXRsZSIsIHQuYXR0cigidGl0bGUiKSkucmVtb3ZlQXR0cigidGl0bGUiKSA6IHZvaWQgMCB9KSkgfSwgX2VuYWJsZTogZnVuY3Rpb24gKCkgeyB0aGlzLmRpc2FibGVkVGl0bGVzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUodGhpcyk7IHQuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpICYmIHQuYXR0cigidGl0bGUiLCB0LmRhdGEoInVpLXRvb2x0aXAtdGl0bGUiKSkgfSksIHRoaXMuZGlzYWJsZWRUaXRsZXMgPSBlKFtdKSB9LCBvcGVuOiBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHRoaXMsIHMgPSBlKHQgPyB0LnRhcmdldCA6IHRoaXMuZWxlbWVudCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuaXRlbXMpOyBzLmxlbmd0aCAmJiAhcy5kYXRhKCJ1aS10b29sdGlwLWlkIikgJiYgKHMuYXR0cigidGl0bGUiKSAmJiBzLmRhdGEoInVpLXRvb2x0aXAtdGl0bGUiLCBzLmF0dHIoInRpdGxlIikpLCBzLmRhdGEoInVpLXRvb2x0aXAtb3BlbiIsICEwKSwgdCAmJiAibW91c2VvdmVyIiA9PT0gdC50eXBlICYmIHMucGFyZW50cygpLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgdCwgcyA9IGUodGhpcyk7IHMuZGF0YSgidWktdG9vbHRpcC1vcGVuIikgJiYgKHQgPSBlLkV2ZW50KCJibHVyIiksIHQudGFyZ2V0ID0gdC5jdXJyZW50VGFyZ2V0ID0gdGhpcywgaS5jbG9zZSh0LCAhMCkpLCBzLmF0dHIoInRpdGxlIikgJiYgKHMudW5pcXVlSWQoKSwgaS5wYXJlbnRzW3RoaXMuaWRdID0geyBlbGVtZW50OiB0aGlzLCB0aXRsZTogcy5hdHRyKCJ0aXRsZSIpIH0sIHMuYXR0cigidGl0bGUiLCAiIikpIH0pLCB0aGlzLl9yZWdpc3RlckNsb3NlSGFuZGxlcnModCwgcyksIHRoaXMuX3VwZGF0ZUNvbnRlbnQocywgdCkpIH0sIF91cGRhdGVDb250ZW50OiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSwgcyA9IHRoaXMub3B0aW9ucy5jb250ZW50LCBhID0gdGhpcywgbiA9IHQgPyB0LnR5cGUgOiBudWxsOyByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHMgfHwgcy5ub2RlVHlwZSB8fCBzLmpxdWVyeSA/IHRoaXMuX29wZW4odCwgZSwgcykgOiAoaSA9IHMuY2FsbChlWzBdLCBmdW5jdGlvbiAoaSkgeyBhLl9kZWxheShmdW5jdGlvbiAoKSB7IGUuZGF0YSgidWktdG9vbHRpcC1vcGVuIikgJiYgKHQgJiYgKHQudHlwZSA9IG4pLCB0aGlzLl9vcGVuKHQsIGUsIGkpKSB9KSB9KSwgaSAmJiB0aGlzLl9vcGVuKHQsIGUsIGkpLCB2b2lkIDApIH0sIF9vcGVuOiBmdW5jdGlvbiAodCwgaSwgcykgeyBmdW5jdGlvbiBhKGUpIHsgaC5vZiA9IGUsIHIuaXMoIjpoaWRkZW4iKSB8fCByLnBvc2l0aW9uKGgpIH0gdmFyIG4sIHIsIG8sIGwsIGggPSBlLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uKTsgaWYgKHMpIHsgaWYgKG4gPSB0aGlzLl9maW5kKGkpKSByZXR1cm4gbi50b29sdGlwLmZpbmQoIi51aS10b29sdGlwLWNvbnRlbnQiKS5odG1sKHMpLCB2b2lkIDA7IGkuaXMoIlt0aXRsZV0iKSAmJiAodCAmJiAibW91c2VvdmVyIiA9PT0gdC50eXBlID8gaS5hdHRyKCJ0aXRsZSIsICIiKSA6IGkucmVtb3ZlQXR0cigidGl0bGUiKSksIG4gPSB0aGlzLl90b29sdGlwKGkpLCByID0gbi50b29sdGlwLCB0aGlzLl9hZGREZXNjcmliZWRCeShpLCByLmF0dHIoImlkIikpLCByLmZpbmQoIi51aS10b29sdGlwLWNvbnRlbnQiKS5odG1sKHMpLCB0aGlzLmxpdmVSZWdpb24uY2hpbGRyZW4oKS5oaWRlKCksIGwgPSBlKCI8ZGl2PiIpLmh0bWwoci5maW5kKCIudWktdG9vbHRpcC1jb250ZW50IikuaHRtbCgpKSwgbC5yZW1vdmVBdHRyKCJuYW1lIikuZmluZCgiW25hbWVdIikucmVtb3ZlQXR0cigibmFtZSIpLCBsLnJlbW92ZUF0dHIoImlkIikuZmluZCgiW2lkXSIpLnJlbW92ZUF0dHIoImlkIiksIGwuYXBwZW5kVG8odGhpcy5saXZlUmVnaW9uKSwgdGhpcy5vcHRpb25zLnRyYWNrICYmIHQgJiYgL15tb3VzZS8udGVzdCh0LnR5cGUpID8gKHRoaXMuX29uKHRoaXMuZG9jdW1lbnQsIHsgbW91c2Vtb3ZlOiBhIH0pLCBhKHQpKSA6IHIucG9zaXRpb24oZS5leHRlbmQoeyBvZjogaSB9LCB0aGlzLm9wdGlvbnMucG9zaXRpb24pKSwgci5oaWRlKCksIHRoaXMuX3Nob3cociwgdGhpcy5vcHRpb25zLnNob3cpLCB0aGlzLm9wdGlvbnMudHJhY2sgJiYgdGhpcy5vcHRpb25zLnNob3cgJiYgdGhpcy5vcHRpb25zLnNob3cuZGVsYXkgJiYgKG8gPSB0aGlzLmRlbGF5ZWRTaG93ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyByLmlzKCI6dmlzaWJsZSIpICYmIChhKGgub2YpLCBjbGVhckludGVydmFsKG8pKSB9LCBlLmZ4LmludGVydmFsKSksIHRoaXMuX3RyaWdnZXIoIm9wZW4iLCB0LCB7IHRvb2x0aXA6IHIgfSkgfSB9LCBfcmVnaXN0ZXJDbG9zZUhhbmRsZXJzOiBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IHsga2V5dXA6IGZ1bmN0aW9uICh0KSB7IGlmICh0LmtleUNvZGUgPT09IGUudWkua2V5Q29kZS5FU0NBUEUpIHsgdmFyIHMgPSBlLkV2ZW50KHQpOyBzLmN1cnJlbnRUYXJnZXQgPSBpWzBdLCB0aGlzLmNsb3NlKHMsICEwKSB9IH0gfTsgaVswXSAhPT0gdGhpcy5lbGVtZW50WzBdICYmIChzLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fcmVtb3ZlVG9vbHRpcCh0aGlzLl9maW5kKGkpLnRvb2x0aXApIH0pLCB0ICYmICJtb3VzZW92ZXIiICE9PSB0LnR5cGUgfHwgKHMubW91c2VsZWF2ZSA9ICJjbG9zZSIpLCB0ICYmICJmb2N1c2luIiAhPT0gdC50eXBlIHx8IChzLmZvY3Vzb3V0ID0gImNsb3NlIiksIHRoaXMuX29uKCEwLCBpLCBzKSB9LCBjbG9zZTogZnVuY3Rpb24gKHQpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGksIHMgPSB0aGlzLCBhID0gZSh0ID8gdC5jdXJyZW50VGFyZ2V0IDogdGhpcy5lbGVtZW50KSwgbiA9IHRoaXMuX2ZpbmQoYSk7IHJldHVybiBuID8gKGkgPSBuLnRvb2x0aXAsIG4uY2xvc2luZyB8fCAoY2xlYXJJbnRlcnZhbCh0aGlzLmRlbGF5ZWRTaG93KSwgYS5kYXRhKCJ1aS10b29sdGlwLXRpdGxlIikgJiYgIWEuYXR0cigidGl0bGUiKSAmJiBhLmF0dHIoInRpdGxlIiwgYS5kYXRhKCJ1aS10b29sdGlwLXRpdGxlIikpLCB0aGlzLl9yZW1vdmVEZXNjcmliZWRCeShhKSwgbi5oaWRpbmcgPSAhMCwgaS5zdG9wKCEwKSwgdGhpcy5faGlkZShpLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24gKCkgeyBzLl9yZW1vdmVUb29sdGlwKGUodGhpcykpIH0pLCBhLnJlbW92ZURhdGEoInVpLXRvb2x0aXAtb3BlbiIpLCB0aGlzLl9vZmYoYSwgIm1vdXNlbGVhdmUgZm9jdXNvdXQga2V5dXAiKSwgYVswXSAhPT0gdGhpcy5lbGVtZW50WzBdICYmIHRoaXMuX29mZihhLCAicmVtb3ZlIiksIHRoaXMuX29mZih0aGlzLmRvY3VtZW50LCAibW91c2Vtb3ZlIiksIHQgJiYgIm1vdXNlbGVhdmUiID09PSB0LnR5cGUgJiYgZS5lYWNoKHRoaXMucGFyZW50cywgZnVuY3Rpb24gKHQsIGkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGUoaS5lbGVtZW50KS5hdHRyKCJ0aXRsZSIsIGkudGl0bGUpLCBkZWxldGUgcy5wYXJlbnRzW3RdDQogICAgICAgICAgICAgICAgICAgIH0pLCBuLmNsb3NpbmcgPSAhMCwgdGhpcy5fdHJpZ2dlcigiY2xvc2UiLCB0LCB7IHRvb2x0aXA6IGkgfSksIG4uaGlkaW5nIHx8IChuLmNsb3NpbmcgPSAhMSkpLCB2b2lkIDApIDogKGEucmVtb3ZlRGF0YSgidWktdG9vbHRpcC1vcGVuIiksIHZvaWQgMCkNCiAgICAgICAgICAgICAgICB9LCBfdG9vbHRpcDogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKCI8ZGl2PiIpLmF0dHIoInJvbGUiLCAidG9vbHRpcCIpLCBzID0gZSgiPGRpdj4iKS5hcHBlbmRUbyhpKSwgYSA9IGkudW5pcXVlSWQoKS5hdHRyKCJpZCIpOyByZXR1cm4gdGhpcy5fYWRkQ2xhc3MocywgInVpLXRvb2x0aXAtY29udGVudCIpLCB0aGlzLl9hZGRDbGFzcyhpLCAidWktdG9vbHRpcCIsICJ1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQiKSwgaS5hcHBlbmRUbyh0aGlzLl9hcHBlbmRUbyh0KSksIHRoaXMudG9vbHRpcHNbYV0gPSB7IGVsZW1lbnQ6IHQsIHRvb2x0aXA6IGkgfSB9LCBfZmluZDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLmRhdGEoInVpLXRvb2x0aXAtaWQiKTsgcmV0dXJuIHQgPyB0aGlzLnRvb2x0aXBzW3RdIDogbnVsbCB9LCBfcmVtb3ZlVG9vbHRpcDogZnVuY3Rpb24gKGUpIHsgZS5yZW1vdmUoKSwgZGVsZXRlIHRoaXMudG9vbHRpcHNbZS5hdHRyKCJpZCIpXSB9LCBfYXBwZW5kVG86IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5jbG9zZXN0KCIudWktZnJvbnQsIGRpYWxvZyIpOyByZXR1cm4gdC5sZW5ndGggfHwgKHQgPSB0aGlzLmRvY3VtZW50WzBdLmJvZHkpLCB0IH0sIF9kZXN0cm95OiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpczsgZS5lYWNoKHRoaXMudG9vbHRpcHMsIGZ1bmN0aW9uIChpLCBzKSB7IHZhciBhID0gZS5FdmVudCgiYmx1ciIpLCBuID0gcy5lbGVtZW50OyBhLnRhcmdldCA9IGEuY3VycmVudFRhcmdldCA9IG5bMF0sIHQuY2xvc2UoYSwgITApLCBlKCIjIiArIGkpLnJlbW92ZSgpLCBuLmRhdGEoInVpLXRvb2x0aXAtdGl0bGUiKSAmJiAobi5hdHRyKCJ0aXRsZSIpIHx8IG4uYXR0cigidGl0bGUiLCBuLmRhdGEoInVpLXRvb2x0aXAtdGl0bGUiKSksIG4ucmVtb3ZlRGF0YSgidWktdG9vbHRpcC10aXRsZSIpKSB9KSwgdGhpcy5saXZlUmVnaW9uLnJlbW92ZSgpIH0NCiAgICAgICAgICAgIH0pLCBlLnVpQmFja0NvbXBhdCAhPT0gITEgJiYgZS53aWRnZXQoInVpLnRvb2x0aXAiLCBlLnVpLnRvb2x0aXAsIHsgb3B0aW9uczogeyB0b29sdGlwQ2xhc3M6IG51bGwgfSwgX3Rvb2x0aXA6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLl9zdXBlckFwcGx5KGFyZ3VtZW50cyk7IHJldHVybiB0aGlzLm9wdGlvbnMudG9vbHRpcENsYXNzICYmIGUudG9vbHRpcC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMudG9vbHRpcENsYXNzKSwgZSB9IH0pLCBlLnVpLnRvb2x0aXA7IHZhciBtID0gInVpLWVmZmVjdHMtIiwgZiA9ICJ1aS1lZmZlY3RzLXN0eWxlIiwgZyA9ICJ1aS1lZmZlY3RzLWFuaW1hdGVkIiwgdiA9IGU7IGUuZWZmZWN0cyA9IHsgZWZmZWN0OiB7fSB9LCBmdW5jdGlvbiAoZSwgdCkgeyBmdW5jdGlvbiBpKGUsIHQsIGkpIHsgdmFyIHMgPSBkW3QudHlwZV0gfHwge307IHJldHVybiBudWxsID09IGUgPyBpIHx8ICF0LmRlZiA/IG51bGwgOiB0LmRlZiA6IChlID0gcy5mbG9vciA/IH5+ZSA6IHBhcnNlRmxvYXQoZSksIGlzTmFOKGUpID8gdC5kZWYgOiBzLm1vZCA/IChlICsgcy5tb2QpICUgcy5tb2QgOiAwID4gZSA/IDAgOiBlID4gcy5tYXggPyBzLm1heCA6IGUpIH0gZnVuY3Rpb24gcyhpKSB7IHZhciBzID0gaCgpLCBhID0gcy5fcmdiYSA9IFtdOyByZXR1cm4gaSA9IGkudG9Mb3dlckNhc2UoKSwgbShsLCBmdW5jdGlvbiAoZSwgbikgeyB2YXIgciwgbyA9IG4ucmUuZXhlYyhpKSwgbCA9IG8gJiYgbi5wYXJzZShvKSwgaCA9IG4uc3BhY2UgfHwgInJnYmEiOyByZXR1cm4gbCA/IChyID0gc1toXShsKSwgc1t1W2hdLmNhY2hlXSA9IHJbdVtoXS5jYWNoZV0sIGEgPSBzLl9yZ2JhID0gci5fcmdiYSwgITEpIDogdCB9KSwgYS5sZW5ndGggPyAoIjAsMCwwLDAiID09PSBhLmpvaW4oKSAmJiBlLmV4dGVuZChhLCBuLnRyYW5zcGFyZW50KSwgcykgOiBuW2ldIH0gZnVuY3Rpb24gYShlLCB0LCBpKSB7IHJldHVybiBpID0gKGkgKyAxKSAlIDEsIDEgPiA2ICogaSA/IGUgKyA2ICogKHQgLSBlKSAqIGkgOiAxID4gMiAqIGkgPyB0IDogMiA+IDMgKiBpID8gZSArIDYgKiAodCAtIGUpICogKDIgLyAzIC0gaSkgOiBlIH0gdmFyIG4sIHIgPSAiYmFja2dyb3VuZENvbG9yIGJvcmRlckJvdHRvbUNvbG9yIGJvcmRlckxlZnRDb2xvciBib3JkZXJSaWdodENvbG9yIGJvcmRlclRvcENvbG9yIGNvbG9yIGNvbHVtblJ1bGVDb2xvciBvdXRsaW5lQ29sb3IgdGV4dERlY29yYXRpb25Db2xvciB0ZXh0RW1waGFzaXNDb2xvciIsIG8gPSAvXihbXC0rXSk9XHMqKFxkK1wuP1xkKikvLCBsID0gW3sgcmU6IC9yZ2JhP1woXHMqKFxkezEsM30pXHMqLFxzKihcZHsxLDN9KVxzKixccyooXGR7MSwzfSlccyooPzosXHMqKFxkPyg/OlwuXGQrKT8pXHMqKT9cKS8sIHBhcnNlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gW2VbMV0sIGVbMl0sIGVbM10sIGVbNF1dIH0gfSwgeyByZTogL3JnYmE/XChccyooXGQrKD86XC5cZCspPylcJVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKig/OixccyooXGQ/KD86XC5cZCspPylccyopP1wpLywgcGFyc2U6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBbMi41NSAqIGVbMV0sIDIuNTUgKiBlWzJdLCAyLjU1ICogZVszXSwgZVs0XV0gfSB9LCB7IHJlOiAvIyhbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pKFthLWYwLTldezJ9KS8sIHBhcnNlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gW3BhcnNlSW50KGVbMV0sIDE2KSwgcGFyc2VJbnQoZVsyXSwgMTYpLCBwYXJzZUludChlWzNdLCAxNildIH0gfSwgeyByZTogLyMoW2EtZjAtOV0pKFthLWYwLTldKShbYS1mMC05XSkvLCBwYXJzZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFtwYXJzZUludChlWzFdICsgZVsxXSwgMTYpLCBwYXJzZUludChlWzJdICsgZVsyXSwgMTYpLCBwYXJzZUludChlWzNdICsgZVszXSwgMTYpXSB9IH0sIHsgcmU6IC9oc2xhP1woXHMqKFxkKyg/OlwuXGQrKT8pXHMqLFxzKihcZCsoPzpcLlxkKyk/KVwlXHMqLFxzKihcZCsoPzpcLlxkKyk/KVwlXHMqKD86LFxzKihcZD8oPzpcLlxkKyk/KVxzKik/XCkvLCBzcGFjZTogImhzbGEiLCBwYXJzZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFtlWzFdLCBlWzJdIC8gMTAwLCBlWzNdIC8gMTAwLCBlWzRdXSB9IH1dLCBoID0gZS5Db2xvciA9IGZ1bmN0aW9uICh0LCBpLCBzLCBhKSB7IHJldHVybiBuZXcgZS5Db2xvci5mbi5wYXJzZSh0LCBpLCBzLCBhKSB9LCB1ID0geyByZ2JhOiB7IHByb3BzOiB7IHJlZDogeyBpZHg6IDAsIHR5cGU6ICJieXRlIiB9LCBncmVlbjogeyBpZHg6IDEsIHR5cGU6ICJieXRlIiB9LCBibHVlOiB7IGlkeDogMiwgdHlwZTogImJ5dGUiIH0gfSB9LCBoc2xhOiB7IHByb3BzOiB7IGh1ZTogeyBpZHg6IDAsIHR5cGU6ICJkZWdyZWVzIiB9LCBzYXR1cmF0aW9uOiB7IGlkeDogMSwgdHlwZTogInBlcmNlbnQiIH0sIGxpZ2h0bmVzczogeyBpZHg6IDIsIHR5cGU6ICJwZXJjZW50IiB9IH0gfSB9LCBkID0geyAiYnl0ZSI6IHsgZmxvb3I6ICEwLCBtYXg6IDI1NSB9LCBwZXJjZW50OiB7IG1heDogMSB9LCBkZWdyZWVzOiB7IG1vZDogMzYwLCBmbG9vcjogITAgfSB9LCBjID0gaC5zdXBwb3J0ID0ge30sIHAgPSBlKCI8cD4iKVswXSwgbSA9IGUuZWFjaDsgcC5zdHlsZS5jc3NUZXh0ID0gImJhY2tncm91bmQtY29sb3I6cmdiYSgxLDEsMSwuNSkiLCBjLnJnYmEgPSBwLnN0eWxlLmJhY2tncm91bmRDb2xvci5pbmRleE9mKCJyZ2JhIikgPiAtMSwgbSh1LCBmdW5jdGlvbiAoZSwgdCkgeyB0LmNhY2hlID0gIl8iICsgZSwgdC5wcm9wcy5hbHBoYSA9IHsgaWR4OiAzLCB0eXBlOiAicGVyY2VudCIsIGRlZjogMSB9IH0pLCBoLmZuID0gZS5leHRlbmQoaC5wcm90b3R5cGUsIHsgcGFyc2U6IGZ1bmN0aW9uIChhLCByLCBvLCBsKSB7IGlmIChhID09PSB0KSByZXR1cm4gdGhpcy5fcmdiYSA9IFtudWxsLCBudWxsLCBudWxsLCBudWxsXSwgdGhpczsgKGEuanF1ZXJ5IHx8IGEubm9kZVR5cGUpICYmIChhID0gZShhKS5jc3MociksIHIgPSB0KTsgdmFyIGQgPSB0aGlzLCBjID0gZS50eXBlKGEpLCBwID0gdGhpcy5fcmdiYSA9IFtdOyByZXR1cm4gciAhPT0gdCAmJiAoYSA9IFthLCByLCBvLCBsXSwgYyA9ICJhcnJheSIpLCAic3RyaW5nIiA9PT0gYyA/IHRoaXMucGFyc2UocyhhKSB8fCBuLl9kZWZhdWx0KSA6ICJhcnJheSIgPT09IGMgPyAobSh1LnJnYmEucHJvcHMsIGZ1bmN0aW9uIChlLCB0KSB7IHBbdC5pZHhdID0gaShhW3QuaWR4XSwgdCkgfSksIHRoaXMpIDogIm9iamVjdCIgPT09IGMgPyAoYSBpbnN0YW5jZW9mIGggPyBtKHUsIGZ1bmN0aW9uIChlLCB0KSB7IGFbdC5jYWNoZV0gJiYgKGRbdC5jYWNoZV0gPSBhW3QuY2FjaGVdLnNsaWNlKCkpIH0pIDogbSh1LCBmdW5jdGlvbiAodCwgcykgeyB2YXIgbiA9IHMuY2FjaGU7IG0ocy5wcm9wcywgZnVuY3Rpb24gKGUsIHQpIHsgaWYgKCFkW25dICYmIHMudG8pIHsgaWYgKCJhbHBoYSIgPT09IGUgfHwgbnVsbCA9PSBhW2VdKSByZXR1cm47IGRbbl0gPSBzLnRvKGQuX3JnYmEpIH0gZFtuXVt0LmlkeF0gPSBpKGFbZV0sIHQsICEwKSB9KSwgZFtuXSAmJiAwID4gZS5pbkFycmF5KG51bGwsIGRbbl0uc2xpY2UoMCwgMykpICYmIChkW25dWzNdID0gMSwgcy5mcm9tICYmIChkLl9yZ2JhID0gcy5mcm9tKGRbbl0pKSkgfSksIHRoaXMpIDogdCB9LCBpczogZnVuY3Rpb24gKGUpIHsgdmFyIGkgPSBoKGUpLCBzID0gITAsIGEgPSB0aGlzOyByZXR1cm4gbSh1LCBmdW5jdGlvbiAoZSwgbikgeyB2YXIgciwgbyA9IGlbbi5jYWNoZV07IHJldHVybiBvICYmIChyID0gYVtuLmNhY2hlXSB8fCBuLnRvICYmIG4udG8oYS5fcmdiYSkgfHwgW10sIG0obi5wcm9wcywgZnVuY3Rpb24gKGUsIGkpIHsgcmV0dXJuIG51bGwgIT0gb1tpLmlkeF0gPyBzID0gb1tpLmlkeF0gPT09IHJbaS5pZHhdIDogdCB9KSksIHMgfSksIHMgfSwgX3NwYWNlOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gW10sIHQgPSB0aGlzOyByZXR1cm4gbSh1LCBmdW5jdGlvbiAoaSwgcykgeyB0W3MuY2FjaGVdICYmIGUucHVzaChpKSB9KSwgZS5wb3AoKSB9LCB0cmFuc2l0aW9uOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgcyA9IGgoZSksIGEgPSBzLl9zcGFjZSgpLCBuID0gdVthXSwgciA9IDAgPT09IHRoaXMuYWxwaGEoKSA/IGgoInRyYW5zcGFyZW50IikgOiB0aGlzLCBvID0gcltuLmNhY2hlXSB8fCBuLnRvKHIuX3JnYmEpLCBsID0gby5zbGljZSgpOyByZXR1cm4gcyA9IHNbbi5jYWNoZV0sIG0obi5wcm9wcywgZnVuY3Rpb24gKGUsIGEpIHsgdmFyIG4gPSBhLmlkeCwgciA9IG9bbl0sIGggPSBzW25dLCB1ID0gZFthLnR5cGVdIHx8IHt9OyBudWxsICE9PSBoICYmIChudWxsID09PSByID8gbFtuXSA9IGggOiAodS5tb2QgJiYgKGggLSByID4gdS5tb2QgLyAyID8gciArPSB1Lm1vZCA6IHIgLSBoID4gdS5tb2QgLyAyICYmIChyIC09IHUubW9kKSksIGxbbl0gPSBpKChoIC0gcikgKiB0ICsgciwgYSkpKSB9KSwgdGhpc1thXShsKSB9LCBibGVuZDogZnVuY3Rpb24gKHQpIHsgaWYgKDEgPT09IHRoaXMuX3JnYmFbM10pIHJldHVybiB0aGlzOyB2YXIgaSA9IHRoaXMuX3JnYmEuc2xpY2UoKSwgcyA9IGkucG9wKCksIGEgPSBoKHQpLl9yZ2JhOyByZXR1cm4gaChlLm1hcChpLCBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gKDEgLSBzKSAqIGFbdF0gKyBzICogZSB9KSkgfSwgdG9SZ2JhU3RyaW5nOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gInJnYmEoIiwgaSA9IGUubWFwKHRoaXMuX3JnYmEsIGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBudWxsID09IGUgPyB0ID4gMiA/IDEgOiAwIDogZSB9KTsgcmV0dXJuIDEgPT09IGlbM10gJiYgKGkucG9wKCksIHQgPSAicmdiKCIpLCB0ICsgaS5qb2luKCkgKyAiKSIgfSwgdG9Ic2xhU3RyaW5nOiBmdW5jdGlvbiAoKSB7IHZhciB0ID0gImhzbGEoIiwgaSA9IGUubWFwKHRoaXMuaHNsYSgpLCBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gbnVsbCA9PSBlICYmIChlID0gdCA+IDIgPyAxIDogMCksIHQgJiYgMyA+IHQgJiYgKGUgPSBNYXRoLnJvdW5kKDEwMCAqIGUpICsgIiUiKSwgZSB9KTsgcmV0dXJuIDEgPT09IGlbM10gJiYgKGkucG9wKCksIHQgPSAiaHNsKCIpLCB0ICsgaS5qb2luKCkgKyAiKSIgfSwgdG9IZXhTdHJpbmc6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gdGhpcy5fcmdiYS5zbGljZSgpLCBzID0gaS5wb3AoKTsgcmV0dXJuIHQgJiYgaS5wdXNoKH5+KDI1NSAqIHMpKSwgIiMiICsgZS5tYXAoaSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgPSAoZSB8fCAwKS50b1N0cmluZygxNiksIDEgPT09IGUubGVuZ3RoID8gIjAiICsgZSA6IGUgfSkuam9pbigiIikgfSwgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDAgPT09IHRoaXMuX3JnYmFbM10gPyAidHJhbnNwYXJlbnQiIDogdGhpcy50b1JnYmFTdHJpbmcoKSB9IH0pLCBoLmZuLnBhcnNlLnByb3RvdHlwZSA9IGguZm4sIHUuaHNsYS50byA9IGZ1bmN0aW9uIChlKSB7IGlmIChudWxsID09IGVbMF0gfHwgbnVsbCA9PSBlWzFdIHx8IG51bGwgPT0gZVsyXSkgcmV0dXJuIFtudWxsLCBudWxsLCBudWxsLCBlWzNdXTsgdmFyIHQsIGksIHMgPSBlWzBdIC8gMjU1LCBhID0gZVsxXSAvIDI1NSwgbiA9IGVbMl0gLyAyNTUsIHIgPSBlWzNdLCBvID0gTWF0aC5tYXgocywgYSwgbiksIGwgPSBNYXRoLm1pbihzLCBhLCBuKSwgaCA9IG8gLSBsLCB1ID0gbyArIGwsIGQgPSAuNSAqIHU7IHJldHVybiB0ID0gbCA9PT0gbyA/IDAgOiBzID09PSBvID8gNjAgKiAoYSAtIG4pIC8gaCArIDM2MCA6IGEgPT09IG8gPyA2MCAqIChuIC0gcykgLyBoICsgMTIwIDogNjAgKiAocyAtIGEpIC8gaCArIDI0MCwgaSA9IDAgPT09IGggPyAwIDogLjUgPj0gZCA/IGggLyB1IDogaCAvICgyIC0gdSksIFtNYXRoLnJvdW5kKHQpICUgMzYwLCBpLCBkLCBudWxsID09IHIgPyAxIDogcl0gfSwgdS5oc2xhLmZyb20gPSBmdW5jdGlvbiAoZSkgeyBpZiAobnVsbCA9PSBlWzBdIHx8IG51bGwgPT0gZVsxXSB8fCBudWxsID09IGVbMl0pIHJldHVybiBbbnVsbCwgbnVsbCwgbnVsbCwgZVszXV07IHZhciB0ID0gZVswXSAvIDM2MCwgaSA9IGVbMV0sIHMgPSBlWzJdLCBuID0gZVszXSwgciA9IC41ID49IHMgPyBzICogKDEgKyBpKSA6IHMgKyBpIC0gcyAqIGksIG8gPSAyICogcyAtIHI7IHJldHVybiBbTWF0aC5yb3VuZCgyNTUgKiBhKG8sIHIsIHQgKyAxIC8gMykpLCBNYXRoLnJvdW5kKDI1NSAqIGEobywgciwgdCkpLCBNYXRoLnJvdW5kKDI1NSAqIGEobywgciwgdCAtIDEgLyAzKSksIG5dIH0sIG0odSwgZnVuY3Rpb24gKHMsIGEpIHsgdmFyIG4gPSBhLnByb3BzLCByID0gYS5jYWNoZSwgbCA9IGEudG8sIHUgPSBhLmZyb207IGguZm5bc10gPSBmdW5jdGlvbiAocykgeyBpZiAobCAmJiAhdGhpc1tyXSAmJiAodGhpc1tyXSA9IGwodGhpcy5fcmdiYSkpLCBzID09PSB0KSByZXR1cm4gdGhpc1tyXS5zbGljZSgpOyB2YXIgYSwgbyA9IGUudHlwZShzKSwgZCA9ICJhcnJheSIgPT09IG8gfHwgIm9iamVjdCIgPT09IG8gPyBzIDogYXJndW1lbnRzLCBjID0gdGhpc1tyXS5zbGljZSgpOyByZXR1cm4gbShuLCBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgcyA9IGRbIm9iamVjdCIgPT09IG8gPyBlIDogdC5pZHhdOyBudWxsID09IHMgJiYgKHMgPSBjW3QuaWR4XSksIGNbdC5pZHhdID0gaShzLCB0KSB9KSwgdSA/IChhID0gaCh1KGMpKSwgYVtyXSA9IGMsIGEpIDogaChjKSB9LCBtKG4sIGZ1bmN0aW9uICh0LCBpKSB7IGguZm5bdF0gfHwgKGguZm5bdF0gPSBmdW5jdGlvbiAoYSkgeyB2YXIgbiwgciA9IGUudHlwZShhKSwgbCA9ICJhbHBoYSIgPT09IHQgPyB0aGlzLl9oc2xhID8gImhzbGEiIDogInJnYmEiIDogcywgaCA9IHRoaXNbbF0oKSwgdSA9IGhbaS5pZHhdOyByZXR1cm4gInVuZGVmaW5lZCIgPT09IHIgPyB1IDogKCJmdW5jdGlvbiIgPT09IHIgJiYgKGEgPSBhLmNhbGwodGhpcywgdSksIHIgPSBlLnR5cGUoYSkpLCBudWxsID09IGEgJiYgaS5lbXB0eSA/IHRoaXMgOiAoInN0cmluZyIgPT09IHIgJiYgKG4gPSBvLmV4ZWMoYSksIG4gJiYgKGEgPSB1ICsgcGFyc2VGbG9hdChuWzJdKSAqICgiKyIgPT09IG5bMV0gPyAxIDogLTEpKSksIGhbaS5pZHhdID0gYSwgdGhpc1tsXShoKSkpIH0pIH0pIH0pLCBoLmhvb2sgPSBmdW5jdGlvbiAodCkgeyB2YXIgaSA9IHQuc3BsaXQoIiAiKTsgbShpLCBmdW5jdGlvbiAodCwgaSkgeyBlLmNzc0hvb2tzW2ldID0geyBzZXQ6IGZ1bmN0aW9uICh0LCBhKSB7IHZhciBuLCByLCBvID0gIiI7IGlmICgidHJhbnNwYXJlbnQiICE9PSBhICYmICgic3RyaW5nIiAhPT0gZS50eXBlKGEpIHx8IChuID0gcyhhKSkpKSB7IGlmIChhID0gaChuIHx8IGEpLCAhYy5yZ2JhICYmIDEgIT09IGEuX3JnYmFbM10pIHsgZm9yIChyID0gImJhY2tncm91bmRDb2xvciIgPT09IGkgPyB0LnBhcmVudE5vZGUgOiB0OyAoIiIgPT09IG8gfHwgInRyYW5zcGFyZW50IiA9PT0gbykgJiYgciAmJiByLnN0eWxlOyl0cnkgeyBvID0gZS5jc3MociwgImJhY2tncm91bmRDb2xvciIpLCByID0gci5wYXJlbnROb2RlIH0gY2F0Y2ggKGwpIHsgfSBhID0gYS5ibGVuZChvICYmICJ0cmFuc3BhcmVudCIgIT09IG8gPyBvIDogIl9kZWZhdWx0IikgfSBhID0gYS50b1JnYmFTdHJpbmcoKSB9IHRyeSB7IHQuc3R5bGVbaV0gPSBhIH0gY2F0Y2ggKGwpIHsgfSB9IH0sIGUuZnguc3RlcFtpXSA9IGZ1bmN0aW9uICh0KSB7IHQuY29sb3JJbml0IHx8ICh0LnN0YXJ0ID0gaCh0LmVsZW0sIGkpLCB0LmVuZCA9IGgodC5lbmQpLCB0LmNvbG9ySW5pdCA9ICEwKSwgZS5jc3NIb29rc1tpXS5zZXQodC5lbGVtLCB0LnN0YXJ0LnRyYW5zaXRpb24odC5lbmQsIHQucG9zKSkgfSB9KSB9LCBoLmhvb2sociksIGUuY3NzSG9va3MuYm9yZGVyQ29sb3IgPSB7IGV4cGFuZDogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSB7fTsgcmV0dXJuIG0oWyJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiXSwgZnVuY3Rpb24gKGksIHMpIHsgdFsiYm9yZGVyIiArIHMgKyAiQ29sb3IiXSA9IGUgfSksIHQgfSB9LCBuID0gZS5Db2xvci5uYW1lcyA9IHsgYXF1YTogIiMwMGZmZmYiLCBibGFjazogIiMwMDAwMDAiLCBibHVlOiAiIzAwMDBmZiIsIGZ1Y2hzaWE6ICIjZmYwMGZmIiwgZ3JheTogIiM4MDgwODAiLCBncmVlbjogIiMwMDgwMDAiLCBsaW1lOiAiIzAwZmYwMCIsIG1hcm9vbjogIiM4MDAwMDAiLCBuYXZ5OiAiIzAwMDA4MCIsIG9saXZlOiAiIzgwODAwMCIsIHB1cnBsZTogIiM4MDAwODAiLCByZWQ6ICIjZmYwMDAwIiwgc2lsdmVyOiAiI2MwYzBjMCIsIHRlYWw6ICIjMDA4MDgwIiwgd2hpdGU6ICIjZmZmZmZmIiwgeWVsbG93OiAiI2ZmZmYwMCIsIHRyYW5zcGFyZW50OiBbbnVsbCwgbnVsbCwgbnVsbCwgMF0sIF9kZWZhdWx0OiAiI2ZmZmZmZiIgfSB9KHYpLCBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB2YXIgaSwgcywgYSA9IHQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyA/IHQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHQsIG51bGwpIDogdC5jdXJyZW50U3R5bGUsIG4gPSB7fTsgaWYgKGEgJiYgYS5sZW5ndGggJiYgYVswXSAmJiBhW2FbMF1dKSBmb3IgKHMgPSBhLmxlbmd0aDsgcy0tOylpID0gYVtzXSwgInN0cmluZyIgPT0gdHlwZW9mIGFbaV0gJiYgKG5bZS5jYW1lbENhc2UoaSldID0gYVtpXSk7IGVsc2UgZm9yIChpIGluIGEpICJzdHJpbmciID09IHR5cGVvZiBhW2ldICYmIChuW2ldID0gYVtpXSk7IHJldHVybiBuIH0gZnVuY3Rpb24gaSh0LCBpKSB7IHZhciBzLCBuLCByID0ge307IGZvciAocyBpbiBpKSBuID0gaVtzXSwgdFtzXSAhPT0gbiAmJiAoYVtzXSB8fCAoZS5meC5zdGVwW3NdIHx8ICFpc05hTihwYXJzZUZsb2F0KG4pKSkgJiYgKHJbc10gPSBuKSk7IHJldHVybiByIH0gdmFyIHMgPSBbImFkZCIsICJyZW1vdmUiLCAidG9nZ2xlIl0sIGEgPSB7IGJvcmRlcjogMSwgYm9yZGVyQm90dG9tOiAxLCBib3JkZXJDb2xvcjogMSwgYm9yZGVyTGVmdDogMSwgYm9yZGVyUmlnaHQ6IDEsIGJvcmRlclRvcDogMSwgYm9yZGVyV2lkdGg6IDEsIG1hcmdpbjogMSwgcGFkZGluZzogMSB9OyBlLmVhY2goWyJib3JkZXJMZWZ0U3R5bGUiLCAiYm9yZGVyUmlnaHRTdHlsZSIsICJib3JkZXJCb3R0b21TdHlsZSIsICJib3JkZXJUb3BTdHlsZSJdLCBmdW5jdGlvbiAodCwgaSkgeyBlLmZ4LnN0ZXBbaV0gPSBmdW5jdGlvbiAoZSkgeyAoIm5vbmUiICE9PSBlLmVuZCAmJiAhZS5zZXRBdHRyIHx8IDEgPT09IGUucG9zICYmICFlLnNldEF0dHIpICYmICh2LnN0eWxlKGUuZWxlbSwgaSwgZS5lbmQpLCBlLnNldEF0dHIgPSAhMCkgfSB9KSwgZS5mbi5hZGRCYWNrIHx8IChlLmZuLmFkZEJhY2sgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5hZGQobnVsbCA9PSBlID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSkgfSksIGUuZWZmZWN0cy5hbmltYXRlQ2xhc3MgPSBmdW5jdGlvbiAoYSwgbiwgciwgbykgeyB2YXIgbCA9IGUuc3BlZWQobiwgciwgbyk7IHJldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uICgpIHsgdmFyIG4sIHIgPSBlKHRoaXMpLCBvID0gci5hdHRyKCJjbGFzcyIpIHx8ICIiLCBoID0gbC5jaGlsZHJlbiA/IHIuZmluZCgiKiIpLmFkZEJhY2soKSA6IHI7IGggPSBoLm1hcChmdW5jdGlvbiAoKSB7IHZhciBpID0gZSh0aGlzKTsgcmV0dXJuIHsgZWw6IGksIHN0YXJ0OiB0KHRoaXMpIH0gfSksIG4gPSBmdW5jdGlvbiAoKSB7IGUuZWFjaChzLCBmdW5jdGlvbiAoZSwgdCkgeyBhW3RdICYmIHJbdCArICJDbGFzcyJdKGFbdF0pIH0pIH0sIG4oKSwgaCA9IGgubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZW5kID0gdCh0aGlzLmVsWzBdKSwgdGhpcy5kaWZmID0gaSh0aGlzLnN0YXJ0LCB0aGlzLmVuZCksIHRoaXMgfSksIHIuYXR0cigiY2xhc3MiLCBvKSwgaCA9IGgubWFwKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLCBpID0gZS5EZWZlcnJlZCgpLCBzID0gZS5leHRlbmQoe30sIGwsIHsgcXVldWU6ICExLCBjb21wbGV0ZTogZnVuY3Rpb24gKCkgeyBpLnJlc29sdmUodCkgfSB9KTsgcmV0dXJuIHRoaXMuZWwuYW5pbWF0ZSh0aGlzLmRpZmYsIHMpLCBpLnByb21pc2UoKSB9KSwgZS53aGVuLmFwcGx5KGUsIGguZ2V0KCkpLmRvbmUoZnVuY3Rpb24gKCkgeyBuKCksIGUuZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmVsOyBlLmVhY2godGhpcy5kaWZmLCBmdW5jdGlvbiAoZSkgeyB0LmNzcyhlLCAiIikgfSkgfSksIGwuY29tcGxldGUuY2FsbChyWzBdKSB9KSB9KSB9LCBlLmZuLmV4dGVuZCh7IGFkZENsYXNzOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGksIHMsIGEsIG4pIHsgcmV0dXJuIHMgPyBlLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcywgeyBhZGQ6IGkgfSwgcywgYSwgbikgOiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9KGUuZm4uYWRkQ2xhc3MpLCByZW1vdmVDbGFzczogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChpLCBzLCBhLCBuKSB7IHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGUuZWZmZWN0cy5hbmltYXRlQ2xhc3MuY2FsbCh0aGlzLCB7IHJlbW92ZTogaSB9LCBzLCBhLCBuKSA6IHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9IH0oZS5mbi5yZW1vdmVDbGFzcyksIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGksIHMsIGEsIG4sIHIpIHsgcmV0dXJuICJib29sZWFuIiA9PSB0eXBlb2YgcyB8fCB2b2lkIDAgPT09IHMgPyBhID8gZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMsIHMgPyB7IGFkZDogaSB9IDogeyByZW1vdmU6IGkgfSwgYSwgbiwgcikgOiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBlLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcywgeyB0b2dnbGU6IGkgfSwgcywgYSwgbikgfSB9KGUuZm4udG9nZ2xlQ2xhc3MpLCBzd2l0Y2hDbGFzczogZnVuY3Rpb24gKHQsIGksIHMsIGEsIG4pIHsgcmV0dXJuIGUuZWZmZWN0cy5hbmltYXRlQ2xhc3MuY2FsbCh0aGlzLCB7IGFkZDogaSwgcmVtb3ZlOiB0IH0sIHMsIGEsIG4pIH0gfSkgfSgpLCBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgaSwgcywgYSkgeyByZXR1cm4gZS5pc1BsYWluT2JqZWN0KHQpICYmIChpID0gdCwgdCA9IHQuZWZmZWN0KSwgdCA9IHsgZWZmZWN0OiB0IH0sIG51bGwgPT0gaSAmJiAoaSA9IHt9KSwgZS5pc0Z1bmN0aW9uKGkpICYmIChhID0gaSwgcyA9IG51bGwsIGkgPSB7fSksICgibnVtYmVyIiA9PSB0eXBlb2YgaSB8fCBlLmZ4LnNwZWVkc1tpXSkgJiYgKGEgPSBzLCBzID0gaSwgaSA9IHt9KSwgZS5pc0Z1bmN0aW9uKHMpICYmIChhID0gcywgcyA9IG51bGwpLCBpICYmIGUuZXh0ZW5kKHQsIGkpLCBzID0gcyB8fCBpLmR1cmF0aW9uLCB0LmR1cmF0aW9uID0gZS5meC5vZmYgPyAwIDogIm51bWJlciIgPT0gdHlwZW9mIHMgPyBzIDogcyBpbiBlLmZ4LnNwZWVkcyA/IGUuZnguc3BlZWRzW3NdIDogZS5meC5zcGVlZHMuX2RlZmF1bHQsIHQuY29tcGxldGUgPSBhIHx8IGkuY29tcGxldGUsIHQgfSBmdW5jdGlvbiBpKHQpIHsgcmV0dXJuICF0IHx8ICJudW1iZXIiID09IHR5cGVvZiB0IHx8IGUuZnguc3BlZWRzW3RdID8gITAgOiAic3RyaW5nIiAhPSB0eXBlb2YgdCB8fCBlLmVmZmVjdHMuZWZmZWN0W3RdID8gZS5pc0Z1bmN0aW9uKHQpID8gITAgOiAib2JqZWN0IiAhPSB0eXBlb2YgdCB8fCB0LmVmZmVjdCA/ICExIDogITAgOiAhMCB9IGZ1bmN0aW9uIHMoZSwgdCkgeyB2YXIgaSA9IHQub3V0ZXJXaWR0aCgpLCBzID0gdC5vdXRlckhlaWdodCgpLCBhID0gL15yZWN0XCgoLT9cZCpcLj9cZCpweHwtP1xkKyV8YXV0byksP1xzKigtP1xkKlwuP1xkKnB4fC0/XGQrJXxhdXRvKSw/XHMqKC0/XGQqXC4/XGQqcHh8LT9cZCslfGF1dG8pLD9ccyooLT9cZCpcLj9cZCpweHwtP1xkKyV8YXV0bylcKSQvLCBuID0gYS5leGVjKGUpIHx8IFsiIiwgMCwgaSwgcywgMF07IHJldHVybiB7IHRvcDogcGFyc2VGbG9hdChuWzFdKSB8fCAwLCByaWdodDogImF1dG8iID09PSBuWzJdID8gaSA6IHBhcnNlRmxvYXQoblsyXSksIGJvdHRvbTogImF1dG8iID09PSBuWzNdID8gcyA6IHBhcnNlRmxvYXQoblszXSksIGxlZnQ6IHBhcnNlRmxvYXQobls0XSkgfHwgMCB9IH0gZS5leHByICYmIGUuZXhwci5maWx0ZXJzICYmIGUuZXhwci5maWx0ZXJzLmFuaW1hdGVkICYmIChlLmV4cHIuZmlsdGVycy5hbmltYXRlZCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoaSkgeyByZXR1cm4gISFlKGkpLmRhdGEoZykgfHwgdChpKSB9IH0oZS5leHByLmZpbHRlcnMuYW5pbWF0ZWQpKSwgZS51aUJhY2tDb21wYXQgIT09ICExICYmIGUuZXh0ZW5kKGUuZWZmZWN0cywgeyBzYXZlOiBmdW5jdGlvbiAoZSwgdCkgeyBmb3IgKHZhciBpID0gMCwgcyA9IHQubGVuZ3RoOyBzID4gaTsgaSsrKW51bGwgIT09IHRbaV0gJiYgZS5kYXRhKG0gKyB0W2ldLCBlWzBdLnN0eWxlW3RbaV1dKSB9LCByZXN0b3JlOiBmdW5jdGlvbiAoZSwgdCkgeyBmb3IgKHZhciBpLCBzID0gMCwgYSA9IHQubGVuZ3RoOyBhID4gczsgcysrKW51bGwgIT09IHRbc10gJiYgKGkgPSBlLmRhdGEobSArIHRbc10pLCBlLmNzcyh0W3NdLCBpKSkgfSwgc2V0TW9kZTogZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuICJ0b2dnbGUiID09PSB0ICYmICh0ID0gZS5pcygiOmhpZGRlbiIpID8gInNob3ciIDogImhpZGUiKSwgdCB9LCBjcmVhdGVXcmFwcGVyOiBmdW5jdGlvbiAodCkgeyBpZiAodC5wYXJlbnQoKS5pcygiLnVpLWVmZmVjdHMtd3JhcHBlciIpKSByZXR1cm4gdC5wYXJlbnQoKTsgdmFyIGkgPSB7IHdpZHRoOiB0Lm91dGVyV2lkdGgoITApLCBoZWlnaHQ6IHQub3V0ZXJIZWlnaHQoITApLCAiZmxvYXQiOiB0LmNzcygiZmxvYXQiKSB9LCBzID0gZSgiPGRpdj48L2Rpdj4iKS5hZGRDbGFzcygidWktZWZmZWN0cy13cmFwcGVyIikuY3NzKHsgZm9udFNpemU6ICIxMDAlIiwgYmFja2dyb3VuZDogInRyYW5zcGFyZW50IiwgYm9yZGVyOiAibm9uZSIsIG1hcmdpbjogMCwgcGFkZGluZzogMCB9KSwgYSA9IHsgd2lkdGg6IHQud2lkdGgoKSwgaGVpZ2h0OiB0LmhlaWdodCgpIH0sIG4gPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OyB0cnkgeyBuLmlkIH0gY2F0Y2ggKHIpIHsgbiA9IGRvY3VtZW50LmJvZHkgfSByZXR1cm4gdC53cmFwKHMpLCAodFswXSA9PT0gbiB8fCBlLmNvbnRhaW5zKHRbMF0sIG4pKSAmJiBlKG4pLnRyaWdnZXIoImZvY3VzIiksIHMgPSB0LnBhcmVudCgpLCAic3RhdGljIiA9PT0gdC5jc3MoInBvc2l0aW9uIikgPyAocy5jc3MoeyBwb3NpdGlvbjogInJlbGF0aXZlIiB9KSwgdC5jc3MoeyBwb3NpdGlvbjogInJlbGF0aXZlIiB9KSkgOiAoZS5leHRlbmQoaSwgeyBwb3NpdGlvbjogdC5jc3MoInBvc2l0aW9uIiksIHpJbmRleDogdC5jc3MoInotaW5kZXgiKSB9KSwgZS5lYWNoKFsidG9wIiwgImxlZnQiLCAiYm90dG9tIiwgInJpZ2h0Il0sIGZ1bmN0aW9uIChlLCBzKSB7IGlbc10gPSB0LmNzcyhzKSwgaXNOYU4ocGFyc2VJbnQoaVtzXSwgMTApKSAmJiAoaVtzXSA9ICJhdXRvIikgfSksIHQuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIsIHRvcDogMCwgbGVmdDogMCwgcmlnaHQ6ICJhdXRvIiwgYm90dG9tOiAiYXV0byIgfSkpLCB0LmNzcyhhKSwgcy5jc3MoaSkuc2hvdygpIH0sIHJlbW92ZVdyYXBwZXI6IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsgcmV0dXJuIHQucGFyZW50KCkuaXMoIi51aS1lZmZlY3RzLXdyYXBwZXIiKSAmJiAodC5wYXJlbnQoKS5yZXBsYWNlV2l0aCh0KSwgKHRbMF0gPT09IGkgfHwgZS5jb250YWlucyh0WzBdLCBpKSkgJiYgZShpKS50cmlnZ2VyKCJmb2N1cyIpKSwgdCB9IH0pLCBlLmV4dGVuZChlLmVmZmVjdHMsIHsgdmVyc2lvbjogIjEuMTIuMSIsIGRlZmluZTogZnVuY3Rpb24gKHQsIGksIHMpIHsgcmV0dXJuIHMgfHwgKHMgPSBpLCBpID0gImVmZmVjdCIpLCBlLmVmZmVjdHMuZWZmZWN0W3RdID0gcywgZS5lZmZlY3RzLmVmZmVjdFt0XS5tb2RlID0gaSwgcyB9LCBzY2FsZWREaW1lbnNpb25zOiBmdW5jdGlvbiAoZSwgdCwgaSkgeyBpZiAoMCA9PT0gdCkgcmV0dXJuIHsgaGVpZ2h0OiAwLCB3aWR0aDogMCwgb3V0ZXJIZWlnaHQ6IDAsIG91dGVyV2lkdGg6IDAgfTsgdmFyIHMgPSAiaG9yaXpvbnRhbCIgIT09IGkgPyAodCB8fCAxMDApIC8gMTAwIDogMSwgYSA9ICJ2ZXJ0aWNhbCIgIT09IGkgPyAodCB8fCAxMDApIC8gMTAwIDogMTsgcmV0dXJuIHsgaGVpZ2h0OiBlLmhlaWdodCgpICogYSwgd2lkdGg6IGUud2lkdGgoKSAqIHMsIG91dGVySGVpZ2h0OiBlLm91dGVySGVpZ2h0KCkgKiBhLCBvdXRlcldpZHRoOiBlLm91dGVyV2lkdGgoKSAqIHMgfSB9LCBjbGlwVG9Cb3g6IGZ1bmN0aW9uIChlKSB7IHJldHVybiB7IHdpZHRoOiBlLmNsaXAucmlnaHQgLSBlLmNsaXAubGVmdCwgaGVpZ2h0OiBlLmNsaXAuYm90dG9tIC0gZS5jbGlwLnRvcCwgbGVmdDogZS5jbGlwLmxlZnQsIHRvcDogZS5jbGlwLnRvcCB9IH0sIHVuc2hpZnQ6IGZ1bmN0aW9uIChlLCB0LCBpKSB7IHZhciBzID0gZS5xdWV1ZSgpOyB0ID4gMSAmJiBzLnNwbGljZS5hcHBseShzLCBbMSwgMF0uY29uY2F0KHMuc3BsaWNlKHQsIGkpKSksIGUuZGVxdWV1ZSgpIH0sIHNhdmVTdHlsZTogZnVuY3Rpb24gKGUpIHsgZS5kYXRhKGYsIGVbMF0uc3R5bGUuY3NzVGV4dCkgfSwgcmVzdG9yZVN0eWxlOiBmdW5jdGlvbiAoZSkgeyBlWzBdLnN0eWxlLmNzc1RleHQgPSBlLmRhdGEoZikgfHwgIiIsIGUucmVtb3ZlRGF0YShmKSB9LCBtb2RlOiBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgaSA9IGUuaXMoIjpoaWRkZW4iKTsgcmV0dXJuICJ0b2dnbGUiID09PSB0ICYmICh0ID0gaSA/ICJzaG93IiA6ICJoaWRlIiksIChpID8gImhpZGUiID09PSB0IDogInNob3ciID09PSB0KSAmJiAodCA9ICJub25lIiksIHQgfSwgZ2V0QmFzZWxpbmU6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciBpLCBzOyBzd2l0Y2ggKGVbMF0pIHsgY2FzZSAidG9wIjogaSA9IDA7IGJyZWFrOyBjYXNlICJtaWRkbGUiOiBpID0gLjU7IGJyZWFrOyBjYXNlICJib3R0b20iOiBpID0gMTsgYnJlYWs7IGRlZmF1bHQ6IGkgPSBlWzBdIC8gdC5oZWlnaHQgfXN3aXRjaCAoZVsxXSkgeyBjYXNlICJsZWZ0IjogcyA9IDA7IGJyZWFrOyBjYXNlICJjZW50ZXIiOiBzID0gLjU7IGJyZWFrOyBjYXNlICJyaWdodCI6IHMgPSAxOyBicmVhazsgZGVmYXVsdDogcyA9IGVbMV0gLyB0LndpZHRoIH1yZXR1cm4geyB4OiBzLCB5OiBpIH0gfSwgY3JlYXRlUGxhY2Vob2xkZXI6IGZ1bmN0aW9uICh0KSB7IHZhciBpLCBzID0gdC5jc3MoInBvc2l0aW9uIiksIGEgPSB0LnBvc2l0aW9uKCk7IHJldHVybiB0LmNzcyh7IG1hcmdpblRvcDogdC5jc3MoIm1hcmdpblRvcCIpLCBtYXJnaW5Cb3R0b206IHQuY3NzKCJtYXJnaW5Cb3R0b20iKSwgbWFyZ2luTGVmdDogdC5jc3MoIm1hcmdpbkxlZnQiKSwgbWFyZ2luUmlnaHQ6IHQuY3NzKCJtYXJnaW5SaWdodCIpIH0pLm91dGVyV2lkdGgodC5vdXRlcldpZHRoKCkpLm91dGVySGVpZ2h0KHQub3V0ZXJIZWlnaHQoKSksIC9eKHN0YXRpY3xyZWxhdGl2ZSkvLnRlc3QocykgJiYgKHMgPSAiYWJzb2x1dGUiLCBpID0gZSgiPCIgKyB0WzBdLm5vZGVOYW1lICsgIj4iKS5pbnNlcnRBZnRlcih0KS5jc3MoeyBkaXNwbGF5OiAvXihpbmxpbmV8cnVieSkvLnRlc3QodC5jc3MoImRpc3BsYXkiKSkgPyAiaW5saW5lLWJsb2NrIiA6ICJibG9jayIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBtYXJnaW5Ub3A6IHQuY3NzKCJtYXJnaW5Ub3AiKSwgbWFyZ2luQm90dG9tOiB0LmNzcygibWFyZ2luQm90dG9tIiksIG1hcmdpbkxlZnQ6IHQuY3NzKCJtYXJnaW5MZWZ0IiksIG1hcmdpblJpZ2h0OiB0LmNzcygibWFyZ2luUmlnaHQiKSwgImZsb2F0IjogdC5jc3MoImZsb2F0IikgfSkub3V0ZXJXaWR0aCh0Lm91dGVyV2lkdGgoKSkub3V0ZXJIZWlnaHQodC5vdXRlckhlaWdodCgpKS5hZGRDbGFzcygidWktZWZmZWN0cy1wbGFjZWhvbGRlciIpLCB0LmRhdGEobSArICJwbGFjZWhvbGRlciIsIGkpKSwgdC5jc3MoeyBwb3NpdGlvbjogcywgbGVmdDogYS5sZWZ0LCB0b3A6IGEudG9wIH0pLCBpIH0sIHJlbW92ZVBsYWNlaG9sZGVyOiBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IG0gKyAicGxhY2Vob2xkZXIiLCBpID0gZS5kYXRhKHQpOyBpICYmIChpLnJlbW92ZSgpLCBlLnJlbW92ZURhdGEodCkpIH0sIGNsZWFuVXA6IGZ1bmN0aW9uICh0KSB7IGUuZWZmZWN0cy5yZXN0b3JlU3R5bGUodCksIGUuZWZmZWN0cy5yZW1vdmVQbGFjZWhvbGRlcih0KSB9LCBzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbiAodCwgaSwgcywgYSkgeyByZXR1cm4gYSA9IGEgfHwge30sIGUuZWFjaChpLCBmdW5jdGlvbiAoZSwgaSkgeyB2YXIgbiA9IHQuY3NzVW5pdChpKTsgblswXSA+IDAgJiYgKGFbaV0gPSBuWzBdICogcyArIG5bMV0pIH0pLCBhIH0gfSksIGUuZm4uZXh0ZW5kKHsgZWZmZWN0OiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGkodCkgeyBmdW5jdGlvbiBpKCkgeyBvLnJlbW92ZURhdGEoZyksIGUuZWZmZWN0cy5jbGVhblVwKG8pLCAiaGlkZSIgPT09IHMubW9kZSAmJiBvLmhpZGUoKSwgcigpIH0gZnVuY3Rpb24gcigpIHsgZS5pc0Z1bmN0aW9uKGwpICYmIGwuY2FsbChvWzBdKSwgZS5pc0Z1bmN0aW9uKHQpICYmIHQoKSB9IHZhciBvID0gZSh0aGlzKTsgcy5tb2RlID0gdS5zaGlmdCgpLCBlLnVpQmFja0NvbXBhdCA9PT0gITEgfHwgbiA/ICJub25lIiA9PT0gcy5tb2RlID8gKG9baF0oKSwgcigpKSA6IGEuY2FsbChvWzBdLCBzLCBpKSA6IChvLmlzKCI6aGlkZGVuIikgPyAiaGlkZSIgPT09IGggOiAic2hvdyIgPT09IGgpID8gKG9baF0oKSwgcigpKSA6IGEuY2FsbChvWzBdLCBzLCByKSB9IHZhciBzID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBhID0gZS5lZmZlY3RzLmVmZmVjdFtzLmVmZmVjdF0sIG4gPSBhLm1vZGUsIHIgPSBzLnF1ZXVlLCBvID0gciB8fCAiZngiLCBsID0gcy5jb21wbGV0ZSwgaCA9IHMubW9kZSwgdSA9IFtdLCBkID0gZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSBlKHRoaXMpLCBzID0gZS5lZmZlY3RzLm1vZGUoaSwgaCkgfHwgbjsgaS5kYXRhKGcsICEwKSwgdS5wdXNoKHMpLCBuICYmICgic2hvdyIgPT09IHMgfHwgcyA9PT0gbiAmJiAiaGlkZSIgPT09IHMpICYmIGkuc2hvdygpLCBuICYmICJub25lIiA9PT0gcyB8fCBlLmVmZmVjdHMuc2F2ZVN0eWxlKGkpLCBlLmlzRnVuY3Rpb24odCkgJiYgdCgpIH07IHJldHVybiBlLmZ4Lm9mZiB8fCAhYSA/IGggPyB0aGlzW2hdKHMuZHVyYXRpb24sIGwpIDogdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgbCAmJiBsLmNhbGwodGhpcykgfSkgOiByID09PSAhMSA/IHRoaXMuZWFjaChkKS5lYWNoKGkpIDogdGhpcy5xdWV1ZShvLCBkKS5xdWV1ZShvLCBpKSB9LCBzaG93OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHMpIHsgaWYgKGkocykpIHJldHVybiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IHZhciBhID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gYS5tb2RlID0gInNob3ciLCB0aGlzLmVmZmVjdC5jYWxsKHRoaXMsIGEpIH0gfShlLmZuLnNob3cpLCBoaWRlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHMpIHsgaWYgKGkocykpIHJldHVybiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IHZhciBhID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gYS5tb2RlID0gImhpZGUiLCB0aGlzLmVmZmVjdC5jYWxsKHRoaXMsIGEpIH0gfShlLmZuLmhpZGUpLCB0b2dnbGU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBmdW5jdGlvbiAocykgeyBpZiAoaShzKSB8fCAiYm9vbGVhbiIgPT0gdHlwZW9mIHMpIHJldHVybiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IHZhciBhID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gYS5tb2RlID0gInRvZ2dsZSIsIHRoaXMuZWZmZWN0LmNhbGwodGhpcywgYSkgfSB9KGUuZm4udG9nZ2xlKSwgY3NzVW5pdDogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB0aGlzLmNzcyh0KSwgcyA9IFtdOyByZXR1cm4gZS5lYWNoKFsiZW0iLCAicHgiLCAiJSIsICJwdCJdLCBmdW5jdGlvbiAoZSwgdCkgeyBpLmluZGV4T2YodCkgPiAwICYmIChzID0gW3BhcnNlRmxvYXQoaSksIHRdKSB9KSwgcyB9LCBjc3NDbGlwOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSA/IHRoaXMuY3NzKCJjbGlwIiwgInJlY3QoIiArIGUudG9wICsgInB4ICIgKyBlLnJpZ2h0ICsgInB4ICIgKyBlLmJvdHRvbSArICJweCAiICsgZS5sZWZ0ICsgInB4KSIpIDogcyh0aGlzLmNzcygiY2xpcCIpLCB0aGlzKSB9LCB0cmFuc2ZlcjogZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSBlKHRoaXMpLCBhID0gZSh0LnRvKSwgbiA9ICJmaXhlZCIgPT09IGEuY3NzKCJwb3NpdGlvbiIpLCByID0gZSgiYm9keSIpLCBvID0gbiA/IHIuc2Nyb2xsVG9wKCkgOiAwLCBsID0gbiA/IHIuc2Nyb2xsTGVmdCgpIDogMCwgaCA9IGEub2Zmc2V0KCksIHUgPSB7IHRvcDogaC50b3AgLSBvLCBsZWZ0OiBoLmxlZnQgLSBsLCBoZWlnaHQ6IGEuaW5uZXJIZWlnaHQoKSwgd2lkdGg6IGEuaW5uZXJXaWR0aCgpIH0sIGQgPSBzLm9mZnNldCgpLCBjID0gZSgiPGRpdiBjbGFzcz0ndWktZWZmZWN0cy10cmFuc2Zlcic+PC9kaXY+IikuYXBwZW5kVG8oImJvZHkiKS5hZGRDbGFzcyh0LmNsYXNzTmFtZSkuY3NzKHsgdG9wOiBkLnRvcCAtIG8sIGxlZnQ6IGQubGVmdCAtIGwsIGhlaWdodDogcy5pbm5lckhlaWdodCgpLCB3aWR0aDogcy5pbm5lcldpZHRoKCksIHBvc2l0aW9uOiBuID8gImZpeGVkIiA6ICJhYnNvbHV0ZSIgfSkuYW5pbWF0ZSh1LCB0LmR1cmF0aW9uLCB0LmVhc2luZywgZnVuY3Rpb24gKCkgeyBjLnJlbW92ZSgpLCBlLmlzRnVuY3Rpb24oaSkgJiYgaSgpIH0pIH0gfSksIGUuZnguc3RlcC5jbGlwID0gZnVuY3Rpb24gKHQpIHsgdC5jbGlwSW5pdCB8fCAodC5zdGFydCA9IGUodC5lbGVtKS5jc3NDbGlwKCksICJzdHJpbmciID09IHR5cGVvZiB0LmVuZCAmJiAodC5lbmQgPSBzKHQuZW5kLCB0LmVsZW0pKSwgdC5jbGlwSW5pdCA9ICEwKSwgZSh0LmVsZW0pLmNzc0NsaXAoeyB0b3A6IHQucG9zICogKHQuZW5kLnRvcCAtIHQuc3RhcnQudG9wKSArIHQuc3RhcnQudG9wLCByaWdodDogdC5wb3MgKiAodC5lbmQucmlnaHQgLSB0LnN0YXJ0LnJpZ2h0KSArIHQuc3RhcnQucmlnaHQsIGJvdHRvbTogdC5wb3MgKiAodC5lbmQuYm90dG9tIC0gdC5zdGFydC5ib3R0b20pICsgdC5zdGFydC5ib3R0b20sIGxlZnQ6IHQucG9zICogKHQuZW5kLmxlZnQgLSB0LnN0YXJ0LmxlZnQpICsgdC5zdGFydC5sZWZ0IH0pIH0gfSgpLCBmdW5jdGlvbiAoKSB7IHZhciB0ID0ge307IGUuZWFjaChbIlF1YWQiLCAiQ3ViaWMiLCAiUXVhcnQiLCAiUXVpbnQiLCAiRXhwbyJdLCBmdW5jdGlvbiAoZSwgaSkgeyB0W2ldID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIE1hdGgucG93KHQsIGUgKyAyKSB9IH0pLCBlLmV4dGVuZCh0LCB7IFNpbmU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAxIC0gTWF0aC5jb3MoZSAqIE1hdGguUEkgLyAyKSB9LCBDaXJjOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gMSAtIE1hdGguc3FydCgxIC0gZSAqIGUpIH0sIEVsYXN0aWM6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAwID09PSBlIHx8IDEgPT09IGUgPyBlIDogLU1hdGgucG93KDIsIDggKiAoZSAtIDEpKSAqIE1hdGguc2luKCg4MCAqIChlIC0gMSkgLSA3LjUpICogTWF0aC5QSSAvIDE1KSB9LCBCYWNrOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSAqIGUgKiAoMyAqIGUgLSAyKSB9LCBCb3VuY2U6IGZ1bmN0aW9uIChlKSB7IGZvciAodmFyIHQsIGkgPSA0OyAoKHQgPSBNYXRoLnBvdygyLCAtLWkpKSAtIDEpIC8gMTEgPiBlOyk7IHJldHVybiAxIC8gTWF0aC5wb3coNCwgMyAtIGkpIC0gNy41NjI1ICogTWF0aC5wb3coKDMgKiB0IC0gMikgLyAyMiAtIGUsIDIpIH0gfSksIGUuZWFjaCh0LCBmdW5jdGlvbiAodCwgaSkgeyBlLmVhc2luZ1siZWFzZUluIiArIHRdID0gaSwgZS5lYXNpbmdbImVhc2VPdXQiICsgdF0gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gMSAtIGkoMSAtIGUpIH0sIGUuZWFzaW5nWyJlYXNlSW5PdXQiICsgdF0gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gLjUgPiBlID8gaSgyICogZSkgLyAyIDogMSAtIGkoLTIgKiBlICsgMikgLyAyIH0gfSkgfSgpOyB2YXIgeSA9IGUuZWZmZWN0czsgZS5lZmZlY3RzLmRlZmluZSgiYmxpbmQiLCAiaGlkZSIsIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0geyB1cDogWyJib3R0b20iLCAidG9wIl0sIHZlcnRpY2FsOiBbImJvdHRvbSIsICJ0b3AiXSwgZG93bjogWyJ0b3AiLCAiYm90dG9tIl0sIGxlZnQ6IFsicmlnaHQiLCAibGVmdCJdLCBob3Jpem9udGFsOiBbInJpZ2h0IiwgImxlZnQiXSwgcmlnaHQ6IFsibGVmdCIsICJyaWdodCJdIH0sIGEgPSBlKHRoaXMpLCBuID0gdC5kaXJlY3Rpb24gfHwgInVwIiwgciA9IGEuY3NzQ2xpcCgpLCBvID0geyBjbGlwOiBlLmV4dGVuZCh7fSwgcikgfSwgbCA9IGUuZWZmZWN0cy5jcmVhdGVQbGFjZWhvbGRlcihhKTsgby5jbGlwW3Nbbl1bMF1dID0gby5jbGlwW3Nbbl1bMV1dLCAic2hvdyIgPT09IHQubW9kZSAmJiAoYS5jc3NDbGlwKG8uY2xpcCksIGwgJiYgbC5jc3MoZS5lZmZlY3RzLmNsaXBUb0JveChvKSksIG8uY2xpcCA9IHIpLCBsICYmIGwuYW5pbWF0ZShlLmVmZmVjdHMuY2xpcFRvQm94KG8pLCB0LmR1cmF0aW9uLCB0LmVhc2luZyksIGEuYW5pbWF0ZShvLCB7IHF1ZXVlOiAhMSwgZHVyYXRpb246IHQuZHVyYXRpb24sIGVhc2luZzogdC5lYXNpbmcsIGNvbXBsZXRlOiBpIH0pIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJib3VuY2UiLCBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSwgbiwgciA9IGUodGhpcyksIG8gPSB0Lm1vZGUsIGwgPSAiaGlkZSIgPT09IG8sIGggPSAic2hvdyIgPT09IG8sIHUgPSB0LmRpcmVjdGlvbiB8fCAidXAiLCBkID0gdC5kaXN0YW5jZSwgYyA9IHQudGltZXMgfHwgNSwgcCA9IDIgKiBjICsgKGggfHwgbCA/IDEgOiAwKSwgbSA9IHQuZHVyYXRpb24gLyBwLCBmID0gdC5lYXNpbmcsIGcgPSAidXAiID09PSB1IHx8ICJkb3duIiA9PT0gdSA/ICJ0b3AiIDogImxlZnQiLCB2ID0gInVwIiA9PT0gdSB8fCAibGVmdCIgPT09IHUsIHkgPSAwLCBfID0gci5xdWV1ZSgpLmxlbmd0aDsgZm9yIChlLmVmZmVjdHMuY3JlYXRlUGxhY2Vob2xkZXIociksIG4gPSByLmNzcyhnKSwgZCB8fCAoZCA9IHJbInRvcCIgPT09IGcgPyAib3V0ZXJIZWlnaHQiIDogIm91dGVyV2lkdGgiXSgpIC8gMyksIGggJiYgKGEgPSB7IG9wYWNpdHk6IDEgfSwgYVtnXSA9IG4sIHIuY3NzKCJvcGFjaXR5IiwgMCkuY3NzKGcsIHYgPyAyICogLWQgOiAyICogZCkuYW5pbWF0ZShhLCBtLCBmKSksIGwgJiYgKGQgLz0gTWF0aC5wb3coMiwgYyAtIDEpKSwgYSA9IHt9LCBhW2ddID0gbjsgYyA+IHk7IHkrKylzID0ge30sIHNbZ10gPSAodiA/ICItPSIgOiAiKz0iKSArIGQsIHIuYW5pbWF0ZShzLCBtLCBmKS5hbmltYXRlKGEsIG0sIGYpLCBkID0gbCA/IDIgKiBkIDogZCAvIDI7IGwgJiYgKHMgPSB7IG9wYWNpdHk6IDAgfSwgc1tnXSA9ICh2ID8gIi09IiA6ICIrPSIpICsgZCwgci5hbmltYXRlKHMsIG0sIGYpKSwgci5xdWV1ZShpKSwgZS5lZmZlY3RzLnVuc2hpZnQociwgXywgcCArIDEpIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJjbGlwIiwgImhpZGUiLCBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSA9IHt9LCBuID0gZSh0aGlzKSwgciA9IHQuZGlyZWN0aW9uIHx8ICJ2ZXJ0aWNhbCIsIG8gPSAiYm90aCIgPT09IHIsIGwgPSBvIHx8ICJob3Jpem9udGFsIiA9PT0gciwgaCA9IG8gfHwgInZlcnRpY2FsIiA9PT0gcjsgcyA9IG4uY3NzQ2xpcCgpLCBhLmNsaXAgPSB7IHRvcDogaCA/IChzLmJvdHRvbSAtIHMudG9wKSAvIDIgOiBzLnRvcCwgcmlnaHQ6IGwgPyAocy5yaWdodCAtIHMubGVmdCkgLyAyIDogcy5yaWdodCwgYm90dG9tOiBoID8gKHMuYm90dG9tIC0gcy50b3ApIC8gMiA6IHMuYm90dG9tLCBsZWZ0OiBsID8gKHMucmlnaHQgLSBzLmxlZnQpIC8gMiA6IHMubGVmdCB9LCBlLmVmZmVjdHMuY3JlYXRlUGxhY2Vob2xkZXIobiksICJzaG93IiA9PT0gdC5tb2RlICYmIChuLmNzc0NsaXAoYS5jbGlwKSwgYS5jbGlwID0gcyksIG4uYW5pbWF0ZShhLCB7IHF1ZXVlOiAhMSwgZHVyYXRpb246IHQuZHVyYXRpb24sIGVhc2luZzogdC5lYXNpbmcsIGNvbXBsZXRlOiBpIH0pIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJkcm9wIiwgImhpZGUiLCBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcywgYSA9IGUodGhpcyksIG4gPSB0Lm1vZGUsIHIgPSAic2hvdyIgPT09IG4sIG8gPSB0LmRpcmVjdGlvbiB8fCAibGVmdCIsIGwgPSAidXAiID09PSBvIHx8ICJkb3duIiA9PT0gbyA/ICJ0b3AiIDogImxlZnQiLCBoID0gInVwIiA9PT0gbyB8fCAibGVmdCIgPT09IG8gPyAiLT0iIDogIis9IiwgdSA9ICIrPSIgPT09IGggPyAiLT0iIDogIis9IiwgZCA9IHsgb3BhY2l0eTogMCB9OyBlLmVmZmVjdHMuY3JlYXRlUGxhY2Vob2xkZXIoYSksIHMgPSB0LmRpc3RhbmNlIHx8IGFbInRvcCIgPT09IGwgPyAib3V0ZXJIZWlnaHQiIDogIm91dGVyV2lkdGgiXSghMCkgLyAyLCBkW2xdID0gaCArIHMsIHIgJiYgKGEuY3NzKGQpLCBkW2xdID0gdSArIHMsIGQub3BhY2l0eSA9IDEpLCBhLmFuaW1hdGUoZCwgeyBxdWV1ZTogITEsIGR1cmF0aW9uOiB0LmR1cmF0aW9uLCBlYXNpbmc6IHQuZWFzaW5nLCBjb21wbGV0ZTogaSB9KSB9KSwgZS5lZmZlY3RzLmRlZmluZSgiZXhwbG9kZSIsICJoaWRlIiwgZnVuY3Rpb24gKHQsIGkpIHsgZnVuY3Rpb24gcygpIHsgXy5wdXNoKHRoaXMpLCBfLmxlbmd0aCA9PT0gZCAqIGMgJiYgYSgpIH0gZnVuY3Rpb24gYSgpIHsgcC5jc3MoeyB2aXNpYmlsaXR5OiAidmlzaWJsZSIgfSksIGUoXykucmVtb3ZlKCksIGkoKSB9IHZhciBuLCByLCBvLCBsLCBoLCB1LCBkID0gdC5waWVjZXMgPyBNYXRoLnJvdW5kKE1hdGguc3FydCh0LnBpZWNlcykpIDogMywgYyA9IGQsIHAgPSBlKHRoaXMpLCBtID0gdC5tb2RlLCBmID0gInNob3ciID09PSBtLCBnID0gcC5zaG93KCkuY3NzKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpLm9mZnNldCgpLCB2ID0gTWF0aC5jZWlsKHAub3V0ZXJXaWR0aCgpIC8gYyksIHkgPSBNYXRoLmNlaWwocC5vdXRlckhlaWdodCgpIC8gZCksIF8gPSBbXTsgZm9yIChuID0gMDsgZCA+IG47IG4rKylmb3IgKGwgPSBnLnRvcCArIG4gKiB5LCB1ID0gbiAtIChkIC0gMSkgLyAyLCByID0gMDsgYyA+IHI7IHIrKylvID0gZy5sZWZ0ICsgciAqIHYsIGggPSByIC0gKGMgLSAxKSAvIDIsIHAuY2xvbmUoKS5hcHBlbmRUbygiYm9keSIpLndyYXAoIjxkaXY+PC9kaXY+IikuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJ2aXNpYmxlIiwgbGVmdDogLXIgKiB2LCB0b3A6IC1uICogeSB9KS5wYXJlbnQoKS5hZGRDbGFzcygidWktZWZmZWN0cy1leHBsb2RlIikuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIG92ZXJmbG93OiAiaGlkZGVuIiwgd2lkdGg6IHYsIGhlaWdodDogeSwgbGVmdDogbyArIChmID8gaCAqIHYgOiAwKSwgdG9wOiBsICsgKGYgPyB1ICogeSA6IDApLCBvcGFjaXR5OiBmID8gMCA6IDEgfSkuYW5pbWF0ZSh7IGxlZnQ6IG8gKyAoZiA/IDAgOiBoICogdiksIHRvcDogbCArIChmID8gMCA6IHUgKiB5KSwgb3BhY2l0eTogZiA/IDEgOiAwIH0sIHQuZHVyYXRpb24gfHwgNTAwLCB0LmVhc2luZywgcykgfSksIGUuZWZmZWN0cy5kZWZpbmUoImZhZGUiLCAidG9nZ2xlIiwgZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSAic2hvdyIgPT09IHQubW9kZTsgZSh0aGlzKS5jc3MoIm9wYWNpdHkiLCBzID8gMCA6IDEpLmFuaW1hdGUoeyBvcGFjaXR5OiBzID8gMSA6IDAgfSwgeyBxdWV1ZTogITEsIGR1cmF0aW9uOiB0LmR1cmF0aW9uLCBlYXNpbmc6IHQuZWFzaW5nLCBjb21wbGV0ZTogaSB9KSB9KSwgZS5lZmZlY3RzLmRlZmluZSgiZm9sZCIsICJoaWRlIiwgZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSBlKHRoaXMpLCBhID0gdC5tb2RlLCBuID0gInNob3ciID09PSBhLCByID0gImhpZGUiID09PSBhLCBvID0gdC5zaXplIHx8IDE1LCBsID0gLyhbMC05XSspJS8uZXhlYyhvKSwgaCA9ICEhdC5ob3JpekZpcnN0LCB1ID0gaCA/IFsicmlnaHQiLCAiYm90dG9tIl0gOiBbImJvdHRvbSIsICJyaWdodCJdLCBkID0gdC5kdXJhdGlvbiAvIDIsIGMgPSBlLmVmZmVjdHMuY3JlYXRlUGxhY2Vob2xkZXIocyksIHAgPSBzLmNzc0NsaXAoKSwgbSA9IHsgY2xpcDogZS5leHRlbmQoe30sIHApIH0sIGYgPSB7IGNsaXA6IGUuZXh0ZW5kKHt9LCBwKSB9LCBnID0gW3BbdVswXV0sIHBbdVsxXV1dLCB2ID0gcy5xdWV1ZSgpLmxlbmd0aDsgbCAmJiAobyA9IHBhcnNlSW50KGxbMV0sIDEwKSAvIDEwMCAqIGdbciA/IDAgOiAxXSksIG0uY2xpcFt1WzBdXSA9IG8sIGYuY2xpcFt1WzBdXSA9IG8sIGYuY2xpcFt1WzFdXSA9IDAsIG4gJiYgKHMuY3NzQ2xpcChmLmNsaXApLCBjICYmIGMuY3NzKGUuZWZmZWN0cy5jbGlwVG9Cb3goZikpLCBmLmNsaXAgPSBwKSwgcy5xdWV1ZShmdW5jdGlvbiAoaSkgeyBjICYmIGMuYW5pbWF0ZShlLmVmZmVjdHMuY2xpcFRvQm94KG0pLCBkLCB0LmVhc2luZykuYW5pbWF0ZShlLmVmZmVjdHMuY2xpcFRvQm94KGYpLCBkLCB0LmVhc2luZyksIGkoKSB9KS5hbmltYXRlKG0sIGQsIHQuZWFzaW5nKS5hbmltYXRlKGYsIGQsIHQuZWFzaW5nKS5xdWV1ZShpKSwgZS5lZmZlY3RzLnVuc2hpZnQocywgdiwgNCkgfSksIGUuZWZmZWN0cy5kZWZpbmUoImhpZ2hsaWdodCIsICJzaG93IiwgZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSBlKHRoaXMpLCBhID0geyBiYWNrZ3JvdW5kQ29sb3I6IHMuY3NzKCJiYWNrZ3JvdW5kQ29sb3IiKSB9OyAiaGlkZSIgPT09IHQubW9kZSAmJiAoYS5vcGFjaXR5ID0gMCksIGUuZWZmZWN0cy5zYXZlU3R5bGUocyksIHMuY3NzKHsgYmFja2dyb3VuZEltYWdlOiAibm9uZSIsIGJhY2tncm91bmRDb2xvcjogdC5jb2xvciB8fCAiI2ZmZmY5OSIgfSkuYW5pbWF0ZShhLCB7IHF1ZXVlOiAhMSwgZHVyYXRpb246IHQuZHVyYXRpb24sIGVhc2luZzogdC5lYXNpbmcsIGNvbXBsZXRlOiBpIH0pIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJzaXplIiwgZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMsIGEsIG4sIHIgPSBlKHRoaXMpLCBvID0gWyJmb250U2l6ZSJdLCBsID0gWyJib3JkZXJUb3BXaWR0aCIsICJib3JkZXJCb3R0b21XaWR0aCIsICJwYWRkaW5nVG9wIiwgInBhZGRpbmdCb3R0b20iXSwgaCA9IFsiYm9yZGVyTGVmdFdpZHRoIiwgImJvcmRlclJpZ2h0V2lkdGgiLCAicGFkZGluZ0xlZnQiLCAicGFkZGluZ1JpZ2h0Il0sIHUgPSB0Lm1vZGUsIGQgPSAiZWZmZWN0IiAhPT0gdSwgYyA9IHQuc2NhbGUgfHwgImJvdGgiLCBwID0gdC5vcmlnaW4gfHwgWyJtaWRkbGUiLCAiY2VudGVyIl0sIG0gPSByLmNzcygicG9zaXRpb24iKSwgZiA9IHIucG9zaXRpb24oKSwgZyA9IGUuZWZmZWN0cy5zY2FsZWREaW1lbnNpb25zKHIpLCB2ID0gdC5mcm9tIHx8IGcsIHkgPSB0LnRvIHx8IGUuZWZmZWN0cy5zY2FsZWREaW1lbnNpb25zKHIsIDApOyBlLmVmZmVjdHMuY3JlYXRlUGxhY2Vob2xkZXIociksICJzaG93IiA9PT0gdSAmJiAobiA9IHYsIHYgPSB5LCB5ID0gbiksIGEgPSB7IGZyb206IHsgeTogdi5oZWlnaHQgLyBnLmhlaWdodCwgeDogdi53aWR0aCAvIGcud2lkdGggfSwgdG86IHsgeTogeS5oZWlnaHQgLyBnLmhlaWdodCwgeDogeS53aWR0aCAvIGcud2lkdGggfSB9LCAoImJveCIgPT09IGMgfHwgImJvdGgiID09PSBjKSAmJiAoYS5mcm9tLnkgIT09IGEudG8ueSAmJiAodiA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKHIsIGwsIGEuZnJvbS55LCB2KSwgeSA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKHIsIGwsIGEudG8ueSwgeSkpLCBhLmZyb20ueCAhPT0gYS50by54ICYmICh2ID0gZS5lZmZlY3RzLnNldFRyYW5zaXRpb24ociwgaCwgYS5mcm9tLngsIHYpLCB5ID0gZS5lZmZlY3RzLnNldFRyYW5zaXRpb24ociwgaCwgYS50by54LCB5KSkpLCAoImNvbnRlbnQiID09PSBjIHx8ICJib3RoIiA9PT0gYykgJiYgYS5mcm9tLnkgIT09IGEudG8ueSAmJiAodiA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKHIsIG8sIGEuZnJvbS55LCB2KSwgeSA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKHIsIG8sIGEudG8ueSwgeSkpLCBwICYmIChzID0gZS5lZmZlY3RzLmdldEJhc2VsaW5lKHAsIGcpLCB2LnRvcCA9IChnLm91dGVySGVpZ2h0IC0gdi5vdXRlckhlaWdodCkgKiBzLnkgKyBmLnRvcCwgdi5sZWZ0ID0gKGcub3V0ZXJXaWR0aCAtIHYub3V0ZXJXaWR0aCkgKiBzLnggKyBmLmxlZnQsIHkudG9wID0gKGcub3V0ZXJIZWlnaHQgLSB5Lm91dGVySGVpZ2h0KSAqIHMueSArIGYudG9wLCB5LmxlZnQgPSAoZy5vdXRlcldpZHRoIC0geS5vdXRlcldpZHRoKSAqIHMueCArIGYubGVmdCksIHIuY3NzKHYpLCAoImNvbnRlbnQiID09PSBjIHx8ICJib3RoIiA9PT0gYykgJiYgKGwgPSBsLmNvbmNhdChbIm1hcmdpblRvcCIsICJtYXJnaW5Cb3R0b20iXSkuY29uY2F0KG8pLCBoID0gaC5jb25jYXQoWyJtYXJnaW5MZWZ0IiwgIm1hcmdpblJpZ2h0Il0pLCByLmZpbmQoIipbd2lkdGhdIikuZWFjaChmdW5jdGlvbiAoKSB7IHZhciBpID0gZSh0aGlzKSwgcyA9IGUuZWZmZWN0cy5zY2FsZWREaW1lbnNpb25zKGkpLCBuID0geyBoZWlnaHQ6IHMuaGVpZ2h0ICogYS5mcm9tLnksIHdpZHRoOiBzLndpZHRoICogYS5mcm9tLngsIG91dGVySGVpZ2h0OiBzLm91dGVySGVpZ2h0ICogYS5mcm9tLnksIG91dGVyV2lkdGg6IHMub3V0ZXJXaWR0aCAqIGEuZnJvbS54IH0sIHIgPSB7IGhlaWdodDogcy5oZWlnaHQgKiBhLnRvLnksIHdpZHRoOiBzLndpZHRoICogYS50by54LCBvdXRlckhlaWdodDogcy5oZWlnaHQgKiBhLnRvLnksIG91dGVyV2lkdGg6IHMud2lkdGggKiBhLnRvLnggfTsgYS5mcm9tLnkgIT09IGEudG8ueSAmJiAobiA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGksIGwsIGEuZnJvbS55LCBuKSwgciA9IGUuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGksIGwsIGEudG8ueSwgcikpLCBhLmZyb20ueCAhPT0gYS50by54ICYmIChuID0gZS5lZmZlY3RzLnNldFRyYW5zaXRpb24oaSwgaCwgYS5mcm9tLngsIG4pLCByID0gZS5lZmZlY3RzLnNldFRyYW5zaXRpb24oaSwgaCwgYS50by54LCByKSksIGQgJiYgZS5lZmZlY3RzLnNhdmVTdHlsZShpKSwgaS5jc3MobiksIGkuYW5pbWF0ZShyLCB0LmR1cmF0aW9uLCB0LmVhc2luZywgZnVuY3Rpb24gKCkgeyBkICYmIGUuZWZmZWN0cy5yZXN0b3JlU3R5bGUoaSkgfSkgfSkpLCByLmFuaW1hdGUoeSwgeyBxdWV1ZTogITEsIGR1cmF0aW9uOiB0LmR1cmF0aW9uLCBlYXNpbmc6IHQuZWFzaW5nLCBjb21wbGV0ZTogZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHIub2Zmc2V0KCk7IDAgPT09IHkub3BhY2l0eSAmJiByLmNzcygib3BhY2l0eSIsIHYub3BhY2l0eSksIGQgfHwgKHIuY3NzKCJwb3NpdGlvbiIsICJzdGF0aWMiID09PSBtID8gInJlbGF0aXZlIiA6IG0pLm9mZnNldCh0KSwgZS5lZmZlY3RzLnNhdmVTdHlsZShyKSksIGkoKSB9IH0pIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJzY2FsZSIsIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gZSh0aGlzKSwgYSA9IHQubW9kZSwgbiA9IHBhcnNlSW50KHQucGVyY2VudCwgMTApIHx8ICgwID09PSBwYXJzZUludCh0LnBlcmNlbnQsIDEwKSA/IDAgOiAiZWZmZWN0IiAhPT0gYSA/IDAgOiAxMDApLCByID0gZS5leHRlbmQoITAsIHsgZnJvbTogZS5lZmZlY3RzLnNjYWxlZERpbWVuc2lvbnMocyksIHRvOiBlLmVmZmVjdHMuc2NhbGVkRGltZW5zaW9ucyhzLCBuLCB0LmRpcmVjdGlvbiB8fCAiYm90aCIpLCBvcmlnaW46IHQub3JpZ2luIHx8IFsibWlkZGxlIiwgImNlbnRlciJdIH0sIHQpOyB0LmZhZGUgJiYgKHIuZnJvbS5vcGFjaXR5ID0gMSwgci50by5vcGFjaXR5ID0gMCksIGUuZWZmZWN0cy5lZmZlY3Quc2l6ZS5jYWxsKHRoaXMsIHIsIGkpIH0pLCBlLmVmZmVjdHMuZGVmaW5lKCJwdWZmIiwgImhpZGUiLCBmdW5jdGlvbiAodCwgaSkgeyB2YXIgcyA9IGUuZXh0ZW5kKCEwLCB7fSwgdCwgeyBmYWRlOiAhMCwgcGVyY2VudDogcGFyc2VJbnQodC5wZXJjZW50LCAxMCkgfHwgMTUwIH0pOyBlLmVmZmVjdHMuZWZmZWN0LnNjYWxlLmNhbGwodGhpcywgcywgaSkgfSksIGUuZWZmZWN0cy5kZWZpbmUoInB1bHNhdGUiLCAic2hvdyIsIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzID0gZSh0aGlzKSwgYSA9IHQubW9kZSwgbiA9ICJzaG93IiA9PT0gYSwgciA9ICJoaWRlIiA9PT0gYSwgbyA9IG4gfHwgciwgbCA9IDIgKiAodC50aW1lcyB8fCA1KSArIChvID8gMSA6IDApLCBoID0gdC5kdXJhdGlvbiAvIGwsIHUgPSAwLCBkID0gMSwgYyA9IHMucXVldWUoKS5sZW5ndGg7IGZvciAoKG4gfHwgIXMuaXMoIjp2aXNpYmxlIikpICYmIChzLmNzcygib3BhY2l0eSIsIDApLnNob3coKSwgdSA9IDEpOyBsID4gZDsgZCsrKXMuYW5pbWF0ZSh7IG9wYWNpdHk6IHUgfSwgaCwgdC5lYXNpbmcpLCB1ID0gMSAtIHU7IHMuYW5pbWF0ZSh7IG9wYWNpdHk6IHUgfSwgaCwgdC5lYXNpbmcpLCBzLnF1ZXVlKGkpLCBlLmVmZmVjdHMudW5zaGlmdChzLCBjLCBsICsgMSkgfSksIGUuZWZmZWN0cy5kZWZpbmUoInNoYWtlIiwgZnVuY3Rpb24gKHQsIGkpIHsgdmFyIHMgPSAxLCBhID0gZSh0aGlzKSwgbiA9IHQuZGlyZWN0aW9uIHx8ICJsZWZ0IiwgciA9IHQuZGlzdGFuY2UgfHwgMjAsIG8gPSB0LnRpbWVzIHx8IDMsIGwgPSAyICogbyArIDEsIGggPSBNYXRoLnJvdW5kKHQuZHVyYXRpb24gLyBsKSwgdSA9ICJ1cCIgPT09IG4gfHwgImRvd24iID09PSBuID8gInRvcCIgOiAibGVmdCIsIGQgPSAidXAiID09PSBuIHx8ICJsZWZ0IiA9PT0gbiwgYyA9IHt9LCBwID0ge30sIG0gPSB7fSwgZiA9IGEucXVldWUoKS5sZW5ndGg7IGZvciAoZS5lZmZlY3RzLmNyZWF0ZVBsYWNlaG9sZGVyKGEpLCBjW3VdID0gKGQgPyAiLT0iIDogIis9IikgKyByLCBwW3VdID0gKGQgPyAiKz0iIDogIi09IikgKyAyICogciwgbVt1XSA9IChkID8gIi09IiA6ICIrPSIpICsgMiAqIHIsIGEuYW5pbWF0ZShjLCBoLCB0LmVhc2luZyk7IG8gPiBzOyBzKyspYS5hbmltYXRlKHAsIGgsIHQuZWFzaW5nKS5hbmltYXRlKG0sIGgsIHQuZWFzaW5nKTsgYS5hbmltYXRlKHAsIGgsIHQuZWFzaW5nKS5hbmltYXRlKGMsIGggLyAyLCB0LmVhc2luZykucXVldWUoaSksIGUuZWZmZWN0cy51bnNoaWZ0KGEsIGYsIGwgKyAxKSB9KSwgZS5lZmZlY3RzLmRlZmluZSgic2xpZGUiLCAic2hvdyIsIGZ1bmN0aW9uICh0LCBpKSB7IHZhciBzLCBhLCBuID0gZSh0aGlzKSwgciA9IHsgdXA6IFsiYm90dG9tIiwgInRvcCJdLCBkb3duOiBbInRvcCIsICJib3R0b20iXSwgbGVmdDogWyJyaWdodCIsICJsZWZ0Il0sIHJpZ2h0OiBbImxlZnQiLCAicmlnaHQiXSB9LCBvID0gdC5tb2RlLCBsID0gdC5kaXJlY3Rpb24gfHwgImxlZnQiLCBoID0gInVwIiA9PT0gbCB8fCAiZG93biIgPT09IGwgPyAidG9wIiA6ICJsZWZ0IiwgdSA9ICJ1cCIgPT09IGwgfHwgImxlZnQiID09PSBsLCBkID0gdC5kaXN0YW5jZSB8fCBuWyJ0b3AiID09PSBoID8gIm91dGVySGVpZ2h0IiA6ICJvdXRlcldpZHRoIl0oITApLCBjID0ge307IGUuZWZmZWN0cy5jcmVhdGVQbGFjZWhvbGRlcihuKSwgcyA9IG4uY3NzQ2xpcCgpLCBhID0gbi5wb3NpdGlvbigpW2hdLCBjW2hdID0gKHUgPyAtMSA6IDEpICogZCArIGEsIGMuY2xpcCA9IG4uY3NzQ2xpcCgpLCBjLmNsaXBbcltsXVsxXV0gPSBjLmNsaXBbcltsXVswXV0sICJzaG93IiA9PT0gbyAmJiAobi5jc3NDbGlwKGMuY2xpcCksIG4uY3NzKGgsIGNbaF0pLCBjLmNsaXAgPSBzLCBjW2hdID0gYSksIG4uYW5pbWF0ZShjLCB7IHF1ZXVlOiAhMSwgZHVyYXRpb246IHQuZHVyYXRpb24sIGVhc2luZzogdC5lYXNpbmcsIGNvbXBsZXRlOiBpIH0pIH0pOyB2YXIgeTsgZS51aUJhY2tDb21wYXQgIT09ICExICYmICh5ID0gZS5lZmZlY3RzLmRlZmluZSgidHJhbnNmZXIiLCBmdW5jdGlvbiAodCwgaSkgeyBlKHRoaXMpLnRyYW5zZmVyKHQsIGkpIH0pKQ0KICAgICAgICB9KTsNCiAgICB9KHhhSnF1ZXJ5KTsNCg0KICAgIHhhSnF1ZXJ5LnNob3VsZEluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiAhIXdpbmRvdy5TaXRlY29yZS5XZWJFZGl0U2V0dGluZ3MuZWRpdGluZzsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHhhSnF1ZXJ5Ow0KfSgpOw0K
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 398142
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20220630T091634Z
    - ID: "52807595-0f8f-4b20-8d2a-cb71d28c6103"
      Hint: __Owner
      Value: |
        sitecore\Admin
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\Admin
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "632e53f3-df00-498f-8ff8-c1c9495f5e32"
    - ID: "badd9cf9-53e0-4d0c-bcc0-2d784c282f6a"
      Hint: __Updated by
      Value: |
        sitecore\Admin
    - ID: "d9cf14b1-fa16-4ba6-9288-e8a174d4d522"
      Hint: __Updated
      Value: 20220630T091634Z
